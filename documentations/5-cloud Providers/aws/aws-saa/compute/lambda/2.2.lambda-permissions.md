# üîê **AWS Lambda Permissions: Managing Access and Security**

AWS Lambda permissions are essential for controlling what your Lambda functions can access and which services or users can invoke them. This guide provides a clear and simplified overview of Lambda permissions, including execution roles, S3 event notifications, and resource-based policies for cross-account access.

---

## üõ†Ô∏è **Execution Role**

Every AWS Lambda function requires an **IAM execution role** that grants the necessary permissions to interact with other AWS services and resources.

### üìå **Key Points:**

- **Purpose:** The execution role allows your Lambda function to **read, write, and perform actions** on other AWS services or resources.
- **Default Permissions:**
  - The **basic execution role** includes permissions for Lambda to **write logs to CloudWatch**.
- **Resource-Based Policies:**
  - Services like **S3** can **invoke or notify** the Lambda function through its **resource-based policy**.

![Lambda Execution Role](images/lambda-execution-role.png)

### üõ°Ô∏è **Responsibilities:**

- **AWS Responsibilities:**

  - **Manage Infrastructure:** AWS handles the underlying compute resources.
  - **Maintain Security:** AWS ensures the security of the compute and operating system resources.

- **Customer Responsibilities:**
  - **Supply Code:** Provide the application code that Lambda will execute.
  - **Manage Roles:** Create and update IAM roles and policies to define permissions.

---

## üì¶ **S3 Event Notifications**

AWS Lambda can **process event notifications** from Amazon S3, enabling automated responses to changes in your S3 buckets.

### üìå **Key Points:**

- **Event Types:**
  - Lambda functions can be triggered by events such as **object creation** or **deletion** in an S3 bucket.
- **Versioning Requirement:**
  - **Enable versioning** on the source S3 bucket to ensure all write actions trigger notifications.
- **Permissions:**
  - S3 requires permissions in the Lambda function‚Äôs **resource-based policy** to invoke the function.
- **Output Storage:**
  - If the Lambda function needs to **store output in an S3 bucket**, use a **different bucket** than the event source to avoid conflicts.

### üõ†Ô∏è **Configuration Steps:**

1. **Enable Versioning:**

   - Ensure that versioning is enabled on the S3 bucket to capture all events.

2. **Set Up Event Notifications:**

   - Configure S3 to send event notifications to the Lambda function for specific actions (e.g., object creation, deletion).

3. **Assign Permissions:**
   - Update the Lambda function‚Äôs resource-based policy to allow S3 to invoke the function.

---

## üîÑ **Lambda Resource-Based Policy & Cross-Account Access**

Lambda resource-based policies allow you to **grant permissions** to other AWS services or accounts to **invoke your Lambda functions**.

### üìå **Key Points:**

- **Resource-Based Policies:**
  - Define who can invoke your Lambda function and under what conditions.
- **Cross-Account Access:**
  - Use **IAM roles** to allow users or services from **different AWS accounts** to invoke your functions.

### üìù **Example Policy:**

Below is an example of a **resource-based policy** that allows S3 from a specific account to invoke a Lambda function:

```json
{
  "Version": "2012-10-17",
  "Id": "default",
  "Statement": [
    {
      "Sid": "lambda-allow-s3-my-function",
      "Effect": "Allow",
      "Principal": {
        "Service": "s3.amazonaws.com"
      },
      "Action": "lambda:InvokeFunction",
      "Resource": "arn:aws:lambda:us-east-2:123456789012:function:myfunction:*",
      "Condition": {
        "StringEquals": {
          "AWS:SourceAccount": "123456789012"
        },
        "ArnLike": {
          "AWS:SourceArn": "arn:aws:s3:::my-bucket"
        }
      }
    }
  ]
}
```

### üõ°Ô∏è **Components Explained:**

- **Version:** Specifies the policy language version.
- **Sid (Statement ID):** A unique identifier for the statement.
- **Effect:** Whether the statement allows or denies access (`Allow` in this case).
- **Principal:** The entity that is allowed or denied access (`s3.amazonaws.com`).
- **Action:** The specific action that is allowed (`lambda:InvokeFunction`).
- **Resource:** The ARN of the Lambda function being accessed.
- **Condition:** Additional constraints (e.g., source account and bucket).

### üõ†Ô∏è **Configuration Steps:**

1. **Navigate to Lambda Console:**

   - Go to the AWS Lambda console and select your function.

2. **Access Permissions:**

   - Under the **Permissions** tab, view the **resource-based policy**.

3. **Add or Modify Policy:**

   - Add statements to grant permissions to specific services or accounts as needed.

4. **Verify Access:**
   - Ensure that the specified principals can invoke the Lambda function according to the policy conditions.

---

## üèÅ **Conclusion**

Managing permissions in AWS Lambda is crucial for ensuring secure and efficient interactions with other AWS services and resources. By understanding and properly configuring **execution roles**, **S3 event notifications**, and **resource-based policies**, you can maintain robust security while leveraging the full potential of serverless computing.
