# AWS WAF 🆚 AWS Network Firewall

## AWS WAF

- **Primary Focus:** AWS WAF is designed to protect web applications by filtering and monitoring HTTP and HTTPS requests.
- **Scope:** It primarily operates at the application layer (Layer 7) of the OSI model.
- **Capabilities:** It can prevent attacks like SQL injection, cross-site scripting (XSS), and other web exploits.
- **Traffic Inspection:** Focuses on the content of web traffic, such as headers, URL strings, and body content.

## AWS Network Firewall

- **Primary Focus:** AWS Network Firewall provides protection for your entire network infrastructure.
- **Scope:** It operates at the network layer (Layer 3) of the OSI model.
- **Capabilities:** It can inspect and filter traffic based on IP addresses, ports, and protocols, providing more comprehensive network security.
- **Traffic Inspection:** Focuses on packets, including source and destination IPs, ports, and the contents of IP packets.

## Key Differences of Functionality

- **Layer of Operation:** AWS WAF operates at Layer 7 (application layer) and is focused on web traffic. AWS Network Firewall operates at Layer 3 (network layer) and inspects packets.
- **Traffic Type:** AWS WAF deals with HTTP/HTTPS traffic, whereas AWS Network Firewall handles all types of network traffic, including non-web traffic.
- **Security Focus:** AWS WAF is specialized in protecting web applications, while AWS Network Firewall provides broader network protection, including non-web applications and services.

## Key Differences of Request Lifecycle

### 🌐 Request Lifecycle with AWS WAF

1. **Route 53:**

   - The user makes a DNS request, which is resolved by Amazon Route 53.
   - **Route 53** routes the request directly to the **Application Load Balancer (ALB)**.

2. **Application Load Balancer (ALB):**

   - The ALB has AWS WAF associated with it. This means the request hits the ALB first.
   - The ALB forwards the request to **AWS WAF** for inspection.

3. **AWS WAF Inspection:**

   - **AWS WAF** inspects the request based on the defined Web ACL (rules for allowing, blocking, or counting requests).

4. **Back to ALB:**

   - If the request passes the WAF inspection, it is processed by the ALB again.
   - The ALB then forwards the allowed request to the EC2 instances.

5. **Auto Scaling Group (ASG):**

   - The ALB forwards the request to an EC2 instance managed by the ASG.
   - The ASG automatically adjusts the number of EC2 instances based on demand.

6. **EC2 Instance:**

   - The EC2 instance receives the request and processes it.
   - **Components:**
     - **EC2 Instance:** Runs your application (e.g., a web server).
     - **Security Groups:** Control inbound and outbound traffic to the EC2 instances.

7. **Response:**
   - The EC2 instance processes the request and sends a response back to the ALB.
   - The ALB then forwards the response back to the client.

### 🌐 Request Lifecycle with AWS Network Firewall

1. **Route 53:**

   - The user makes a DNS request, which is resolved by Amazon Route 53.
   - **Route 53** can route the request to a public IP of the Network Firewall if it is set up that way.

2. **AWS Network Firewall:**

   - The traffic is inspected by AWS Network Firewall based on the defined firewall policies.
   - **Inspection:** AWS Network Firewall evaluates the traffic against the rules defined in the policy.

3. **Application Load Balancer (ALB):**

   - If the traffic is allowed by AWS Network Firewall, it reaches the ALB.
   - The ALB distributes the incoming traffic to the EC2 instances in the target group.

4. **Auto Scaling Group (ASG):**

   - The ALB forwards the request to an EC2 instance managed by the ASG.
   - The ASG automatically adjusts the number of EC2 instances based on demand.

5. **EC2 Instance:**

   - The EC2 instance receives the request and processes it.
   - **Components:**
     - **EC2 Instance:** Runs your application (e.g., a web server).
     - **Security Groups:** Control inbound and outbound traffic to the EC2 instances.

6. **Response:**
   - The EC2 instance processes the request and sends a response back to the ALB.
   - The ALB then forwards the response back to the client.

### Summary of DNS Resolution and Request Lifecycle

- **With AWS WAF:**

  - **Route 53** -> **ALB** -> **AWS WAF** -> **ALB** -> **ASG (EC2 instances)** -> **Client**

- **With AWS Network Firewall:**
  - **Route 53** -> **AWS Network Firewall** -> **ALB** -> **ASG (EC2 instances)** -> **Client**

## Summary

In summary, while AWS WAF is excellent for securing web applications at the application layer, AWS Network Firewall is better suited for comprehensive network security at the packet level. They complement each other by providing layered security for different aspects of your AWS environment.
