# **IAM Role - Advanced Overview üîë**

An **IAM Role** is a powerful AWS feature that enables flexible, temporary, and secure access to AWS resources. Unlike IAM users, IAM roles do not have long-term credentials like passwords or access keys. Instead, they use **STS temporary credentials**, which are dynamically created and expire after a set time period.

> Think of an IAM role as a _costume_ or _badge_ that gives you specific powers (permissions) to perform tasks in AWS.

## **Key Characteristics:**

- **No Long-Term Credentials**: IAM roles do not store passwords or access keys. They rely on temporary **STS credentials**.
- **Assumable by Anyone**: Unlike IAM users, an IAM role can be assumed by:

  - **IAM users** within the same or different AWS accounts.
  - **AWS services** like EC2, Lambda, and S3.
  - **Federated users** (non-IAM users) authenticated through an external identity provider.

**Why use IAM roles?**  
With IAM roles, you do not need to manage long-term security credentials for every entity that needs access to your AWS resources, which improves security and reduces the overhead of credential management.

## üè∑Ô∏è **The Key Policies for IAM Roles**

### 1. **Trust Policy üîë**

- It is resource based policy that attach inline to iam role
- Decides _who_ is allowed to assume (wear) the role. Example: "Only EC2 instances can wear this role."

### 2. **Permissions Policy üìù**

- it is identity based policy that attached to iam role
- Specifies _what_ the role can do once assumed. Example: "This role can read objects from S3 buckets."

### ü§î **Why Do Users Need Another Policy?**

Before a user (or service) can wear a role, they need their own **policy** granting the `sts:AssumeRole` action.  
Without this, it‚Äôs like having a costume but no ticket to enter the party.

---

## üîç **Three Real-World Examples**

### 1Ô∏è‚É£ **EC2 Instance Reading from S3**

üìñ **Scenario:**

You want an EC2 instance to access S3 without hardcoding access keys.

ü™ú **Steps:**

1. **Prepare a Trust Policy**:  
   This allows EC2 instances to assume the role.

   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Principal": {
           "Service": "ec2.amazonaws.com"
         },
         "Action": "sts:AssumeRole"
       }
     ]
   }
   ```

2. **Create the Role**:

   ```sh
   aws iam create-role --role-name EC2Role --assume-role-policy-document file://trust-policy.json
   ```

3. **Attach a Permissions Policy**:  
   Give the role the power to read S3:

   ```sh
   aws iam attach-role-policy --role-name EC2Role --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
   ```

4. **Assign the Role to the EC2 Instance**:
   During EC2 launch, attach the role:

   ```sh
   aws ec2 run-instances --image-id ami-0abcdef1234567890 --count 1 --instance-type t2.micro --iam-instance-profile Name=EC2Role
   ```

‚úÖ **Result:** The EC2 instance can now read data from S3 using the role‚Äôs permissions.

---

### 2Ô∏è‚É£ **Lambda Function Logging to CloudWatch**

üìñ **Scenario:**

You have a Lambda function that needs to log its activity in CloudWatch.

ü™ú **Steps:**

1. **Prepare a Trust Policy**:  
   This allows Lambda to assume the role.

   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Principal": {
           "Service": "lambda.amazonaws.com"
         },
         "Action": "sts:AssumeRole"
       }
     ]
   }
   ```

2. **Create the Role**:

   ```sh
   aws iam create-role --role-name LambdaExecutionRole --assume-role-policy-document file://trust-policy.json
   ```

3. **Attach a Permissions Policy**:  
   Allow the role to write logs to CloudWatch:

   ```sh
   aws iam attach-role-policy --role-name LambdaExecutionRole --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
   ```

4. **Assign the Role to the Lambda Function**:
   While creating the Lambda function:

   ```sh
   aws lambda create-function --function-name MyLambdaFunction --runtime python3.8 --role arn:aws:iam::123456789012:role/LambdaExecutionRole --handler lambda_function.lambda_handler --zip-file fileb://my-deployment-package.zip
   ```

‚úÖ **Result:** The Lambda function logs its activity in CloudWatch.

---

### 3Ô∏è‚É£ **Cross-Account Role for Read-Only Access**

üìñ **Scenario:**

You need a user in another AWS account to read your S3 buckets.

ü™ú **Steps:**

1. **Prepare a Trust Policy**:  
   Allow the other account (e.g., 123456789012) to assume the role.

   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Principal": {
           "AWS": "arn:aws:iam::123456789012:root"
         },
         "Action": "sts:AssumeRole"
       }
     ]
   }
   ```

2. **Create the Role**:

   ```sh
   aws iam create-role --role-name CrossAccountRole --assume-role-policy-document file://trust-policy.json
   ```

3. **Attach a Permissions Policy**:  
   Allow the role to have read-only access to S3:

   ```sh
   aws iam attach-role-policy --role-name CrossAccountRole --policy-arn arn:aws:iam::aws:policy/ReadOnlyAccess
   ```

4. **Grant the User Permission to Assume the Role**:  
   In the trusted account, attach this policy to the user:

   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Action": "sts:AssumeRole",
         "Resource": "arn:aws:iam::YOUR_ACCOUNT_ID:role/CrossAccountRole"
       }
     ]
   }
   ```

5. **Assume the Role**:
   The user in the trusted account assumes the role:

   ```sh
   aws sts assume-role --role-arn arn:aws:iam::YOUR_ACCOUNT_ID:role/CrossAccountRole --role-session-name MySession
   ```

‚úÖ **Result:** The user gains temporary credentials for read-only access to your S3 buckets.

---

## üéØ **Quick Recap**

- **Role**: A costume with superpowers.
- **Trust Policy**: Decides who can wear the costume.
- **Permissions Policy**: Defines what the costume can do.
- **User Policy**: Your ticket to wear the costume.
