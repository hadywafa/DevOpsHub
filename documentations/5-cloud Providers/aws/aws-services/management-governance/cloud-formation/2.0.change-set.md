# **ğŸ”„ AWS CloudFormation Change Sets: Safely Updating Infrastructure**

## **ğŸ“Œ Introduction**

AWS CloudFormation **Change Sets** allow you to preview **modifications to your infrastructure** before applying them.

âœ” **Prevents accidental changes** that could disrupt workloads.  
âœ” **Provides a detailed preview** of added, modified, and removed resources.  
âœ” **Ensures safe updates** to AWS resources with rollback protection.

---

## **ğŸ—ï¸ How Change Sets Work (Step-by-Step)**

Change Sets follow a **four-step lifecycle**:

```mermaid
sequenceDiagram
    autonumber
    participant User as AWS Developer / Admin
    participant CloudFormation as AWS CloudFormation
    participant AWSResources as AWS Services (EC2, RDS, S3)

    Note over User: ğŸ”¹ Creates a CloudFormation stack update request

    User->>CloudFormation: 1ï¸âƒ£ Submit Change Set Request
    CloudFormation->>AWSResources: 2ï¸âƒ£ Compare Existing Stack with New Template
    AWSResources->>CloudFormation: 3ï¸âƒ£ Generate Change Set Summary
    CloudFormation->>User: 4ï¸âƒ£ Display Change Set Preview âœ…

    Note over User: ğŸ”¹ Reviews the proposed changes

    User->>CloudFormation: 5ï¸âƒ£ Execute Change Set
    CloudFormation->>AWSResources: 6ï¸âƒ£ Apply Updates to Resources
    AWSResources->>CloudFormation: 7ï¸âƒ£ Return Success/Failure
    CloudFormation->>User: âœ… Stack Successfully Updated
```

---

## **ğŸ“œ Creating a Change Set in AWS CloudFormation**

A **Change Set** is created when modifying an existing CloudFormation **stack**.

### **1ï¸âƒ£ Create a Change Set via AWS CLI**

```sh
aws cloudformation create-change-set \
    --stack-name MyStack \
    --template-body file://updated_template.yaml \
    --change-set-name MyChangeSet
```

âœ… **Submits a change request to AWS CloudFormation.**

---

### **2ï¸âƒ£ View the Change Set Summary**

```sh
aws cloudformation describe-change-set --change-set-name MyChangeSet --stack-name MyStack
```

âœ… **Displays all planned modifications before execution.**

Example **Change Set Output**:

```json
{
  "Changes": [
    {
      "ResourceChange": {
        "Action": "Modify",
        "LogicalResourceId": "MyEC2Instance",
        "ResourceType": "AWS::EC2::Instance",
        "Replacement": "True",
        "Scope": ["Properties"],
        "Details": [
          {
            "Target": {
              "Attribute": "InstanceType",
              "Name": "InstanceType",
              "RequiresRecreation": "Always"
            },
            "ChangeSource": "DirectModification",
            "Evaluation": "Static"
          }
        ]
      }
    }
  ]
}
```

ğŸ”¹ **In this example**:

- The **EC2 instance type** is changing.
- **Instance recreation is required** due to a major change.

âœ… **Allows verification of the impact before deployment.**

---

### **3ï¸âƒ£ Execute the Change Set**

```sh
aws cloudformation execute-change-set --change-set-name MyChangeSet --stack-name MyStack
```

âœ… **Applies the changes to the stack.**

---

### **4ï¸âƒ£ Deleting a Change Set (If Not Needed)**

```sh
aws cloudformation delete-change-set --change-set-name MyChangeSet --stack-name MyStack
```

âœ… **Cancels an unwanted update.**

---

## **ğŸ”„ Understanding Change Set Actions**

A Change Set can **add, modify, or remove resources**.

| **Action** | **Description**                       |
| ---------- | ------------------------------------- |
| **Add**    | A new resource will be created.       |
| **Modify** | An existing resource will be updated. |
| **Remove** | A resource will be deleted.           |

---

## **ğŸ”„ Change Set vs Direct Stack Updates**

| **Feature**                     | **Change Set** | **Direct Stack Update** |
| ------------------------------- | -------------- | ----------------------- |
| **Preview of changes**          | âœ… Yes         | âŒ No                   |
| **Rollback on failure**         | âœ… Yes         | âŒ No                   |
| **Safe updates**                | âœ… Yes         | âš  Risky                 |
| **Visibility before execution** | âœ… Yes         | âŒ No                   |

---

## **ğŸ“œ Best Practices for Using Change Sets**

âœ… **Always create a Change Set before modifying a stack.**  
âœ… **Use `describe-change-set` to review modifications before execution.**  
âœ… **Verify if resources require replacement (`Replacement: True`).**  
âœ… **Test updates in a separate environment before applying to production.**  
âœ… **Use IAM least privilege principles to restrict Change Set execution.**

---

## ğŸ“ **Conclusion**

AWS CloudFormation **Change Sets** provide a **safe and controlled approach** to updating AWS infrastructure.

âœ” **Prevents unexpected downtime by previewing updates.**  
âœ” **Improves visibility of infrastructure changes.**  
âœ” **Ensures secure and predictable AWS deployments.**
