# üîí **Amazon S3 Access Policies**

Amazon S3 **Access Policies** are essential for controlling who can access your S3 buckets and objects, ensuring data security and compliance. Understanding how to effectively implement and manage these policies is crucial for solution architects to design secure and efficient storage solutions. This guide explores the different types of access policies available in S3, their features, and best practices for implementation.

---

## üîê **Access Policies Overview**

Access policies in Amazon S3 can be categorized into two primary types:

- **Identity-Based Policies:** Policies attached to IAM users, groups, or roles that define their permissions.
- **Resource-Based Policies:** Policies attached directly to S3 resources (buckets or objects) that define who can access them.

Both S3 buckets and Glacier vaults support IAM resource-based policies, with Glacier vaults utilizing **Vault Access Policies**.

### **Policy Types:**

1. **Access Control Lists (ACLs):**

   - **Format:** XML
   - **Grants:** Up to 100 grants per policy
   - **Scope:** Can be applied at the bucket or object level

2. **Bucket Policies:**
   - **Format:** JSON
   - **Size Limit:** Up to 20KB per policy
   - **Scope:** Applied only at the bucket level

---

## üõ†Ô∏è **Understanding Object Ownership in S3**

**Object Ownership** determines which AWS account owns the objects within an S3 bucket. Properly configuring object ownership is vital for managing access and ensuring security.

### **Key Points:**

- **Default Privacy:** Objects and buckets are private by default.
- **Ownership:** Every resource in AWS is owned by an AWS account.
- **Bucket Owner:** The account that created the bucket is the resource owner.

### **Object Ownership Options:**

![S3 Object Ownership](images/s3-object-ownership.png)

- **Bucket Owner Preferred:**

  - The bucket owner automatically owns every object in the bucket.
  - Access control is managed exclusively through policies, eliminating the need for ACLs.

- **Object Writer:**
  - The account that uploads the object is the object owner.
  - Useful in cross-account scenarios but can complicate access management.

**Recommendation:** Disable ACLs and use **Object Ownership** with policy-based access controls unless ACLs are absolutely necessary.

---

## üõ°Ô∏è **Using Access Control Lists (ACLs)**

While ACLs provide a way to grant basic permissions, they are **not recommended** due to their complexity and limited flexibility.

### **Key Points:**

- **Structure:** Each bucket and object has an ACL as a sub-resource.
- **Purpose:** Defines which AWS accounts or groups are granted access and the type of access.
- **Limitations:**
  - Complexity in managing multiple grants
  - Limited to basic permission settings

### **Best Practices:**

- **Disable ACLs:** Use **Object Ownership** to enforce bucket ownership and manage access through policies.
- **Policy-Based Access:** Rely on IAM policies, bucket policies, and other policy types for more granular and manageable access control.

---

## üîë **Using Resource Policies**

Resource policies provide a powerful and flexible way to manage access to your S3 buckets and objects. They allow you to define permissions that apply to all or specific objects within a bucket.

### **Types of Resource Policies:**

1. **ü™£ Bucket Policies:**

   - **Scope:** Applied at the bucket level
   - **Format:** JSON
   - **Use Cases:** Granting cross-account access, enforcing encryption, restricting access based on conditions

2. **üì¶ Vault Access Policies (Glacier):**
   - **Scope:** Applied to Glacier vaults
   - **Format:** JSON
   - **Use Cases:** Similar to bucket policies but specific to Glacier vaults

### **Advantages:**

- **Granular Control:** Define precise permissions and conditions for access.
- **Centralized Management:** Manage access for all objects within a bucket from a single policy.
- **Flexibility:** Use conditions to enforce specific access requirements, such as IP address restrictions or encryption mandates.

### **Examples**

#### 1Ô∏è‚É£ **Granting Public Read Access**

This example grants **public read access** to all objects in the S3 bucket `hw-bucket-01`.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicRead",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": ["arn:aws:s3:::hw-bucket-01/*"]
    }
  ]
}
```

---

#### 2Ô∏è‚É£ **Cross-Account Uploads**

Allows another AWS account to upload objects to your bucket but restricts them to a specific storage class.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "statement1",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::AccountB-ID:user/Ahmed"
      },
      "Action": "s3:PutObject",
      "Resource": ["arn:aws:s3:::hw-bucket-01/*"],
      "Condition": {
        "StringEquals": {
          "s3:x-amz-storage-class": ["STANDARD_IA"]
        }
      }
    }
  ]
}
```

---

#### 3Ô∏è‚É£ **Cross-Account Object Uploads - Public Read Access**

Allows specified AWS accounts to upload objects with public read access.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AddCannedAcl",
      "Effect": "Allow",
      "Principal": {
        "AWS": ["arn:aws:iam::accountA-ID:root", "arn:aws:iam::accountB-ID:root"]
      },
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::hw-bucket-01/*",
      "Condition": {
        "StringEquals": {
          "s3:x-amz-acl": "public-read"
        }
      }
    }
  ]
}
```

---

#### 4Ô∏è‚É£ **Object Uploads - Enforcing Encryption**

Enforces that all object uploads use AWS KMS-managed encryption.

```json
{
  "Version": "2012-10-17",
  "Id": "PutObjectPolicy",
  "Statement": [
    {
      "Sid": "DenyUnEncryptedObjectUploads",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::hw-bucket-01/*",
      "Condition": {
        "StringNotEquals": {
          "s3:x-amz-server-side-encryption": "aws:kms"
        }
      }
    }
  ]
}
```

**Explanation:**

- **Condition:** Denies any `PutObject` request that does not include `s3:x-amz-server-side-encryption` set to `aws:kms`.
- **Effect:** Ensures that all objects uploaded to the bucket are encrypted using AWS KMS-managed keys.
