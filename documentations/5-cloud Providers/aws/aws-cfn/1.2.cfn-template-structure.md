# **AWS CloudFormation Template Structure üìú**

A **CloudFormation template** is a **JSON or YAML file** that defines **AWS resources, configurations, and dependencies**. It acts as a blueprint for **automating infrastructure deployment** in AWS.

‚úî **Declarative Syntax** ‚Äì `WHAT YOU NEED`.  
‚úî **Reusable & Scalable** ‚Äì Use the same template across multiple environments.  
‚úî **Automatic Dependency Management** ‚Äì Ensures resources are created in the correct order.

---

## üîë **Key Sections in a CloudFormation Template**

A CloudFormation template consists of **six primary sections**:

| **Section**                  | **Purpose**                                            |
| ---------------------------- | ------------------------------------------------------ |
| **AWSTemplateFormatVersion** | Specifies the CloudFormation template version.         |
| **Description**              | A brief description of the template's purpose.         |
| **Metadata**                 | Provides additional information about the template.    |
| **Parameters**               | Defines user-supplied input values.                    |
| **Mappings**                 | Creates lookup tables for region-specific settings.    |
| **Conditions**               | Specifies conditions to control resource creation.     |
| **Resources** üî•             | **Defines AWS resources (Required).**                  |
| **Outputs**                  | Returns useful values (e.g., instance IDs, endpoints). |

---

## üèóÔ∏è **CloudFormation Template Structure**

```yaml
AWSTemplateFormatVersion: "2010-09-09"

Description: "CloudFormation template to deploy an EC2 instance."

Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
          default: "Instance Configuration"
        Parameters:
          - InstanceType
          - KeyName

Parameters:
  InstanceType:
    Description: "EC2 instance type."
    Type: String
    Default: "t2.micro"
    AllowedValues: ["t2.micro", "t2.small", "t2.medium"]

  KeyName:
    Description: "Name of the EC2 KeyPair."
    Type: AWS::EC2::KeyPair::KeyName

Mappings:
  RegionMap:
    us-east-1:
      AMI: "ami-12345678"
    us-west-2:
      AMI: "ami-87654321"

Conditions:
  CreateProdInstance: !Equals [!Ref AWS::Region, "us-east-1"]

Resources:
  MyEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: !Ref InstanceType
      ImageId: !FindInMap [RegionMap, !Ref AWS::Region, AMI]
      KeyName: !Ref KeyName
      Tags:
        - Key: Name
          Value: "CloudFormation-EC2"

Outputs:
  InstanceID:
    Description: "EC2 Instance ID"
    Value: !Ref MyEC2Instance
```

‚úÖ **This YAML template provisions an EC2 instance based on user-specified parameters.**  
‚úÖ **The template dynamically selects the correct AMI based on the region.**

---

## üõ†Ô∏è **Detailed Explanation of Each Section**

### **1Ô∏è‚É£ AWSTemplateFormatVersion**

Defines the **CloudFormation template version** (always `2010-09-09`).

```yaml
AWSTemplateFormatVersion: "2010-09-09"
```

---

### **2Ô∏è‚É£ Description**

A short **human-readable description** of the template.

```yaml
Description: "CloudFormation template to deploy an EC2 instance."
```

---

### **3Ô∏è‚É£ Metadata**

Stores **extra template details** (e.g., UI hints in the AWS Console).

```yaml
Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
          default: "Instance Configuration"
        Parameters:
          - InstanceType
          - KeyName
```

‚úÖ **This groups parameters in the AWS Console UI.**

---

### **4Ô∏è‚É£ Parameters**

Allows users to **customize input values** (e.g., instance type, key pair).

```yaml
Parameters:
  InstanceType:
    Description: "EC2 instance type."
    Type: String
    Default: "t2.micro"
    AllowedValues: ["t2.micro", "t2.small", "t2.medium"]

  KeyName:
    Description: "Name of the EC2 KeyPair."
    Type: AWS::EC2::KeyPair::KeyName
```

‚úÖ **Allows users to define instance types dynamically.**

---

### **5Ô∏è‚É£ Mappings**

Defines **lookup tables** (e.g., region-specific AMI IDs).

```yaml
Mappings:
  RegionMap:
    us-east-1:
      AMI: "ami-12345678"
    us-west-2:
      AMI: "ami-87654321"
```

‚úÖ **Automatically selects the right AMI based on AWS Region.**

---

### **6Ô∏è‚É£ Conditions**

Controls **resource creation** based on logic.

```yaml
Conditions:
  CreateProdInstance: !Equals [!Ref AWS::Region, "us-east-1"]
```

‚úÖ **Only provisions resources in `us-east-1`.**

---

### **7Ô∏è‚É£ Resources (Required Section) ‚úÖ**

Defines AWS **resources like EC2, S3, RDS, IAM, and VPC**.

```yaml
Resources:
  MyEC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: !Ref InstanceType
      ImageId: !FindInMap [RegionMap, !Ref AWS::Region, AMI]
      KeyName: !Ref KeyName
      Tags:
        - Key: Name
          Value: "CloudFormation-EC2"
```

‚úÖ **Creates an EC2 instance with dynamic properties.**

---

### **8Ô∏è‚É£ Outputs**

Returns **useful information** (e.g., Instance ID, Database Endpoint).

```yaml
Outputs:
  InstanceID:
    Description: "EC2 Instance ID"
    Value: !Ref MyEC2Instance
```

‚úÖ **Displays instance details after stack creation.**

---

## üîë **Intrinsic Functions in CloudFormation**

AWS CloudFormation supports **intrinsic functions** for dynamic configurations.

| **Function** | **Purpose**                         | **Example**                                     |
| ------------ | ----------------------------------- | ----------------------------------------------- |
| `!Ref`       | References a parameter or resource  | `!Ref MyEC2Instance`                            |
| `!Sub`       | String substitution                 | `!Sub "Instance ID: ${MyEC2Instance}"`          |
| `!FindInMap` | Retrieves values from a mapping     | `!FindInMap [RegionMap, !Ref AWS::Region, AMI]` |
| `!Join`      | Joins multiple values into a string | `!Join [", ", ["Value1", "Value2"]]`            |
| `!GetAtt`    | Retrieves a resource‚Äôs attribute    | `!GetAtt MyEC2Instance.PublicIp`                |

---

## üöÄ **Best Practices for CloudFormation Templates**

‚úÖ **Use YAML instead of JSON** for readability.  
‚úÖ **Leverage Parameters, Mappings, and Conditions** for reusable templates.  
‚úÖ **Implement Outputs** to retrieve useful resource details.  
‚úÖ **Use Change Sets** before updating stacks to prevent accidental changes.  
‚úÖ **Store CloudFormation Templates in Version Control (GitHub, CodeCommit).**
