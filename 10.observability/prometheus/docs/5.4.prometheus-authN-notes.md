# üß© Best Practices for Prometheus Authentication

## üéØ Purpose

Now that you understand:

- how Prometheus authenticates _to_ exporters,
- how to protect _its own_ web interface,

‚Ä¶it‚Äôs time to combine both into a **secure, enterprise-ready architecture** üß±

---

## üß≠ 1Ô∏è‚É£ Core Security Principles

| Principle                | Description                                                                    |
| ------------------------ | ------------------------------------------------------------------------------ |
| **üîí Defense in Depth**  | Use multiple layers (TLS + Auth + Network restrictions).                       |
| **üîê Least Privilege**   | Give Prometheus only what it needs ‚Äî read-only tokens, restricted certs.       |
| **üïµÔ∏è Secret Separation** | Never hardcode passwords/tokens directly into config files.                    |
| **üîÅ Regular Rotation**  | Rotate credentials, tokens, and certs regularly.                               |
| **üåç Network Isolation** | Run Prometheus and exporters on a private network (no direct Internet access). |

---

## üß© 2Ô∏è‚É£ Real-World Authentication Setup

Let‚Äôs look at what a **secure production setup** typically looks like üëá

```mermaid
flowchart LR
    U[User / Grafana] -->|OAuth2 or SSO| RP[Nginx / Traefik Reverse Proxy]
    RP -->|HTTPS| P[Prometheus Server]
    P -->|Basic Auth / Bearer Token / mTLS| E1[Node Exporter]
    P -->|Bearer Token| E2[App Exporter]
    P -->|mTLS| E3[Database Exporter]
    P -->|Basic Auth| A[Alertmanager]
```

---

## ‚öôÔ∏è 3Ô∏è‚É£ How Each Layer is Secured

| Component                           | Auth Type                                 | Why It‚Äôs Needed                                 |
| ----------------------------------- | ----------------------------------------- | ----------------------------------------------- |
| **Prometheus ‚Üí Exporter**           | Basic / Token / TLS                       | Ensures only trusted Prometheus scrapes metrics |
| **Prometheus ‚Üí Alertmanager**       | Basic / TLS                               | Protects alert traffic                          |
| **Prometheus UI**                   | Basic Auth (web.yml) / OAuth2 (via proxy) | Prevents unauthorized access to data            |
| **Reverse Proxy (Nginx / Traefik)** | OAuth2 / LDAP / SAML                      | Enables enterprise login and SSO                |
| **Network Layer (Firewall / SGs)**  | IP Whitelisting                           | Ensures only Prometheus can reach exporters     |

---

## üîë 4Ô∏è‚É£ Credential Management Best Practices

| Area                      | Recommendation                                                  |
| ------------------------- | --------------------------------------------------------------- |
| **Passwords**             | Use bcrypt-hashed values in `web.yml`.                          |
| **Tokens**                | Store in separate files and reference with `bearer_token_file`. |
| **Certificates**          | Store in `/etc/prometheus/certs`, protect permissions (600).    |
| **Secrets Rotation**      | Automate with Vault / AWS Secrets Manager / Azure Key Vault.    |
| **Environment Variables** | Avoid using them for long-term secrets ‚Äî use files instead.     |

---

## üß± 5Ô∏è‚É£ Secure Network Layout Example

| Zone               | Components                          | Access Control                            |
| ------------------ | ----------------------------------- | ----------------------------------------- |
| **Private Subnet** | Prometheus, Alertmanager, Exporters | Only Prometheus IPs allowed               |
| **Public Subnet**  | Reverse Proxy (Nginx)               | Authenticates users, routes HTTPS traffic |
| **Internet**       | Users, Grafana                      | Access only through the proxy             |

‚úÖ This ensures:

- Exporters aren‚Äôt exposed publicly.
- Prometheus is reachable only via proxy.
- Metrics can‚Äôt be scraped or viewed without login.

---

## üîß 6Ô∏è‚É£ Combining TLS + Auth (Common Company Pattern)

Many companies combine both:

```yaml
scrape_configs:
  - job_name: "secure_exporter"
    scheme: https
    basic_auth:
      username: "prometheus"
      password: "S3cur3Pa55"
    tls_config:
      ca_file: "/etc/prometheus/certs/ca.crt"
      cert_file: "/etc/prometheus/certs/client.crt"
      key_file: "/etc/prometheus/certs/client.key"
      insecure_skip_verify: false
```

üß© Why?
Because:

- **TLS** = encrypts traffic + server identity
- **Basic Auth** = extra identity layer for access control

This combo is called **multi-layer authentication**, common in regulated industries (finance, telecom, healthcare).

---

## üß† 7Ô∏è‚É£ Enterprise Authentication Integration

Larger setups integrate Prometheus with:

- **SSO / LDAP / Azure Entra ID / Okta** via reverse proxy
- **Vault** or **Secrets Manager** for token/cert rotation
- **Mutual TLS** between components
- **Private CA** to issue and trust certificates

---

## üß© 8Ô∏è‚É£ Summary Cheat Sheet

| What                          | Where               | Recommended Method                                 |
| ----------------------------- | ------------------- | -------------------------------------------------- |
| **Prometheus ‚Üí Exporter**     | `scrape_configs`    | `basic_auth`, `bearer_token_file`, or `tls_config` |
| **Prometheus ‚Üí Alertmanager** | `alerting:` section | `basic_auth` or `tls_config`                       |
| **Prometheus Web UI**         | `--web.config.file` | `web.yml` (Basic) or Reverse Proxy (OAuth2)        |
| **Enterprise Security**       | Front proxy + mTLS  | Nginx / Traefik + corporate SSO                    |

---

## üèÅ Final Thought

Prometheus gives you **no authentication by default**, but full flexibility to add the layers you need.
The key is to **treat Prometheus like a service**, not a toy dashboard ‚Äî
so it‚Äôs protected by:

- üîê **Authentication**
- üß± **Network isolation**
- üß© **TLS encryption**
- üîÅ **Secret rotation**
