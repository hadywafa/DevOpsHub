# **Node Exporter install guide**

you can follow on any Linux host. I‚Äôll cover:

1. Direct (run the binary)
2. systemd service (production-friendly)
3. Docker + one-liner
4. Docker Compose + persistent labels
5. Hook it into Prometheus (scrape config)
6. Quick troubleshooting & hardening tips

You can copy-paste as you go. I‚Äôll use a `VERSION` variable so you can bump it easily.

---

## üß© 1) Direct install (run the binary)

### Step 1: Download & extract

```bash
# Pick a version; update as needed
VERSION="1.8.1"
PKG="node_exporter-${VERSION}.linux-amd64"
TAR="${PKG}.tar.gz"

wget "https://github.com/prometheus/node_exporter/releases/download/v${VERSION}/${TAR}"
tar -xvf "${TAR}"
cd "${PKG}"
ls -l   # you should see: node_exporter, LICENSE, NOTICE
```

### Step 2: Run it

```bash
./node_exporter
```

- Default listen address: `:9100`
- Open your browser (or curl):

  ```bash
  curl -s http://localhost:9100/metrics | head
  ```

  You should see Prometheus-style metrics.

> Tip: run it in the background for quick tests:

```bash
nohup ./node_exporter > node_exporter.log 2>&1 &
```

---

## ‚öôÔ∏è 2) systemd service (recommended on VMs/bare metal)

### Step 1: Create a dedicated user

```bash
sudo useradd --no-create-home --shell /bin/false node_exporter || true
```

### Step 2: Install the binary to PATH

(If you didn‚Äôt download yet, do it first‚Äîsame as section 1.)

```bash
VERSION="1.8.1"
PKG="node_exporter-${VERSION}.linux-amd64"
sudo cp "${PKG}/node_exporter" /usr/local/bin/
sudo chown node_exporter:node_exporter /usr/local/bin/node_exporter
```

### Step 3: Create the service unit

```bash
sudo tee /etc/systemd/system/node_exporter.service >/dev/null <<'EOF'
[Unit]
Description=Prometheus Node Exporter
Wants=network-online.target
After=network-online.target

[Service]
User=node_exporter
Group=node_exporter
Type=simple
# Adjust flags as needed (examples commented)
# --collector.systemd --collector.tcpstat --collector.processes
ExecStart=/usr/local/bin/node_exporter \
  --web.listen-address=:9100

# Basic hardening
NoNewPrivileges=true
ProtectSystem=full
ProtectHome=true
PrivateTmp=true
ProtectKernelTunables=true
ProtectKernelModules=true
ProtectControlGroups=true
LockPersonality=true

[Install]
WantedBy=multi-user.target
EOF
```

### Step 4: Start & enable

```bash
sudo systemctl daemon-reload
sudo systemctl start node_exporter
sudo systemctl enable node_exporter
sudo systemctl status node_exporter --no-pager
```

### Step 5: Verify

```bash
curl -s http://localhost:9100/metrics | head
```

If the host firewall is enabled and you need remote access:

```bash
# Ubuntu UFW example
sudo ufw allow 9100/tcp
```

---

## üê≥ 3) Run with Docker (single command)

### Create a small config dir (optional, just for labeling)

```bash
mkdir -p ./node-exporter
```

### Run the container

```bash
docker run -d \
  --name node-exporter \
  -p 9100:9100 \
  --restart unless-stopped \
  --pid="host" \
  -v "/:/host:ro,rslave" \
  prom/node-exporter:latest \
  --path.rootfs=/host
```

- `--pid="host"` and `--path.rootfs=/host` let Node Exporter see host-level metrics from inside the container.

Verify:

```bash
curl -s http://localhost:9100/metrics | head
```

---

## üß© 4) Docker Compose

`docker-compose.yml`:

```yaml
version: "3.8"

services:
  node-exporter:
    image: prom/node-exporter:latest
    container_name: node-exporter
    restart: unless-stopped
    network_mode: "host"
    pid: "host"
    volumes:
      - "/:/host:ro,rslave"
    command:
      - "--path.rootfs=/host"
```

Run it:

```bash
docker compose up -d
# or: docker-compose up -d
```

Verify:

```bash
curl -s http://localhost:9100/metrics | head
```

> Using `network_mode: host` avoids port mapping hassles and matches host IP:9100.

---

## üîó 5) Add Node Exporter to Prometheus (scrape config)

Open your Prometheus server‚Äôs `prometheus.yml` and add a job like:

```yaml
scrape_configs:
  - job_name: "node"
    static_configs:
      - targets: ["localhost:9100"] # or "server-ip:9100"
```

Reload Prometheus (depends on how you run it):

- **If you used the direct binary**: send SIGHUP or restart.
- **systemd**:

  ```bash
  sudo systemctl reload prometheus || sudo systemctl restart prometheus
  ```

- **Docker**: restart the container.

Then in Prometheus UI ‚Üí **Status ‚Üí Targets**, you should see job `node` as **UP**.

---

## üß™ 6) Quick test queries (PromQL)

Try some common node metrics:

```promql
# CPU utilization per core (rate over 5m)
rate(node_cpu_seconds_total{mode!="idle"}[5m])

# Memory used (bytes)
node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes

# Disk free bytes per mount
node_filesystem_free_bytes{fstype!~"tmpfs|overlay"}

# Network receive bytes per interface (rate over 5m)
rate(node_network_receive_bytes_total[5m])
```

---

## üõ°Ô∏è Hardening & tuning tips

- Listen only on specific interfaces if needed:

  ```bash
  # systemd ExecStart addition
  --web.listen-address=0.0.0.0:9100
  # or bind to private IP only
  --web.listen-address=10.0.0.10:9100
  ```

- Use an ingress proxy (Nginx/Traefik) for TLS & auth if you must expose publicly.
- Limit collectors (only what you need), e.g.:

  ```bash
  --collector.disable-defaults --collector.cpu --collector.meminfo --collector.filesystem
  ```

- Watch the filesystem: **exclude** pseudo/ephemeral mounts with relabeling (Prometheus-side) or careful `node_filesystem_*` filtering in queries/alerts.

---

## üßØ Troubleshooting

- **Port in use**:
  `sudo lsof -i :9100` ‚Üí kill or change port with `--web.listen-address`
- **No metrics shown**:
  Check logs: `journalctl -u node_exporter -e` (systemd) or `docker logs node-exporter`
- **Targets down in Prometheus**:
  Verify network path, firewalls, and that Prometheus `targets` list has the correct host/IP:port
