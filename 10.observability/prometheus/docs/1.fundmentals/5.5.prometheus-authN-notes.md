# âœ… **Best Practices for Prometheus Authentication**

## ğŸ¯ **Purpose**

Now that you understand:

- how Prometheus authenticates _to_ exporters,
- how to protect _its own_ web interface,

â€¦itâ€™s time to combine both into a **secure, enterprise-ready architecture** ğŸ§±

---

## ğŸ§­ **Core Security Principles**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Principle                | Description                                                                    |
| ------------------------ | ------------------------------------------------------------------------------ |
| **ğŸ”’ Defense in Depth**  | Use multiple layers (TLS + Auth + Network restrictions).                       |
| **ğŸ” Least Privilege**   | Give Prometheus only what it needs â€” read-only tokens, restricted certs.       |
| **ğŸ•µï¸ Secret Separation** | Never hardcode passwords/tokens directly into config files.                    |
| **ğŸ” Regular Rotation**  | Rotate credentials, tokens, and certs regularly.                               |
| **ğŸŒ Network Isolation** | Run Prometheus and exporters on a private network (no direct Internet access). |

</div>

---

## ğŸ’­ **Real-World Authentication Setup**

Letâ€™s look at what a **secure production setup** typically looks like ğŸ‘‡

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

```mermaid
flowchart LR
    U[User / Grafana] -->|OAuth2 or SSO| RP[Nginx / Traefik Reverse Proxy]
    RP -->|HTTPS| P[Prometheus Server]
    P -->|Basic Auth / Bearer Token / mTLS| E1[Node Exporter]
    P -->|Bearer Token| E2[App Exporter]
    P -->|mTLS| E3[Database Exporter]
    P -->|Basic Auth| A[Alertmanager]
```

</div>

---

## âš™ï¸ **How Each Layer is Secured**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Component                           | Auth Type                                 | Why Itâ€™s Needed                                 |
| ----------------------------------- | ----------------------------------------- | ----------------------------------------------- |
| **Prometheus â†’ Exporter**           | Basic / Token / TLS                       | Ensures only trusted Prometheus scrapes metrics |
| **Prometheus â†’ Alertmanager**       | Basic / TLS                               | Protects alert traffic                          |
| **Prometheus UI**                   | Basic Auth (web.yml) / OAuth2 (via proxy) | Prevents unauthorized access to data            |
| **Reverse Proxy (Nginx / Traefik)** | OAuth2 / LDAP / SAML                      | Enables enterprise login and SSO                |
| **Network Layer (Firewall / SGs)**  | IP Whitelisting                           | Ensures only Prometheus can reach exporters     |

</div>

---

## ğŸ”‘ **Credential Management Best Practices**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Area                      | Recommendation                                                  |
| ------------------------- | --------------------------------------------------------------- |
| **Passwords**             | Use bcrypt-hashed values in `web.yml`.                          |
| **Tokens**                | Store in separate files and reference with `bearer_token_file`. |
| **Certificates**          | Store in `/etc/prometheus/certs`, protect permissions (600).    |
| **Secrets Rotation**      | Automate with Vault / AWS Secrets Manager / Azure Key Vault.    |
| **Environment Variables** | Avoid using them for long-term secrets â€” use files instead.     |

</div>

---

## ğŸŒ **Secure Network Layout Example**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Zone               | Components                          | Access Control                            |
| ------------------ | ----------------------------------- | ----------------------------------------- |
| **Private Subnet** | Prometheus, Alertmanager, Exporters | Only Prometheus IPs allowed               |
| **Public Subnet**  | Reverse Proxy (Nginx)               | Authenticates users, routes HTTPS traffic |
| **Internet**       | Users, Grafana                      | Access only through the proxy             |

</div>

---

âœ… This ensures:

- Exporters arenâ€™t exposed publicly.
- Prometheus is reachable only via proxy.
- Metrics canâ€™t be scraped or viewed without login.

---

## ğŸ”§ **Combining TLS + Auth** (Common Company Pattern)

Many companies combine both:

```yaml
scrape_configs:
  - job_name: "secure_exporter"
    scheme: https
    basic_auth:
      username: "prometheus"
      password: "S3cur3Pa55"
    tls_config:
      ca_file: "/etc/prometheus/certs/ca.crt"
      cert_file: "/etc/prometheus/certs/client.crt"
      key_file: "/etc/prometheus/certs/client.key"
      insecure_skip_verify: false
```

ğŸ§© Why?  
Because:

- **TLS** = encrypts traffic + server identity
- **Basic Auth** = extra identity layer for access control

This combo is called **multi-layer authentication**, common in regulated industries (finance, telecom, healthcare).

---

## ğŸ£ **Enterprise Authentication Integration**

Larger setups integrate Prometheus with:

- **SSO / LDAP / Azure Entra ID / Okta** via reverse proxy
- **Vault** or **Secrets Manager** for token/cert rotation
- **Mutual TLS** between components
- **Private CA** to issue and trust certificates

---

## âœ… **Summary**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| What                          | Where               | Recommended Method                                 |
| ----------------------------- | ------------------- | -------------------------------------------------- |
| **Prometheus â†’ Exporter**     | `scrape_configs`    | `basic_auth`, `bearer_token_file`, or `tls_config` |
| **Prometheus â†’ Alertmanager** | `alerting:` section | `basic_auth` or `tls_config`                       |
| **Prometheus Web UI**         | `--web.config.file` | `web.yml` (Basic) or Reverse Proxy (OAuth2)        |
| **Enterprise Security**       | Front proxy + mTLS  | Nginx / Traefik + corporate SSO                    |

</div>

---

## ğŸ **Final Thought**

Prometheus gives you **no authentication by default**, but full flexibility to add the layers you need.
The key is to **treat Prometheus like a service**, not a toy dashboard â€”
so itâ€™s protected by:

- ğŸ” **Authentication**
- ğŸ§± **Network isolation**
- ğŸ§© **TLS encryption**
- ğŸ” **Secret rotation**
