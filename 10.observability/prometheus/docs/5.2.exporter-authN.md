# ðŸ§© Authenticating Exporters (Targets)

## ðŸŽ¯ Goal

Prometheus must **pull metrics** from many endpoints called **exporters** (like Node Exporter, MySQL Exporter, or custom app exporters).
If those endpoints are **secured**, Prometheus needs credentials or certificates to access them.

So, hereâ€™s the key idea ðŸ‘‡

> Prometheus doesnâ€™t expect exporters to log in to _it_.
> Prometheus itself must authenticate _to them._

---

## ðŸ” Three Main Authentication Methods

| Method           | Description                                   | Real Use Case                           |
| ---------------- | --------------------------------------------- | --------------------------------------- |
| **Basic Auth**   | Username + password                           | Exporters behind web servers like Nginx |
| **Bearer Token** | Token or API key (JWT, service account)       | APIs, Kubernetes endpoints              |
| **TLS / mTLS**   | Certificates used for identity and encryption | Enterprise or zero-trust environments   |

---

## ðŸ§± 1ï¸âƒ£ Basic Authentication

### âœ… Example

If your exporter is protected by Basic Auth:

```yaml
scrape_configs:
  - job_name: "secure_node"
    static_configs:
      - targets: ["node1:9101"]
    basic_auth:
      username: "prometheus"
      password: "s3cr3t"
```

Prometheus automatically adds this header when scraping:

```ini
Authorization: Basic cHJvbWV0aGV1czpzM2NyM3Q=
```

(Base64-encoded `prometheus:s3cr3t`)

âœ… Used when exporters sit behind **Nginx**, **Traefik**, or a **simple app-level auth**.

---

## ðŸ”‘ 2ï¸âƒ£ Bearer Token Authentication

### âœ… Example

Bearer tokens (like API keys or JWTs) are common in Kubernetes or APIs.

```yaml
scrape_configs:
  - job_name: "k8s_api"
    static_configs:
      - targets: ["https://kubernetes.default.svc"]
    bearer_token_file: "/var/run/secrets/kubernetes.io/serviceaccount/token"
    tls_config:
      ca_file: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
```

Prometheus sends this header:

```ini
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

âœ… This is how Prometheus authenticates with **Kubernetes API servers** or secured exporters.

---

## ðŸªª 3ï¸âƒ£ TLS / Mutual TLS (mTLS)

### âœ… Example

When both Prometheus and the exporter must prove who they are:

```yaml
scrape_configs:
  - job_name: "mtls_exporter"
    scheme: https
    static_configs:
      - targets: ["secure-node:9443"]
    tls_config:
      ca_file: "/etc/prometheus/certs/ca.crt"
      cert_file: "/etc/prometheus/certs/client.crt"
      key_file: "/etc/prometheus/certs/client.key"
      insecure_skip_verify: false
```

Here:

- The **exporter** has a server certificate (HTTPS)
- Prometheus has a **client certificate**
- Both sides trust the same **CA**
- Connection is **encrypted + authenticated** (mutual TLS)

âœ… Used in **enterprises**, **banks**, **production clusters**, or **zero-trust setups**

---

## ðŸ§© How Prometheus Handles Failed Auth

Prometheus shows scrape issues in its UI (Targets tab):

```ini
server returned HTTP status 401 Unauthorized
```

Common causes:

- Wrong username/password (Basic)
- Expired token (Bearer)
- Untrusted cert / expired cert (TLS)
- Wrong file paths in `tls_config`

---

## ðŸ§  Best Practices for Exporter Authentication

| Practice                             | Reason                                              |
| ------------------------------------ | --------------------------------------------------- |
| **Use HTTPS**                        | Always encrypt traffic                              |
| **Avoid inline passwords/tokens**    | Use secret files or mounts                          |
| **Rotate tokens/certs periodically** | Prevent stale credentials                           |
| **Restrict exporter IP access**      | Prometheus-only access (firewall or network policy) |
| **Use mTLS for high security**       | Prevent spoofed Prometheus clients                  |
| **Check Prometheus logs**            | Detect scrape or auth failures quickly              |

---

## ðŸ—ºï¸ Visual Summary

```mermaid
flowchart LR
A[Prometheus] -->|Basic Auth| B[Exporter (Nginx Proxy)]
A -->|Bearer Token| C[Kubernetes API / Custom Exporter]
A -->|mTLS| D[Enterprise Exporter with Certs]
```

---

## ðŸ§© TL;DR

| Method           | Secure? | Auth Type         | Use Case                            |
| ---------------- | ------- | ----------------- | ----------------------------------- |
| **Basic Auth**   | âœ…      | Username/Password | Nginx / simple HTTP exporter        |
| **Bearer Token** | âœ…      | Token-based       | Kubernetes / APIs                   |
| **TLS / mTLS**   | âœ…âœ…    | Cert-based        | Enterprise-grade, zero-trust setups |
