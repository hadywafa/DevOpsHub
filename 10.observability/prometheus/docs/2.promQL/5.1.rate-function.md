# âš¡ï¸ PromQL: `rate()` vs `irate()` â€” The Speedometers of Prometheus

Raw counter values arenâ€™t useful by themselvesâ€”you want the **speed of increase**:

- â€œHow many requests per second?â€
- â€œHow fast are bytes being received?â€
- â€œWhatâ€™s the error rate right now?â€

> ğŸ’¡ imagine Prometheus as your car dashboard.  
> Metrics like `http_requests_total` are your **odometer** â€” always going up as long as the app runs.  
> But what you _actually care about_ is **speed** â€” how fast those requests are happening _right now_.

Thatâ€™s what **`rate()`** and **`irate()`** tell you.

---

<div align="center" style="background-color: #11171F; border-radius: 10px; border: 2px solid">
    <img src="image/1762528479026.png" alt="Instant Vector" style="width: 60%">
</div>

---

<div align="center" style="background-color: #11171F; border-radius: 10px; border: 2px solid">
    <img src="image/1762528489073.png" alt="Instant Vector" style="width: 60%">
</div>

---

## ğŸ§® What They Do in One Line

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Function  | Meaning                 | Analogy                                       |
| --------- | ----------------------- | --------------------------------------------- |
| `rate()`  | Average speed over time | Cruise control â€” smooth, stable               |
| `irate()` | Instantaneous speed     | Your speedometer needle â€” jumpy but real-time |

</div>

---

## ğŸ§© How `rate()` Works (the Smooth Operator)

Think of `rate()` like this:

> â€œTell me the average increase per second in the last X minutes.â€

It looks at **all data points** in your chosen time range (e.g., `[5m]`),
handles resets, and calculates the average slope of the line.

```promql
rate(http_requests_total[5m])
```

If 300 requests happened in 5 minutes,
`rate()` = `300 / (5 * 60)` = **1 request per second**.

âœ… **Perfect for**: dashboards, alerts, SLAs â€” anything long-term and stable.  
âŒ **Not ideal for**: super short bursts or debugging latency spikes.

---

<div align="center" style="background-color: #11171F; border-radius: 10px; border: 2px solid">
    <img src="image/1762528583735.png" alt="Instant Vector" style="width: 80%">
</div>

---

## âš¡ How `irate()` Works (the Impulsive One)

`irate()` says:

> â€œForget the past! Whatâ€™s my rate **right now**, based on the last two scrapes?â€

```promql
irate(http_requests_total[5m])
```

It only uses the **most recent two points** inside `[5m]`.

So if youâ€™re scraping every 15 seconds,
thatâ€™s basically â€œthe last 30 seconds of activityâ€.

âœ… **Perfect for**: spotting sudden spikes or debugging  
âŒ **Too noisy for**: alerts or steady dashboards

---

<div align="center" style="background-color: #11171F; border-radius: 10px; border: 2px solid">
    <img src="image/1762528691570.png" alt="Instant Vector" style="width: 80%">
</div>

---

## ğŸ“Š Letâ€™s See an Example

### Data from `http_requests_total`:

| Timestamp | Value |
| --------- | ----- |
| 0s        | 1000  |
| 15s       | 1020  |
| 30s       | 1040  |
| 45s       | 1060  |
| 60s       | 1080  |

---

### ğŸ§® Using `rate(http_requests_total[1m])`

Average increase = 1080 - 1000 = 80
Time = 60s
`rate()` = 80 / 60 = **1.33 requests/sec**

â¡ï¸ A smooth average over 1 minute.

---

### âš¡ Using `irate(http_requests_total[1m])`

Only looks at the last two:
(1080 - 1060) / (60 - 45) = 20 / 15 = **1.33 req/sec**

â¡ï¸ In this case, same result â€” but if traffic spiked for 5s, `irate()` would instantly jump, while `rate()` would smooth it.

---

## ğŸ§¨ Counter Reset Example

Imagine your app restarts, resetting the counter to 0:

| Timestamp | Value |         |
| --------- | ----- | ------- |
| 0s        | 500   |         |
| 30s       | 800   |         |
| 60s       | 50    | â† reset |
| 90s       | 200   |         |

`rate()` automatically detects that reset
and continues counting as if it was 800 â†’ 850.
So no spike or negative rate.
Thatâ€™s why you _never_ need to manually fix resets â€” Prometheus handles it. ğŸ’ª

---

## ğŸ•’ Which Window to Use?

<div align="center" style="background-color: #11171F; border-radius: 10px; border: 2px solid">
    <img src="image/1762528958790.png" alt="Instant Vector" style="width: 80%">
</div>

---

Scrape interval = how often Prometheus collects metrics.

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Scrape interval | Recommended `[range]` |
| --------------- | --------------------- |
| 15s             | `[1m]` or `[5m]`      |
| 30s             | `[2m]` or `[5m]`      |
| 60s             | `[5m]` or `[10m]`     |

</div>

---

Why? Because you need at least **2 samples**,  
and ideally ~4â€“5Ã— your scrape interval for a stable trend.

---

## ğŸ“’ Notes

- Make sure there at least 4 sample points in the time series, ideally more.
- 15 s scrape interval 60 s = 4 samples

## ğŸ’» Real Examples Youâ€™ll Actually Use

### ğŸ”¸ Requests per second (smooth dashboard)

```promql
sum by (job) (rate(http_requests_total[5m]))
```

### ğŸ”¸ Instantaneous request spikes (debug)

```promql
sum by (job) (irate(http_requests_total[1m]))
```

### ğŸ”¸ Network throughput

```promql
sum by (instance) (rate(node_network_transmit_bytes_total[5m]))
```

### ğŸ”¸ Error percentage

```promql
100 *
sum(rate(http_requests_total{status=~"5.."}[5m]))
/
sum(rate(http_requests_total[5m]))
```

### ğŸ”¸ 95th percentile latency (histogram)

```promql
histogram_quantile(0.95,
  sum by (le) (rate(http_request_duration_seconds_bucket[5m]))
)
```

> âš ï¸ Always use `rate()` (not `irate()`) with histograms â€” `irate()` makes percentiles nonsense.

---

## ğŸ’¡ Common Mistakes to Avoid

âŒ Using `rate()` on a gauge metric (like memory usage)

> Itâ€™s not cumulative, so rate() gives garbage values.

âŒ Using too small a window (`[15s]`)

> Prometheus may only have one sample â†’ returns nothing.

âŒ Using `irate()` for alerts

> Youâ€™ll get noisy, unreliable results.

âœ… Combine `rate()` with `sum by()` for meaningful totals.  
âœ… Always match window size to your scrape frequency.

---

## ğŸ§¾ TL;DR â€” Quick Comparison

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Feature               | `rate()`             | `irate()`           |
| --------------------- | -------------------- | ------------------- |
| Looks at              | All samples in range | Only last 2 samples |
| Behavior              | Smooth, average      | Spiky, instant      |
| Best for              | Alerts, dashboards   | Quick debugging     |
| Sensitive to bursts   | Less                 | Very                |
| Works with histograms | âœ…                   | âŒ                  |
| Example window        | `[5m]`               | `[1m]`              |

</div>

---

## ğŸ§  Human Memory Trick

> â€œ`rate()` thinks like your **doctor** â€” average heart rate over time.  
> `irate()` thinks like your **Apple Watch** â€” your pulse right now.â€
