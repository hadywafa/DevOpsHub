# â±ï¸ Instant vs Range Vectors

_(a.k.a. â€œHow Prometheus sees time when you ask for dataâ€)!_

---

## ğŸ§  Big Picture

Prometheus doesnâ€™t just store values â€” it stores **values _over time_**.
So when you query it, you can either ask:

1. ğŸ‘‰ â€œWhatâ€™s the value _right now_?â€ â†’ **Instant Vector**
2. ğŸ‘‰ â€œWhatâ€™s the _series of values_ over the last X time?â€ â†’ **Range Vector**

Thatâ€™s it. These two are the foundation of PromQL.
Everything else (functions, aggregations, rates) builds on them.

---

## ğŸ¯ 1ï¸âƒ£ Instant Vector (Snapshot View)

Think of an **instant vector** as a photo â€” a _single value per time series at one timestamp._

### ğŸ’¡ Definition

> An **instant vector** returns the _latest sample value_ for each time series that matches the query at the evaluation time.

### ğŸ” Example

```promql
node_memory_MemFree_bytes
```

This query returns:

| instance | value  |
| -------- | ------ |
| node1    | 12.3e9 |
| node2    | 8.1e9  |
| node3    | 9.5e9  |

â° **Evaluation time:** Now  
ğŸ“¸ **Result:** A snapshot at that time

---

### ğŸ§  You Can Still Use Filters

```promql
node_memory_MemFree_bytes{instance="node1"}
```

Still an **instant vector** â€” just fewer series.

---

### âš™ï¸ When to Use Instant Vectors

âœ… Dashboard gauges (Grafana single-stat panels)  
âœ… Aggregations like `sum()` or `avg()` _at this moment_  
âœ… Threshold-based alerts (â€œif CPU > 90% right nowâ€)

---

## â³ 2ï¸âƒ£ Range Vector (Time Window View)

Now, imagine instead of a photo, you record a short _video clip_ of metric values â€” thatâ€™s a **range vector**.

### ğŸ’¡ Definition

> A **range vector** represents a _set of samples over a specific time range_ for each matching time series.

### ğŸ” Example

```promql
node_cpu_seconds_total[5m]
```

This means:

> â€œGive me all samples of `node_cpu_seconds_total` for the last 5 minutes.â€

---

### ğŸ§± Structure Example

```ini
node_cpu_seconds_total{instance="node1"} = [
  (t-300s, 1000),
  (t-240s, 1012),
  (t-180s, 1023),
  (t-120s, 1031),
  (t-60s, 1044),
  (t, 1050)
]
```

Each time series â†’ a _list_ of timestamp-value pairs covering the 5-minute window.

---

## ğŸ§® Functions That _Require_ Range Vectors

Some PromQL functions _only_ work on range vectors because they analyze _changes over time_.

| Function          | Works On | Meaning                               |
| ----------------- | -------- | ------------------------------------- |
| `rate()`          | Range    | Per-second rate of increase           |
| `increase()`      | Range    | Total increase over time              |
| `delta()`         | Range    | Difference between first & last value |
| `avg_over_time()` | Range    | Average value in range                |
| `max_over_time()` | Range    | Highest value in range                |

Example:

```promql
rate(http_requests_total[5m])
```

ğŸ’¬ â€œHow fast are requests increasing over the last 5 minutes?â€

---

### ğŸ§  Remember:

- Instant vectors â†’ **1 value per series**
- Range vectors â†’ **many values per series**

---

## ğŸ§© Conversion: Range â†’ Instant

Functions like `rate()`, `increase()`, or `avg_over_time()`  
**convert a range vector into an instant vector.**

Thatâ€™s why `rate()` can be used inside `sum()`:

```promql
sum(rate(http_requests_total[5m])) by (job)
```

âœ… `rate()` returns instant vectors (one per time series)  
âœ… `sum()` can then aggregate those

---

## ğŸ§® Subquery Example (Advanced Teaser)

You can even _nest_ range queries:

```promql
avg_over_time(
  rate(http_requests_total[5m])[30m:]
)
```

- Inner `rate(http_requests_total[5m])` â†’ instant vector every step
- Outer `[30m:]` â†’ converts that into a range
- Outer `avg_over_time()` â†’ averages those

This is called a **subquery** â€” youâ€™ll learn that in topic #7.

---

## ğŸ§­ Visual Comparison

```mermaid
graph TD
    A["Instant Vector Query"] -->|returns| B["One value per time series"]
    A2["Range Vector Query [5m]"] -->|returns| C["Multiple values (time window) per series"]
    B --> D["Used for dashboards / snapshots"]
    C --> E["Used for rates / trends"]
```

---

## ğŸ§© Quick Analogy

| Concept            | Analogy                  | Description                                       |
| ------------------ | ------------------------ | ------------------------------------------------- |
| **Instant Vector** | ğŸ–¼ï¸ Photo                 | Single moment in time                             |
| **Range Vector**   | ğŸï¸ Video clip            | Sequence of samples                               |
| **rate()**         | ğŸšï¸ Motion speed detector | Calculates how fast the value changes in the clip |

---

## ğŸ§  Quick Summary

| Concept        | Symbol          | Description                | Used In                 |
| -------------- | --------------- | -------------------------- | ----------------------- |
| Instant Vector | _(none)_        | Single sample at eval time | Dashboards, thresholds  |
| Range Vector   | `[5m]`          | Window of samples          | Rate, increase, trends  |
| Conversion     | Function result | Turns range â†’ instant      | rate(), avg_over_time() |

---

âœ… **Memory Trick:**

> â€œIf it has `[time]`, itâ€™s a _range vector_.  
> If not, itâ€™s an _instant vector_.â€
