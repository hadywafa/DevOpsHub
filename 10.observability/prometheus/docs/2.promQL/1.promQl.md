# ğŸ§© 1. Metric Types & Prometheus Data Model

_(a.k.a. â€œHow Prometheus thinks about your data before you even query itâ€)!_

---

![1762032268557](image/1.promQl/1762032268557.png)

---

## ğŸ§  What Is Prometheusâ€™s Data Model?

Prometheus doesnâ€™t store tables or JSONâ€”it stores **time series**.
A _time series_ = a sequence of `(timestamp, value)` pairs attached to a metric **name** and a set of **labels**.

Think of it as:

```ini
http_requests_total{method="GET", status="200"} â†’ [
  (1730700000, 25),
  (1730700060, 45),
  (1730700120, 75)
]
```

In English:

> The metric `http_requests_total` for GET requests with 200 OK status
> had values 25 â†’ 45 â†’ 75 over time.

---

### ğŸ§© Data Model Breakdown

| Component        | Meaning                      | Example                                             |
| ---------------- | ---------------------------- | --------------------------------------------------- |
| **Metric name**  | Describes _what_ is measured | `http_requests_total`                               |
| **Labels**       | Add context (metadata)       | `method="POST"`, `status="500"`, `instance="app01"` |
| **Sample value** | The numeric data point       | `123.0`                                             |
| **Timestamp**    | UNIX time (seconds or ms)    | `1730700120`                                        |

So the **real identity** of a time series is `(metric name + label set)`.
Each unique combination is one series.

---

## ğŸ§® 4 Core Metric Types

Prometheus scrapes raw numeric data, but it classifies each metric into one of **4 fundamental types**.
Knowing these will prevent you from using the wrong PromQL function later (like using `rate()` on a gauge ğŸ˜…).

---

### 1ï¸âƒ£ **Counter**

- ğŸ“ˆ _Only increases_ (resets to 0 on restart)
- Use for things like total requests, errors, jobs processed.
- Query examples:

  ```promql
  http_requests_total
  rate(http_requests_total[5m])
  ```

- âš ï¸ Use `rate()` or `increase()` to get _per-second rate_ or _delta_.
- Example:

  - Value goes 10 â†’ 15 â†’ 20 â†’ 25 (in 5 mins)
  - `rate()` â‰ˆ (25-10)/300 = 0.05 req/sec

---

### 2ï¸âƒ£ **Gauge**

- âš–ï¸ _Goes up or down_ freely.
- Represents a measurement at a single point in time (memory usage, temperature, active connections).
- Query examples:

  ```promql
  node_memory_Active_bytes
  avg(node_memory_Active_bytes) by (instance)
  ```

- âš ï¸ Donâ€™t use `rate()`â€”use it _as is_.

---

### 3ï¸âƒ£ **Histogram**

- ğŸ“Š Measures _distribution_ of observed values (e.g., request latency).
- Stores multiple time series per bucket:

  ```ini
  http_request_duration_seconds_bucket{le="0.1"}  â†’ count of requests â‰¤ 0.1s
  http_request_duration_seconds_bucket{le="1"}    â†’ count â‰¤ 1s
  http_request_duration_seconds_bucket{le="+Inf"} â†’ all requests
  ```

- Also includes:

  ```ini
  http_request_duration_seconds_sum
  http_request_duration_seconds_count
  ```

- âš™ï¸ Use `rate()` and `histogram_quantile()` to get percentiles:

  ```promql
  histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))
  ```

---

### 4ï¸âƒ£ **Summary**

- ğŸ§¾ Similar to histogram but **client-side** calculated quantiles.
- Emits precomputed quantiles like:

  ```ini
  http_request_duration_seconds{quantile="0.95"}
  ```

- Easier but less flexible than histograms.
- Not aggregatable across instances (âš ï¸ a common trap!).

---

## ğŸ§­ Mental Map: Which Function Goes with Which Type

| Metric Type   | Common Use                   | Recommended Functions                |
| ------------- | ---------------------------- | ------------------------------------ |
| **Counter**   | Total number of events       | `rate()`, `increase()`, `irate()`    |
| **Gauge**     | Current state / snapshot     | raw value, `avg()`, `max()`, `min()` |
| **Histogram** | Latency or size distribution | `rate()`, `histogram_quantile()`     |
| **Summary**   | Local quantiles per instance | read directly by quantile label      |

---

### ğŸ§© Visual: Metric â†’ Time Series Explosion

```mermaid
graph TD
    A["http_requests_total"] --> B["method=GET, status=200"]
    A --> C["method=GET, status=500"]
    A --> D["method=POST, status=200"]
    B --> E["(t1, 25)"]
    B --> F["(t2, 45)"]
    C --> G["(t1, 5)"]
    D --> H["(t1, 13)"]
```

Each label combo = a unique time series Prometheus stores.

---

### ğŸ§© Quick Real-Life Analogy

- **Counter** â†’ Odometer (always goes up)
- **Gauge** â†’ Speedometer (goes up/down)
- **Histogram** â†’ Speed distribution over time
- **Summary** â†’ Speed report pre-summarized by each car

---

### ğŸ§° Tip for Memorization

> â€œC-G-H-Sâ€ â†’ _Counters Grow_, _Gauges Swing_, _Histograms Quantify_, _Summaries Simplify._
