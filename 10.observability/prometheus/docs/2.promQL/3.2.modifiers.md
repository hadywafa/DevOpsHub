# ğŸ§­ PromQL Modifiers: `offset`, `@`, and Combined Use â€” With Real-Time Examples

Modifiers in PromQL allow you to **shift or fix the evaluation time** of a query. This is essential for comparing past behavior, reproducing incidents, or aligning metrics across services.

---

<div align="center" style="background-color: #11171F; border-radius: 10px; border: 2px solid">
    <img src="image/1762346815471.png" alt="Instant Vector" style="width: 60%">
</div>

---

## ğŸ” 1. `offset` Modifier â€” Shift Back in Time

### âœ… Purpose

Shifts the query evaluation **backward** by a fixed duration.

### ğŸ“Œ Syntax

```promql
metric_name offset 1h
```

---

<div align="center" style="background-color: #11171F; border-radius: 10px; border: 2px solid">
    <img src="image/1762346844133.png" alt="Instant Vector" style="width: 60%">
</div>

<div align="center" style="background-color: #11171F; border-radius: 10px; border: 2px solid">
    <img src="image/1762346924020.png" alt="Instant Vector" style="width: 60%">
</div>

<div align="center" style="background-color: #11171F; border-radius: 10px; border: 2px solid">
    <img src="image/1762346945877.png" alt="Instant Vector" style="width: 60%">
</div>

---

### ğŸ”¹ Example

```promql
rate(http_requests_total[5m] offset 1h)
```

### ğŸ§  Behavior

This calculates the **rate of increase** in `http_requests_total` from **1 hour ago**, using samples from:

- **Start**: 1 hour + 5 minutes ago
- **End**: 1 hour ago

### ğŸ“Š Real-Time Example

Assume current time is **Nov 7, 2025 at 3:00 PM**  
Then:

```promql
rate(http_requests_total[5m] offset 1h)
```

Evaluates the rate between:

- **Start**: 1:55 PM
- **End**: 2:00 PM

If:

- Value at 1:55 PM = 100
- Value at 2:00 PM = 130

Then:

$$
\frac{130 - 100}{300 \text{ seconds}} = 0.1
$$

---

## ğŸ“ 2. `@` Modifier â€” Fix Evaluation Time

### âœ… Purpose

Fixes the query evaluation at an **exact timestamp**.

### ğŸ“Œ Syntax

```promql
metric_name @ <timestamp>
```

---

<div align="center" style="background-color: #11171F; border-radius: 10px; border: 2px solid">
    <img src="image/1762346987285.png" alt="Instant Vector" style="width: 60%">
</div>

---

### ğŸ”¹ Example

```promql
http_requests_total @ 1699350000
```

### ğŸ§  Behavior

Returns the value of `http_requests_total` **at Unix timestamp `1699350000`**, which is:

> ğŸ•’ **Nov 7, 2023 at 10:00 PM UTC**  
> ğŸ•’ **Nov 8, 2023 at 12:00 AM Egypt time**

### ğŸ“Š Expected Output

If:

- Value at that time = `250`

Then:

```promql
http_requests_total @ 1699350000 â†’ 250
```

---

## ğŸ”€ 3. Combined: `offset` + `@`

### âœ… Purpose

Shifts the query back in time **and** evaluates it at a fixed timestamp.

### ğŸ“Œ Syntax

```promql
rate(metric_name[5m] offset 1h @ 1699350000)
```

---

<div align="center" style="background-color: #11171F; border-radius: 10px; border: 2px solid">
    <img src="image/1762347021557.png" alt="Instant Vector" style="width: 60%">
</div>

> ğŸ’¡ Order doesn't matter when combine @ modifier with `offset` modifier  
> ğŸ’¡ You can combine range vector with offset modifier and `@` modifier

---

### ğŸ”¹ Example

```promql
rate(http_requests_total[5m] offset 1h @ 1699350000)
```

### ğŸ§  Behavior

Evaluates the rate of `http_requests_total` **1 hour before timestamp `1699350000`**, using samples from:

- **Start**: `1699350000 âˆ’ 65m` â†’ **Nov 7, 2023 at 8:55 PM UTC**
- **End**: `1699350000 âˆ’ 60m` â†’ **Nov 7, 2023 at 9:00 PM UTC**

### ğŸ“Š Expected Output

If:

- Value at 8:55 PM = 400
- Value at 9:00 PM = 430

Then:

```promql
rate(...) = (430 âˆ’ 400) / 300 = 0.1 req/sec
```

---

## âœ… Summary Table

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Modifier | Purpose                      | Example                                      | Evaluates At                | Output Example         |
| -------- | ---------------------------- | -------------------------------------------- | --------------------------- | ---------------------- |
| `offset` | Shift query back in time     | `cpu_usage offset 30m`                       | 30 minutes before now       | Value at tâˆ’30m         |
| `@`      | Fix query at exact timestamp | `cpu_usage @ 1699350000`                     | Nov 7, 2023 at 10:00 PM UTC | Value at that time     |
| Both     | Shift + fix evaluation time  | `rate(cpu_usage[5m] offset 1h @ 1699350000)` | Nov 7, 2023 at 9:00 PM UTC  | Rate from 8:55â€“9:00 PM |

</div>
