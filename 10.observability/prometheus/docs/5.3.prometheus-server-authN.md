# ðŸ§© Securing Prometheus UI / API

## ðŸ§  Why You Need to Secure It

By default, Prometheus exposes:

- **Web UI** â†’ `http://<host>:9090/`
- **API** â†’ `/api/v1/...`

And guess what? ðŸ˜…
Itâ€™s **completely open** â€” anyone on the network can:

- See metrics
- Query with PromQL
- Add or delete alert rules
- Access `/metrics` of Prometheus itself

So, we must **secure the interface**, especially in production or shared environments.

---

## ðŸ”’ Two Ways to Secure Prometheus

| Method                                              | Description                                         | Difficulty                     |
| --------------------------------------------------- | --------------------------------------------------- | ------------------------------ |
| **1ï¸âƒ£ web.yml (built-in security file)**             | Native support for Basic Auth + TLS                 | â­ Easy                        |
| **2ï¸âƒ£ Reverse Proxy (Nginx, Traefik, Apache, etc.)** | External protection layer with advanced auth or SSO | ðŸ”¥ Flexible & enterprise-ready |

---

## ðŸ§© 1ï¸âƒ£ Option 1 â€” Using `web.yml`

Prometheus supports a configuration file (`web.yml`) for **Basic Auth** and **TLS**.

### ðŸ“„ Example: `/etc/prometheus/web.yml`

```yaml
# web.yml
basic_auth_users:
  admin: "$2b$12$VxCZ3MKu8rQycc1y8WlBi..z0WqweJyycBxoQ6UZVf6J1KGEHdDa6" # bcrypt password

tls_server_config:
  cert_file: /etc/prometheus/certs/server.crt
  key_file: /etc/prometheus/certs/server.key
```

> âš™ï¸ Password must be **bcrypt-hashed** (use `htpasswd -nBC 10 ""` or `openssl passwd -bcrypt`)

### ðŸ§­ Prometheus service config (e.g. systemd or Docker)

```bash
prometheus \
  --config.file=/etc/prometheus/prometheus.yml \
  --web.config.file=/etc/prometheus/web.yml
```

Now open:
ðŸ”— [https://your-prometheus-server:9090](https://your-prometheus-server:9090)

and youâ€™ll see a **login prompt** âœ…

---

## ðŸŒ 2ï¸âƒ£ Option 2 â€” Reverse Proxy (Recommended in Companies)

Most enterprises prefer placing Prometheus **behind a reverse proxy** like **Nginx**, **Traefik**, or **Apache**.

This gives you:

- Centralized **SSO (OAuth2, SAML, LDAP)**
- **Rate limiting**
- **IP whitelisting**
- Easier **certificate rotation**

### âš™ï¸ Example: Nginx in front of Prometheus

```nginx
server {
  listen 443 ssl;
  server_name prometheus.example.com;

  ssl_certificate     /etc/nginx/certs/server.crt;
  ssl_certificate_key /etc/nginx/certs/server.key;

  auth_basic           "Prometheus Login";
  auth_basic_user_file /etc/nginx/.htpasswd;

  location / {
    proxy_pass http://localhost:9090;
  }
}
```

Run this and access:

```ini
https://prometheus.example.com
```

Youâ€™ll get a login window from Nginx ðŸ”

âœ… Great for corporate setups where Prometheus is one of many internal dashboards.

---

## ðŸ§± TLS vs. Authentication

| Concept            | Purpose                      | Example                                    |
| ------------------ | ---------------------------- | ------------------------------------------ |
| **TLS**            | Encrypts traffic (HTTPS)     | `tls_server_config` or reverse proxy certs |
| **Authentication** | Verifies user identity       | `basic_auth` / OAuth / LDAP                |
| **mTLS**           | Both sides verify each other | Used between Prometheus and exporters      |

ðŸ§© So, companies often use **both** TLS + Auth:

- TLS for secure transport
- Basic Auth or SSO for user access

---

## ðŸ§  Real-World Security Recommendations

| Level         | Recommendation                     | Why                               |
| ------------- | ---------------------------------- | --------------------------------- |
| ðŸ§± Basic      | Use `web.yml` with bcrypt password | Quick protection for test/staging |
| ðŸ” Medium     | Use Nginx with HTTPS + Basic Auth  | More flexible, logs access        |
| ðŸ¢ Enterprise | Use OAuth2 / SSO via reverse proxy | Integrate with AD/Entra/Okta      |
| ðŸš« Avoid      | Exposing port 9090 directly        | No built-in protection!           |

---

## ðŸ“Š Visual Summary

```mermaid
flowchart LR
A[User] -->|Login via Basic/OAuth| B[Nginx Proxy]
B -->|Forward HTTPS| C[Prometheus UI/API]
C -->|Serve Metrics| D[Grafana / Alertmanager]
```

---

## ðŸ§© TL;DR

| Option        | Where it runs             | Handles Auth              | Handles TLS | Best For                |
| ------------- | ------------------------- | ------------------------- | ----------- | ----------------------- |
| `web.yml`     | Inside Prometheus         | Basic (bcrypt)            | âœ…          | Simple secure setup     |
| Reverse Proxy | External (Nginx, Traefik) | Any (Basic, OAuth2, LDAP) | âœ…          | Production / enterprise |
