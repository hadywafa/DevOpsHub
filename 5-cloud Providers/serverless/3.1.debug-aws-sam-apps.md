# Debug in AWS SAM

## ğŸ“Œ **Understanding AWS Toolkit Debugging Configuration for AWS SAM**

The JSON configuration you shared is a **VS Code debug configuration** used by **AWS Toolkit for VS Code** to invoke and debug AWS SAM applications.

---

### **ğŸ” Configuration Breakdown**

```json
{
  "configurations": [
    {
      "type": "aws-sam",
      "request": "direct-invoke",
      "name": "API sam-app-nodejs-js:HelloWorldFunction",
      "invokeTarget": {
        "target": "api",
        "templatePath": "${workspaceFolder}/sam-app-nodejs-js/template.yaml",
        "logicalId": "HelloWorldFunction"
      },
      "api": {
        "path": "/hello",
        "httpMethod": "get",
        "payload": {
          "json": {}
        }
      }
    }
  ]
}
```

Letâ€™s go through each section **line by line**.

---

### **1ï¸âƒ£ `"type": "aws-sam"`**

```json
"type": "aws-sam"
```

ğŸ”¹ This tells **VS Code** that this debug configuration is for **AWS SAM** (Serverless Application Model).  
ğŸ”¹ **AWS Toolkit for VS Code** recognizes this and uses **AWS SAM CLI** to execute the function.

---

### **2ï¸âƒ£ `"request": "direct-invoke"`**

```json
"request": "direct-invoke"
```

ğŸ”¹ This means **the Lambda function is invoked directly** (without needing an external trigger like API Gateway, SNS, or S3).  
ğŸ”¹ It ensures the function runs **locally** inside **VS Code**, without you having to manually invoke it via `sam local invoke`.

---

### **3ï¸âƒ£ `"name": "API sam-app-nodejs-js:HelloWorldFunction"`**

```json
"name": "API sam-app-nodejs-js:HelloWorldFunction"
```

ğŸ”¹ **Human-readable name** for the debug configuration.  
ğŸ”¹ This helps **identify the function** in the VS Code Debug panel.

ğŸ”¹ The format is:

```
API <AWS SAM Project Name>:<Lambda Function Logical ID>
```

ğŸ“Œ **Example:** If your project is called `sam-app-nodejs-js` and your function is named `HelloWorldFunction`, this is how AWS Toolkit labels it.

---

### **4ï¸âƒ£ `"invokeTarget": { ... }`**

```json
"invokeTarget": {
    "target": "api",
    "templatePath": "${workspaceFolder}/sam-app-nodejs-js/template.yaml",
    "logicalId": "HelloWorldFunction"
}
```

This section specifies **how AWS SAM should execute the function**.

### ğŸ”¹ `"target": "api"`

```json
"target": "api"
```

ğŸ“Œ **Indicates that the function is triggered via API Gateway.**

- If it were `"target": "function"`, AWS SAM would invoke the Lambda function **directly**, without API Gateway.

### ğŸ”¹ `"templatePath": "${workspaceFolder}/sam-app-nodejs-js/template.yaml"`

```json
"templatePath": "${workspaceFolder}/sam-app-nodejs-js/template.yaml"
```

ğŸ“Œ **Tells AWS SAM where to find the CloudFormation/SAM template (`template.yaml`).**

- This file defines the function, its permissions, and event sources (like API Gateway).
- **`${workspaceFolder}`** dynamically refers to your projectâ€™s root directory.

### ğŸ”¹ `"logicalId": "HelloWorldFunction"`

```json
"logicalId": "HelloWorldFunction"
```

ğŸ“Œ **This specifies which function to invoke from `template.yaml`.**

- **Logical ID** is the **unique name** of the Lambda function in AWS SAM.
- This must match the function name inside `template.yaml`:

```yaml
Resources:
  HelloWorldFunction:
    Type: AWS::Serverless::Function
```

---

### **5ï¸âƒ£ `"api": { ... }`**

```json
"api": {
    "path": "/hello",
    "httpMethod": "get",
    "payload": {
        "json": {}
    }
}
```

This section **defines the API Gateway request that AWS SAM will simulate**.

### ğŸ”¹ `"path": "/hello"`

```json
"path": "/hello"
```

ğŸ“Œ **Specifies the API Gateway route** that triggers the Lambda function.

- This should match the `Path` in `template.yaml`:

```yaml
Events:
  ApiEvent:
    Type: Api
    Properties:
      Path: /hello
      Method: get
```

### ğŸ”¹ `"httpMethod": "get"`

```json
"httpMethod": "get"
```

ğŸ“Œ **Defines the HTTP method** (`GET`, `POST`, etc.).

- This must match **how the Lambda function is triggered** in `template.yaml`.

### ğŸ”¹ `"payload": { "json": {} }`

```json
"payload": {
    "json": {}
}
```

ğŸ“Œ **Defines the request body sent to the Lambda function**.

- The empty `{}` means **no request body** (useful for `GET` requests).
- For **POST requests**, you could pass sample JSON data:

```json
"payload": {
    "json": {
        "name": "Alice"
    }
}
```

---

## ğŸ”¥ **What Happens Behind the Scenes?**

When you **click "Start Debugging"** in VS Code, AWS Toolkit **automates the following steps**:

1ï¸âƒ£ **Parses `launch.json`** and identifies `"type": "aws-sam"`.  
2ï¸âƒ£ **Uses `template.yaml`** to locate the Lambda function (`logicalId`: `HelloWorldFunction`).  
3ï¸âƒ£ **Starts a local API Gateway emulator** (`sam local start-api`).  
4ï¸âƒ£ **Sends a test HTTP request** to API Gateway:

```ini
GET http://127.0.0.1:3000/hello
```

5ï¸âƒ£ **Runs the Lambda function** inside a Docker container with the correct runtime.  
6ï¸âƒ£ **Streams logs and debugging information** to VS Code.  
7ï¸âƒ£ **Stops execution if a breakpoint is hit**, allowing you to inspect variables and step through code.

---

## ğŸ¯ **Can I Debug AWS SAM Without Docker?**

### **âœ… YES â€“ If using AWS Toolkit in VS Code**

- AWS Toolkit uses **"direct-invoke" mode**, which runs Lambda functions **without Docker**.
- Useful for **quick debugging**.

### **âŒ NO â€“ If using `sam local invoke` manually**

- `sam local invoke` **needs Docker** to emulate AWS Lambda's environment.
- To **force no Docker**, use:

```bash
sam local invoke HelloWorldFunction --skip-pull-image
```

- However, this **may not work for all runtimes** (especially compiled languages like Java or Go).

---

## ğŸš€ **Final Thoughts**

âœ… **AWS Toolkit automates AWS SAM debugging inside VS Code.**  
âœ… **It generates `launch.json`, which configures API Gateway emulation & function invocation.**  
âœ… **If using `sam local invoke` manually, Docker is required to simulate AWS Lambda.**  
âœ… **For API testing, `sam local start-api` is used to mimic AWS API Gateway.**  
âœ… **AWS Toolkit simplifies debugging by removing the need for manual Docker setup.**

---

Would you like a **step-by-step debugging guide** with a real AWS SAM project? ğŸš€ğŸ˜Š
