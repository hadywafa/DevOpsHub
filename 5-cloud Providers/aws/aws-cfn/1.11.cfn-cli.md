# **ğŸš€ Managing AWS CloudFormation with AWS CLI**

AWS CloudFormation (CFN) allows **infrastructure automation** using YAML/JSON templates. The **AWS CLI** provides powerful commands to **create, update, and manage stacks** directly from the command line.

âœ… **Automate AWS infrastructure** from your local terminal.  
âœ… **Easily create, update, and delete stacks** using CLI commands.  
âœ… **Use Change Sets for safe updates** and preview modifications before applying them.

---

## **ğŸ—ï¸ Working with CloudFormation Stacks Using AWS CLI**

### **ğŸ”¹ 1ï¸âƒ£ Create a New Stack**

To create a stack from a CloudFormation template:

```sh
aws cloudformation create-stack \
    --stack-name MyStack \
    --template-body file://template.yaml \
    --parameters ParameterKey=InstanceType,ParameterValue=t3.micro \
    --region us-east-1 \
    --capabilities CAPABILITY_NAMED_IAM
```

âœ” **`--stack-name`** â†’ Name of the CloudFormation stack.  
âœ” **`--template-body`** â†’ Path to the YAML/JSON file containing the CloudFormation template.  
âœ” **`--parameters`** â†’ Key-value pairs for template parameters.  
âœ” **`--capabilities`** â†’ Required if IAM roles or policies are created.

---

### **ğŸ”¹ 2ï¸âƒ£ Check Stack Creation Status**

Monitor stack creation progress:

```sh
aws cloudformation describe-stacks --stack-name MyStack
```

âœ” Returns **stack status** (e.g., `CREATE_IN_PROGRESS`, `CREATE_COMPLETE`, or `ROLLBACK_IN_PROGRESS`).

To view detailed events during stack creation:

```sh
aws cloudformation describe-stack-events --stack-name MyStack
```

âœ” Helps troubleshoot **failures in stack deployment**.

---

### **ğŸ”¹ 3ï¸âƒ£ Updating an Existing Stack**

To update a CloudFormation stack:

```sh
aws cloudformation update-stack \
    --stack-name MyStack \
    --template-body file://updated_template.yaml \
    --parameters ParameterKey=InstanceType,ParameterValue=t3.medium
```

âœ” Updates the stack with a **new template** or **modified parameters**.

To check the update progress:

```sh
aws cloudformation describe-stacks --stack-name MyStack
```

âœ” If an update fails, CloudFormation automatically **rolls back** to the previous state.

---

### **ğŸ”¹ 4ï¸âƒ£ Deleting a Stack**

To delete a stack and all its associated resources:

```sh
aws cloudformation delete-stack --stack-name MyStack
```

âœ” Removes all AWS resources **created by the stack**.  
âœ” This action **cannot be undone** unless you have backups or Drift Detection enabled.

To confirm stack deletion status:

```sh
aws cloudformation describe-stacks --stack-name MyStack
```

âœ” Stack status will change from `DELETE_IN_PROGRESS` â†’ `DELETE_COMPLETE`.

---

## **ğŸ”„ Managing CloudFormation Change Sets Using AWS CLI**

### **ğŸ“Œ What is a Change Set?**

A Change Set **allows previewing modifications** before applying them to a CloudFormation stack.

âœ… **Prevents accidental changes** that may break infrastructure.  
âœ… **Identifies modifications (Add, Modify, Delete) before execution.**

---

### **ğŸ”¹ 1ï¸âƒ£ Create a Change Set**

To propose modifications to an existing stack:

```sh
aws cloudformation create-change-set \
    --stack-name MyStack \
    --template-body file://updated_template.yaml \
    --parameters ParameterKey=InstanceType,ParameterValue=t3.medium \
    --change-set-name MyChangeSet
```

âœ” Does not apply the changes immediately.  
âœ” The Change Set remains **pending for review**.

---

### **ğŸ”¹ 2ï¸âƒ£ View Change Set Summary**

To check what changes will be applied:

```sh
aws cloudformation describe-change-set --stack-name MyStack --change-set-name MyChangeSet
```

âœ” Displays a list of **added, modified, or deleted** resources.

Example **Change Set Output**:

```json
{
  "Changes": [
    {
      "ResourceChange": {
        "Action": "Modify",
        "LogicalResourceId": "MyEC2Instance",
        "ResourceType": "AWS::EC2::Instance",
        "Replacement": "True"
      }
    }
  ]
}
```

ğŸ”¹ **EC2 instance type is being modified, and replacement is required.**

---

### **ğŸ”¹ 3ï¸âƒ£ Execute a Change Set**

To apply the changes:

```sh
aws cloudformation execute-change-set \
    --stack-name MyStack \
    --change-set-name MyChangeSet
```

âœ” CloudFormation updates the stack **only after execution**.

---

### **ğŸ”¹ 4ï¸âƒ£ Delete a Change Set (If Not Needed)**

```sh
aws cloudformation delete-change-set --stack-name MyStack --change-set-name MyChangeSet
```

âœ” Removes an unwanted Change Set **without modifying the stack**.

---

## **ğŸš€ Deploying CloudFormation Stacks Using `aws cloudformation deploy`**

The `deploy` command **simplifies stack creation and updates**.  
It **automatically detects changes** and **applies updates only if necessary**.

```sh
aws cloudformation deploy \
    --stack-name MyStack \
    --template-file template.yaml \
    --parameter-overrides InstanceType=t3.micro \
    --capabilities CAPABILITY_NAMED_IAM
```

âœ” **Creates or updates the stack automatically**.  
âœ” **No need to manually create Change Sets**.

---

## **ğŸ› ï¸ Best Practices for Using AWS CLI with CloudFormation**

âœ… **Use Change Sets before updating production stacks** to prevent unwanted changes.  
âœ… **Always validate CloudFormation templates before execution**:

```sh
aws cloudformation validate-template --template-body file://template.yaml
```

âœ… **Enable Stack Rollback for safety**:

```sh
aws cloudformation update-stack --rollback-configuration RollbackTriggers=[{Type="AWS::CloudWatch::Alarm",Arn="alarm-arn"}]
```

âœ… **Use S3 for large templates** to avoid AWS CLI size limitations:

```sh
aws cloudformation create-stack --template-url https://s3.amazonaws.com/mybucket/template.yaml
```

âœ… **Automate deployments using `aws cloudformation deploy`** instead of manually creating Change Sets.

---

## âœ… **Conclusion**

AWS CloudFormation + AWS CLI provides **powerful automation** for AWS infrastructure.

âœ” **Create, update, and delete stacks efficiently.**  
âœ” **Use Change Sets for safe modifications.**  
âœ” **Automate stack deployment with `deploy` command.**

ğŸ’¡ **Mastering CloudFormation CLI commands ensures scalable and consistent AWS infrastructure deployments!** ğŸš€
