# ğŸ” **IAM Policy Evaluation Logic (Within an AWS Account)**

<div align="center">
  <img src="images/aws-iam-policy-evaluation-login.png" alt="AWS IAM Policy Evaluation" style="border-radius: 10px">
</div>

---

## ğŸ“š **What Is Policy Evaluation in IAM?**

When a user or service makes a request to AWS (like `s3:GetObject`), AWS evaluates **all applicable policies** to determine one thing:

> âœ… **Should I allow this action on this resource in this context?**

That decision is based on **IAM policy evaluation logic**, which always follows a predictable flow.

---

## âš™ï¸ **Key Concepts Before the Evaluation**

| ğŸ§© Concept                | ğŸ” Meaning                                                       |
| ------------------------- | ---------------------------------------------------------------- |
| **Identity-based policy** | Attached to users, groups, or roles                              |
| **Resource-based policy** | Attached to resources (like S3 buckets, SQS queues, etc.)        |
| **Permission boundary**   | Max limit for what an identity-based policy can grant (optional) |
| **Session policy**        | Temporary policy that further restricts the session              |
| **Explicit allow**        | A policy that directly allows an action (`"Effect": "Allow"`)    |
| **Explicit deny**         | A policy that directly blocks an action (`"Effect": "Deny"`)     |
| **Implicit deny**         | The default when nothing allows an action                        |

---

## ğŸ”„ **IAM Policy Evaluation Process Step-by-Step**

### ğŸ§­ Step 1: AWS Collects All Applicable Policies

AWS gathers:

- All **identity-based policies** (user, group, role)
- All **resource-based policies**
- Optional: session policies and permission boundaries

### â›” Step 2: Start with an **Implicit Deny**

By default, **everything is denied** unless **explicitly allowed**.

```text
Default: Deny everything
```

### âœ… Step 3: Look for Any Matching **Allow**

If any policy contains an `"Effect": "Allow"` that matches:

- the requested action
- the target resource
- and the context (conditions, IPs, MFA, etc.)

...then AWS considers allowing it.

### âŒ Step 4: Check for Any **Explicit Deny**

If **any policy** explicitly denies the action:

```json
"Effect": "Deny"
```

â¡ï¸ It **overrides all allows**.

Even if 100 policies say "Allow", **a single explicit Deny wins**.

### ğŸ“˜ Step 5: Final Decision

| âœ… If thereâ€™s a matching **Allow** AND **no Deny** â†’ **Request is allowed**  
| âŒ If thereâ€™s a matching **Deny** â†’ **Request is denied**  
| âŒ If nothing matches â†’ **Request is implicitly denied**

---

## ğŸ“Š IAM Evaluation Logic Table

| Condition                                     | Result           |
| --------------------------------------------- | ---------------- |
| No matching policy                            | âŒ Implicit Deny |
| One policy allows action                      | âœ… Allowed       |
| One allows, another denies                    | âŒ Denied        |
| Only deny policies match                      | âŒ Denied        |
| Session policy or boundary removes permission | âŒ Denied        |

---

## ğŸ§  Analogy: IAM Policy Logic Is Like a Security Gate

Imagine AWS IAM as a **security guard at a gate**:

1. The gate is **closed by default** ğŸ§±
2. If someone shows an "Allow" pass âœ…, the guard **considers letting them in**
3. But if any pass says "DENY this person" âŒâ€”they're **instantly blocked**, no questions asked

---

## ğŸ§ª Real-Life Example: Evaluating S3 Access

- ğŸ¯ **Request**: User tries to run `s3:GetObject` on a file in an S3 bucket

### ğŸ” Step-by-Step

- âœ… Identity-based policy allows `s3:GetObject` on `arn:aws:s3:::docs/*`
- âŒ Resource-based policy has `"Effect": "Deny"` on `arn:aws:s3:::docs/secret.pdf`

**Result** â†’ âŒ Denied (because Deny > Allow)

---

## ğŸš« Gotchas to Watch Out For

- âŒ **Missing Allow** means Implicit Deny
- âŒ **Explicit Deny** overrides everything
- âŒ Conditions like `"aws:MultiFactorAuthPresent": "true"` can silently block requests if not met
- âœ… Combine multiple "Allow" statements to get full access, but **one Deny still ruins it**

---

## âœ… Summary

| Step | What Happens                                                          |
| ---- | --------------------------------------------------------------------- |
| 1ï¸âƒ£   | AWS collects all identity-based, resource-based, and session policies |
| 2ï¸âƒ£   | By default, the request is denied                                     |
| 3ï¸âƒ£   | AWS looks for a matching `"Effect": "Allow"`                          |
| 4ï¸âƒ£   | If any `"Effect": "Deny"` is found, it overrides the allow            |
| 5ï¸âƒ£   | If no allows match, access is implicitly denied                       |
