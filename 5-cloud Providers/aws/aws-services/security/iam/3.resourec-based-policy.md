# üîí **Resource-Based Policies in AWS**

> _"Who **can‚Äôt** do what on this **resource**?"_

A **resource-based policy** is a **JSON policy document** that you attach directly to an AWS resource (e.g., **S3 bucket**, **Lambda function**, **SQS queue**, etc.). It **grants permissions** to a **principal**‚Äîan external or internal identity‚Äîto perform specific actions on that resource.

---

## üß© **Key Characteristics**

| Feature                      | Description                                                             |
| ---------------------------- | ----------------------------------------------------------------------- |
| üìç **Attached To**           | A specific **AWS resource** (e.g., `S3`, `Lambda`, `SNS`, `SQS`)        |
| üë§ **Principal Required**    | ‚úÖ Must include `Principal` (unlike identity policies)                  |
| üåê **Cross-Account Support** | ‚úÖ Yes ‚Äî ideal for granting access to **other AWS accounts**            |
| üß∑ **Policy Type**           | Always **inline** (exists only on the resource, not reusable)           |
| üéØ **Granularity**           | Can allow/deny specific actions and resources, under certain conditions |

---

## üì¶ **Common Services That Use Resource-Based Policies**

- **S3 Bucket Policies**
- **AWS Lambda Permissions**
- **SQS Access Policies**
- **SNS Topic Policies**
- **Secrets Manager**
- **EventBridge**

---

## üß† **Policy Structure Example**

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::123456789012:user/Alice"
      },
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::example-bucket/*"
    }
  ]
}
```

---

## üéØ **Examples by Service**

### 1Ô∏è‚É£ S3 Bucket Policy: Public Read Access

```json
{
  "Effect": "Allow",
  "Principal": "*",
  "Action": "s3:GetObject",
  "Resource": "arn:aws:s3:::example_bucket/*"
}
```

‚û°Ô∏è **Use case**: Host a static website or share public files.

---

### 2Ô∏è‚É£ S3 Bucket Policy: Cross-Account Upload

```json
{
  "Effect": "Allow",
  "Principal": {
    "AWS": "arn:aws:iam::777788889999:user/bob"
  },
  "Action": ["s3:PutObject", "s3:PutObjectAcl"],
  "Resource": "arn:aws:s3:::example-bucket/*"
}
```

‚û°Ô∏è **Use case**: Allow Bob from another AWS account to upload objects.

---

### 3Ô∏è‚É£ Lambda Permission: S3 Trigger

```json
{
  "Effect": "Allow",
  "Principal": {
    "Service": "s3.amazonaws.com"
  },
  "Action": "lambda:InvokeFunction",
  "Resource": "arn:aws:lambda:us-west-2:123456789012:function:example_function",
  "Condition": {
    "StringEquals": {
      "AWS:SourceAccount": "123456789012"
    },
    "ArnLike": {
      "AWS:SourceArn": "arn:aws:s3:::example_bucket"
    }
  }
}
```

‚û°Ô∏è **Use case**: Let S3 trigger a Lambda function on new object creation.

---

### 4Ô∏è‚É£ SNS Topic Policy: Cross-Account Publish

```json
{
  "Effect": "Allow",
  "Principal": {
    "AWS": "arn:aws:iam::987654321098:root"
  },
  "Action": "sns:Publish",
  "Resource": "arn:aws:sns:us-west-2:123456789012:example_topic"
}
```

‚û°Ô∏è **Use case**: Let another account publish to your SNS topic.

---

## üîÅ **How They Compare: Resource-Based vs IAM Roles**

| Feature                       | Resource-Based Policy                          | IAM Role (Cross-Account AssumeRole)                      |
| ----------------------------- | ---------------------------------------------- | -------------------------------------------------------- |
| üéØ Purpose                    | Grant direct access to **a specific resource** | Delegate **temporary access** to AWS **identities**      |
| üß∑ Attach To                  | AWS Resource (e.g., S3, Lambda, SNS)           | IAM Role (identity)                                      |
| üë§ Principal Element Required | ‚úÖ Yes                                         | üö´ Not in the permission policy, but in **trust policy** |
| üîÑ Cross-Account Access       | ‚úÖ Yes                                         | ‚úÖ Yes                                                   |
| üîì Access Mechanism           | Resource checks the principal‚Äôs policy         | Principal assumes the role                               |
| üß† Role Used by Caller        | Caller retains their identity                  | Caller acts as the **assumed role**                      |

---

## ‚úÖ **When to Use Resource-Based Policies**

‚úÖ **Use them when**:

- You want to **share a resource** with other AWS accounts or services
- You want to allow **access without assuming a role**
- You want to enforce **access at the resource level**

üö´ **Don‚Äôt use them when**:

- You need **granular session control or credential expiration**
- You want users to **temporarily act as someone else (assume a role)**

---

## üõ†Ô∏è **Visualizing the Evaluation (Cross Account)**

```mermaid
flowchart LR
    A[Caller from Account A] -- Principal --> B[S3 Bucket Policy in Account B]
    B -- Action Allowed --> C[S3 Resource Access Granted]
    D[Caller without principal in resource policy] -->|Denied| X[Access Denied]
```

---

## üîç Extra Conditions You Can Use in Resource Policies

| Condition Key                | Use Case Example                         |
| ---------------------------- | ---------------------------------------- |
| `aws:SourceIp`               | Restrict access by IP range              |
| `aws:SourceArn`              | Validate event source (e.g., S3 trigger) |
| `aws:PrincipalOrgID`         | Limit to your AWS Organization only      |
| `aws:MultiFactorAuthPresent` | Enforce MFA (rare in resource-based)     |

---

## üß† Final Notes

- Resource-based policies are **powerful**, but **must be tightly scoped** to prevent unintended access.
- These policies allow you to **delegate access without transferring identity**‚Äîuseful for automation and secure integrations.
- You can **combine them** with **IAM identity-based policies** for **layered control**.

---

## üßæ Summary Table

| Feature                  | Resource-Based Policy                               |
| ------------------------ | --------------------------------------------------- |
| **Attached To**          | AWS Resource (e.g., S3, SNS, Lambda)                |
| **Principal Element**    | ‚úÖ Required                                         |
| **Cross-Account Access** | ‚úÖ Yes                                              |
| **Trust Delegation**     | ‚ùå Not applicable (use IAM role instead)            |
| **Evaluation Context**   | Evaluated by **resource**                           |
| **Best Use Case**        | Granting access to external users/services          |
| **Limitations**          | Can‚Äôt manage temporary credentials or session logic |
