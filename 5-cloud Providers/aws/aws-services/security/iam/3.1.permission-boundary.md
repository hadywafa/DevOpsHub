# â™‰ **IAM Permissions Boundary in AWS**

_Advanced control over what users and roles are **allowed to do, even with full permissions**_

---

<div align="center" style="padding: 0 20px;">
  <img src="images/permission-boundary.png" alt="Permission Boundary Overview" style="border-radius: 20px;" />
</div>

---

## ğŸ” **What Is a Permissions Boundary?**

A **Permissions Boundary** is an **advanced IAM feature** used to define the **maximum set of permissions** an IAM user or role can ever getâ€”even if their identity-based policy grants more.

> ğŸ§  **Analogy**:  
> Think of it like a **ceiling**â€”no matter how high a user jumps (via permissions), they canâ€™t go beyond the boundary.

### Key Concepts

- ğŸš« **It doesn't grant permissions**  
  â€” it only restricts them.
- âœ… **Effective permissions** = whatâ€™s allowed by **both**:
  - Identity-based policy
  - Permissions boundary

---

## ğŸ§° **Use Cases for Permissions Boundaries**

| Scenario                                   | Why It's Useful                                                                |
| ------------------------------------------ | ------------------------------------------------------------------------------ |
| ğŸ§‘â€ğŸ’¼ Delegate IAM access to junior admins | Let them create/manage users but **enforce limits** on what those users can do |
| ğŸš¨ Protect Production Resources            | Prevent elevated privileges in sensitive environments                          |
| ğŸ›¡ï¸ Prevent Misuse                          | Ensure even full-access users/roles **canâ€™t go beyond whatâ€™s allowed**         |

---

## âš™ï¸ **How It Works (The Math Behind It)**

```text
Effective Permissions = Identity Policy âˆ© Permissions Boundary
```

Only **actions allowed by BOTH** the identity-based policy **and** the boundary are permitted.

---

## ğŸ” **Simple Example: Restrict S3 Bucket Creation to `us-east-1`**

### ğŸ¯ Goal

Limit an admin named **Hady** to only create S3 buckets in `us-east-1`.

---

### âœ… Step 1: Create a Boundary Policy

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:CreateBucket",
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "s3:LocationConstraint": "us-east-1"
        }
      }
    }
  ]
}
```

ğŸ“Œ Save it as: `CreateS3BucketBoundary`

---

### âœ… Step 2: Attach the Boundary to User Hady

```bash
aws iam put-user-permissions-boundary \
  --user-name Hady \
  --permissions-boundary arn:aws:iam::AccountID:policy/CreateS3BucketBoundary
```

---

### âœ… Step 3: Assign a Broad Identity-Based Policy

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:*",
      "Resource": "*"
    }
  ]
}
```

Even though this policy allows all S3 actions, **Hady** will only be allowed to create buckets in `us-east-1`.

âœ… **Why?**  
Because the permissions boundary **filters out anything else**!

---

## ğŸ§ª **Full Use Case: Admin + User Setup with Boundaries (Fully Explained)**

<div align="center">
  <img src="images/permission-boundary-use-case.png" alt="Permission Boundary Use Case" style="border-radius: 10px;" />
</div>

---

Letâ€™s walk through how you can **securely delegate IAM permissions** to a sub-admin like `bob` who can create other users (like `hady`), while ensuring:

- `bob` can't assign dangerous permissions
- `hady` stays within a safe, controlled permission set

Weâ€™ll enforce this using **IAM permissions boundaries**.

---

### ğŸ‘¨â€ğŸ’¼ Step 1: Create Admin (`bob`) with Boundaries

You, as the root or super-admin, will first create `bob`â€”but you will **restrict him** using a permissions boundary (`adminboundary`) so he doesnâ€™t get out of control.

---

#### âœ… 1.1 Create `bob`

```bash
aws iam create-user --user-name bob
```

â¡ï¸ Creates the IAM user `bob`.

---

#### âœ… 1.2 Attach Admin Policy

```bash
aws iam put-user-policy --user-name bob \
--policy-name AdminPolicy \
--policy-document '{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "IAM",
      "Effect": "Allow",
      "Action": "iam:*",
      "Resource": "*"
    },
    {
      "Sid": "CloudWatchLimited",
      "Effect": "Allow",
      "Action": [
        "cloudwatch:GetDashboard",
        "cloudwatch:GetMetricData",
        "cloudwatch:ListDashboards",
        "cloudwatch:GetMetricStatistics",
        "cloudwatch:ListMetrics"
      ],
      "Resource": "*"
    }
  ]
}'
```

ğŸ§  This policy gives `bob`:

- Full IAM access: create users, attach policies, etc.
- Limited CloudWatch read access: just to monitor metrics.

But this policy **alone would make him too powerful**â€”so we attach a boundary next.

---

#### âœ… 1.3 Attach `adminboundary` to `bob`

```bash
aws iam put-user-permissions-boundary --user-name bob \
--permissions-boundary arn:aws:iam::MANAGEMENTACCOUNTNUMBER:policy/adminboundary
```

ğŸ§  Now, no matter how permissive the above policy is, `bob` can **only do whatâ€™s inside the boundary below**.

---

ğŸ“œ **`adminboundary` policy**  
_(Defines what `bob` is allowed to do)_

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "CreateOrChangeOnlyWithBoundary",
      "Effect": "Allow",
      "Action": [
        "iam:CreateUser",
        "iam:DeleteUserPolicy",
        "iam:AttachUserPolicy",
        "iam:DetachUserPolicy",
        "iam:PutUserPermissionsBoundary",
        "iam:PutUserPolicy"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "iam:PermissionsBoundary": "arn:aws:iam::MANAGEMENTACCOUNTNUMBER:policy/userboundary"
        }
      }
    },
    {
      "Sid": "CloudWatchAndOtherIAMTasks",
      "Effect": "Allow",
      "Action": [
        "cloudwatch:*",
        "iam:GetUser",
        "iam:ListUsers",
        "iam:DeleteUser",
        "iam:UpdateUser",
        "iam:CreateAccessKey",
        "iam:CreateLoginProfile",
        "iam:GetAccountPasswordPolicy",
        "iam:GetLoginProfile",
        "iam:ListGroups",
        "iam:ListGroupsForUser",
        "iam:CreateGroup",
        "iam:GetGroup",
        "iam:DeleteGroup",
        "iam:UpdateGroup",
        "iam:CreatePolicy",
        "iam:DeletePolicy",
        "iam:DeletePolicyVersion",
        "iam:GetPolicy",
        "iam:GetPolicyVersion",
        "iam:GetUserPolicy",
        "iam:GetRolePolicy",
        "iam:ListPolicies",
        "iam:ListPolicyVersions",
        "iam:ListEntitiesForPolicy",
        "iam:ListUserPolicies",
        "iam:ListAttachedUserPolicies",
        "iam:ListRolePolicies",
        "iam:ListAttachedRolePolicies",
        "iam:SetDefaultPolicyVersion",
        "iam:SimulatePrincipalPolicy",
        "iam:SimulateCustomPolicy"
      ],
      "NotResource": "arn:aws:iam::MANAGEMENTACCOUNTNUMBER:user/bob"
    },
    {
      "Sid": "NoBoundaryPolicyEdit",
      "Effect": "Deny",
      "Action": [
        "iam:CreatePolicyVersion",
        "iam:DeletePolicy",
        "iam:DeletePolicyVersion",
        "iam:SetDefaultPolicyVersion"
      ],
      "Resource": ["arn:aws:iam::MANAGEMENTACCOUNTNUMBER:policy/userboundary"]
    },
    {
      "Sid": "NoBoundaryUserDelete",
      "Effect": "Deny",
      "Action": "iam:DeleteUserPermissionsBoundary",
      "Resource": "*"
    }
  ]
}
```

ğŸ§  Key behavior:

- âœ… `bob` can **create** users **only if** he attaches `userboundary`
- âŒ `bob` **cannot remove boundaries**
- âŒ `bob` **cannot modify or delete the boundary itself**
- âœ… `bob` cannot escalate his own access (`NotResource`: himself)

---

### ğŸ‘¨â€ğŸ”§ Step 2: `bob` Creates a User (`hady`) with a Boundary

Now, `bob` is going to:

1. Create `hady`
2. Give `hady` permissions
3. Attach `userboundary` to `hady` (required)

---

#### âœ… 2.1 Create `hady`

```bash
aws iam create-user --user-name hady
```

â¡ï¸ IAM user created by `bob`.

---

#### âœ… 2.2 Attach Policy to `hady`

```bash
aws iam put-user-policy --user-name hady \
--policy-name ManageEC2Policy \
--policy-document '{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "ManageEC2",
      "Effect": "Allow",
      "Action": "ec2:*",
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "aws:RequestedRegion": "us-west-2"
        }
      }
    }
  ]
}'
```

ğŸ§  This policy gives `hady` full EC2 accessâ€”but only in region `us-west-2`.  
But this alone doesnâ€™t guarantee safety. Thatâ€™s why we also apply a **permissions boundary** next.

---

#### âœ… 2.3 Attach `userboundary`

```bash
aws iam put-user-permissions-boundary --user-name hady \
--permissions-boundary arn:aws:iam::MANAGEMENTACCOUNTNUMBER:policy/userboundary
```

âœ… This restricts `hady` to whatâ€™s inside the `userboundary` policy.

---

ğŸ“œ **`userboundary` policy**

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "ServicesLimitViaBoundaries",
      "Effect": "Allow",
      "Action": ["s3:*", "cloudwatch:*", "ec2:*"],
      "Resource": "*"
    },
    {
      "Sid": "AllowIAMConsoleForCredentials",
      "Effect": "Allow",
      "Action": ["iam:ListUsers", "iam:GetAccountPasswordPolicy"],
      "Resource": "*"
    },
    {
      "Sid": "AllowManageOwnPasswordAndAccessKeys",
      "Effect": "Allow",
      "Action": [
        "iam:*AccessKey*",
        "iam:ChangePassword",
        "iam:GetUser",
        "iam:*ServiceSpecificCredential*",
        "iam:*SigningCertificate*"
      ],
      "Resource": ["arn:aws:iam::*:user/${aws:username}"]
    }
  ]
}
```

ğŸ§  What this boundary does:

- âœ… Allows only `s3`, `ec2`, and `cloudwatch` actions
- âŒ Blocks access to anything outside those services
- âœ… Lets `hady` manage his own credentials/password

---

### âœ… Final Behavior

| User   | Permissions Policy                | Boundary Applied | Final Result                                                    |
| ------ | --------------------------------- | ---------------- | --------------------------------------------------------------- |
| `bob`  | Can manage IAM users and policies | `adminboundary`  | Can only create users that have `userboundary` enforced         |
| `hady` | Can access EC2 in `us-west-2`     | `userboundary`   | Limited to only EC2, S3, and CloudWatch; only in allowed region |

---

### ğŸ” **Verify Boundaries**

```bash
aws iam get-user --user-name bob
aws iam get-user-permissions-boundary --user-name bob

aws iam get-user --user-name hady
aws iam get-user-policy --user-name hady --policy-name ManageEC2Policy
aws iam get-user-permissions-boundary --user-name hady
```

---

## ğŸ“š Final Takeaways

- âœ… **Permissions Boundaries** are like safety nets for roles and users.
- ğŸ¯ They help prevent **over-permissioning**, especially in delegated environments.
- ğŸ” Powerful for **multi-account**, **delegation**, or **MFA-required scenarios**.
- ğŸ§  **Effective permissions** = Identity policy âˆ© boundary
