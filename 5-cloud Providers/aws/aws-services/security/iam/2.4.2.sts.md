# ğŸ” **AWS Security Token Service (STS)**

> _â€œSecure, short-lived, on-demand credentialsâ€”without long-term exposure.â€_

---

<div style="text-align: center;">
  <img src="images/sts-lifecycle.gif" alt="STS Lifecycle" style="border-radius: 20px;" />
</div>

---

## ğŸ“˜ **What is AWS STS?**

**AWS Security Token Service (STS)** is a global AWS service that enables you to request **temporary, limited-privilege credentials** for **IAM users**, **federated identities**, or **applications**. These credentials are issued on-demand and **automatically expire**, making them ideal for short-lived operations.

---

## ğŸŒŸ **Key Features of STS**

| Feature                             | Description                                                          |
| ----------------------------------- | -------------------------------------------------------------------- |
| ğŸ•’ **Temporary Credentials**        | Valid for 15 minutes to 12 hours (default: 1 hour)                   |
| ğŸ”„ **No Credential Rotation**       | Temporary credentials expire automaticallyâ€”no manual rotation needed |
| ğŸŒ **Global Service**               | Can be called from any region using the **global endpoint**          |
| ğŸ” **Supports Identity Federation** | External users (Google, AD, etc.) can securely access AWS            |
| âš™ï¸ **Role-Based Access**            | Easily assume roles across AWS services and accounts                 |

---

## ğŸ¯ **When to Use STS?**

| Use Case                    | Description                                                                   |
| --------------------------- | ----------------------------------------------------------------------------- |
| âœ… **Assume IAM Role**      | Allow a user or service to temporarily take on a different set of permissions |
| ğŸ” **Cross-Account Access** | Let users/services in Account A assume roles in Account B                     |
| ğŸŒ **Federated Identity**   | Allow external users (via SAML, Google, etc.) to temporarily access AWS       |
| ğŸ› ï¸ **CI/CD or Automation**  | Provide scripts, pipelines, or apps temporary secure access                   |

---

## ğŸ”„ **How STS Works â€“ Behind the Scenes**

```mermaid
sequenceDiagram
    participant App as App/User
    participant STS as AWS STS
    participant Role as IAM Role
    participant AWS as AWS Resource

    App->>STS: Request credentials (sts:AssumeRole)
    STS-->>App: Temp credentials (AccessKey, SecretKey, SessionToken)
    App->>AWS: Call services using temporary creds
    AWS-->>App: âœ… If permissions are allowed
```

---

## ğŸ”§ **How STS Generates Credentials**

1. **User/Service Makes Request**  
   Using the `sts:AssumeRole` API call, a user, service, or federated identity requests credentials.

2. **IAM Policy Check**  
   STS checks if the requester has permission to assume the target role using:

   ```json
   {
     "Effect": "Allow",
     "Action": "sts:AssumeRole",
     "Resource": "arn:aws:iam::123456789012:role/MyRole"
   }
   ```

3. **Trust Policy Validation**  
   The **role's trust policy** must also allow the principal to assume the role:

   ```json
   {
     "Effect": "Allow",
     "Principal": { "AWS": "arn:aws:iam::111111111111:user/John" },
     "Action": "sts:AssumeRole"
   }
   ```

4. **Temporary Credentials Issued**  
   STS returns a temporary credential set:

   - `AccessKeyId`
   - `SecretAccessKey`
   - `SessionToken`

5. **Credential Expiry**  
   By default, credentials last **1 hour**, but can be set between **15 minutes to 12 hours** depending on the role configuration.

---

## ğŸ”‘ **STS Credential Format Example**

```json
{
  "AccessKeyId": "ASIA....",
  "SecretAccessKey": "wJalrXUtnFEMI/K7MDENG/bPxRfiCY....",
  "SessionToken": "IQoJb3JpZ2luX2VjE...",
  "Expiration": "2025-04-15T14:30:00Z"
}
```

---

## ğŸ‘¥ **STS and External Identity Federation**

With **Web Identity Federation**, **SAML**, or **AWS IAM Identity Center**, users authenticated outside AWS (e.g., Google, Facebook, Microsoft AD) can temporarily access AWS using STS.

> ğŸ’¡ Perfect for integrating **single sign-on (SSO)** into your AWS ecosystem.

---

## ğŸ§ª **Real-World Use Cases**

### ğŸ”„ Cross-Account Access

- **Scenario**: DevOps user in Account A wants to manage RDS in Account B
- **Solution**:
  - IAM policy in Account A allows `sts:AssumeRole`
  - Trust policy in Account B allows Account Aâ€™s user

### âš™ï¸ Automation

- **Scenario**: A build pipeline in GitHub Actions needs to deploy to AWS
- **Solution**: GitHub Action assumes a role using STS with a short duration

### ğŸŒ Federated Login

- **Scenario**: An employee signs in with Google OAuth, then uses AWS via STS.
- **Solution**: Use AWS Cognito or IAM Identity Center to federate login and issue STS credentials.

---

## ğŸ“ **STS Session Duration Limits**

| Method                      | Duration Allowed  |
| --------------------------- | ----------------- |
| `AssumeRole`                | 15 min â€“ 12 hours |
| `AssumeRoleWithWebIdentity` | 15 min â€“ 1 hour   |
| `AssumeRoleWithSAML`        | 15 min â€“ 12 hours |
| `GetSessionToken`           | 15 min â€“ 36 hours |

> ğŸ“ The default is often **1 hour**, but this can be extended only if the role allows longer durations.

---

## âœ… **Benefits Recap**

| Benefit                     | Description                                              |
| --------------------------- | -------------------------------------------------------- |
| ğŸ” **Security**             | No long-lived secretsâ€”credentials expire automatically   |
| ğŸ”„ **Flexibility**          | Works with roles, SAML, OIDC, or web identity federation |
| ğŸ›¡ï¸ **Fine-Grained Control** | Policies control who can assume which roles and when     |
| ğŸŒ **Global Access**        | Available in all AWS regions and via global endpoints    |

---

## ğŸ§  Best Practices for Using STS

1. **Always prefer short sessions** (e.g., 15â€“30 minutes) for automation.
2. **Audit usage** with **CloudTrail** to detect anomalies.
3. **Do not hardcode STS credentials** in config files or apps.
4. **Use Session Tags** for traceability across microservices or users.
5. **Combine with IAM Roles** for access control and cross-account delegation.

---

## ğŸ§© Summary Table

| Feature                 | STS Capability                             |
| ----------------------- | ------------------------------------------ |
| Credentials Type        | Temporary                                  |
| Expiration Time         | Configurable (15mâ€“12h or more)             |
| Manual Rotation Needed? | âŒ No                                      |
| Requires IAM Permission | âœ… Yes (`sts:AssumeRole`, etc.)            |
| Supports Federation     | âœ… Web Identity, SAML, IAM Identity Center |
| Used For                | IAM roles, automation, third-party access  |
