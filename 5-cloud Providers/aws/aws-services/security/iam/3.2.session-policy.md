# Session Policy

## **What is a Session Policy in AWS?**

A **session policy** in AWS is a policy that you attach **temporarily** to a session when you assume a role, federate a user, or request temporary credentials. These policies limit the permissions of the session, even if the entity (e.g., role or user) has broader permissions associated with it.

**Key Points About Session Policies:**

1. **Temporary Nature**: Session policies apply only for the duration of the temporary session.
2. **Usage Context**: They are primarily used with:
   - **AssumeRole API**: To restrict the permissions of a role during a specific session.
   - **Federation**: To limit permissions of federated users.
   - **STS (Security Token Service)**: When obtaining temporary credentials.
3. **Scope Limitation**: A session policy cannot grant more permissions than the associated IAM principal (user or role) already has. It acts as an additional layer of restriction.

---

## **How Session Policies Work**

1. When you assume a role or request temporary credentials using AWS STS, you can pass a session policy to define what actions and resources are allowed during that session.
2. The session policy is evaluated alongside the permissions policies (IAM policies and resource-based policies). The **resulting session permissions** are the **intersection** of these policies.

---

## **Session Policy Use Cases**

1. **Limiting Role Usage for a Specific Task**:

   - A developer assumes a role with wide permissions, but a session policy restricts them to manage only a subset of resources (e.g., a specific S3 bucket) during the session.

2. **Temporary Permissions for Federated Users**:

   - When using identity federation, a session policy restricts what a federated user can do during their session in AWS.

3. **Security Enhancements**:
   - Adding a session policy ensures that even if the role has broader permissions, the temporary session is restricted to only what is needed for a specific task.

---

## **Example of a Session Policy**

Use Case: Assume a Role and Restrict Access to a Specific S3 Bucket

**1. **Role Policy** (Grants full S3 permissions):**

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:*",
      "Resource": "*"
    }
  ]
}
```

**2. **Session Policy** (Restricts to one specific S3 bucket):**

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::example-bucket/*"
    }
  ]
}
```

**3. **AssumeRole API Call** with the Session Policy:**

```bash
aws sts assume-role \
  --role-arn arn:aws:iam::ACCOUNT-ID:role/ExampleRole \
  --role-session-name ExampleSession \
  --policy '{
      "Version": "2012-10-17",
      "Statement": [
          {
              "Effect": "Allow",
              "Action": "s3:GetObject",
              "Resource": "arn:aws:s3:::example-bucket/*"
          }
      ]
  }'
```

**In this example:**

- The role itself has permissions for **all S3 actions** on **all resources**.
- The session policy limits access to **read objects only in a specific S3 bucket**.

---

## **Key Benefits of Session Policies**

- **Granular Control**: Provide task-specific restrictions without modifying the role or user permissions.
- **Security**: Mitigate risks by temporarily limiting access during a session.
- **Flexibility**: Enable temporary permissions for tasks without making permanent policy changes.

---

## **Limitations**

1. Session policies cannot grant more permissions than the attached policies (IAM role, user, or resource-based).
2. Session policies are evaluated along with all other applicable policies, and the most restrictive set of permissions is enforced.
