# ğŸ” **Encryption: Securing Your Data in the Cloud (Deep Dive)**

Encryption is the **mathematical shield** that secures your data during transmission and storage. In the cloud, it ensures that your sensitive data stays safe from interception, tampering, and unauthorized access.

---

<div style="text-align: center;">
    <img src="images/encryption.png" style="border-radius: 10px;" alt="Encryption">
</div>

---

## ğŸ›¡ï¸ **Two Types of Encryption in the Cloud**

### ğŸ”„ 1. **Encryption In Transit**

Protects data **while it travels** from one system to another (e.g., browser â†’ web server).

- âœ… Encrypts traffic using **TLS/SSL**
- âœ… Prevents eavesdropping and MITM attacks
- ğŸ” Uses **asymmetric key exchange + symmetric encryption**

### ğŸ’¾ 2. **Encryption At Rest**

Protects data **when it's stored** (e.g., on disk, in databases, or object storage like S3).

- âœ… Ensures data is unreadable without decryption keys
- âœ… Uses **symmetric encryption** (e.g., AES-256)
- ğŸ” Common in AWS: EBS, S3, RDS with AWS KMS

---

<div align="center">
  <img src="images/in-transit-vs-at-rest.png" style="border-radius: 10px; width: 80%;" alt="In Transit vs At Rest">
</div>

---

## ğŸ”‘ **Encryption Methods Explained**

Encryption methods define how data is secured using **keys** and **algorithms**. There are two main methods of encryption:

---

### ğŸ§  1. **Asymmetric Encryption** (Public/Private Key Cryptography) ğŸ”‘ğŸ”‘

<div style="text-align: center;">
    <img src="images/asymmetric.png" style="border-radius: 20px; width: 80%;" alt="Asymmetric Encryption">
</div>

#### ğŸ“˜ Definition

Asymmetric encryption uses a **key pair**:

- **Public key** (shared with anyone) â†’ used to **encrypt**
- **Private key** (kept secret) â†’ used to **decrypt**

> ğŸ”“ Data encrypted with a public key can only be decrypted with its corresponding private key.

---

#### ğŸ”¬ How It Works

1. ğŸ§‘â€ğŸ’» Client obtains the **serverâ€™s public key**
2. ğŸ” Client encrypts sensitive data using that public key
3. ğŸ” Server receives encrypted data
4. ğŸ”“ Server decrypts it using its **private key**

---

#### ğŸ§­ Real-World Usage

- TLS/SSL (key exchange step)
- Email encryption (PGP)
- SSH key pairs
- AWS KMS (asymmetric keys for signing or encryption)

---

#### âœ… Pros

- Public key can be safely distributed
- Supports **digital signatures** (authenticity & non-repudiation)
- Enables **secure key exchange**

---

#### âŒ Cons

- **Slow** for large datasets
- Only used for **small data** or **key exchange**, not bulk encryption

---

#### ğŸ“¦ Example

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -outform PEM -pubout -out public.pem
```

Now you can:

- Encrypt with `public.pem`
- Decrypt with `private.pem`

---

### ğŸ” 2. **Symmetric Encryption** (Shared Key) ğŸ”‘

<div style="text-align: center;">
    <img src="images/symmetric.png" style="border-radius: 20px; width: 80%;" alt="Symmetric Encryption">
</div>

#### ğŸ“˜ Definition

Symmetric encryption uses a **single shared secret key** for both:

- **Encryption**
- **Decryption**

> ğŸ” Anyone with the key can read the data.

---

#### ğŸ”¬ How It Works

1. ğŸ”‘ A secure key is shared (manually or using asymmetric encryption)
2. ğŸ§‘â€ğŸ’» Sender encrypts data with the key
3. ğŸ“¤ Sends encrypted message
4. ğŸ“¥ Receiver decrypts using the **same key**

---

#### ğŸ§­ Real-World Usage

- File storage (S3, EBS)
- Database encryption (RDS)
- VPN tunnels
- AWS KMS for envelope encryption

---

#### âœ… Pros

- **Very fast and efficient** (ideal for large files)
- Supported by hardware acceleration

---

#### âŒ Cons

- You must protect the shared key
- Not suitable for untrusted environments by itself

---

#### ğŸ“¦ Example (AES-256)

```bash
openssl enc -aes-256-cbc -salt -in file.txt -out file.enc
openssl enc -d -aes-256-cbc -in file.enc -out file_decrypted.txt
```

---

### ğŸ”— Combining Both (Real Cloud Practice)

> ğŸ” Use **asymmetric encryption** to securely exchange or wrap a **symmetric key**, then use symmetric encryption for bulk data encryption.

This is called **envelope encryption**â€”used by AWS KMS, GCP KMS, etc.

---

## ğŸ¤ TLS Encryption in Transit (Deep Internals)

<div align="center">

```mermaid
sequenceDiagram
    autonumber
    participant Browser as ğŸ§‘â€ğŸ’» Browser
    participant Server as ğŸŒ Web Server
    participant CA as ğŸ›ï¸ Certificate Authority

    Browser->>Server: ClientHello
    Note right of Browser: Sends TLS version, cipher list, ClientRandom

    Server-->>Browser: ServerHello + Certificate
    Note left of Server: Sends ServerRandom, selected cipher, and X.509 certificate

    Browser->>CA: Validate Certificate
    Note right of Browser: Verifies cert against trusted CA

    Browser->>Server: Encrypted Pre-Master Key (using server's public key)
    Note right of Browser: Only server can decrypt using its private key

    Server->>Server: Decrypt Pre-Master Key (with private key)

    Note over Browser, Server: Both derive same Master Key via PRF(ClientRandom + ServerRandom + PreMaster)

    Browser->>Server: Finished (encrypted)
    Server->>Browser: Finished (encrypted)

    Browser->>Server: Encrypted HTTP request (symmetric)
    Server-->>Browser: Encrypted HTTP response (symmetric)
```

</div>

---

## ğŸ§± **Encryption At Rest (with AWS KMS)**

> ğŸ”‘ AWS KMS is a **key management service** that provides **encryption at rest** for data stored in AWS
> ğŸ”‘ It uses **symmetric encryption**.

1. AWS KMS generates a **Data Encryption Key (DEK)**
2. It:
   - Returns plaintext DEK to encrypt the data
   - Encrypts DEK with a **CMK** (Customer Master Key)
3. Store:
   - Encrypted data
   - Encrypted DEK alongside it
4. On read:
   - Decrypt encrypted DEK with CMK
   - Use DEK to decrypt data

âœ… Efficient and secure  
âœ… Enables fine-grained key access control via IAM/KMS policies

---

## âœ… Best Practices for Encryption

| Practice                                | Why It's Important                              |
| --------------------------------------- | ----------------------------------------------- |
| Encrypt **in transit** and **at rest**  | Prevent theft from sniffing and storage attacks |
| Use **TLS 1.3** wherever possible       | Faster and more secure handshake                |
| Use **asymmetric key exchange**         | Never transmit symmetric keys in plain          |
| Use **envelope encryption** for storage | Securely handle keys with performance benefits  |
| Store keys in **dedicated KMS/HSM**     | Avoid app-layer key management                  |
| Rotate keys regularly                   | Reduce risk in case of compromise               |
| Enforce IAM permissions on key usage    | Least privilege access to keys and logs         |

---

## ğŸ“˜ Key Terminology

| Term                    | Definition                                                               |
| ----------------------- | ------------------------------------------------------------------------ |
| **Plaintext**           | Original readable data before encryption                                 |
| **Ciphertext**          | Encrypted, unreadable version of the data                                |
| **Public Key**          | Shared openly for encrypting or verifying                                |
| **Private Key**         | Secret key used for decryption or signing                                |
| **Session Key**         | Symmetric key used for fast encryption during a TLS session              |
| **CMK (KMS)**           | Customer Master Key (in AWS KMS), used to encrypt data keys              |
| **Envelope Encryption** | Secure method to encrypt data using a data key encrypted by a master key |

---

## ğŸ§  Final Summary

| ğŸ”’ Concept         | ğŸ’¬ Description                                            |
| ------------------ | --------------------------------------------------------- |
| **In Transit**     | Protects data during communication using TLS (HTTPS, VPN) |
| **At Rest**        | Protects stored data using AES-256 or envelope encryption |
| **Asymmetric**     | Public/private key pair, ideal for secure key exchange    |
| **Symmetric**      | Shared secret key, ideal for speed and large volumes      |
| **TLS + Envelope** | Combined approach used by cloud platforms                 |
