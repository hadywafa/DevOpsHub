# ğŸš€ **DynamoDB Streams & Pulling Mechanism: How It Works & Best Practices**

## ğŸ“Œ **What is DynamoDB Streams?**

DynamoDB Streams is a feature that **captures data changes** (INSERT, UPDATE, DELETE) in real-time and allows other services to **process these changes asynchronously**.

âœ”ï¸ **Key Features:**

- Captures item modifications in a **24-hour rolling window**.
- Can trigger **AWS Lambda, Kinesis, or custom consumers**.
- Uses a **sharded architecture** to scale automatically.
- Events are **ordered within each shard**.

âœ”ï¸ **Use Cases:**

- Event-driven applications (e.g., notifications, analytics).
- Replicating data to OpenSearch or other databases.
- **Triggering workflows** when an item is modified.

---

## ğŸ— **How DynamoDB Streams Works Internally**

### 1ï¸âƒ£ **Shards & Partition Mapping**

- **Each DynamoDB partition has a corresponding shard** in the stream.
- When an item is modified, the event is **recorded in the correct shard**.
- A **shard only contains records for its assigned partition**.

ğŸ”¹ **Example:**

| **DynamoDB Partition** | **Stream Shard** |
| ---------------------- | ---------------- |
| Partition 1            | Shard 1          |
| Partition 2            | Shard 2          |
| Partition 3            | Shard 3          |

ğŸ“Œ **If Partition 2 is modified, the event appears in Shard 2.**

---

### 2ï¸âƒ£ **Push vs. Pull Mechanism**

| **Mechanism** | **Description**                                                          | **Used By**               |
| ------------- | ------------------------------------------------------------------------ | ------------------------- |
| **Push**      | Event is **automatically delivered** to the consumer **without polling** | AWS SNS, SQS, EventBridge |
| **Pull**      | Consumer must **poll for new events** in a loop                          | DynamoDB Streams, Kinesis |

ğŸ“Œ **DynamoDB Streams uses a PULL mechanism**â€”consumers must fetch new records by **polling** the stream.

---

### 3ï¸âƒ£ **How AWS Lambda Handles Polling Efficiently**

AWS Lambda automatically polls DynamoDB Streams every **1 second**. The polling is:  
âœ… **Managed by AWS**â€”You donâ€™t need to handle polling logic.  
âœ… **Optimized for Cost**â€”You donâ€™t pay for the polling itself.  
âœ… **Scalable**â€”AWS Lambda multiple shards and scales as needed.

ğŸ“Œ **If no new data is available, AWS Lambda does nothingâ€”no unnecessary execution!**

---

## ğŸ’° **Cost of Reading DynamoDB Streams**

### âœ… **DynamoDB Streams are Free to Enable**

DynamoDB Streams do **not charge for enabling or storing stream records** for the **first 24 hours**.

ğŸ”¹ **However, reading from DynamoDB Streams incurs costs depending on the AWS service used for polling.**  
Letâ€™s break it down.

---

## ğŸ”„ **How DynamoDB Stream Reads Are Charged**

DynamoDB Streams use **Read Request Units (RRUs)** for reading stream records.

ğŸ“Œ **Cost per Read Request:**

- **\$0.02 per 100,000 read request units (RRUs)**
- **Each RRU can return up to 1 MB of stream data**

ğŸ”¹ **Formula for Estimating Read Costs:**

```plaintext
Total Cost = (Total Streamed Data in MB Ã· 1MB) Ã— ($0.02 Ã· 100,000)
```

---

## ğŸ” **Example Read Costs for DynamoDB Streams**

| **Stream Data Volume (Per Month)** | **Total Read Requests (RRUs)** | **Monthly Cost** |
| ---------------------------------- | ------------------------------ | ---------------- |
| **10 GB of stream data**           | `(10GB Ã· 1MB) = 10,000` RRUs   | **\$0.002**      |
| **100 GB of stream data**          | `(100GB Ã· 1MB) = 100,000` RRUs | **\$2**          |
| **1 TB of stream data**            | `(1TB Ã· 1MB) = 1,000,000` RRUs | **\$20**         |

âœ… **Key Takeaway:**  
DynamoDB Stream read costs are **very low** unless dealing with **high-volume real-time streaming**.

---

## ğŸš€ **How AWS Services Affect Stream Read Costs**

**Different AWS services interact with DynamoDB Streams and may introduce additional costs:**

| **AWS Service**       | **How It Reads the Stream?**                                | **Extra Costs?**                                            |
| --------------------- | ----------------------------------------------------------- | ----------------------------------------------------------- |
| **AWS Lambda**        | **AWS polls every second, triggers Lambda on new events**   | **No additional read costs (AWS manages polling for free)** |
| **Amazon Kinesis**    | **Kinesis polls stream records for analytics**              | **Kinesis processing costs apply**                          |
| **AWS Glue**          | **Glue ETL jobs read from the stream for batch processing** | **Glue job costs apply**                                    |
| **EC2 / Custom Apps** | **Custom polling logic using SDK (DynamoDB API calls)**     | **API requests consume read request units**                 |

ğŸ“Œ **Using Lambda is the most cost-effective because AWS handles polling for free!**

---

## ğŸ¯ **Best Practices to Reduce Costs**

âœ” **Use AWS Lambda to process streams (free polling)**.  
âœ” **Use `BatchSize` in Lambda to process multiple records per execution**.  
âœ” **Filter stream data at the source to reduce unnecessary reads**.  
âœ” **Use Amazon Kinesis only if dealing with high-throughput analytics.**

---

## ğŸ¯ **Final Thoughts**

âœ” **DynamoDB Streams uses a PULL mechanism, but AWS manages polling for you.**  
âœ” **Instead of implementing a manual polling system, use AWS Lambda for event-driven execution.**  
âœ” **For high-volume processing, Kinesis is a better choice than Lambda.**  
âœ” **Use EventBridge for real-time notifications and push-based workflows.**  
âœ” **AWS handles shard ordering and parallel processing to ensure scalability.**

âœ” **DynamoDB Stream reads cost \$0.02 per 100,000 read requests**.  
âœ” **Each read request retrieves up to 1MB of data**.  
âœ” **AWS Lambda processes streams without additional read costs** (polling is free).  
âœ” **For high-throughput streaming, Amazon Kinesis and Glue have extra processing costs**.

ğŸ“Œ **For most event-driven applications, AWS Lambda is the best cost-efficient way to consume DynamoDB Streams!** ğŸš€
