# üå± Root: RDS Backup and Snapshot üìÇ

Amazon **RDS (Relational Database Service)** provides multiple ways to back up and restore your database instances. These include **automated backups** and **manual snapshots**, each serving different purposes. Below, we‚Äôll break them down in detail, explaining **how they work, when to use them, and best practices**.

---

AWS SOMETime RENAME Automated Backup ==

---

## üîÑ **1. Automated Backups (Point-in-Time Recovery-PITR)**

### üìå **What Are Automated Backups?**

**Automated backups** are **daily backups** of your entire RDS database that AWS manages for you. They allow you to **restore your database to any point in time** within a defined retention period (up to 35 days).

### ‚úÖ **Key Features**

- **First Backup:** AWS takes a **full database backup** when automated backups are first enabled.
- **Incremental Backups:** After the first backup, AWS stores only **changes made since the last backup** (incremental).
- **Transaction Logs:** Captured **every 5 minutes**, allowing you to restore to a specific second.
- **Storage Location:** Backups are stored in **Amazon S3**.
- **Retention Period:** You can configure the retention period (default: **7 days**, max: **35 days**).
- **Multi-AZ Deployments:** Backups are taken from the **standby instance** to reduce performance impact.

---

### üí∞ **Pricing**

- **Free backup storage:** AWS provides **free storage equal to the size of your DB instance**. If your instance is 100GB, you get **100GB of free backup storage**.
- **Extra backup storage:** If you exceed the free limit, **additional storage incurs charges** based on **Amazon S3 pricing**.
- **Point-in-Time Recovery (PITR) costs:** Transaction log storage incurs a small fee per GB/month.
- **Restoration costs:** Restoring a backup is **free**, but the new RDS instance incurs standard RDS pricing.

> üí° if you delete your db instance, the automatic backup are deleted also, unless you copied it to your s3 bucket.

---

### üîÑ **How Automated Backups Work**

- **1Ô∏è‚É£** **Full backup** is taken when backups are first enabled.
- **2Ô∏è‚É£** **Daily incremental backups** store only changes.
- **3Ô∏è‚É£** **Transaction logs are captured every 5 minutes.**
- **4Ô∏è‚É£** AWS keeps backups **within the retention period** and **automatically deletes older ones**.
- **5Ô∏è‚É£** You can **restore to any second** within the retention period.

---

### üõ† **Mermaid Diagram: Automated Backup Process**

```mermaid
sequenceDiagram
    participant RDS Instance
    participant S3 Storage
    participant User

    RDS Instance->>S3 Storage: Perform Full Backup (Day 1)
    loop Every Day
        RDS Instance->>S3 Storage: Store Incremental Backup
    end
    loop Every 5 Min
        RDS Instance->>S3 Storage: Save Transaction Logs
    end
    User->>RDS Instance: Request Restore
    RDS Instance->>S3 Storage: Retrieve Full Backup
    RDS Instance->>S3 Storage: Apply Incremental Changes
    RDS Instance->>S3 Storage: Apply Transaction Logs
    RDS Instance->>User: Database Restored to Requested Time
```

---

### üìå **Restoring from Automated Backups**

AWS allows **Point-in-Time Recovery** (PITR), meaning you can restore your DB to an **exact second** within the retention period.  
‚úÖ **Example Use Case:** Your database got corrupted at **3:15 PM**, and you want to restore it to **3:14 PM**.

### üõ† **Example: Restore Database from Automated Backup**

```sh
aws rds restore-db-instance-to-point-in-time \
    --source-db-instance-identifier mydbinstance \
    --target-db-instance-identifier mydbinstance-restored \
    --restore-time "2025-03-05T15:14:00Z"
```

---

## üì∏ **2. Manual Snapshots (User-Controlled Backups)**

### üìå **What Are Manual Snapshots?**

A **manual snapshot** is a **user-initiated** full backup of an RDS instance at a specific time. Unlike automated backups, **manual snapshots are NOT deleted automatically** and persist until you delete them.

### ‚úÖ **Key Features**

- **Created manually** at any time.
- **Stored in Amazon S3** like automated backups.
- **Not automatically deleted** (you must delete them manually).
- **Only restored to the exact time they were taken** (unlike automated backups, which allow PITR).
- **Manual or Automated** ‚Äì Can be taken manually or as part of AWS Backup.
- **Can be copied across AWS regions.**
- **Does NOT support PITR (Point-in-Time Recovery).**

### üí∞ **Pricing**

- **Storage costs:** Manual snapshots are stored in **Amazon S3** and incur charges based on **Amazon S3 pricing per GB/month**.
- **Retention costs:** Since manual snapshots **are not automatically deleted**, they can accumulate costs if not managed properly.
- **Restoration costs:** Restoring a snapshot is **free**, but the new RDS instance will incur standard RDS pricing.

---

### üîÑ **How Manual Snapshots Work**

- **1Ô∏è‚É£** You **manually trigger** a snapshot via AWS Console, CLI, or API.
- **2Ô∏è‚É£** AWS **creates a full backup** and stores it in **Amazon S3**.
- **3Ô∏è‚É£** The snapshot **remains until you delete it**.
- **4Ô∏è‚É£** To restore, AWS **creates a new RDS instance** from the snapshot.

---

### üõ† **Mermaid Diagram: Manual Snapshot Process**

```mermaid
sequenceDiagram
    participant User
    participant AWS RDS
    participant S3 Storage

    User->>AWS RDS: Create Manual Snapshot
    AWS RDS->>S3 Storage: Store Full Database Copy
    User->>AWS RDS: Restore from Snapshot
    AWS RDS->>S3 Storage: Retrieve Snapshot Data
    AWS RDS->>User: New RDS Instance Created
```

---

### üõ† **Example: Create and Restore a Manual Snapshot**

```sh
# Create a Manual Snapshot
aws rds create-db-snapshot \
    --db-instance-identifier mydbinstance \
    --db-snapshot-identifier mydbsnapshot

# Restore from a Manual Snapshot
aws rds restore-db-instance-from-db-snapshot \
    --db-instance-identifier mydbinstance-restored \
    --db-snapshot-identifier mydbsnapshot
```

---

## ü§î **Automated Snapshots in RDS?**

### **What‚Äôs the Confusion?**

‚úî **Automated backups** happen **daily** and allow **point-in-time recovery (PITR)**.  
‚úî **Snapshots** are typically **manual** and do **not** support PITR.  
‚úî **But AWS also refers to "automated snapshots"** when talking about **the full backup** that happens as part of automated backups.

---

### **üîÑ What Are Automated Snapshots in RDS?**

When you enable **automated backups** in RDS, AWS **automatically takes a full storage-level snapshot** of your database **once per day**. This is sometimes referred to as an **"automated snapshot."**

### ‚úÖ **Key Points About Automated Snapshots**

- **They are NOT manually triggered** ‚Äì AWS takes them **automatically**.
- **They work with PITR** ‚Äì AWS also stores transaction logs every **5 minutes**, which allows point-in-time recovery.
- **Retention is configurable** ‚Äì You can store automated snapshots for up to **35 days**.
- **Deleted when the DB is deleted** ‚Äì Unless you copy them manually.

üí° **AWS automated snapshots are part of the automated backup system and are NOT the same as manually created snapshots.**

## üîÑ **3. Copying and Sharing RDS Snapshots**

### üìå **Why Copy a Snapshot?**

- **Cross-Region Disaster Recovery** ‚Äì Copy to another AWS region.
- **Compliance & Security** ‚Äì Keep multiple copies of backups.
- **Sharing with Other AWS Accounts** ‚Äì Grant access to snapshots to other AWS accounts.

---

### üõ† **Mermaid Diagram: Copying and Sharing a Snapshot**

```mermaid
sequenceDiagram
    participant User
    participant AWS RDS
    participant AWS Region 1
    participant AWS Region 2
    participant AWS Account 2

    User->>AWS RDS: Copy Snapshot
    AWS RDS->>AWS Region 1: Retrieve Snapshot
    AWS RDS->>AWS Region 2: Copy Snapshot to Another Region

    User->>AWS RDS: Share Snapshot
    AWS RDS->>AWS Account 2: Grant Access to Snapshot
```

---

### üõ† **Example: Copy and Share a Snapshot**

```sh
# Copy Snapshot to Another Region
aws rds copy-db-snapshot \
    --source-db-snapshot-identifier arn:aws:rds:us-east-1:123456789012:snapshot:mydbsnapshot \
    --target-db-snapshot-identifier mydbsnapshot-copy \
    --destination-region us-west-1

# Share Snapshot with Another AWS Account
aws rds modify-db-snapshot-attribute \
    --db-snapshot-identifier mydbsnapshot \
    --attribute-name restore \
    --values-to-add 987654321012
```

---

## üîç **Key Differences: Automated Backup vs. Manual Snapshot**

| Feature                         | **Automated Backup üîÑ**   | **Manual Snapshot üì∏**    |
| ------------------------------- | ------------------------- | ------------------------- |
| **Trigger**                     | Automatic (Daily)         | Manual (User Initiated)   |
| **Type**                        | Full + Incremental        | Full Only                 |
| **Point-in-Time Recovery**      | ‚úÖ Yes (to the second)    | ‚ùå No                     |
| **Retention**                   | Up to 35 days             | Until deleted manually    |
| **Storage Location**            | Amazon S3                 | Amazon S3                 |
| **Shared with Other Accounts?** | ‚ùå No                     | ‚úÖ Yes                    |
| **Copied Across Regions?**      | ‚úÖ Yes                    | ‚úÖ Yes                    |
| **Restoration**                 | Creates a new DB instance | Creates a new DB instance |

---

## **üîÑ 3. How Automated Backups & Snapshots Work Together**

| **Scenario**                                  | **Use Automated Backup?** | **Use Manual Snapshot?**                        |
| --------------------------------------------- | ------------------------- | ----------------------------------------------- |
| Restore a database to **a specific time**     | ‚úÖ Yes (PITR available)   | ‚ùå No (Only restores to snapshot time)          |
| Create a **backup before an upgrade**         | ‚ùå No                     | ‚úÖ Yes (Manual snapshot recommended)            |
| Archive data **for long-term retention**      | ‚ùå No (Backups expire)    | ‚úÖ Yes (Snapshots last indefinitely)            |
| Clone database **for testing or development** | ‚ùå No                     | ‚úÖ Yes                                          |
| Migrate database **across AWS accounts**      | ‚ùå No                     | ‚úÖ Yes (Snapshots can be shared)                |
| Perform **cross-region disaster recovery**    | ‚ùå No                     | ‚úÖ Yes (Snapshots can be copied across regions) |

---

## **üîç 4. Special Considerations for Multi-AZ Backups**

If your database is running **Multi-AZ**, **automated backups** and **snapshots** behave slightly differently.

‚úî **Automated backups (PITR) are taken from the standby instance**  
‚úî **Snapshots (manual or automated) are taken from the standby instance**  
‚úî **This prevents downtime but may take longer after failover**

### ‚ùì **Why Does the First Backup After Failover Take Longer?**

- **When failover happens**, the **standby instance becomes the new primary**.
- **Its storage blocks might not have recent incremental backups**.
- **AWS must back up all changed data**, which may take longer.

---

## **üî• 5. Key Takeaways & Best Practices**

‚úî **Automated backups are for disaster recovery (PITR).**  
‚úî **Manual snapshots are for long-term retention, testing, and migrations.**  
‚úî **If using Multi-AZ, backups are taken from the standby instance to avoid downtime.**  
‚úî **Snapshots are always full backups, but automated backups are incremental.**  
‚úî **Use AWS Backup for centralized control over retention and compliance.**

---

## **üí° Final Summary**

## üèÅ **Summary**

üöÄ **Automated Backups:**

- ‚úÖ Good for **daily backups** and **point-in-time recovery**.
- ‚úÖ AWS manages them automatically.
- ‚úÖ Retained **for up to 35 days** and deleted afterward.

üöÄ **Manual Snapshots:**

- ‚úÖ Good for **long-term storage** and **sharing with other accounts**.
- ‚úÖ User-initiated and **must be deleted manually**.
- ‚úÖ Can be copied across regions for **disaster recovery**.

üí° **Use automated backups for point-in-time recovery and disaster recovery. Use manual snapshots for long-term storage and controlled backups.**
