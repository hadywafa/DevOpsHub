# ğŸ” **AWS SSM Session Manager: Secure Shell Access Without SSH**

_The safest, most cloud-native way to connect to your EC2 and on-prem instances._

---

## ğŸ“˜ **What Is Session Manager?**

> **Session Manager** is a feature of **AWS Systems Manager** that allows you to **securely connect** to **EC2 instances**, **on-prem servers**, and **hybrid environments** without using SSH, opening ports, or managing SSH keys.

It's like having a **built-in, fully audited terminal** for your instances. Yes, even the ones in a **private subnet**.

---

## ğŸ” **Why Use Session Manager?**

| Feature                    | SSH                              | Session Manager                       |
| -------------------------- | -------------------------------- | ------------------------------------- |
| ğŸ” Keyless & Portless      | âŒ Needs SSH keys & open port 22 | âœ… No keys, no open ports             |
| ğŸ“œ Audit Logging           | âŒ Manual setup                  | âœ… Built-in (CloudTrail & CloudWatch) |
| ğŸ§  IAM Integrated          | âŒ No                            | âœ… Yes                                |
| ğŸï¸ Works in Private Subnet | âŒ Needs bastion or NAT          | âœ… Yes                                |
| ğŸ¯ Session Control         | âŒ Hard                          | âœ… Timeout, idle settings, logging    |
| ğŸŒ Browser Access          | âŒ                               | âœ… Terminal in AWS Console            |

---

## ğŸ§ª **How Session Manager Works Internally**

```mermaid
sequenceDiagram
    participant Admin as ğŸ‘¨â€ğŸ’» You (Admin)
    participant Console as ğŸ“Š AWS Console / CLI / SDK
    participant SSM as ğŸ§  AWS Systems Manager
    participant Agent as ğŸ“¡ SSM Agent on EC2
    participant EC2 as ğŸ–¥ï¸ EC2 OS Shell

    Admin->>Console: Start Session
    Console->>SSM: StartSession API Call
    SSM->>Agent: Secure WebSocket Setup (via SSM endpoint)
    Agent->>EC2: Open shell
    Admin-->>EC2: Interactive shell over HTTPS
    EC2-->>Admin: Output stream
```

> ğŸ’¡ **No inbound ports**, **no SSH Daemon**, just **SSM Agent + HTTPS**.

---

## ğŸ§© **Requirements & Setup**

### âœ… Prerequisites

1. âœ… EC2 instance must have the **SSM Agent installed and running**

   - Pre-installed on Amazon Linux 2, Ubuntu 20.04+, Windows Server 2016+
   - Can be installed manually on custom AMIs

2. âœ… Instance must have access to **SSM endpoints**

   - Via **Internet Gateway**, **NAT**, or **SSM VPC Endpoint**

3. âœ… Attached IAM Role must allow these actions:

   ```json
   {
     "Effect": "Allow",
     "Action": [
       "ssm:StartSession",
       "ssm:DescribeInstanceInformation",
       "ssm:SendCommand",
       "ssm:TerminateSession",
       "ssm:GetConnectionStatus"
     ],
     "Resource": "*"
   }
   ```

4. âœ… Instance Profile must include:

```json
{
  "Action": ["ssm:UpdateInstanceInformation", "ssmmessages:*", "ec2messages:*", "cloudwatch:PutMetricData", "logs:*"]
}
```

---

## ğŸš€ **How to Start a Session**

### ğŸ”¸ **Via Console:**

1. Go to **Systems Manager > Session Manager**
2. Click **Start Session**
3. Choose your EC2 instance
4. Get instant access to a browser-based terminal!

### ğŸ”¸ **Via AWS CLI:**

```bash
aws ssm start-session --target i-1234567890abcdef0
```

---

## ğŸ—‚ï¸ **Optional Configurations**

### ğŸ“¦ **Audit Logs (Enable Logging):**

You can log:

- Commands run during session
- Full shell output

To:

- ğŸ“„ **CloudWatch Logs**
- ğŸ“¦ **S3**

```bash
aws ssm put-document \
  --name MySessionLogConfig \
  --content file://session-config.json \
  --document-type Session
```

### Example `session-config.json`

```json
{
  "schemaVersion": "1.0",
  "description": "Log all session activity",
  "sessionType": "Standard_Stream",
  "inputs": {
    "s3BucketName": "my-log-bucket",
    "cloudWatchLogGroupName": "ssm-session-logs"
  }
}
```

---

## ğŸ§° Use Cases

| Scenario                       | SSM Session Manager Benefit                |
| ------------------------------ | ------------------------------------------ |
| EC2 in Private Subnet          | No NAT or bastion needed                   |
| Remote Admin                   | Use browser from any machine               |
| Security-Hardened Environments | No SSH key exposure                        |
| Audit & Compliance             | Every session logged and traceable         |
| Incident Response              | Drop into machine ASAP from console or CLI |

---

## ğŸ§  Best Practices

- âœ… Always enable **CloudWatch or S3 logging** for auditability
- âœ… Apply **IAM condition policies** (e.g. only allow sessions to prod if MFA is used)
- âœ… Disable direct SSH and close port 22 completely!
- âœ… Tag sessions or log groups by user/instance environment

---

## ğŸš« Common Pitfalls

| Issue                                 | Cause                                     | Fix                                          |
| ------------------------------------- | ----------------------------------------- | -------------------------------------------- |
| âŒ "Session cannot be started"        | SSM agent not installed or IAM missing    | Ensure agent runs and IAM is correct         |
| âŒ Session opens but no output        | Logging misconfigured or CW not permitted | Fix IAM for logs and verify log group exists |
| âŒ Canâ€™t access EC2 in private subnet | No NAT or SSM VPC endpoint                | Add VPC endpoint or route through NAT        |

---

## ğŸ”š Summary

âœ… **SSM Session Manager** gives you:

- Keyless, portless, secure shell access
- Fully auditable session history
- IAM-controlled and regionally available
- Works in **ANY VPC** â€” even isolated ones

---

## ğŸ”— References

- [ğŸ“˜ Official Docs](https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager.html)
- [ğŸ“˜ Start Session (CLI)](https://docs.aws.amazon.com/cli/latest/reference/ssm/start-session.html)
- [ğŸ“˜ IAM Policies for SSM Access](https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-getting-started-instance-profile.html)
- [ğŸ“˜ Session Logging](https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-logging.html)
