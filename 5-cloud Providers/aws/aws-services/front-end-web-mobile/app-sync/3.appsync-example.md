# 🛠️ **Full Example: Building an AWS AppSync API with DynamoDB (Step-by-Step Guide)**

In this tutorial, we will **create a GraphQL API using AWS AppSync** and connect it to **Amazon DynamoDB** to store and retrieve data. We will define GraphQL queries, mutations, and subscriptions to perform **CRUD operations on a Todo list**.

---

## 🎯 **Overview of What We’ll Build**

✔️ **Create an AWS AppSync API** with a **GraphQL schema**.  
✔️ **Connect AppSync to DynamoDB** as the data source.  
✔️ **Perform CRUD operations** (Create, Read, Update, Delete) using **GraphQL queries and mutations**.  
✔️ **Enable real-time updates** using **GraphQL subscriptions**.

---

## 🔥 **1. Setting Up an AppSync API**

### **Step 1: Create a New AppSync API**

1️⃣ Open the **AWS AppSync console**:

- Go to **AWS Console → AppSync → Create API**.  
  2️⃣ Select **"Build from Scratch"** and name your API **TodoAppAPI**.  
  3️⃣ Choose **API Key** as the authentication method (for demo purposes).  
  4️⃣ Click **Create**.

✔️ **Your GraphQL API is now created!**

---

## 📜 **2. Define a GraphQL Schema**

### **Step 2: Go to the Schema Tab and Add the Following Schema**

A **GraphQL schema** defines the API's structure.

```graphql
type Todo {
  id: ID!
  title: String!
  completed: Boolean!
}

type Query {
  getTodo(id: ID!): Todo
  listTodos: [Todo]
}

type Mutation {
  createTodo(title: String!, completed: Boolean!): Todo
  updateTodo(id: ID!, title: String, completed: Boolean): Todo
  deleteTodo(id: ID!): Todo
}

type Subscription {
  onCreateTodo: Todo @aws_subscribe(mutations: ["createTodo"])
}
```

✔️ **Queries** → Fetch data (`getTodo`, `listTodos`).  
✔️ **Mutations** → Modify data (`createTodo`, `updateTodo`, `deleteTodo`).  
✔️ **Subscriptions** → Get real-time updates (`onCreateTodo`).

---

## 🏢 **3. Set Up a DynamoDB Table as a Data Source**

### **Step 3: Create a DynamoDB Table**

1️⃣ Go to **AWS Console → DynamoDB → Create Table**.  
2️⃣ Table Name: **TodosTable**  
3️⃣ Partition Key: `id` (String)  
4️⃣ Click **Create Table**.

✔️ **Your DynamoDB table is ready!**

---

## 🔗 **4. Connect AppSync to DynamoDB**

### **Step 4: Add a Data Source in AppSync**

1️⃣ In **AppSync**, go to **"Data Sources"** → Click **"Create Data Source"**.  
2️⃣ Select **"Amazon DynamoDB Table"**.  
3️⃣ Enter **Data Source Name: `TodosTableDataSource`**.  
4️⃣ Choose **TodosTable** from the dropdown.  
5️⃣ Click **Create**.

✔️ **Your AppSync API is now connected to DynamoDB!**

---

## ⚡ **5. Create Resolvers to Fetch and Save Data**

### **Step 5: Attach Resolvers to Queries and Mutations**

1️⃣ Go to **Schema → Resolvers**.  
2️⃣ Click **Attach Resolver** for `listTodos`, `getTodo`, `createTodo`, `updateTodo`, and `deleteTodo`.  
3️⃣ Choose **`TodosTableDataSource`** as the data source.  
4️⃣ Use the following **resolvers** for each operation.

---

### **📖 Query Resolver – Get a Single Todo**

✔️ **This resolver retrieves a single todo by ID from DynamoDB.**

```json
{
  "version": "2018-05-29",
  "operation": "GetItem",
  "key": {
    "id": { "S": "$context.arguments.id" }
  }
}
```

✔️ **How It Works?**

- `operation: GetItem` fetches data from DynamoDB.
- `$context.arguments.id` retrieves the requested `id` from the GraphQL query.

---

### **📖 Query Resolver – List All Todos**

✔️ **This resolver fetches all todos from DynamoDB.**

```json
{
  "version": "2018-05-29",
  "operation": "Scan"
}
```

✔️ **How It Works?**

- `operation: Scan` retrieves all records from the DynamoDB table.

---

### **✏️ Mutation Resolver – Create a Todo**

✔️ **This resolver saves a new todo in DynamoDB.**

```json
{
  "version": "2018-05-29",
  "operation": "PutItem",
  "key": {
    "id": { "S": "$util.autoId()" }
  },
  "attributeValues": {
    "title": { "S": "$context.arguments.title" },
    "completed": { "BOOL": "$context.arguments.completed" }
  }
}
```

✔️ **How It Works?**

- `PutItem` inserts a new todo.
- `$util.autoId()` generates a unique `id`.
- `$context.arguments.title` and `completed` store the values from the GraphQL mutation.

---

### **✏️ Mutation Resolver – Update a Todo**

✔️ **This resolver updates an existing todo in DynamoDB.**

```json
{
  "version": "2018-05-29",
  "operation": "UpdateItem",
  "key": {
    "id": { "S": "$context.arguments.id" }
  },
  "update": {
    "expression": "SET #title = :title, #completed = :completed",
    "expressionNames": {
      "#title": "title",
      "#completed": "completed"
    },
    "expressionValues": {
      ":title": { "S": "$context.arguments.title" },
      ":completed": { "BOOL": "$context.arguments.completed" }
    }
  }
}
```

✔️ **How It Works?**

- `UpdateItem` modifies an existing todo.
- `SET #title = :title, #completed = :completed` updates the values.

---

### **❌ Mutation Resolver – Delete a Todo**

✔️ **This resolver deletes a todo from DynamoDB.**

```json
{
  "version": "2018-05-29",
  "operation": "DeleteItem",
  "key": {
    "id": { "S": "$context.arguments.id" }
  }
}
```

✔️ **How It Works?**

- `DeleteItem` removes a todo by its `id`.

---

## 🔄 **6. Real-Time Updates with Subscriptions**

### **Step 6: Subscribe to New Todos**

✔️ **Enable subscriptions for new todos.**

```graphql
subscription OnCreateTodo {
  onCreateTodo {
    id
    title
    completed
  }
}
```

✔️ Now, **clients get real-time updates whenever a new todo is added**!

---

## 🚀 **7. Testing the API**

### **Step 7: Use AppSync GraphQL Explorer**

1️⃣ Open **AWS AppSync Console → Queries**.  
2️⃣ Run the following GraphQL mutation:

```graphql
mutation {
  createTodo(title: "Learn AppSync", completed: false) {
    id
    title
    completed
  }
}
```

✔️ This adds a **new todo to DynamoDB**.  
✔️ Then, run the `listTodos` query to **fetch all todos**.

---

## 🎯 **Final Summary**

| **Step** | **Task**                                     |
| -------- | -------------------------------------------- |
| 1️⃣       | **Create an AppSync API**                    |
| 2️⃣       | **Define a GraphQL Schema**                  |
| 3️⃣       | **Create a DynamoDB Table**                  |
| 4️⃣       | **Connect AppSync to DynamoDB**              |
| 5️⃣       | **Attach Resolvers for Queries & Mutations** |
| 6️⃣       | **Enable Real-Time Subscriptions**           |
| 7️⃣       | **Test API with GraphQL Queries**            |

✔️ **You now have a fully working AppSync API with DynamoDB!** 🎉

---

### 🚀 **Next Steps**

- Want to add **authentication (Cognito, IAM, API Key)?**
- Need **Lambda resolvers** instead of DynamoDB?
- Want to connect **AppSync to SQL databases (RDS/Aurora)?**
