# ğŸ› ï¸ **Full Example: Building an AWS AppSync API with DynamoDB (Step-by-Step Guide)**

In this tutorial, we will **create a GraphQL API using AWS AppSync** and connect it to **Amazon DynamoDB** to store and retrieve data. We will define GraphQL queries, mutations, and subscriptions to perform **CRUD operations on a Todo list**.

---

## ğŸ¯ **Overview of What Weâ€™ll Build**

âœ”ï¸ **Create an AWS AppSync API** with a **GraphQL schema**.  
âœ”ï¸ **Connect AppSync to DynamoDB** as the data source.  
âœ”ï¸ **Perform CRUD operations** (Create, Read, Update, Delete) using **GraphQL queries and mutations**.  
âœ”ï¸ **Enable real-time updates** using **GraphQL subscriptions**.

---

## ğŸ”¥ **1. Setting Up an AppSync API**

### **Step 1: Create a New AppSync API**

1ï¸âƒ£ Open the **AWS AppSync console**:

- Go to **AWS Console â†’ AppSync â†’ Create API**.  
  2ï¸âƒ£ Select **"Build from Scratch"** and name your API **TodoAppAPI**.  
  3ï¸âƒ£ Choose **API Key** as the authentication method (for demo purposes).  
  4ï¸âƒ£ Click **Create**.

âœ”ï¸ **Your GraphQL API is now created!**

---

## ğŸ“œ **2. Define a GraphQL Schema**

### **Step 2: Go to the Schema Tab and Add the Following Schema**

A **GraphQL schema** defines the API's structure.

```graphql
type Todo {
  id: ID!
  title: String!
  completed: Boolean!
}

type Query {
  getTodo(id: ID!): Todo
  listTodos: [Todo]
}

type Mutation {
  createTodo(title: String!, completed: Boolean!): Todo
  updateTodo(id: ID!, title: String, completed: Boolean): Todo
  deleteTodo(id: ID!): Todo
}

type Subscription {
  onCreateTodo: Todo @aws_subscribe(mutations: ["createTodo"])
}
```

âœ”ï¸ **Queries** â†’ Fetch data (`getTodo`, `listTodos`).  
âœ”ï¸ **Mutations** â†’ Modify data (`createTodo`, `updateTodo`, `deleteTodo`).  
âœ”ï¸ **Subscriptions** â†’ Get real-time updates (`onCreateTodo`).

---

## ğŸ¢ **3. Set Up a DynamoDB Table as a Data Source**

### **Step 3: Create a DynamoDB Table**

1ï¸âƒ£ Go to **AWS Console â†’ DynamoDB â†’ Create Table**.  
2ï¸âƒ£ Table Name: **TodosTable**  
3ï¸âƒ£ Partition Key: `id` (String)  
4ï¸âƒ£ Click **Create Table**.

âœ”ï¸ **Your DynamoDB table is ready!**

---

## ğŸ”— **4. Connect AppSync to DynamoDB**

### **Step 4: Add a Data Source in AppSync**

1ï¸âƒ£ In **AppSync**, go to **"Data Sources"** â†’ Click **"Create Data Source"**.  
2ï¸âƒ£ Select **"Amazon DynamoDB Table"**.  
3ï¸âƒ£ Enter **Data Source Name: `TodosTableDataSource`**.  
4ï¸âƒ£ Choose **TodosTable** from the dropdown.  
5ï¸âƒ£ Click **Create**.

âœ”ï¸ **Your AppSync API is now connected to DynamoDB!**

---

## âš¡ **5. Create Resolvers to Fetch and Save Data**

### **Step 5: Attach Resolvers to Queries and Mutations**

1ï¸âƒ£ Go to **Schema â†’ Resolvers**.  
2ï¸âƒ£ Click **Attach Resolver** for `listTodos`, `getTodo`, `createTodo`, `updateTodo`, and `deleteTodo`.  
3ï¸âƒ£ Choose **`TodosTableDataSource`** as the data source.  
4ï¸âƒ£ Use the following **resolvers** for each operation.

---

### **ğŸ“– Query Resolver â€“ Get a Single Todo**

âœ”ï¸ **This resolver retrieves a single todo by ID from DynamoDB.**

```json
{
  "version": "2018-05-29",
  "operation": "GetItem",
  "key": {
    "id": { "S": "$context.arguments.id" }
  }
}
```

âœ”ï¸ **How It Works?**

- `operation: GetItem` fetches data from DynamoDB.
- `$context.arguments.id` retrieves the requested `id` from the GraphQL query.

---

### **ğŸ“– Query Resolver â€“ List All Todos**

âœ”ï¸ **This resolver fetches all todos from DynamoDB.**

```json
{
  "version": "2018-05-29",
  "operation": "Scan"
}
```

âœ”ï¸ **How It Works?**

- `operation: Scan` retrieves all records from the DynamoDB table.

---

### **âœï¸ Mutation Resolver â€“ Create a Todo**

âœ”ï¸ **This resolver saves a new todo in DynamoDB.**

```json
{
  "version": "2018-05-29",
  "operation": "PutItem",
  "key": {
    "id": { "S": "$util.autoId()" }
  },
  "attributeValues": {
    "title": { "S": "$context.arguments.title" },
    "completed": { "BOOL": "$context.arguments.completed" }
  }
}
```

âœ”ï¸ **How It Works?**

- `PutItem` inserts a new todo.
- `$util.autoId()` generates a unique `id`.
- `$context.arguments.title` and `completed` store the values from the GraphQL mutation.

---

### **âœï¸ Mutation Resolver â€“ Update a Todo**

âœ”ï¸ **This resolver updates an existing todo in DynamoDB.**

```json
{
  "version": "2018-05-29",
  "operation": "UpdateItem",
  "key": {
    "id": { "S": "$context.arguments.id" }
  },
  "update": {
    "expression": "SET #title = :title, #completed = :completed",
    "expressionNames": {
      "#title": "title",
      "#completed": "completed"
    },
    "expressionValues": {
      ":title": { "S": "$context.arguments.title" },
      ":completed": { "BOOL": "$context.arguments.completed" }
    }
  }
}
```

âœ”ï¸ **How It Works?**

- `UpdateItem` modifies an existing todo.
- `SET #title = :title, #completed = :completed` updates the values.

---

### **âŒ Mutation Resolver â€“ Delete a Todo**

âœ”ï¸ **This resolver deletes a todo from DynamoDB.**

```json
{
  "version": "2018-05-29",
  "operation": "DeleteItem",
  "key": {
    "id": { "S": "$context.arguments.id" }
  }
}
```

âœ”ï¸ **How It Works?**

- `DeleteItem` removes a todo by its `id`.

---

## ğŸ”„ **6. Real-Time Updates with Subscriptions**

### **Step 6: Subscribe to New Todos**

âœ”ï¸ **Enable subscriptions for new todos.**

```graphql
subscription OnCreateTodo {
  onCreateTodo {
    id
    title
    completed
  }
}
```

âœ”ï¸ Now, **clients get real-time updates whenever a new todo is added**!

---

## ğŸš€ **7. Testing the API**

### **Step 7: Use AppSync GraphQL Explorer**

1ï¸âƒ£ Open **AWS AppSync Console â†’ Queries**.  
2ï¸âƒ£ Run the following GraphQL mutation:

```graphql
mutation {
  createTodo(title: "Learn AppSync", completed: false) {
    id
    title
    completed
  }
}
```

âœ”ï¸ This adds a **new todo to DynamoDB**.  
âœ”ï¸ Then, run the `listTodos` query to **fetch all todos**.

---

## ğŸ¯ **Final Summary**

| **Step** | **Task**                                     |
| -------- | -------------------------------------------- |
| 1ï¸âƒ£       | **Create an AppSync API**                    |
| 2ï¸âƒ£       | **Define a GraphQL Schema**                  |
| 3ï¸âƒ£       | **Create a DynamoDB Table**                  |
| 4ï¸âƒ£       | **Connect AppSync to DynamoDB**              |
| 5ï¸âƒ£       | **Attach Resolvers for Queries & Mutations** |
| 6ï¸âƒ£       | **Enable Real-Time Subscriptions**           |
| 7ï¸âƒ£       | **Test API with GraphQL Queries**            |

âœ”ï¸ **You now have a fully working AppSync API with DynamoDB!** ğŸ‰

---

### ğŸš€ **Next Steps**

- Want to add **authentication (Cognito, IAM, API Key)?**
- Need **Lambda resolvers** instead of DynamoDB?
- Want to connect **AppSync to SQL databases (RDS/Aurora)?**
