# ğŸš€ **Amazon Kinesis Data Streams: Shared Throughput vs. Enhanced Fan-Out**

## **ğŸ“Œ Introduction**

Kinesis Data Streams (KDS) allows multiple consumers (applications) to **read and process** streaming data from a **shard**. However, when multiple consumers try to read from the same shard, there are **throughput limitations (quota)**.

To manage this, **Kinesis provides two modes** for reading data:

- 1ï¸âƒ£ **Shared Throughput Mode** (default)
- 2ï¸âƒ£ **Enhanced Fan-Out Mode** (premium feature)

---

## ğŸ¤” **WHY fan-out feature**

In Amazon Kinesis Data Streams (KDS), the **fan-out feature** is necessary to optimize throughput and latency when multiple consumers are reading the same record from the same stream. Hereâ€™s why fan-out is valuable even though multiple consumers can technically read the same data:

### 1ï¸âƒ£ **Parallel Data Delivery with Higher Throughput**

- Without enhanced fan-out, all consumers share the same read throughput quota for a shard (e.g., 2 MB/s per shard for data retrieval).
- **Fan-out enables each consumer to have its own dedicated throughput** (up to 2 MB/s per shard), ensuring that one consumerâ€™s high data demand doesnâ€™t affect the others.

### 2ï¸âƒ£ **Reduced Latency**

- Without fan-out, consumers may experience **latency spikes** because they must compete for read bandwidth and make frequent `GetRecords` API calls to poll data.
- **Fan-out provides a push-based model**, delivering data to consumers with much lower latency compared to polling.

### 3ï¸âƒ£ **Scalability for Multiple Independent Consumers**

- In scenarios where there are **multiple independent applications** reading the same data (e.g., analytics, monitoring, and archiving), fan-out ensures they can all operate at full speed without bottlenecks.

### 4ï¸âƒ£ **Use Cases for Real-Time and Concurrent Processing**

- Enhanced fan-out is especially useful for real-time applications, such as streaming dashboards or event-driven architectures, where minimizing delays and maximizing speed are critical.

> So, while basic consumers can share and read the same data, fan-out provides a performance boost, better scaling, and improved user experience for use cases requiring high-speed, parallel data consumption.

## ğŸ¯ **1. What is Shared Throughput?**

<div style="text-align: center;">
    <img src="images/aws-kds-shared-throughput.png" alt="aws-kds-shared-throughput" />
</div>

---

- ğŸ”¹ **All consumers share the 2 MB/sec read limit per shard**
- ğŸ”¹ **Higher consumer count = Slower performance**
- ğŸ”¹ **Consumes records using the `GetRecords` API** (pull-based)

---

- ğŸ”¹ **Throughput Limit**: ğŸš§ **2 MB/sec per shard**
- ğŸ”¹ **Latency**: ğŸš¨ Higher as the number of consumers increases
- ğŸ”¹ **Best for**: âœ… **Few consumers** (<3) and **non-latency-sensitive** applications

---

ğŸ”¹ **How it Works:**

```mermaid
sequenceDiagram
    participant Producer as ğŸ”µ Producer (Sends Data)
    participant Shard as ğŸ“¦ Kinesis Shard (2MB/sec limit)
    participant Consumer1 as ğŸ“¥ Consumer 1
    participant Consumer2 as ğŸ“¥ Consumer 2
    participant Consumer3 as ğŸ“¥ Consumer 3

    Producer->>Shard: ğŸ“© Sends Data (Log Events, Clicks, etc.)
    Consumer1->>Shard: ğŸ”„ Requests Data (GetRecords API)
    Consumer2->>Shard: ğŸ”„ Requests Data (GetRecords API)
    Consumer3->>Shard: ğŸ”„ Requests Data (GetRecords API)
    Shard->>Consumer1: â³ Limited Bandwidth
    Shard->>Consumer2: â³ Limited Bandwidth
    Shard->>Consumer3: â³ Limited Bandwidth
```

ğŸ“Œ **Issue**: More consumers = **higher delay** â³ because they all compete for the **same 2 MB/sec bandwidth**.

---

## ğŸš€ **2. What is Enhanced Fan-Out?**

<div style="text-align: center;">
    <img src="images/aws-kds-enhanced-fan-out.png" alt="aws-kds-enhanced-fan-out" />
</div>

---

- ğŸ”¹ **Each consumer gets a dedicated 2 MB/sec read throughput**
- ğŸ”¹ **Faster data propagation (latency ~70ms)**
- ğŸ”¹ **Uses `SubscribeToShard` API (push-based instead of pull-based)**

---

- ğŸ”¹ **Throughput Limit**: ğŸš€ **2 MB/sec per consumer**
- ğŸ”¹ **Latency**: âš¡ **~70ms, regardless of the number of consumers**
- ğŸ”¹ **Best for**: âœ… **Multiple consumers** (3+) and **real-time, low-latency processing**

---

ğŸ”¹ **How it Works:**

```mermaid
sequenceDiagram
    participant Producer as ğŸ”µ Producer (Sends Data)
    participant Shard as ğŸ“¦ Kinesis Shard
    participant Consumer1 as âš¡ Consumer 1 (2MB/sec)
    participant Consumer2 as âš¡ Consumer 2 (2MB/sec)
    participant Consumer3 as âš¡ Consumer 3 (2MB/sec)

    Producer->>Shard: ğŸ“© Sends Data (Log Events, Clicks, etc.)
    Shard->>Consumer1: ğŸš€ Pushes Data (SubscribeToShard API)
    Shard->>Consumer2: ğŸš€ Pushes Data (SubscribeToShard API)
    Shard->>Consumer3: ğŸš€ Pushes Data (SubscribeToShard API)
```

ğŸ“Œ **Advantage**: Each consumer gets **its own dedicated 2 MB/sec bandwidth**, so **no competition!** ğŸš€

---

## ğŸ”„ **Comparison: Shared Throughput vs. Enhanced Fan-Out**

| Feature             | Shared Throughput                                   | Enhanced Fan-Out                           |
| ------------------- | --------------------------------------------------- | ------------------------------------------ |
| **Read Bandwidth**  | ğŸš§ **2 MB/sec per shard** (shared)                  | ğŸš€ **2 MB/sec per consumer**               |
| **Latency**         | â³ **200ms (1 consumer)**, **1000ms (5 consumers)** | âš¡ **~70ms, even with multiple consumers** |
| **Record Delivery** | ğŸ”„ **Pull model** (`GetRecords` API)                | ğŸš€ **Push model** (`SubscribeToShard` API) |
| **Max Consumers**   | âœ… Unlimited (but limited by shared bandwidth)      | âŒ **20 consumers max** per stream         |
| **Best for**        | âœ… Few consumers, non-latency-sensitive             | âœ… Multiple consumers, real-time data      |

---

## ğŸ’° **Cost Considerations**

| **Mode**              | **Cost**                                                             |
| --------------------- | -------------------------------------------------------------------- |
| **Shared Throughput** | ğŸ†“ Free (no additional cost)                                         |
| **Enhanced Fan-Out**  | ğŸ’° **Extra cost** (charged per consumer-shard hour & data retrieval) |

ğŸ’¡ **Tip:** Use **Shared Throughput** when you have **few consumers** and **Enhanced Fan-Out** when you need **high-speed parallel processing.** ğŸš€

---

## ğŸ“Œ **When to Use Which Mode?**

| **Scenario**                                        | **Recommended Mode**     |
| --------------------------------------------------- | ------------------------ |
| **Few consumers (<3)**                              | âœ… **Shared Throughput** |
| **Many consumers (>3)**                             | âœ… **Enhanced Fan-Out**  |
| **Non-latency-sensitive**                           | âœ… **Shared Throughput** |
| **Real-time analytics (low latency required)**      | âœ… **Enhanced Fan-Out**  |
| **Cost-sensitive applications**                     | âœ… **Shared Throughput** |
| **Fraud detection, stock trading, live dashboards** | âœ… **Enhanced Fan-Out**  |

---

## ğŸ¯ **Final Thoughts**

âœ… **Shared Throughput** = **Good for small-scale applications, cost-effective**  
âœ… **Enhanced Fan-Out** = **Best for multiple real-time consumers, low-latency needs**  
âœ… **Both modes can be used together** in a **single stream** ğŸš€

ğŸ’¡ **Use Shared Throughput for most cases, but if speed matters, switch to Enhanced Fan-Out.**
