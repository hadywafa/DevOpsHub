# ğŸ† **Multi-Consumer Processing in Kinesis Data Streams (KDS)**

In KDS, multiple applications (or consumers) can read the same record from the same stream independently **without conflict**. You achieve this by configuring **multiple applications or streams readers** that use the Kinesis API (e.g., `GetRecords`, `SubscribeToShard`).

---

## **ğŸ¯ Scenario: E-commerce Order Processing & Notifications**

### **Orders Are Processed with These Statuses:**

âœ… **Order Placed** â†’ ğŸšš **Shipped** â†’ ğŸ“¦ **Delivered**

### **Two Independent Consumers (Systems) Subscribe to the Stream:**

1ï¸âƒ£ **Ordering System** ğŸ›’ â†’ Processes the order and updates inventory  
2ï¸âƒ£ **Notification System** ğŸ“© â†’ Sends emails and SMS notifications

### **Incoming Order Events:**

<div style="text-align: center;">

| Timestamp | Order ID  | Status         |
| --------- | --------- | -------------- |
| `T1`      | `Order-1` | âœ… _Placed_    |
| `T2`      | `Order-2` | âœ… _Placed_    |
| `T3`      | `Order-1` | ğŸšš _Shipped_   |
| `T4`      | `Order-3` | âœ… _Placed_    |
| `T5`      | `Order-2` | ğŸšš _Shipped_   |
| `T6`      | `Order-3` | ğŸšš _Shipped_   |
| `T7`      | `Order-1` | ğŸ“¦ _Delivered_ |
| `T8`      | `Order-2` | ğŸ“¦ _Delivered_ |
| `T9`      | `Order-3` | ğŸ“¦ _Delivered_ |

</div>

---

## **ğŸ”¥ How Kinesis Data Streams (KDS) Handles Multi-Consumer Subscriptions**

ğŸ’¡ **KDS uses shards to store and distribute messages.**

- **Partitioning:** Orders are assigned to a **shard** based on the `Partition Key` (e.g., `Order ID`).
- **Multiple consumers can subscribe to the same shard.**

### **ğŸ”„ KDS Subscription Model**

âœ” **Ordering System** and **Notification System** **both subscribe to the same shard** and read the same events.  
âœ” **Two types of consumer modes**:

- **Shared Throughput Mode** â†’ Consumers share the read bandwidth (2MB/sec per shard).
- **Enhanced Fan-Out Mode (EFO)** â†’ Each consumer gets a dedicated 2MB/sec channel.

```mermaid
sequenceDiagram
    participant Producer as ğŸ›’ Order Producer
    participant KDSShard1 as ğŸ”€ KDS Shard-1 (Orders)
    participant OrderingSystem as ğŸ“Œ Ordering System (Consumer-1)
    participant NotificationSystem as ğŸ“Œ Notification System (Consumer-2)

    Producer->>KDSShard1: âœ… Order-1 Placed
    Producer->>KDSShard1: âœ… Order-2 Placed
    Producer->>KDSShard1: ğŸšš Order-1 Shipped
    Producer->>KDSShard1: âœ… Order-3 Placed
    Producer->>KDSShard1: ğŸšš Order-2 Shipped
    Producer->>KDSShard1: ğŸšš Order-3 Shipped
    Producer->>KDSShard1: ğŸ“¦ Order-1 Delivered
    Producer->>KDSShard1: ğŸ“¦ Order-2 Delivered
    Producer->>KDSShard1: ğŸ“¦ Order-3 Delivered

    KDSShard1-->>OrderingSystem: âœ… Order-1 Placed â†’ ğŸšš Shipped â†’ ğŸ“¦ Delivered
    KDSShard1-->>NotificationSystem: âœ… Order-1 Placed â†’ ğŸšš Shipped â†’ ğŸ“¦ Delivered
    KDSShard1-->>OrderingSystem: âœ… Order-2 Placed â†’ ğŸšš Shipped â†’ ğŸ“¦ Delivered
    KDSShard1-->>NotificationSystem: âœ… Order-2 Placed â†’ ğŸšš Shipped â†’ ğŸ“¦ Delivered
```

## **ğŸ† Key Takeaways for KDS**

- âœ” **Both consumers see the same order sequence** (FIFO within a shard).
- âœ” **Each consumer reads independently** (they donâ€™t interfere with each other).
- âœ” **Enhanced Fan-Out ensures low latency per consumer.**
- ğŸ“Œ **Without EFO, consumers compete for read throughput (2MB/sec per shard).**
