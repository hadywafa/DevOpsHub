# 🔄 **AWS Lambda Triggers vs. Destinations**

AWS Lambda is an **event-driven** service, meaning it **executes functions automatically** when triggered by an event.

---

## ⚡ **What Are AWS Lambda Triggers?**

**Lambda Triggers** are mechanisms that automatically invoke your AWS Lambda functions in response to specific events. These events can originate from AWS services, direct HTTP requests, SDK API calls, or scheduled tasks, enabling your applications to react dynamically to changes and actions within your infrastructure.

<div style="text-align: center;">
    <img src="images/who-can-triggers-lambda-function.png" alt="Who Can Trigger Lambda Function" />
</div>

📌 **Examples of AWS services that can trigger Lambda**

- **S3**: When a file is uploaded to an S3 bucket, it triggers the specified Lambda function. This is often used for real-time processing of uploaded files, such as image resizing or data transformation.

- **API Gateway**: When an HTTP request is received at an API endpoint, the API Gateway triggers the Lambda function to handle the request. This is commonly used for serverless web applications and RESTful APIs.

- **SNS**: When a message is published to an SNS topic, it triggers the Lambda function to process the message. This is useful for building event-driven messaging workflows.

- **EventBridge (CloudWatch Events)**: When a scheduled event or a specific event pattern occurs, EventBridge triggers the Lambda function to execute a defined action. This is often used for scheduling tasks or responding to system events.

- **ALB** (Application Load Balancer): When a request is received by the ALB and routed to a target Lambda function, it triggers the function to process the request. This is used for scaling web applications and handling HTTP/HTTPS requests.

- **CloudFront**: When a CloudFront distribution receives a request, it can trigger a Lambda function (Lambda@Edge) to run and modify the request or response. This is used for tasks like content customization and security enforcement.

- **Cognito**: When an event occurs in an Amazon Cognito user pool, such as user sign-up or sign-in, it triggers the Lambda function to execute custom authentication or validation logic. This is used for enhancing user management and authentication flows.

- **Kinesis Data Streams**: Lambda function polls the Kinesis data stream for records and processes them in real time. This is used for real-time data processing and analytics.

- **Kafka**: Lambda function polls Kafka topics for new messages and processes them as they arrive. This is used for event-driven architectures and real-time data pipelines.

- **SQS**: Lambda function polls the SQS queue for new messages and processes them. This is used for decoupling and scaling microservices or handling asynchronous tasks.

- **DynamoDB Streams**: When a change occurs in a DynamoDB table, the DynamoDB stream captures the change and triggers the Lambda function to process it. This is used for real-time updates, analytics, and data replication.

- **Others**: such as **Step Functions**, **CloudFormation**, **Amazon Lex**, **Alexa**, **IOT**, **SES**

> 💡 We Will Discuss Invocation Types latter.
> 💡 Lambda functions can also be triggered directly from an HTTP request by enabling `function URL`.

### **🔹 How Do Triggers Work?**

When you set up a trigger:

- **1️⃣** The **AWS service (event source)** detects an event (e.g., file upload to S3).
- **2️⃣** It **sends the event data** to the Lambda function.
- **3️⃣** Lambda **executes the function**, processes the event, and returns a response.

---

### 🛠 **Example: S3 Trigger for Lambda**

Let's say you want **Lambda to execute** whenever a file is uploaded to an S3 bucket.

#### **Step 1: Configure an S3 Trigger for Lambda (AWS CLI)**

```sh
aws s3api put-bucket-notification-configuration \
  --bucket my-bucket \
  --notification-configuration '{
      "LambdaFunctionConfigurations": [
          {
              "LambdaFunctionArn": "arn:aws:lambda:us-east-1:123456789012:function:myFunction",
              "Events": ["s3:ObjectCreated:*"]
          }
      ]
  }'
```

> 📌 **What happens now?**
>
> - Every time a new file is uploaded to `my-bucket`, **S3 sends an event to Lambda**, which **executes the function** automatically.

---

## 🎯 **What Are AWS Lambda Destinations?**

### **🔹 What is a Destination?**

AWS Lambda **Destinations** define **where Lambda sends the output** of an **asynchronous invocation**.

📌 **Lambda Destinations are used for:**

- **✅Success Destinations:** Where to send the result if Lambda executes successfully
- **❌Failure Destinations:** Where to send error information if Lambda fails

📌 **Supported Destinations:**

- **SNS (Simple Notification Service)** – Notify users or services of function results
- **SQS (Simple Queue Service)** – Queue function results for further processing
- **EventBridge** – Route results to another AWS service
- **Another Lambda Function** – Chain multiple Lambda executions

---

### 🛠 **Example: Set Up a Destination for Success and Failure Events**

#### **Step 1: Configure Lambda Destinations (AWS CLI)**

```sh
aws lambda put-function-event-invoke-config \
  --function-name myFunction \
  --destination-config '{
      "OnSuccess": {
          "Destination": "arn:aws:sns:us-east-1:123456789012:SuccessTopic"
      },
      "OnFailure": {
          "Destination": "arn:aws:sqs:us-east-1:123456789012:FailureQueue"
      }
  }'
```

> 📌 **What happens now?**
>
> - If Lambda runs **successfully**, it sends the result to **SNS (SuccessTopic)**
> - If Lambda **fails**, it sends error details to **SQS (FailureQueue)**

---

Yes, you got it! Here’s a **clear breakdown** of how **Triggers** and **Resource-Based Policies** relate to each other and their role in invoking AWS Lambda functions.

---

## ✅ **Triggers vs. Resource-Based Policies: When & Why You Need Them**

| Feature                     | **Triggers**                                                                       | **Resource-Based Policies**                                            |
| --------------------------- | ---------------------------------------------------------------------------------- | ---------------------------------------------------------------------- |
| **Purpose**                 | Automatically execute Lambda when an event occurs in an AWS service                | Define **who/what is allowed** to invoke Lambda                        |
| **Execution Type**          | **Event-driven** (automatically runs when an event happens)                        | **Authorization mechanism** (grants permission to invoke)              |
| **Use Case**                | S3 file upload, API Gateway request, DynamoDB stream change, EventBridge, SNS, SQS | Allowing another AWS service or AWS account to invoke Lambda           |
| **Configuration Location**  | Set **inside the triggering AWS service** (e.g., S3, API Gateway, etc.)            | Set **inside the Lambda function’s resource-based policy**             |
| **Is It Required?**         | ✅ Yes, needed for automatic invocation                                            | ✅ Yes, required if another AWS service needs to invoke Lambda         |
| **Works Without Triggers?** | ❌ No, a trigger must be configured to start execution automatically               | ✅ Yes, can be used to manually invoke Lambda from another AWS account |

---

### 🛠 **How Triggers & Resource-Based Policies Work Together**

- **Triggers** define **when Lambda should execute** (e.g., file uploaded to S3).
- **Resource-Based Policies** control **who/what is allowed to trigger Lambda** (e.g., allow S3 to invoke the function).

📌 **So even if you configure a trigger in S3, API Gateway, or EventBridge, Lambda will reject the invocation unless a resource-based policy allows it.**

---

## 🔥 **Example: S3 Trigger Needs a Resource-Based Policy**

### **1️⃣ Set Up an S3 Trigger (Automatic Execution)**

```sh
aws s3api put-bucket-notification-configuration \
  --bucket my-bucket \
  --notification-configuration '{
      "LambdaFunctionConfigurations": [
          {
              "LambdaFunctionArn": "arn:aws:lambda:us-east-1:123456789012:function:myFunction",
              "Events": ["s3:ObjectCreated:*"]
          }
      ]
  }'
```

📌 **Now, S3 is configured to trigger Lambda when a new file is uploaded.**

---

### **2️⃣ Allow S3 to Invoke Lambda (Resource-Based Policy)**

```sh
aws lambda add-permission \
  --function-name myFunction \
  --statement-id AllowS3Invoke \
  --action "lambda:InvokeFunction" \
  --principal s3.amazonaws.com \
  --source-arn arn:aws:s3:::my-bucket \
  --source-account 123456789012
```

📌 **This grants S3 permission to actually invoke the Lambda function.**

🚀 **Now, when a file is uploaded to S3, it will automatically trigger Lambda!**

---

## 🔄 **When Do You Only Need a Resource-Based Policy?**

There are **cases where you don’t need a trigger** but still need a **resource-based policy**, such as:

✅ **Allowing an external AWS account to manually invoke Lambda**  
✅ **Allowing another AWS service (like Step Functions) to invoke Lambda without a trigger**

### **Example: Allow Another AWS Account to Invoke Lambda**

```sh
aws lambda add-permission \
  --function-name myFunction \
  --statement-id AllowCrossAccountInvoke \
  --action "lambda:InvokeFunction" \
  --principal arn:aws:iam::987654321098:root
```

📌 **Now, AWS account `987654321098` can manually invoke Lambda, but it won’t execute automatically.**

---

## 🎯 **Final Summary**

🔹 **Triggers → Define WHEN Lambda should execute (automatic execution)**  
🔹 **Resource-Based Policies → Define WHO/WHAT can invoke Lambda (authorization)**  
🔹 **Triggers need Resource-Based Policies to work**  
🔹 **You can use a Resource-Based Policy alone for manual execution (e.g., cross-account access)**
