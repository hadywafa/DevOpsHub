# ğŸŒ± **AWS Lambda Environment Variables â€“ Configuring Functions Dynamically & Securely**

AWS Lambda **Environment Variables** allow you to **store and manage configuration settings** without modifying your code. They are useful for **storing secrets, database connections, API keys, and feature flags**.

However, while **AWS encrypts environment variables at rest**, **they are not automatically encrypted in transit** when being retrieved inside your Lambda function. Additional security measures are recommended for **sensitive data**.

---

## ğŸ›  **How to Use Environment Variables in Lambda**

âœ”ï¸ **Define Key-Value Pairs** â€“ Set variables in the AWS Lambda console or via the AWS CLI.  
âœ”ï¸ **Access Variables in Code** â€“ Use standard environment variable retrieval methods in Python, Node.js, Java, etc.  
âœ”ï¸ **Secure Sensitive Data** â€“ Encrypt values using **AWS KMS** or store them in **AWS Secrets Manager**.

---

## ğŸ“Œ **Setting Environment Variables**

### **1ï¸âƒ£ AWS Console**

- Go to **AWS Lambda â†’ Your Function â†’ Configuration â†’ Environment Variables**
- Add key-value pairs like:
  - `DB_HOST = mydatabase.example.com`
  - `API_KEY = abc123secret`

### **2ï¸âƒ£ AWS CLI**

```sh
aws lambda update-function-configuration \
  --function-name myLambdaFunction \
  --environment "Variables={DB_HOST=mydatabase.example.com,API_KEY=abc123secret}"
```

---

## ğŸ§‘â€ğŸ’» **Accessing Environment Variables in Code**

### **Python Example**

```python
import os

def lambda_handler(event, context):
    db_host = os.getenv("DB_HOST")  # Fetch environment variable
    api_key = os.getenv("API_KEY")
    return {"Database Host": db_host, "API Key": api_key}
```

### **Node.js Example**

```javascript
exports.handler = async (event) => {
  const dbHost = process.env.DB_HOST;
  const apiKey = process.env.API_KEY;
  return { "Database Host": dbHost, "API Key": apiKey };
};
```

---

## ğŸ” **Security Considerations for Environment Variables**

### **âœ”ï¸ Encryption at Rest (AWS Managed)**

- AWS **automatically encrypts** environment variables **at rest** using an **AWS-managed KMS key**.
- You can also configure a **custom AWS KMS key** for added security.

**AWS CLI Example (Using a KMS Key for Encryption):**

```sh
aws lambda update-function-configuration \
  --function-name myLambdaFunction \
  --kms-key-arn arn:aws:kms:region:account-id:key/your-key-id
```

### **ğŸš¨ Data in Transit is NOT Encrypted Automatically**

- **Environment variables are decrypted when accessed inside the function** but **are NOT encrypted in transit** within the execution environment.
- **If an attacker gains access to the Lambda runtime environment, they can read sensitive data in plaintext.**

---

## ğŸ›¡ï¸ **How to Secure Environment Variables in Transit**

Instead of storing sensitive data like **API keys, database credentials, or secrets** in environment variables, use **a more secure approach**:

### **1ï¸âƒ£ Use AWS Secrets Manager** (Recommended âœ…)

- Secrets Manager encrypts secrets **both at rest and in transit**.
- It supports automatic **rotation of credentials**.
- Fetch secrets securely at runtime instead of storing them in environment variables.

**Example (Fetching a Secret in Python):**

```python
import boto3
import json

def get_secret():
    client = boto3.client('secretsmanager')
    secret_value = client.get_secret_value(SecretId='my-secret-id')
    return json.loads(secret_value['SecretString'])
```

### **2ï¸âƒ£ Use AWS Systems Manager Parameter Store**

- Store sensitive data **securely** and fetch it **only when needed**.
- Supports **encryption with AWS KMS** and **IAM-based access controls**.

**Example (Fetching a Parameter in Python):**

```python
import boto3

def get_parameter():
    ssm = boto3.client('ssm')
    response = ssm.get_parameter(Name='my-db-password', WithDecryption=True)
    return response['Parameter']['Value']
```

---

## ğŸ¯ **Why Use Environment Variables?**

âœ”ï¸ **Easier Configuration** â€“ Update values without changing code.  
âœ”ï¸ **Security at Rest** â€“ Environment variables are **encrypted** using AWS KMS.  
âœ”ï¸ **Flexibility** â€“ Use different configurations for **dev, test, and prod** environments.

ğŸš¨ **Why Avoid Storing Secrets in Environment Variables?**  
âœ”ï¸ **Not encrypted in transit** inside the execution environment.  
âœ”ï¸ **Exposed if an attacker gains access to the runtime process.**  
âœ”ï¸ **No automatic rotation** (unlike AWS Secrets Manager).

---

## ğŸš€ **Final Takeaways**

âœ”ï¸ **Environment variables help manage configurations without code changes.**  
âœ”ï¸ **AWS encrypts environment variables at rest, but NOT in transit** â€“ use AWS Secrets Manager for sensitive data.  
âœ”ï¸ **For security best practices, use AWS Secrets Manager or Systems Manager Parameter Store instead of storing secrets in environment variables.**
