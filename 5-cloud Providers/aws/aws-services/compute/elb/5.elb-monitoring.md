# **📊 ELB Monitoring and Access Logs**

Keeping your applications fast, secure, and highly available is key when using AWS **Elastic Load Balancers (ELBs)**. This guide simplifies how to monitor ELBs and enable access logs, with rich examples, visuals, and best practices to give you full control over your traffic.

---

## **🚀 Why ELB Monitoring & Logs Matter**

- **Performance Insights:** Spot slowdowns before users complain.
- **Security Auditing:** Detect suspicious behavior and unauthorized access.
- **Troubleshooting:** See exactly what requests hit your backend and how they responded.

---

## **1️⃣ Key Monitoring Tools for ELB**

### **🔍 a. Amazon CloudWatch Metrics**

**What it is:** Built-in monitoring tool for ELB performance and health.

#### 🔧 **Metrics You Get:**

| Metric                | Description                              |
| --------------------- | ---------------------------------------- |
| RequestCount          | Total HTTP(S) requests served.           |
| TargetResponseTime    | How long your targets take to respond.   |
| HTTPCode_ELB_5XX      | Errors generated by ELB itself.          |
| HTTPCode_Target_5XX   | Errors coming from your backend targets. |
| ActiveConnectionCount | Ongoing open TCP connections (NLB only). |

#### 🔔 **Setting Alerts (Example)**

- Create a CloudWatch alarm if `TargetResponseTime > 1s` for 3 datapoints.
- Trigger an SNS email alert or auto-scale EC2 instances.

---

### **🕵️‍♂️ b. AWS CloudTrail**

**What it is:** Captures all API calls to ELB (who did what and when).

#### ✅ **What You See:**

- Who created/deleted a load balancer
- When listeners were modified
- What IP triggered the action

**💼 Use Case:** Essential for **security audits**, **troubleshooting**, and **change tracking**.

#### 🛠 Example

> You can filter CloudTrail logs to detect unauthorized ELB configuration changes:

```json
{
  "eventSource": "elasticloadbalancing.amazonaws.com",
  "eventName": "DeleteLoadBalancer"
}
```

---

### **📝 c. ELB Access Logs**

**What it is:** Logs **each request** hitting your ELB — from client IP to backend response code.

#### 📦 What’s in a Log Entry?

```ini
http 2023-08-10T12:34:56Z app/my-alb 192.0.2.10:12345 10.0.1.10:80 200 0.123
```

- `192.0.2.10`: Client IP
- `10.0.1.10`: Backend target IP
- `200`: HTTP status
- `0.123`: Target response time in seconds

#### 🔐 Where It's Stored

- Logs go to your chosen **Amazon S3 bucket**.
- Can be queried using **Amazon Athena** or **AWS Glue**.

#### 🛠 Enable Access Logs

```bash
aws elbv2 modify-load-balancer-attributes \
  --load-balancer-arn arn:aws:... \
  --attributes Key=access_logs.s3.enabled,Value=true \
               Key=access_logs.s3.bucket,Value=my-logs-bucket
```

---

## **2️⃣ Best Practices for Monitoring & Logs**

### ✅ **Enable Access Logs**

- Turn on for all ELBs to retain visibility.
- Store in **S3 with encryption** and **least-privilege access**.

### 📈 **Set Up CloudWatch Alarms**

- Monitor errors (5xx), high latency, or dips in request count.
- Trigger **Auto Scaling**, Lambda, or notifications.

### 🔐 **Integrate with CloudTrail**

- Audit all ELB-related API actions.
- Store logs in **immutable S3 buckets** (versioning + MFA delete).

### 🔄 **Review Logs Regularly**

- Schedule Athena queries or use 3rd-party dashboards (like Datadog, Splunk).
- Spot DDoS, unusual traffic, or performance regressions.

### 💰 **Control Costs**

- Use **S3 lifecycle policies** to archive old logs (e.g., move to Glacier).
- Delete after 30/90 days if logs aren’t needed for compliance.

---

## **3️⃣ Sample Real-World Use Cases**

| Scenario                  | Monitoring Insight                     | Action to Take                      |
| ------------------------- | -------------------------------------- | ----------------------------------- |
| Sudden latency spike      | CloudWatch `TargetResponseTime` > 1.5s | Trigger scale-out policy            |
| Surge in 5xx errors       | `HTTPCode_Target_5XX_Count` rising     | Check backend EC2 logs              |
| Unauthorized ELB deletion | CloudTrail shows suspicious API call   | Alert security team & revert change |
| Investigate malicious IPs | Use ELB access logs from S3            | Block via AWS WAF or NACLs          |

---

## **4️⃣ Conclusion 🎯**

**Monitoring and logging** are your ELB's best friends. They:

- Detect outages before your users do 🧠
- Expose security incidents 🔐
- Help you debug faster 🛠️

By combining **CloudWatch metrics**, **CloudTrail API logs**, and **ELB access logs**, you gain a 360° view of your traffic and infrastructure.

> 📌 Don’t forget: Logs are only useful if you look at them — schedule regular reviews or automate insights!

---

## **📚 Quick Links**

- [Enable ALB Access Logs](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-access-logs.html)
- [CloudWatch Metric Reference](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html)
- [Query ELB Logs with Athena](https://docs.aws.amazon.com/athena/latest/ug/application-load-balancer-logs.html)
- [AWS WAF + ALB Logging](https://docs.aws.amazon.com/waf/latest/developerguide/logging.html)
- [CloudTrail ELB Events](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-application-elb.html)
