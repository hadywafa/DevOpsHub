# ğŸ” **Amazon Route 53 Resolver â€“ Simple & Deep Hybrid DNS**

> _Your bridge between on-premises and AWS DNS worlds._  
> Letâ€™s understand how DNS flows, not just use it!

---

## ğŸŒ **What Is Route 53 Resolver?**

Imagine you have:

- A **VPC in AWS**
- A **local data center (on-premises)**

Nowâ€¦ both sides have **servers that need to talk to each other by DNS names** â€” like `db.local`, `app.internal`, etc.

**Route 53 Resolver** is the **middleman DNS translator** that:

- Lets **on-premises servers** resolve AWS domain names.
- Lets **AWS servers** resolve **on-premises domain names**.

It does that using:

- **Inbound Endpoints** â†’ DNS queries from on-premises â†’ AWS
- **Outbound Endpoints** â†’ DNS queries from AWS â†’ on-premises

---

<div style="text-align:center;">
  <img src="images/route53-resolver.png" alt="Route 53 Resolver" style="border-radius:10px;">
</div>

---

## ğŸ” **How DNS Resolution Works with Route 53 Resolver**

Letâ€™s go through the two directions, **with visuals and real-world thinking**.

---

### ğŸ”„ **1. Inbound DNS Flow: On-Premises â†’ AWS (Private Hosted Zones)**

ğŸ§  **Goal**: Your **on-prem server** wants to resolve a domain in your **AWS VPC**, like `internal-api.aws`.

#### ğŸ› ï¸ What You Do

| Step                           | Description                                                   |
| ------------------------------ | ------------------------------------------------------------- |
| ğŸ”Œ Create **Inbound Endpoint** | Adds IPs inside your VPC for accepting DNS queries            |
| ğŸ” Open Port 53                | Use **security groups** to allow DNS (TCP/UDP 53)             |
| ğŸ”— Connect your network        | Use **VPN or Direct Connect** to link your on-premises to AWS |
| âš™ï¸ Configure on-prem DNS       | Forward queries like `*.aws` to that inbound IP               |

#### ğŸ§­ What Happens Internally

```mermaid
sequenceDiagram
    participant OnPremServer
    participant OnPremDNS
    participant Route53InboundEndpoint
    participant Route53Resolver
    participant PrivateHostedZone

    OnPremServer->>OnPremDNS: DNS Query for internal-api.aws
    OnPremDNS->>Route53InboundEndpoint: Forward query to VPC IP
    Route53InboundEndpoint->>Route53Resolver: Receive query
    Route53Resolver->>PrivateHostedZone: Look up internal-api.aws
    PrivateHostedZone-->>Route53Resolver: IP = 10.0.2.5
    Route53Resolver-->>Route53InboundEndpoint: Response
    Route53InboundEndpoint-->>OnPremDNS: IP = 10.0.2.5
    OnPremDNS-->>OnPremServer: Done!
```

---

<div style="text-align:center;">
  <img src="images/on-premises-to-route53.png" alt="On-Premises to Route 53" style="border-radius:10px;">
</div>

---

### ğŸ”„ **2. Outbound DNS Flow: AWS â†’ On-Premises**

ğŸ§  **Goal**: An **EC2 inside AWS** wants to resolve a name in your **on-premises DNS**, like `db.local`.

#### ğŸ› ï¸ What You Do

| Step                            | Description                                       |
| ------------------------------- | ------------------------------------------------- |
| ğŸ”Œ Create **Outbound Endpoint** | Creates VPC IPs that can send DNS traffic out     |
| ğŸ“„ Create **Rules**             | Tell Route 53: "For `*.local`, use these DNS IPs" |
| ğŸ” Open firewall ports          | Allow DNS traffic to your on-prem DNS server      |

#### ğŸ§­ What Happens Internally

```mermaid
sequenceDiagram
    participant EC2Instance
    participant VPCResolver
    participant ForwardingRule
    participant Route53OutboundEndpoint
    participant OnPremDNS

    EC2Instance->>VPCResolver: DNS Query for db.local
    VPCResolver->>ForwardingRule: Check rule for *.local
    ForwardingRule->>Route53OutboundEndpoint: Send to on-prem IP
    Route53OutboundEndpoint->>OnPremDNS: Query db.local
    OnPremDNS-->>Route53OutboundEndpoint: IP = 192.168.10.5
    Route53OutboundEndpoint-->>EC2Instance: Response
```

---

<div style="text-align:center;">
  <img src="images/route53-to-on-premises.png" alt="Route 53 to On-Premises" style="border-radius:10px;">
</div>

---

## ğŸ§  **Quick Summary of the Two Flows**

| DNS Flow Direction | Purpose                                                  | Setup Needed                            |
| ------------------ | -------------------------------------------------------- | --------------------------------------- |
| ğŸ  On-Prem â†’ AWS   | Access **AWS VPC private DNS** (like `internal-api.aws`) | **Inbound Endpoint**                    |
| â˜ï¸ AWS â†’ On-Prem   | Access **on-prem DNS** (like `db.local`)                 | **Outbound Endpoint + Forwarding Rule** |

---

## ğŸ” **Security Essentials**

| ğŸ” Security Item          | Explanation                                                                                    |
| ------------------------- | ---------------------------------------------------------------------------------------------- |
| **Security Groups**       | Inbound/Outbound endpoints use **ENIs** â€” attach SGs to allow port 53 (TCP + UDP)              |
| **NACLs**                 | Make sure your subnets allow port 53                                                           |
| **VPN or Direct Connect** | Required â€” AWS health checkers or resolvers **can't reach on-prem directly over the internet** |

---

## ğŸ“˜ **Best Practices (Simplified)**

âœ… Create **redundant endpoints** in multiple AZs  
âœ… Only allow traffic from **trusted IPs**  
âœ… Monitor queries via **Route 53 Resolver Query Logging**  
âœ… Automate setup with **Terraform** or **CloudFormation**

---

## ğŸ§ª Real-World Example

### Scenario

You have:

- An EC2 in `dev-vpc` â†’ needs to talk to `db.mycorp.local` (on-prem)
- A service in `on-prem` â†’ needs to call `auth.dev.aws` (in your VPC)

### Your Setup

| Action                                                                     | Setup |
| -------------------------------------------------------------------------- | ----- |
| For `auth.dev.aws` â†’ On-prem â†’ Inbound Resolver                            |       |
| For `db.mycorp.local` â†’ AWS â†’ Outbound Resolver + Rule for `.mycorp.local` |       |

ğŸ¯ Now, DNS works **both ways** â€” clean, secure, and managed!

---

## âœ… Conclusion

**Route 53 Resolver** acts as your **hybrid DNS bridge**:

- Inbound = on-prem â†’ AWS
- Outbound = AWS â†’ on-prem

It uses **custom endpoints**, **rules**, and **secure tunnels** (VPN/DX) to make DNS resolution seamless between worlds â€” no more split-brain DNS or static IP hacks.
