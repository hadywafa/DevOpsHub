# ğŸš€ Mastering CodeDeploy Deployment Types: Focus on Blue/Green ğŸ’™ğŸ’š

When you're deploying applications to EC2 instances, **downtime is your enemy** ğŸ˜¬ and so is a buggy release. AWS CodeDeploy offers multiple deployment strategies to help you avoid both â€” and the **Blue/Green** deployment strategy is the king of them all ğŸ‘‘ (especially in production).

---

## 1. ğŸ§  What Are CodeDeploy Deployment Types?

CodeDeploy supports **three major deployment types** for EC2-based deployments:

| Type                   | Description                                            |
| ---------------------- | ------------------------------------------------------ |
| **In-place**           | Deploy to existing instances                           |
| **Rolling (in-place)** | Deploy in batches (e.g., one-by-one or half-at-a-time) |
| **Blue/Green**         | Create new instances, deploy, then swap traffic        |

---

## 2. âš™ï¸ Overview: In-Place vs Blue/Green Deployments

| Feature                        | In-Place                                 | Rolling                  | Blue/Green                                      |
| ------------------------------ | ---------------------------------------- | ------------------------ | ----------------------------------------------- |
| ğŸ›  Deploys To                   | Existing EC2s                            | Batches of existing EC2s | New set of EC2s (Green)                         |
| âš¡ï¸ Downtime                   | High (All-at-once) or Moderate (Rolling) | Medium to Low            | Near Zero                                       |
| ğŸ” Rollback Behavior           | Manual or partial automatic              | Partial automatic        | Rollback not needed unless traffic was rerouted |
| ğŸ’¸ Cost During Deployment      | No additional EC2s                       | No additional EC2s       | Double the EC2s temporarily                     |
| ğŸ” Deployment Visibility       | Limited                                  | Better visibility        | Full visibility, isolated                       |
| ğŸ§ª Two Versions Simultaneously | âŒ                                       | âœ… (can cause issues)    | âœ… (but managed cleanly)                        |

---

## 3. ğŸ’™ğŸ’š What is Blue/Green Deployment?

A **blue/green deployment** creates a **new environment (green)**, deploys the new version there, and once itâ€™s ready, it **switches traffic** from the current environment (blue) to the green one.

> âœ… This ensures **zero-downtime deployments** and lets you **test the new version** in isolation.

---

## 4. ğŸŒ€ Blue/Green Deployment Workflow (with EC2 + ALB)

Let's visualize it:

<div align="center">

```mermaid
sequenceDiagram
    participant CodeDeploy
    participant ASG-Blue as Blue AutoScaling Group
    participant ALB
    participant ASG-Green as Green AutoScaling Group

    CodeDeploy->>ASG-Green: Create new group (copy of Blue)
    CodeDeploy->>ASG-Green: Deploy new revision
    ALB->>ASG-Green: Health check OK?
    CodeDeploy->>ALB: Register Green instances
    CodeDeploy->>ALB: Deregister Blue instances
    CodeDeploy->>ASG-Blue: Terminate Blue group
```

</div>

---

## 5. ğŸ” Rollbacks in Blue/Green Deployments

Hereâ€™s the twist:

- **If deployment fails BEFORE traffic shift** (e.g., app fails on green):  
  âœ… The blue group is untouched â†’ **No rollback needed**

- **If deployment fails AFTER traffic shift**:  
  ğŸ” Youâ€™ll need **manual rollback** (CodeDeploy doesnâ€™t auto revert traffic)

### â›”ï¸ Common Pitfall

> CodeDeploy **does not rollback traffic** automatically once shifted. You have to manually trigger a rollback to blue instances (if kept).

---

## 6. ğŸ§© Comparison Table: Deployment Configuration Options

| Configuration Name              | Type       | What It Means                              |
| ------------------------------- | ---------- | ------------------------------------------ |
| `CodeDeployDefault.AllAtOnce`   | In-place   | All instances updated at once              |
| `CodeDeployDefault.OneAtATime`  | In-place   | One instance at a time                     |
| `CodeDeployDefault.HalfAtATime` | In-place   | Half the fleet at a time                   |
| `AllAtOnce` + Blue/Green        | Blue/Green | All green instances updated simultaneously |

---

## 7. âœ… Best Practices for Blue/Green Deployments

### ğŸ” IAM Setup

- Your EC2 launch template **must** include CodeDeploy agent and IAM role permissions.
- Ensure ALB health checks are correctly configured on `/`.

### ğŸ“¦ AMI Setup

- Use pre-baked AMIs to reduce instance spin-up time.
- Donâ€™t leave residual app files from old deployments in the AMI.

### ğŸ§¹ Clean-Up

- Set termination time (e.g., 0 minutes) for blue group post-deployment.
- Or retain blue group temporarily for **manual rollback** if needed.

### ğŸ” Rollback Ready

- Even with B/G, **enable automated rollback** in case of pre-switch failures.
- Tag ASGs with deployment IDs to avoid confusion.

### ğŸ’° Watch Your Bill

- EC2 cost _doubles_ temporarily.
- Ensure your **region quotas** allow spinning up duplicate capacity.

---

## 8. ğŸ§ª Real Example Recap (From Course)

| Action                        | Outcome                                    |
| ----------------------------- | ------------------------------------------ |
| Pushed version 8.0            | B/G deployment â†’ new ASG â†’ success         |
| Pushed version 9.0 with error | B/G deployment â†’ failure â†’ **no rollback** |
| Fixed and pushed 9.0 again    | New ASG created â†’ success                  |

âœ… During the failed deployment, **blue group was untouched**, traffic stayed safe, and the green group (failed one) was **manually deleted** after identifying the issue.

---

## 9. ğŸ“Œ Summary

> **Blue/Green deployments** offer the safest deployment model for production apps â€” especially those behind **Application Load Balancers** with EC2 Auto Scaling Groups.

### Key Benefits

- ğŸš« **No downtime** if done right
- ğŸ” **Isolated testing** on green before switching
- âœ… Ideal for production-grade, highly-available systems
- ğŸ›  Requires slightly more setup, but offers **maximum safety**
