# ðŸš€ Full Deployment Examples (With Explanations): .NET & Angular â†’ EC2, S3, Amplify

---

## ðŸ–¥ï¸ 1. Deploying a .NET API to EC2 with CodeDeploy

### ðŸ“¦ `buildspec.yml` (Line-by-Line Explanation)

```yaml
version: 0.2

phases:
  install:
    runtime-versions:
      dotnet: 6.0 # âœ… Use .NET 6 runtime
    commands:
      - echo "Installing .NET SDK..." # Log install step
  build:
    commands:
      - echo "Publishing app..." # Log build step
      - dotnet publish -c Release -o ./publish # âœ… Publish output to /publish
  post_build:
    commands:
      - echo "Zipping app for deployment..."
      - zip -r myapp.zip publish appspec.yml scripts/ # âœ… Zip everything needed

artifacts:
  files:
    - myapp.zip # âœ… Artifact that gets uploaded to S3 for CodeDeploy
```

---

### ðŸ§¾ `appspec.yml` (EC2)

```yaml
version: 0.0
os: linux
files:
  - source: /
    destination: /var/www/myapp # âœ… Location where files will be copied on EC2
hooks:
  ApplicationStart:
    - location: scripts/start.sh
```

---

### â–¶ï¸ `scripts/start.sh`

```bash
#!/bin/bash
cd /var/www/myapp
dotnet MyApi.dll > /dev/null 2>&1 &  # âœ… Starts the API silently in background
```

ðŸ§  **CodeDeploy automatically unzips your `myapp.zip`** on the EC2 instance before executing any hook.

---

## ðŸŒ 2. Deploying Angular App to EC2 via CodeDeploy (With nginx)

### ðŸ“¦ `buildspec.yml`

```yaml
version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - npm ci # âœ… Clean install using lock file
  build:
    commands:
      - npm run build -- --configuration production # âœ… Outputs to /dist
  post_build:
    commands:
      - zip -r angular-app.zip dist appspec.yml scripts/ # âœ… Package for CodeDeploy

artifacts:
  files:
    - angular-app.zip
```

---

### ðŸ§¾ `appspec.yml`

```yaml
version: 0.0
os: linux
files:
  - source: /
    destination: /var/www/html # âœ… Default nginx root directory
hooks:
  ApplicationStart:
    - location: scripts/restart-nginx.sh
```

---

### â–¶ï¸ `scripts/restart-nginx.sh`

```bash
#!/bin/bash
systemctl restart nginx  # âœ… Refresh nginx to serve the updated Angular app
```

> ðŸ’¡ **No need to unzip manually**. CodeDeploy does it before the hook runs.

---

## ðŸª£ 3. Deploying Angular App to S3 (Static Website)

### ðŸ“¦ `buildspec.yml`

```yaml
version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - npm ci
  build:
    commands:
      - npm run build -- --configuration production
  post_build:
    commands:
      - aws s3 sync dist/your-app-name/ s3://your-s3-bucket-name --delete
        # âœ… Upload all files to S3
        # âœ… --delete removes outdated files
```

ðŸ“Œ **No hooks or AppSpec needed** â€” this is direct S3 sync after build.

---

## âœ… Final Comparison

| Case           | Method        | Tool       | Notes                       |
| -------------- | ------------- | ---------- | --------------------------- |
| .NET to EC2    | Zip + AppSpec | CodeDeploy | Fully controlled deployment |
| Angular to EC2 | Build + nginx | CodeDeploy | Serve via Nginx             |
| Angular to S3  | Direct sync   | AWS CLI    | Fast & simple               |
