# ğŸ“¢ **10. Notifications in CodePipeline**

_Trigger Smart Alerts for Pipeline Success, Failures, and Approvals with SNS + CodeStar!_

---

## ğŸ§  What Youâ€™ll Learn

By the end of this topic, you'll know how to:

- Set up **email notifications** for any pipeline event (success, failure, approvals, etc.)
- Create and configure **notification rules** for your pipelines
- Use **SNS topics** as targets for notifications
- Understand **CodeStarâ€™s role** behind the scenes
- Modify **SNS access policies** to make it all work correctly
- Get real-time visibility into your CI/CD process ğŸ’¡

---

## âš™ï¸ What is the Notification System in CodePipeline?

AWS Developer Tools (including CodePipeline) come with a **built-in notification system**.  
It uses **notification rules** + **SNS topics** to:

- ğŸ”” Send **email alerts** (or push to other systems)
- ğŸ“¦ Trigger external **automation tools**
- ğŸ“ˆ Integrate with **monitoring dashboards**

It works via **CodeStar Notifications** under the hood.

---

## ğŸ”§ How It Works Internally

```mermaid
sequenceDiagram
    participant Pipeline
    participant CodeStar
    participant SNS
    participant You

    Pipeline->>CodeStar: Event (e.g., pipeline FAILED)
    CodeStar->>SNS: Publish JSON notification
    SNS->>You: Send Email/Alert
```

âœ… CodePipeline doesnâ€™t directly publish to SNS  
âœ… **CodeStar** does it â€” and thatâ€™s why you need to update the SNS topic policy

---

## ğŸŒ©ï¸ Setting Up Notifications (Step-by-Step)

---

### ğŸªœ Step 1: Go to Your Pipeline Settings

- Go to your pipeline in AWS Console
- Click **Settings â†’ Notifications**
- Click **â€œCreate notification ruleâ€**

---

### ğŸªœ Step 2: Fill Notification Rule Details

- **Name**: `PipelineNotificationRule`
- **Detail type**:
  - `Full` â†’ Includes all execution info (recommended âœ…)
  - `Basic` â†’ Less data (only use if you want light messages)

---

### ğŸªœ Step 3: Choose Events to Monitor

#### âœ… Suggested Events to Select

| Category                     | Recommended? | Description                                 |
| ---------------------------- | ------------ | ------------------------------------------- |
| âœ… Pipeline Execution States | âœ”ï¸ Yes       | Notify on start, success, or failure        |
| âŒ Stage Execution States    | âš ï¸ No        | Too noisy (every stage triggers)            |
| âŒ Action Execution States   | âš ï¸ No        | Even noisier (every CodeBuild, CFN, etc.)   |
| âœ… Approval Action States    | âœ”ï¸ Yes       | Notify when approvals are approved/rejected |

You can also customize to:

- Get alerts **only on failure**
- Get notified when **manual approvals are rejected**

---

### ğŸªœ Step 4: Choose or Create the SNS Target

You have 2 options:

#### Option 1: **Create New Target (Easy Way âœ…)**

- Click **"Create target"**
- It creates an SNS topic **automatically**
- AWS CodeStar automatically sets required permissions âœ…

ğŸ’¡ You just need to **subscribe your email** to the topic

---

#### Option 2: **Use Existing SNS Topic (Manual Way)**

- Select your existing SNS topic (maybe used for ManualApproval)
- But hereâ€™s the catch:  
  Since CodePipeline uses **CodeStar Notifications**, you must manually update the SNS topic policy to allow it.

---

## ğŸ›¡ï¸ Fixing SNS Topic Permissions (for CodeStar)

Open your **SNS topic â†’ Edit â†’ Access Policy**  
Add the following statement inside the `"Statement"` array:

```json
{
  "Sid": "AllowCodeStarNotifications",
  "Effect": "Allow",
  "Principal": {
    "Service": "codestar-notifications.amazonaws.com"
  },
  "Action": "SNS:Publish",
  "Resource": "arn:aws:sns:your-region:your-account-id:your-topic-name"
}
```

> âœ… Replace the `Resource` with the actual ARN of your SNS topic  
> âœ… Donâ€™t forget to add a comma before if this is the second statement in the array

---

### ğŸ§ª Example Policy Snippet

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "Default",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "SNS:Publish",
      "Resource": "arn:aws:sns:us-east-1:123456789012:MyPipelineTopic"
    },
    {
      "Sid": "AllowCodeStarNotifications",
      "Effect": "Allow",
      "Principal": {
        "Service": "codestar-notifications.amazonaws.com"
      },
      "Action": "SNS:Publish",
      "Resource": "arn:aws:sns:us-east-1:123456789012:MyPipelineTopic"
    }
  ]
}
```

âœ… Save the policy  
âœ… Now your existing SNS topic will work with pipeline notifications!

---

## âœ¨ Format of the Notification Email

Youâ€™ll get JSON emails like:

```json
{
  "eventTypeId": "codepipeline-pipeline-pipeline-execution-failed",
  "source": "aws.codepipeline",
  "detailType": "CodePipeline Pipeline Execution State Change",
  "pipeline": "my-app-pipeline",
  "state": "FAILED",
  "region": "us-east-1",
  "time": "2025-04-16T15:00:00Z"
}
```

âœ… You can forward this to:

- Slack via Lambda
- PagerDuty
- Microsoft Teams
- Any monitoring tool that parses JSON

---

## âœ… Final Tips

| Tip ğŸ’¡                              | Why It Matters                 |
| ----------------------------------- | ------------------------------ |
| Use `Full` details                  | Better debugging info          |
| Donâ€™t over-select events            | Avoid inbox flooding           |
| Use `ManualApproval` + SNS          | Great for release coordination |
| Use new topic for each app          | Easier filtering & routing     |
| Combine with CloudWatch Alarms      | Unified alerting strategy      |
| Auto-reject approvals after timeout | Avoid hanging deploys          |

---

## ğŸ¯ Real-World Example

Letâ€™s say:

- You push to `main`
- Pipeline builds, deploys to staging
- A `ManualApproval` step waits
- You get an email:
  > â€œA manual approval is required. Test here: <http://staging.myapp.comâ€>

After approval:

- Prod deploy happens
- You get another email:
  > â€œPipeline succeeded ğŸ‰â€

---

## ğŸ“š Wrap-Up

AWS CodePipeline notifications let you:

- **Stay informed** of your pipeline progress
- React fast to **failures or approvals**
- Integrate pipeline status into **external systems**
- Build **smart, controlled** CI/CD with real-time feedback
