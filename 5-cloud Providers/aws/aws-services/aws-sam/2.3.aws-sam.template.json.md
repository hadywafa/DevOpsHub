# üìÉ **AWS SAM `template.yaml`**

## üìÑ **1. Overview of `template.yaml` in AWS SAM**

The **`template.yaml`** file defines serverless resources in **YAML format**. It extends **AWS CloudFormation** and provides **simplified syntax** for common serverless components.

### üî• **Basic Structure of `template.yaml`**

```yaml
AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31
Resources:
  MyLambdaFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: app.lambda_handler
      Runtime: python3.9
      CodeUri: .
      MemorySize: 128
      Timeout: 10
      Policies: AWSLambdaBasicExecutionRole
```

### üßê **Key Sections Explained**

| Section                    | Description                                                                |
| -------------------------- | -------------------------------------------------------------------------- |
| `AWSTemplateFormatVersion` | CloudFormation version (always `'2010-09-09'`).                            |
| `Transform`                | Enables AWS SAM (`AWS::Serverless-2016-10-31`).                            |
| `Resources`                | Defines AWS resources (e.g., Lambda, API Gateway, DynamoDB).               |
| `Type`                     | Resource type (`AWS::Serverless::Function`, `AWS::Serverless::Api`, etc.). |
| `Properties`               | Configurations for each resource.                                          |

---

## üèóÔ∏è **2. Most Used Attributes in `template.yaml`**

Let's explore the most **commonly used attributes** in AWS SAM:

---

### ‚úÖ **1. `AWS::Serverless::Function` (Lambda Function)**

Defines an AWS Lambda function **with simplified syntax**.

```yaml
Resources:
  MyLambdaFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: app.lambda_handler
      Runtime: python3.9
      CodeUri: .
      MemorySize: 256
      Timeout: 10
      Environment:
        Variables:
          STAGE: production
      Policies:
        - AWSLambdaBasicExecutionRole
      Events:
        HttpApi:
          Type: HttpApi
          Properties:
            Path: /hello
            Method: GET
```

#### üîç **Most Used Attributes**

| Attribute     | Description                                                        |
| ------------- | ------------------------------------------------------------------ |
| `Handler`     | Specifies the function's entry point (e.g., `app.lambda_handler`). |
| `Runtime`     | Defines the language runtime (e.g., `python3.9`, `nodejs18.x`).    |
| `CodeUri`     | Points to the directory or S3 bucket containing the code.          |
| `MemorySize`  | Allocates memory (min 128MB, max 10GB).                            |
| `Timeout`     | Maximum execution time in seconds (default: 3s, max: 900s).        |
| `Environment` | Defines environment variables.                                     |
| `Policies`    | Specifies IAM policies (e.g., `AWSLambdaBasicExecutionRole`).      |
| `Events`      | Defines triggers (e.g., API Gateway, S3, SNS, SQS).                |

---

### ‚úÖ **2. `AWS::Serverless::Api` (API Gateway)**

Creates an **API Gateway** to expose Lambda functions as REST or HTTP APIs.

```yaml
Resources:
  MyApi:
    Type: AWS::Serverless::Api
    Properties:
      StageName: dev
      Cors:
        AllowMethods: "'GET,POST,OPTIONS'"
        AllowHeaders: "'Content-Type'"
        AllowOrigin: "'*'"
```

#### üîç **Most Used Attributes**

| Attribute        | Description                                           |
| ---------------- | ----------------------------------------------------- |
| `StageName`      | Specifies the deployment stage (e.g., `dev`, `prod`). |
| `Cors`           | Configures CORS settings for the API.                 |
| `DefinitionBody` | Defines OpenAPI specifications inline.                |
| `DefinitionUri`  | Links to an external OpenAPI JSON/YAML file.          |

---

### ‚úÖ **3. `AWS::Serverless::SimpleTable` (DynamoDB)**

Creates a **DynamoDB table** with minimal configuration.

```yaml
Resources:
  MyTable:
    Type: AWS::Serverless::SimpleTable
    Properties:
      PrimaryKey:
        Name: id
        Type: String
      TableName: MyDynamoTable
```

#### üîç **Most Used Attributes**

| Attribute               | Description                                               |
| ----------------------- | --------------------------------------------------------- |
| `PrimaryKey`            | Defines the partition key (`Name` & `Type`).              |
| `TableName`             | (Optional) Assigns a custom table name.                   |
| `ProvisionedThroughput` | Specifies read/write capacity (for non-on-demand tables). |

---

### ‚úÖ **4. `AWS::Serverless::LayerVersion` (Lambda Layers)**

Manages **Lambda Layers** to share dependencies across functions.

```yaml
Resources:
  MyLayer:
    Type: AWS::Serverless::LayerVersion
    Properties:
      LayerName: MyLayer
      Description: Shared dependencies for Lambda
      ContentUri: ./layer
      CompatibleRuntimes:
        - python3.9
```

#### üîç **Most Used Attributes**

| Attribute            | Description                                          |
| -------------------- | ---------------------------------------------------- |
| `LayerName`          | Defines a custom name for the layer.                 |
| `ContentUri`         | Specifies the folder containing the layer's content. |
| `CompatibleRuntimes` | Lists compatible runtimes (e.g., `python3.9`).       |

---

### ‚úÖ **5. `Globals` (Global Settings for All Functions)**

The `Globals` section **applies settings to all resources of a specific type**.

```yaml
Globals:
  Function:
    Timeout: 10
    MemorySize: 256
```

---

## üîß **3. Advanced `template.yaml` Example**

Let's put it all together in a **real-world AWS SAM template**:

```yaml
AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31

Globals:
  Function:
    Timeout: 10
    MemorySize: 256

Resources:
  MyLambdaFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: app.lambda_handler
      Runtime: python3.9
      CodeUri: .
      Environment:
        Variables:
          TABLE_NAME: !Ref MyDynamoTable
      Policies:
        - AWSLambdaBasicExecutionRole
        - DynamoDBCrudPolicy:
            TableName: !Ref MyDynamoTable
      Events:
        ApiEvent:
          Type: HttpApi
          Properties:
            Path: /hello
            Method: GET

  MyDynamoTable:
    Type: AWS::Serverless::SimpleTable
    Properties:
      PrimaryKey:
        Name: id
        Type: String

  MyApi:
    Type: AWS::Serverless::Api
    Properties:
      StageName: prod
      Cors:
        AllowMethods: "'GET,POST,OPTIONS'"
        AllowOrigin: "'*'"
```

---

## üéØ **4. Key Takeaways & Best Practices**

‚úÖ **Use `Globals`** to avoid repetitive function settings.  
‚úÖ **Minimize dependencies** by using **Lambda Layers**.  
‚úÖ **Secure resources** with IAM policies (`AWSLambdaBasicExecutionRole`).  
‚úÖ **Use DynamoDB and API Gateway** to build fully serverless applications.  
‚úÖ **Keep `template.yaml` modular** to enhance maintainability.
