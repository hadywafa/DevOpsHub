# AWS IAM Identity Center: Unified Access for Console & API Authentication

AWS **IAM Identity Center** (formerly AWS SSO) simplifies identity management and access control by providing **Single Sign-On (SSO)** for users accessing:

1. AWS Console (Web-Based Access)
1. AWS API & CLI (Programmatic Access)

| Authentication Method | Use Case                     | Session Type          |
| --------------------- | ---------------------------- | --------------------- |
| AWS Console Access    | AWS Web Console Login        | Web-Based Session     |
| AWS CLI/API Access    | CLI commands & SDK API calls | Temporary Credentials |

## üìü **AWS Console Authentication Flow**

The diagram below outlines the **SSO authentication flow** using an external identity provider:

```mermaid
sequenceDiagram
    autonumber
    participant User as User (Employee)
    participant Browser as User Browser
    participant IdP as Identity Provider (Microsoft Entra ID, Okta, Google Workspace)
    participant IAM as AWS IAM Identity Center
    participant STS as AWS Security Token Service (STS)
    participant AWS as AWS Account (IAM Role)

    User->>Browser: Navigate to AWS IAM Identity Center Login Page
    Browser->>IAM: Request Login Page
    IAM->>Browser: Redirect to IdP (SAML Request)

    Browser->>IdP: Redirect to Identity Provider (SSO Login)
    IdP->>User: Prompt for Authentication (Username, Password, MFA)
    User->>IdP: Submit Credentials
    IdP->>IdP: Validate User Credentials
    IdP->>IAM: Send SAML Assertion (Authenticated User Info)

    IAM->>IAM: Validate SAML Assertion
    IAM->>IAM: Identify User & Assigned Permission Sets
    IAM->>Browser: Display AWS Account & Role Selection Page
    User->>Browser: Select AWS Account & IAM Role
    Browser->>IAM: Submit Role Selection

    IAM->>STS: Request Temporary Credentials for Selected Role
    STS->>IAM: Return Temporary AWS Credentials
    IAM->>Browser: Provide Session Token & Redirect to AWS Console

    Browser->>AWS: Use Temporary Credentials to Access AWS Services
    AWS->>User: Provide Access to AWS Services
```

---

**1Ô∏è‚É£ User Initiates Login:**

- The **user navigates** to the **AWS IAM Identity Center login page**.
- AWS IAM Identity Center **redirects the user** to the external **Identity Provider (IdP)** for authentication.

**2Ô∏è‚É£ Identity Provider Authentication:**

- The **IdP prompts the user** for credentials (Username, Password, MFA).
- After authentication, the **IdP generates a SAML assertion** and sends it to **AWS IAM Identity Center**.

**3Ô∏è‚É£ AWS IAM Identity Center Processes the SAML Assertion:**

- IAM Identity Center **validates the SAML assertion**.
- IAM Identity Center **retrieves the user's assigned AWS accounts & IAM roles**.
- The user **selects an AWS account and IAM role**.

**4Ô∏è‚É£ AWS IAM Identity Center Requests Temporary AWS Credentials:**

- IAM Identity Center **requests temporary AWS credentials** from **AWS Security Token Service (STS)**.
- **STS returns short-lived credentials** that allow access to AWS services.

**5Ô∏è‚É£ User Gains Access to AWS Services:**

- IAM Identity Center **redirects the user** to the **AWS Management Console**.
- The **browser uses temporary credentials** to authenticate AWS API requests.
- The **user accesses AWS services** based on their assigned IAM role.

---

<div style="text-align: center;">
    <img src="images/saml-idf-console.png" alt="SAML-Identity-Federation-Console" />
</div>

---

**‚úÖ Security Enhancements:**

‚úî **Use Multi-Factor Authentication (MFA)** for strong security.  
‚úî **Limit session duration** for temporary credentials.  
‚úî **Monitor login events** using **AWS CloudTrail logs**.  
‚úî **Restrict access with AWS Organizations SCPs**.

---

## üßë‚Äçüíª **AWS Console Authentication Flow**

Here is the **detailed request flow** for **AWS API access via IAM Identity Center (SSO)**:

```mermaid
sequenceDiagram
    autonumber
    participant User as User (Developer/Admin)
    participant CLI as AWS CLI
    participant Browser as User Browser
    participant IdP as Identity Provider (Microsoft Entra ID, Okta)
    participant IAM as AWS IAM Identity Center
    participant STS as AWS Security Token Service (STS)
    participant API as AWS API (S3, EC2, Lambda, etc.)

    User->>CLI: Run `aws sso login --profile my-profile`
    CLI->>IAM: Request SSO authentication URL
    IAM->>Browser: Open login page in browser
    Browser->>IdP: Redirect to Identity Provider (SSO Login)
    IdP->>User: Prompt for Authentication (Username, Password, MFA)
    User->>IdP: Submit Credentials
    IdP->>IAM: Send SAML Assertion (Authenticated User Info)

    IAM->>IAM: Validate SAML Assertion
    IAM->>STS: Request Temporary Credentials for Assigned IAM Role
    STS->>IAM: Return Temporary AWS Credentials
    IAM->>CLI: Store Temporary Credentials in `~/.aws/sso/cache/`

    User->>CLI: Run AWS API Command (`aws s3 ls --profile my-profile`)
    CLI->>API: Send API request with Temporary Credentials
    API->>CLI: Return AWS API Response
```

---

**1Ô∏è‚É£ User Logs in via AWS CLI:**

- The user **initiates authentication** by running:

  ```bash
  aws sso login --profile my-profile
  ```

- AWS CLI contacts **IAM Identity Center** to request an authentication URL.

**2Ô∏è‚É£ User Authenticates in Browser:**

- IAM Identity Center **redirects the user** to the **Identity Provider (IdP)**.
- The **user logs in** with **corporate credentials (Microsoft Entra ID, Okta, etc.)**.
- The **IdP verifies authentication** and sends a **SAML assertion** back to **IAM Identity Center**.

**3Ô∏è‚É£ IAM Identity Center Issues Temporary Credentials:**

- IAM Identity Center **validates the SAML assertion**.
- IAM Identity Center **requests temporary AWS credentials** from **AWS Security Token Service (STS)**.
- **STS issues temporary credentials**, which IAM Identity Center stores in:

  ```ini
  ~/.aws/sso/cache/
  ```

**4Ô∏è‚É£ User Runs AWS API Commands:**

- The user executes an **AWS CLI command**:

  ```bash
  aws s3 ls --profile my-profile
  ```

- AWS CLI **retrieves temporary credentials** from the cached session.
- The request is sent to the **AWS API (S3, EC2, Lambda, etc.)**.
- The **AWS API validates the request and returns the response**.

---

<div style="text-align: center;">
    <img src="images/saml-idf-api.png" alt="SAML-Identity-Federation-API" />
</div>

---

## üöÄ **Conclusion**

AWS IAM Identity Center provides a **secure and scalable** way to **authenticate users for AWS API access**. By using **SSO and temporary credentials**, organizations can:  
‚úî Eliminate **hardcoded IAM user credentials**.  
‚úî Enhance **security with SAML-based authentication**.  
‚úî Control **multi-account access** using AWS Organizations.

üîπ **For AWS Console access** ‚Üí IAM Identity Center provides **role-based login**.  
üîπ **For API/CLI access** ‚Üí IAM Identity Center issues **short-lived credentials** for API requests.
