# ğŸ”™ **Rolling Back Your Application in Argo CD (Full Guide)**

When a deployment goes wrong (bad image, failed health checks, broken config), Argo CD gives you **two ways** to roll back:

1. **Argo CD Rollback** â†’ Fast, cluster-only rollback
2. **Git Revert Rollback** â†’ Permanent, true GitOps rollback

Both methods are important, and interviews often expect you to know the difference.

---

## âš™ï¸ **How Argo CD Tracks History**

Every time Argo CD syncs your app, it stores:

- Sync **history ID** (internal)
- Git **revision** (commit SHA or tag)
- Manifest diff
- Sync status (Healthy/Failed)
- Timestamp

Example history (CLI):

```ini
argocd app history my-app
```

Output:

```ini
ID   DATE                 REVISION        MESSAGE
15   2025-01-12 10:00     ghi789          Deployed v2.0.0
14   2025-01-12 09:00     def456          Deployed v1.1.0
13   2025-01-12 08:00     abc123          Deployed v1.0.0
```

---

## âš¡ **Method 1 â€” Argo CD Rollback (Fast Fix)**

Argo CD rollback restores the cluster to a **previous sync history entry**, not a Git commit.

### ğŸ¯ **It uses the history ID, not the commit SHA.**

Example:

```bash
argocd app rollback my-app 14
```

Argo CD will:

1. Load the old manifests stored in history ID **14**
2. Apply them to the cluster
3. Create a new history entry:

   ```ini
   ID 16 â€” rollback to 14
   ```

### â— **Important Notes**

- **Rollback does NOT modify Git**
- It only affects the **cluster**
- Git will now be newer â†’ Argo CD may show **OutOfSync**
- Disable auto-sync before rollback

---

### ğŸ–¥ï¸ **UI Rollback Steps**

1. Open your app in Argo CD web UI
2. Go to **History and Events**
3. Select the desired entry (e.g., ID 14)
4. Click **Rollback**
5. Argo CD redeploys that version

---

### ğŸ§ª **Example Scenario**

You deployed:

| ID  | Commit | Image                  |
| --- | ------ | ---------------------- |
| 13  | abc123 | v1.0.0                 |
| 14  | def456 | v1.1.0                 |
| 15  | ghi789 | v2.0.0 (bad â†’ crashes) |

Rollback command:

```bash
argocd app rollback my-app 14
```

Argo CD reapplies the v1.1.0 manifests.

---

### âš ï¸ **Auto-Sync Warning**

If auto-sync is enabled:

1. You rollback cluster â†’ app goes to v1.1.0
2. Git still points to v2.0.0
3. Argo CD immediately re-syncs â†’ deploys v2.0.0 again ğŸ˜­

**Fix: disable autosync before rollback:**

```bash
argocd app set my-app --sync-policy none
```

---

## ğŸŒ **Method 2 â€” Git Revert (True GitOps Rollback)**

This is the **long-term, correct** rollback approach.
You revert the commit directly in Git, then Argo CD syncs.

### Example:

```bash
git revert ghi789
git push
```

Argo CD notices the new commit and syncs the cluster back.

---

### â“ **Why This Is the Recommended Rollback?**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Feature                      | Argo Rollback | Git Revert |
| ---------------------------- | ------------- | ---------- |
| Fast emergency fix           | âœ”             | âŒ         |
| Permanent GitOps fix         | âŒ            | âœ”          |
| Keeps Git as source of truth | âŒ            | âœ”          |
| Works with auto-sync         | âŒ            | âœ”          |

</div>

---

## âš”ï¸ **Argo CD Rollback vs Git Revert â€” When to Use Which?**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Situation                                       | Best Option          |
| ----------------------------------------------- | -------------------- |
| Production outage â†’ quick restore               | **Argo CD rollback** |
| Long-term fix required                          | **Git revert**       |
| Auto-sync enabled                               | **Git revert**       |
| Investigating broken commit but need app stable | **Argo rollback**    |
| Ensuring Git == cluster                         | **Git revert**       |

</div>

---

## ğŸ·ï¸ **What the Rollback ID Really Is**

âœ• Not a commit SHA  
âœ• Not a revision number
âœ” It is the Argo CD **history entry number**

- History entry internally contains:

  - Git commit
  - Applied manifests
  - Sync operation logs

- Rollback simply restores a previous history entry.

---

## âœğŸ» **Full CLI Workflow Example (Best Practice)**

### ğŸ”¹ Step 1 â€” Inspect history

```bash
argocd app history my-app
```

### ğŸ”¹ Step 2 â€” Disable auto-sync (optional)

```bash
argocd app set my-app --sync-policy none
```

### ğŸ”¹ Step 3 â€” Perform rollback

```bash
argocd app rollback my-app 14
```

### ğŸ”¹ Step 4 â€” Verify

```bash
argocd app get my-app
```

### ğŸ”¹ Step 5 â€” Restore Git correctness (recommended)

```bash
git revert <bad-commit>
git push
```

### ğŸ”¹ Step 6 â€” Re-enable auto-sync

```bash
argocd app set my-app --sync-policy automated
```

---

## ğŸ”š **Summary**

- Argo CD rollback = fast, cluster-only rollback using **history ID**
- History ID â‰  commit SHA
- Git revert = true GitOps rollback (permanent, clean)
- Auto-sync can undo Argo rollback â†’ use Git revert to fix
- Best practice:
  **rollback with Argo â†’ fix in Git later**
