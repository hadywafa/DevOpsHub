# 🫙 **Manage Database**

**Most companies hosting apps in Kubernetes (like EKS) prefer to keep databases _outside_ the cluster using managed services (e.g., Amazon RDS, Aurora). But some do run databases _inside_ the cluster using StatefulSets + CSI volumes, with careful replication and backup strategies.**

---

## 🧭 **Common Database Strategies in Kubernetes** (EKS)

### ✅ 1. **External Managed Databases (Most Common)**

- Companies often use **Amazon RDS**, **Aurora**, or **DynamoDB**.
- These are **outside the EKS cluster**, but apps connect via VPC networking.
- Benefits:
  - Built-in replication, backups, scaling
  - No need to manage storage or failover
  - Easier compliance and durability

### 🔗 Example:

```yaml
env:
  - name: DB_HOST
    value: mydb.cluster-xyz.us-east-1.rds.amazonaws.com
```

---

### ✅ 2. **In-Cluster Stateful Databases (Less Common)**

Some companies run databases like **PostgreSQL**, **MongoDB**, or **MySQL** inside EKS using:

- **StatefulSets**: for stable identity and persistent storage
- **PersistentVolumeClaims (PVCs)** backed by **CSI drivers** (e.g., EBS)
- **Operators**: like [Crunchy PostgreSQL Operator](https://www.crunchydata.com/products/crunchy-postgres-operator) or [MongoDB Atlas Operator](https://www.mongodb.com/docs/kubernetes/)
- **Sidecars**: for backup, monitoring, failover

---

## 🔁 How Replication Works (In-Cluster)

| Database   | Replication Strategy                         |
| ---------- | -------------------------------------------- |
| PostgreSQL | Primary + replicas via streaming replication |
| MongoDB    | Replica sets with election                   |
| MySQL      | Group replication or master-slave            |
| Redis      | Sentinel or Cluster mode                     |

These setups often use:

- **Headless Services** for pod discovery
- **Pod anti-affinity rules** to spread replicas across nodes
- **Custom controllers/operators** to manage failover and scaling

---

## ⚠️ **Challenges of In-Cluster DBs**

- **Data durability**: must use CSI volumes (e.g., EBS) with proper reclaim policies
- **Backup/restore**: needs custom jobs or sidecars
- **Scaling**: harder than stateless apps
- **Failover**: must be manually or operator-managed

---

## 🧠 **Summary** for Your Portfolio

- **External DBs (RDS/Aurora)** → preferred for production
- **StatefulSets + CSI** → used for dev/test or when vendor lock-in is a concern
- **Operators** → critical for managing replication, upgrades, and failover

---

## 📚 **Sources:**

- [AWS Community Guide](https://dev.to/aws-builders/how-to-run-databases-on-kubernetes-an-8-step-guide-4339)
- [Google Cloud Blog](https://cloud.google.com/blog/products/databases/to-run-or-not-to-run-a-database-on-kubernetes-what-to-consider)
- [Amazon EKS Architecture](https://docs.aws.amazon.com/eks/latest/userguide/eks-architecture.html)

---

Would you like a YAML snippet showing a PostgreSQL StatefulSet with replication and PVCs, or a diagram comparing external vs in-cluster DB architecture? Perfect for your cloud/SRE documentation.
