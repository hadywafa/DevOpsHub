# üê≥ Understanding `ENTRYPOINT`, `CMD`, and Kubernetes Overrides

## üß≠ **Table of Contents**

1. [Introduction](#1)
2. [Dockerfile: `ENTRYPOINT` vs `CMD`](#2)

   - [Understanding `ENTRYPOINT`](#2.1)
   - [Understanding `CMD`](#2.2)
   - [Key Differences](#2.3)
   - [Common Mistakes & Fixes](#2.4)

3. [Kubernetes Pod YAML: `command` and `args`](#3)

   - [Understanding `command`](#3.1)
   - [Understanding `args`](#3.2)
   - [Common YAML Pitfalls](#3.3)

4. [Docker vs Kubernetes Behavior](#4)
5. [Hands-On Examples](#5)

   - [Example 1: Combined Use](#5.1)
   - [Example 2: CMD Without ENTRYPOINT](#5.2)
   - [Example 3: ENTRYPOINT with Runtime Args](#5.2)
   - [Example 4: Kubernetes Override](#5.3)

6. [Best Practices Checklist](#6)
7. [Conclusion](#7)

---

## üìñ **Introduction** <a id="1"></a>

When defining container behavior, the **startup command** and its **arguments** determine how your application runs.

- **Docker** defines this behavior _at build time_ using `ENTRYPOINT` and `CMD`.
- **Kubernetes** lets you _override or extend_ it _at deployment time_ using `command` and `args`.

Understanding the difference helps prevent unpredictable container starts, command overrides, and deployment errors.

---

## ‚öôÔ∏è **Dockerfile**: `ENTRYPOINT` vs `CMD` <a id="2"></a>

Both are used to define what happens when your container starts ‚Äî but they play **different roles**.

---

### üöÄ Understanding `ENTRYPOINT` <a id="2.1"></a>

- **Purpose** ‚Üí Defines the _main executable_ that always runs.
- **Behavior** ‚Üí Can‚Äôt be overridden unless you explicitly use `--entrypoint`.
- **Preferred Syntax** ‚Üí _Exec form (JSON array)_

```dockerfile
ENTRYPOINT ["python", "app.py"]
```

Avoid the **shell form**:

```dockerfile
ENTRYPOINT python app.py    # ‚ùå wraps in /bin/sh -c
```

üß† _Why exec form is better:_

- Runs directly as PID 1
- Proper signal handling (clean shutdowns)
- Works cleanly with additional runtime arguments

---

### üí¨ Understanding `CMD` <a id="2.2"></a>

- **Purpose** ‚Üí Defines _default arguments_ for the `ENTRYPOINT`, or acts as the _default command_ if no `ENTRYPOINT` is set.
- **Behavior** ‚Üí Easily overridden by adding arguments at runtime.

‚úÖ Example:

```dockerfile
ENTRYPOINT ["python", "app.py"]
CMD ["--port", "8080"]
```

Now:

```bash
docker run myimage                # ‚Üí python app.py --port 8080
docker run myimage --debug        # ‚Üí python app.py --debug
```

---

### üîç **Key Differences** <a id="2.3"></a>

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| üîπ Feature         | üß± `ENTRYPOINT`                      | ‚öôÔ∏è `CMD`                           |
| ------------------ | ------------------------------------ | ---------------------------------- |
| **Purpose**        | Defines the executable               | Defines default parameters         |
| **Overridable?**   | Only with `--entrypoint`             | Yes ‚Äî by runtime args              |
| **Execution Form** | Must use exec form                   | Can use exec or shell form         |
| **PID 1 Process**  | Becomes PID 1                        | Arguments only                     |
| **Typical Use**    | Main command (e.g., `python app.py`) | Default args (e.g., `--port 8080`) |

</div>

---

### ‚ùó **Common Mistakes & Fixes** <a id="2.4"></a>

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Mistake ‚ùå                                                        | Problem                             | Correct ‚úÖ                                                                        |
| ----------------------------------------------------------------- | ----------------------------------- | --------------------------------------------------------------------------------- |
| `ENTRYPOINT python app.py`                                        | Shell form ‚Üí signal issues          | `ENTRYPOINT ["python", "app.py"]`                                                 |
| Only `CMD ["--debug"]`                                            | No command ‚Üí ‚Äúexecutable not found‚Äù | Add `ENTRYPOINT ["python", "app.py"]`                                             |
| `ENTRYPOINT ["echo", "Starting..."]` + `CMD ["python", "app.py"]` | CMD passed to echo ‚Üí app never runs | Use same tool in both: `ENTRYPOINT ["python", "app.py"]`, `CMD ["--port","8080"]` |
| Shell script without `exec "$@"`                                  | App runs as child ‚Üí bad signals     | Add `exec "$@"` in script                                                         |

</div>

---

## üß≠ Kubernetes Pod YAML: `command` and `args` <a id="3"></a>

Kubernetes offers a way to **override or extend Docker‚Äôs defaults** at runtime using two fields inside the container spec.

<div align="center" style="background-color:#ffff;border-radius: 20px">
  <img src="./image/entrypoint-commands-in-docker-file.png" width="60%" alt="Docker ENTRYPOINT vs Kubernetes Command">
</div>

---

### üß† Understanding `command` <a id="3.1"></a>

- **Equivalent to** ‚Üí Docker‚Äôs `ENTRYPOINT`
- **Purpose** ‚Üí Defines the main program to run
- **Behavior** ‚Üí Completely overrides image‚Äôs `ENTRYPOINT`

```yaml
command: ["python", "server.py"]
```

If omitted, Kubernetes uses the Dockerfile‚Äôs `ENTRYPOINT`.

---

### üß© Understanding `args` <a id="3.2"></a>

- **Equivalent to** ‚Üí Docker‚Äôs `CMD`
- **Purpose** ‚Üí Provides arguments to the command
- **Behavior** ‚Üí Overrides Dockerfile‚Äôs `CMD`

```yaml
args: ["--port", "9090"]
```

---

### ‚ö†Ô∏è Common YAML Pitfalls <a id="3.3"></a>

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Mistake ‚ùå                                 | Why it fails                                  | Fix ‚úÖ                                   |
| ------------------------------------------ | --------------------------------------------- | ---------------------------------------- |
| `command: ["python app.py"]`               | Single string ‚Üí treated as literal, not split | `command: ["python", "app.py"]`          |
| Using both command & args as shell strings | Breaks argument parsing                       | Always use array (JSON) syntax           |
| Forgetting args override CMD               | Causes old defaults to persist                | Always check which field overrides which |

</div>

---

## üîÑ Docker vs Kubernetes Behavior <a id="4"></a>

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Behavior            | Dockerfile (`ENTRYPOINT` + `CMD`) | Kubernetes (`command` + `args`) |
| ------------------- | --------------------------------- | ------------------------------- |
| **When defined**    | During image build                | During pod deployment           |
| **Who controls it** | Image author                      | Cluster operator / DevOps       |
| **How to override** | `docker run --entrypoint` or args | `command:` / `args:` in YAML    |
| **Flexibility**     | Limited                           | Very flexible                   |
| **Best use**        | Define defaults once              | Adjust behavior per environment |

</div>

---

## üß™ **Hands-On Examples** <a id="5"></a>

### ‚úçüèª Example 1: Combined Use <a id="5.1"></a>

```dockerfile
FROM ubuntu:latest
ENTRYPOINT ["echo"]
CMD ["Hello, World!"]
```

| Command                                     | Behavior              | Output           |
| ------------------------------------------- | --------------------- | ---------------- |
| `docker run myimage`                        | Uses ENTRYPOINT + CMD | `Hello, World!`  |
| `docker run myimage Hi There!`              | Overrides CMD         | `Hi There!`      |
| `docker run --entrypoint /bin/bash myimage` | Overrides ENTRYPOINT  | Opens Bash shell |

---

### ‚úçüèª Example 2: CMD Without ENTRYPOINT <a id="5.2"></a>

```dockerfile
FROM ubuntu:latest
CMD ["echo", "Hello!"]
```

```bash
docker run myimage "Hi"
```

‚ùå **Result:**  
Docker replaces `CMD` entirely with `"Hi"`, tries to execute it as a binary ‚Üí
`exec: "Hi": executable file not found in $PATH`

‚úÖ **Fix:**  
Add a proper ENTRYPOINT:

```dockerfile
ENTRYPOINT ["echo"]
CMD ["Hello!"]
```

---

### ‚úçüèª Example 3: ENTRYPOINT with Runtime Args <a id="5.3"></a>

```dockerfile
FROM ubuntu:latest
ENTRYPOINT ["echo", "Hey there,"]
```

```bash
docker run myimage Hady Wafa
```

‚úÖ Output:

```ini
Hey there, Hady Wafa
```

‚Üí Runtime args are **appended** to the ENTRYPOINT automatically.

---

### ‚úçüèª Example 4: Kubernetes Override <a id="5.4"></a>

**Dockerfile:**

```dockerfile
ENTRYPOINT ["echo"]
CMD ["Hello from Docker!"]
```

**Kubernetes Pod YAML:**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: echo-pod
spec:
  containers:
    - name: echo
      image: your-image
      args: ["Hello from Kubernetes!"] # overrides CMD
```

‚úÖ Output:

```ini
Hello from Kubernetes!
```

Or override both:

```yaml
command: ["/bin/bash", "-c"]
args: ["echo 'ENTRYPOINT overridden in Kubernetes'"]
```

‚úÖ Output:

```ini
ENTRYPOINT overridden in Kubernetes
```

---

## ‚úÖ **Best Practices** <a id="6"></a>

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| #   | Best Practice                                          | Why                                        |
| --- | ------------------------------------------------------ | ------------------------------------------ |
| 1Ô∏è‚É£  | Use **exec form** (`["cmd", "arg"]`)                   | Avoids `/bin/sh -c`, ensures clean signals |
| 2Ô∏è‚É£  | **ENTRYPOINT** for the main command                    | Prevents accidental override               |
| 3Ô∏è‚É£  | **CMD** for default parameters                         | Keeps runtime flexible                     |
| 4Ô∏è‚É£  | Use Kubernetes `args` for overrides                    | No rebuilds required                       |
| 5Ô∏è‚É£  | Avoid single-string commands                           | YAML will misinterpret them                |
| 6Ô∏è‚É£  | Test overrides (`docker run ...`, `kubectl apply ...`) | Confirms expected behavior                 |
| 7Ô∏è‚É£  | Document command expectations                          | Saves debugging time                       |

</div>

---

## üèÅ **Conclusion** <a id="7"></a>

- Docker‚Äôs **`ENTRYPOINT`** defines **what runs**, and **`CMD`** defines **with what arguments**.
- Kubernetes‚Äô **`command`** and **`args`** let you **override** them per deployment ‚Äî no image rebuilds needed.
- Use **exec form**, avoid **shell wrapping**, and always **test both Docker and Kubernetes execution paths**.
