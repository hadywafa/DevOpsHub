# ğŸ“¦ **Kubernetes ResourceQuota**

## ğŸ“– **What is a ResourceQuota?**

A **ResourceQuota** is a Kubernetes object that **limits how much of a clusterâ€™s resources a single namespace can consume**.

It prevents:

- One team / namespace using all CPU
- Endless Pod creation
- Uncontrolled PVC creation
- Node/Disk exhaustion
- "Noisy neighbor" problems

It works **per namespace** only.

---

## ğŸ’¡ **Why ResourceQuota Exists**

Imagine Cluster has:

- 16 CPUs
- 32 GB memory
- 100 PVC allowed

Team A creates many Pods â†’ cluster becomes full â†’ Team B cannot deploy.

ResourceQuota ensures **fair resource sharing**.

---

## ğŸ”§ **What Can ResourceQuota Limit?**

### 1ï¸âƒ£ **Compute Resources**

- CPU requests
- CPU limits
- Memory requests
- Memory limits
- Hugepages

### 2ï¸âƒ£ **Object Counts**

- Pod count
- PVC count
- Service count
- LoadBalancers
- Secrets
- ConfigMaps

### 3ï¸âƒ£ **Storage (per PVC type)**

- total storage across PVCs
- per storage class quota

---

## ğŸ¯ **How It Works**

The quota controller:

- Watches a namespaceâ€™s resource usage
- Tracks how much is already used
- Blocks creation of new resources if quota exceeded

ResourceQuota + LimitRange â†’ full resource control.

---

## ğŸ§ª **Simple Example #1: Limit CPU and Memory in a Namespace**

### Step 1 â€” Create a namespace

```bash
kubectl create ns dev
```

### Step 2 â€” Create a ResourceQuota

```yaml
apiVersion: v1
kind: ResourceQuota
metadata:
  name: dev-quota
  namespace: dev
spec:
  hard:
    requests.cpu: "2"
    requests.memory: "4Gi"
    limits.cpu: "4"
    limits.memory: "8Gi"
```

Apply:

```bash
kubectl apply -f quota.yaml
```

---

## ğŸ” **Check quota**

```bash
kubectl get resourcequota -n dev
# or
kubectl get quota -n dev
```

Output:

```ini
NAME        AGE   REQUEST                                              LIMIT
dev-quota   10s   requests.cpu:0/2, requests.memory:0/4Gi             limits.cpu:0/4, limits.memory:0/8Gi
```

---

## ğŸ§ª **Simple Example #2: Quota for Number of Pods**

```yaml
apiVersion: v1
kind: ResourceQuota
metadata:
  name: object-quota
  namespace: dev
spec:
  hard:
    pods: "10"
    persistentvolumeclaims: "5"
    services: "3"
    configmaps: "20"
    secrets: "50"
```

ğŸ‘‰ This namespace cannot create more than:

- 10 Pods
- 5 PVCs
- 3 Services
- 20 ConfigMaps
- 50 Secrets

---

## ğŸ§ª **Example #3: Storage Class Quota**

```yaml
apiVersion: v1
kind: ResourceQuota
metadata:
  name: storage-quota
  namespace: dev
spec:
  hard:
    requests.storage: "100Gi"
    gp2.storageclass.storage.k8s.io/requests.storage: "50Gi"
    gp3.storageclass.storage.k8s.io/persistentvolumeclaims: "5"
```

Meaning:

- Total PVC storage â‰¤ 100Gi
- gp2 PVC storage â‰¤ 50Gi
- Max 5 PVCs created using gp3 storageClass

---

## âš ï¸ **Important: ResourceQuota Requires LimitRange**

If you require quotas on CPU/memory, Pods **must** define resource requests/limits.

If a pod has no requests â†’ quota controller doesnâ€™t know how to count it â†’ **it will be rejected**.

Fix: Add a LimitRange.

---

## ğŸ› ï¸ **LimitRange Example (works with quota)**

limit-range.yaml:

```yaml
apiVersion: v1
kind: LimitRange
metadata:
  name: default-limits
  namespace: dev
spec:
  limits:
    - default:
        cpu: 500m
        memory: 512Mi
      defaultRequest:
        cpu: 200m
        memory: 256Mi
      type: Container
```

Now Pods automatically get:

- 200m request
- 500m limit

So they count toward the quota properly.

---

## ğŸ§ª **Test ResourceQuota in Action**

### Try creating 20 Pods in namespace dev:

```bash
kubectl run test --image=nginx -n dev --replicas=20
```

You will get:

```ini
Error from server: pods "test-xxxxx" is forbidden: exceeded quota: object-quota
```

Try to create Pods with high memory:

```bash
kubectl run big --image=nginx -n dev --requests='cpu=1,memory=4Gi'
```

You will get:

```ini
exceeded quota: dev-quota, requested: requests.memory=4Gi
```

---

## ğŸš€ **Full Hands-On Workflow**

1. Create namespace â†’ `dev`
2. Apply ResourceQuota
3. Apply LimitRange
4. Create Pods
5. Watch quota usage

   ```bash
   kubectl describe quota dev-quota -n dev
   ```

6. Try exceeding quota
7. Get error messages â†’ understand behavior

---

## ğŸ“˜ **Summary (Very Simple)**

- **ResourceQuota controls max usage per namespace**
- Used to prevent â€œnoisy neighborâ€ problems
- Types:

  - Compute quota (CPU/mem)
  - Object quota (pods/pvc/etc.)
  - Storage quota

- Works best with **LimitRange**
- Enforced automatically by K8s API server
