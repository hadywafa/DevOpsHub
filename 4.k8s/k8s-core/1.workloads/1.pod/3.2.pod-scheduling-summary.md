# ğŸš€ **Kubernetes Pod Scheduling â€” The Ultimate Organized Guide**

There are **4 big families** of scheduling controls in Kubernetes:

---

## ğŸ—ºï¸ **The Entire Scheduling Decision Tree**

```mermaid
flowchart TD
A[Pod Scheduling Controls] --> B[Choose Node?]
A --> C[Place Relative to Other Pods?]
A --> D[Node Rejects Pods?]
A --> E[Availability Protection?]

B --> B1[nodeName]
B --> B2[nodeSelector]
B --> B3[Node Affinity]

C --> C1[Pod Affinity]
C --> C2[Pod Anti-Affinity]

D --> D1[Taints]
D --> D2[Tolerations]

E --> E1[PDB]
```

---

## ğŸ§­ **1. Node Targeting Controls**

> _â€œChoose **which nodes** a pod is allowed/preferred to run on.â€_

These rules depend **ONLY on the nodeâ€™s labels**.

---

### 1ï¸âƒ£ **nodeName** â€” _Direct assignment (avoid unless testing)_

**Behavior**:

- âœ”ï¸ Pod goes to exactly one node
- âŒ Skips scheduler
- âŒ If node is down â†’ pod stays Pending forever

**Use only for:**

- Debugging
- Forcing pod on a specific machine temporarily

**Mnemonic**:  
â¡ï¸ **nodeName = ZIP code** (one exact address)

---

```yaml
spec:
  nodeName: worker-1
```

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  nodeName: worker-1
  containers:
    - name: mypod
      image: busybox
      command: ["sh", "-c", "while true; do echo hello; sleep 5; done"]
```

---

### 2ï¸âƒ£ **nodeSelector** â€” _Simple 1:1 label match_

**Behavior:**

- âœ”ï¸ Pod must match node labels
- âŒ No conditions, no OR logic
- âŒ Exact match only

**Use for:**

- Simple mapping

  - `disktype=ssd`
  - `env=prod`

**Mnemonic**:
â¡ï¸ **nodeSelector = Basic filter** (like â€œgive me all red shoesâ€)

---

```yaml
spec:
  nodeSelector:
    disktype: ssd
```

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  nodeSelector:
    disktype: ssd
  containers:
    - name: mypod
      image: busybox
      command: ["sh", "-c", "while true; do echo hello; sleep 5; done"]
```

---

### 3ï¸âƒ£ **Node Affinity** â€” _Advanced version of nodeSelector_

**Behavior:**

- âœ”ï¸ Uses expressions (`In`, `NotIn`, `Exists`, `Gt`, etc.)
- âœ”ï¸ Supports AND/OR
- âœ”ï¸ Has soft & hard rules

#### Types:

| Type                           | Meaning                  |
| ------------------------------ | ------------------------ |
| **requiredDuringSchedulingâ€¦**  | Must match (hard rule)   |
| **preferredDuringSchedulingâ€¦** | Try to match (soft rule) |

**Use for:**

- Multiple labels
- Zones/regions
- â€œPrefer SSD nodes but allow HDD if no choiceâ€

**Mnemonic**:  
â¡ï¸ **Node Affinity = Smart filter** (like Amazon search with many conditions)

---

```yaml
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: disktype
                operator: In
                values:
                  - ssd
```

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: disktype
                operator: In
                values:
                  - ssd
  containers:
    - name: mypod
      image: nginx
```

## ğŸ”— **2. Pod-to-Pod Placement Controls**

> _â€œPlace pods near/far from **other pods** (not nodes).â€_

These rules depend on **other podsâ€™ labels**, not on nodes.

---

### 4ï¸âƒ£ **Pod Affinity** â€” _â€œStick togetherâ€_

Use when pods must be co-located for:

- âœ”ï¸ Low latency
- âœ”ï¸ Shared cache
- âœ”ï¸ Logging agent + app running together

**Example:**
Frontend wants to run with backend:

```yaml
topologyKey: kubernetes.io/hostname # required statement that tell the scheduler to place the pod on the same node as the other pod

# you're telling Kubernetes:
# ğŸ‘‰ â€œApply this rule per node â€” group or separate pods by node.â€
```

**Mnemonic:**  
â¡ï¸ **Affinity = BFF pods** (best friends forever)

---

```yaml
affinity:
podAffinity:
  requiredDuringSchedulingIgnoredDuringExecution:
    - labelSelector:
        matchLabels:
          app: backend
        topologyKey: "kubernetes.io/hostname"
```

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  affinity:
    podAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchLabels:
              app: backend
            topologyKey: "kubernetes.io/hostname"
  containers:
    - name: mypod
      image: nginx
```

---

### 5ï¸âƒ£ **Pod Anti-Affinity** â€” _â€œSpread apartâ€_

Best for **high availability**:

- âœ”ï¸ Replicas in different nodes
- âœ”ï¸ Avoid putting all pods on same node
- âœ”ï¸ Failure-domain separation (zone/region)

**Mnemonic:**  
â¡ï¸ **Anti-Affinity = Social distancing** (spread out)

---

```yaml
affinity:
podAntiAffinity:
  requiredDuringSchedulingIgnoredDuringExecution:
    - labelSelector:
        matchLabels:
          app: web
        topologyKey: "kubernetes.io/hostname"
```

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchLabels:
              app: web
            topologyKey: "kubernetes.io/hostname"
  containers:
    - name: mypod
      image: nginx
```

---

## ğŸš« **3. Node Rejection & Pod Permissions**

> _â€œNodes can reject pods. Pods can say theyâ€™re allowed.â€_

This is **direction reversed** from affinity:

- Affinity = Pod chooses node
- Taints = Node rejects pod
- Tolerations = Pod says â€œI can handle that taintâ€

---

### 6ï¸âƒ£ **Taints** â€” _Node says â€œDo NOT schedule pods here unless allowedâ€_

```bash
kubectl taint nodes node1 dedicated=gpu:NoSchedule
```

Node becomes:

- âŒ hostile to all pods
- âœ”ï¸ unless they tolerate the taint

Use for:

- GPU nodes
- Special workloads
- Reserved nodes

**Mnemonic:**  
â¡ï¸ **Taints = Bouncers at a club** (no entry unless on the list)

---

### 7ï¸âƒ£ **Tolerations** â€” _Pod says â€œIâ€™m allowed on that tainted nodeâ€_

```yaml
tolerations:
  - key: "gpu"
    value: "true"
    effect: "NoSchedule"
```

Pod becomes:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  tolerations:
    - key: "gpu"
      value: "true"
      effect: "NoSchedule"
  containers:
    - name: mypod
      image: nginx
```

Use for:

- Allow certain pods to run on isolated nodes
- Let system-level pods run everywhere

**Mnemonic:**  
â¡ï¸ **Toleration = VIP pass** (grants access to restricted spaces)

---

## ğŸ¥ **4. Pod Availability Protections**

> _â€œLimit how many pods can be taken down at once.â€_

Not about scheduling location â†’ but **scheduling stability**.

---

### 8ï¸âƒ£ **PodDisruptionBudget (PDB)** â€” _Protect pods during maintenance_

Use for:

- âœ”ï¸ Node drain
- âœ”ï¸ Cluster upgrades
- âœ”ï¸ Prevent all replicas from going down

Example:

```yaml
minAvailable: 1
```

**Mnemonic:**  
â¡ï¸ **PDB = Insurance policy** (protects against voluntary disruptions)

---

## ğŸ§  **When to Use What â€” The 1-Minute Cheatsheet**

| Goal                                  | Use                   |
| ------------------------------------- | --------------------- |
| Put pod on exact node                 | **nodeName**          |
| Simple label match                    | **nodeSelector**      |
| Advanced node filtering               | **Node Affinity**     |
| Keep pods together                    | **Pod Affinity**      |
| Separate replicas                     | **Pod Anti-Affinity** |
| Block pods from nodes                 | **Taints**            |
| Allow pods on tainted nodes           | **Tolerations**       |
| Prevent too many pods from being down | **PDB**               |

---

## ğŸ† **The Memory Framework (SUPER EASY)**

> All scheduling controls fall into **only 4 categories**:

### **1. â€œGo TO this nodeâ€**

- nodeName
- nodeSelector
- Node Affinity

### **2. â€œGo NEAR / FAR from these podsâ€**

- Pod Affinity
- Pod Anti-Affinity

### **3. â€œNode Rejects Pod unlessâ€¦â€**

- Taints â†’ node blocks
- Tolerations â†’ pod allowed

### **4. â€œDonâ€™t kill too many pods at onceâ€**

- PDB

This mental map ensures you never mix them again.

---

## ğŸ Want me to turn this into a printable 1-page PDF cheatsheet with colors & diagrams?
