# ğŸ”„ Understanding `rewrite-target` in NGINX Ingress: From Basics to Advanced

## ğŸ§­ Overview

In Kubernetes, the NGINX Ingress Controller allows you to route external traffic to internal services. But what happens when your backend services donâ€™t expect the path prefix used in the Ingress? Thatâ€™s where the `rewrite-target` annotation comes in â€” it lets you **rewrite the incoming request path** before forwarding it to the backend.

---

## ğŸ§± Basic Use Case: Strip the Path Prefix

Imagine two apps:

- **Watch App** at `http://<watch-service>:<port>/`
- **Wear App** at `http://<wear-service>:<port>/`

You want users to access them via:

- `http://<ingress-service>:<port>/watch`
- `http://<ingress-service>:<port>/wear`

But without rewriting, the controller forwards:

- `/watch` â†’ `http://<watch-service>:<port>/watch` âŒ
- `/wear` â†’ `http://<wear-service>:<port>/wear` âŒ

These paths donâ€™t exist in the apps, so users get `404`.

âœ… **Fix**: Use `rewrite-target: /` to strip the prefix.

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: app-ingress
  namespace: frontend
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
    - http:
        paths:
          - path: /watch
            pathType: Prefix
            backend:
              service:
                name: watch-service
                port:
                  number: 80
          - path: /wear
            pathType: Prefix
            backend:
              service:
                name: wear-service
                port:
                  number: 80
```

ğŸ” This rewrites `/watch` â†’ `/` before sending to `watch-service`.

---

## ğŸ§ª Advanced Use Case: Regex Rewrite

Sometimes you want **partial rewrites**, not just stripping everything. For example:

- Incoming: `/something/abc`
- Desired backend path: `/abc`

Use regex in the path and capture groups:

```yaml
metadata:
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
spec:
  rules:
    - host: rewrite.bar.com
      http:
        paths:
          - path: /something(/|$)(.*)
            pathType: Prefix
            backend:
              service:
                name: http-svc
                port:
                  number: 80
```

ğŸ§  Breakdown:

- `(/|$)(.*)` captures everything after `/something`
- `$2` injects that into the rewritten path

So `/something/abc` â†’ `/abc`  
And `/something/xyz/page` â†’ `/xyz/page`

---

## ğŸ§  Summary

| Scenario                       | Rewrite Target   | Result                    |
| ------------------------------ | ---------------- | ------------------------- |
| Strip prefix `/watch`          | `/`              | `/watch` â†’ `/`            |
| Regex capture `/something/abc` | `/$2`            | `/something/abc` â†’ `/abc` |
| Preserve subpaths `/wear/item` | `/$2` with regex | `/wear/item` â†’ `/item`    |
