# üìÉ `kubeconfig`

## üï∞Ô∏è Life Before `kubeconfig`: Manual API Access

Before `kubeconfig`, interacting with the Kubernetes API meant manually specifying:

- The API server‚Äôs IP or DNS
- TLS client certificate and key
- CA certificate for server verification
- Authentication token or identity
- Namespace and context

This was tedious, error-prone, and hard to automate ‚Äî especially across clusters or users.

> üîÅ `kubeconfig` solves this by bundling all connection, authentication, and context info into a single declarative file.

---

### üîß Example: Using `curl` to Access the API Server

```bash
curl --cert hady-admin.crt \
     --key hady-admin.key \
     --cacert ca.crt \
     https://38.0.101.76:6443/api/v1/namespaces/default/pods
```

This:

- Authenticates using your client cert
- Verifies the server using the CA
- Manually hits the API endpoint

> üß® This is tedious, error-prone, and hard to automate ‚Äî especially across clusters.

---

### üîß Example: `kubectl` Without `kubeconfig`

You _can_ use `kubectl` without a `kubeconfig`, but you must manually pass all connection and auth flags.

```bash
kubectl get pods \
  --server=https://38.0.101.76:6443 \
  --certificate-authority=/etc/kubernetes/pki/ca.crt \
  --client-certificate=hady-admin.crt \
  --client-key=hady-admin.key \
  --namespace=default
```

This:

- Connects to the API server at `38.0.101.76:6443`
- Authenticates using your client cert/key
- Verifies the server using the CA
- Targets the `default` namespace

> üß® This is verbose, hard to remember, and not scalable across clusters or users.

---

## ‚ú® Enter `kubeconfig`: Declarative, Context-Aware Access

With `kubeconfig`, you define:

- **Clusters**: API server endpoint + CA
- **Users**: Identity (certs, tokens, exec plugins)
- **Contexts**: Cluster + user + namespace
- **Current context**: Default target for `kubectl`

### üì¶ Example `kubeconfig`

```yaml
apiVersion: v1
kind: Config
clusters:
  - name: my-cluster
    cluster:
      server: https://38.0.101.76:6443
      certificate-authority: /etc/kubernetes/pki/ca.crt
users:
  - name: hady-admin
    user:
      client-certificate: hady-admin.crt
      client-key: hady-admin.key
contexts:
  - name: hady-admin-context
    context:
      cluster: my-cluster
      user: hady-admin
      namespace: default
current-context: hady-admin-context
```

Save this as `hady-kubeconfig.yaml`.

---

### üîß Example: `kubectl` With `kubeconfig`

```bash
kubectl get pods --kubeconfig=hady-kubeconfig.yaml
```

Or if it's set as default:

```bash
export KUBECONFIG=hady-kubeconfig.yaml
kubectl get pods
```

or if it is in `~/.kube/config`:

```bash
kubectl get pods
```

> üîÅ Now `kubectl` knows everything ‚Äî no need to pass certs, keys, or server flags.

---

## üîê What Is `kubeconfig` and Why Do We Need It?

`kubeconfig` is a configuration file that tells `kubectl` (and other clients) **how to connect to the Kubernetes API server** ‚Äî including:

- **Where** the API server is (`server:` URL)
- **Who** you are (`user:` identity)
- **How** to authenticate (certs, tokens, etc.)
- **Which cluster** and **namespace** to use

> üß† Without `kubeconfig`, every API call would require manually specifying TLS certs, tokens, and endpoints ‚Äî which is painful and error-prone.

---

## üì¶ Anatomy of a `kubeconfig` File

```yaml
apiVersion: v1
kind: Config
clusters:
  - name: my-cluster
    cluster:
      server: https://38.0.101.76:6443
      certificate-authority: /etc/kubernetes/pki/ca.crt
users:
  - name: hady-admin
    user:
      client-certificate: hady-admin.crt
      client-key: hady-admin.key
contexts:
  - name: hady-admin-context
    context:
      cluster: my-cluster
      user: hady-admin
      namespace: default
current-context: hady-admin-context
```

> üîÅ This file lets you run `kubectl get pods` without manually passing certs or tokens.

---

## üîê Authentication Methods in `kubeconfig`

<div align="center" style="background:#343739ff; border-radius:20px">

| Method            | Use Case                   | Example Field                      |
| ----------------- | -------------------------- | ---------------------------------- |
| Username/password | Basic auth (deprecated)    | `username`, `password`             |
| Bearer token      | ServiceAccounts, CI/CD     | `token`                            |
| Client certs      | Admins, kubelet, webhooks  | `client-certificate`, `client-key` |
| Exec plugin       | Cloud IAM (e.g., EKS, GKE) | `exec:` block                      |

</div>

---

## üß† How `kubectl` Uses `kubeconfig`

When you run `kubectl`, it:

1. Loads the config from:
   - `$KUBECONFIG` env var (if set)
   - `~/.kube/config` (default)
2. Selects the `current-context`
3. Uses the associated cluster and user
4. Builds a secure HTTPS request to the API server

---

## üß™ Bonus: Build Your Own `kubeconfig` from Certs

```bash
kubectl config set-cluster my-cluster \
  --server=https://38.0.101.76:6443 \
  --certificate-authority=/etc/kubernetes/pki/ca.crt \
  --kubeconfig=hady-kubeconfig.yaml

kubectl config set-credentials hady-admin \
  --client-certificate=hady-admin.crt \
  --client-key=hady-admin.key \
  --kubeconfig=hady-kubeconfig.yaml

kubectl config set-context hady-admin-context \
  --cluster=my-cluster \
  --user=hady-admin \
  --namespace=default \
  --kubeconfig=hady-kubeconfig.yaml

kubectl config use-context hady-admin-context --kubeconfig=hady-kubeconfig.yaml
```

---

## üß† TL;DR

<div align="center" style="background:#343739ff; border-radius:20px">

| Feature       | `kubectl` Without `kubeconfig` | `kubectl` With `kubeconfig`       |
| ------------- | ------------------------------ | --------------------------------- |
| Auth          | Manual certs/tokens            | Auto-loaded from config           |
| TLS           | Manual CA and flags            | Auto-loaded from config           |
| Usability     | Low                            | High                              |
| Multi-cluster | Manual switching               | Context switching (`use-context`) |
| Automation    | Hard                           | Easy                              |

</div>
