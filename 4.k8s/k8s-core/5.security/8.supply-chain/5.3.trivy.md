# ğŸ¨ **Trivy**

_A simple yet powerful vulnerability scanner for containers, IaC, SBOMs, filesystems, Git repos, Kubernetes, and cloud._

---

## ğŸ“– **What Is Trivy?**

**Trivy** (by Aqua Security) is an **all-in-one security scanner** used to scan:

| Scan Target                          | Purpose                                       |
| ------------------------------------ | --------------------------------------------- |
| **Container Images**                 | Detect CVEs in OS packages & app dependencies |
| **File System**                      | Scan local projects                           |
| **Git Repos**                        | Pre-commit security scanning                  |
| **SBOMs**                            | Analyze existing SBOM files                   |
| **Kubernetes Clusters**              | Audit running workloads                       |
| **IaC (Terraform, Kubernetes YAML)** | Detect misconfigurations                      |
| **AWS, GCP, Azure**                  | Cloud security posture management             |

ğŸ¯ **You can think of Trivy as:**

> â€œThe Swiss Army Knife of DevSecOps scanning.â€

---

<div align="center" style="background-color:#F1F1F1; border-radius: 10px; border: 2px solid">
<img src="image/1763548540487.png" alt="OpenSSL" style="width: 80%">
</div>

---

<div align="center" style="background-color:#F1F1F1; border-radius: 10px; border: 2px solid">
<img src="image/1763548565229.png" alt="OpenSSL" style="width: 80%">
</div>

---

<div align="center" style="background-color:#F1F1F1; border-radius: 10px; border: 2px solid">
<img src="image/1763548587429.png" alt="OpenSSL" style="width: 80%">
</div>

---

## ğŸ§  **Why DevOps Engineers Use Trivy**

- âœ” Lightning fast
- âœ” Low setup (no DB install â€” auto updates)
- âœ” Scans OS + dependencies (npm, pip, go, jars, Rust, etc.)
- âœ” Integrated with GitHub Actions / GitLab / Azure DevOps
- âœ” Produces **SBOMs** (CycloneDX / SPDX)
- âœ” Free & open-source

---

## ğŸ”¥ **Trivy Architecture (Simple View)**

<div align="center" style="background-color: #161414ff; border-radius: 10px; border: 2px solid">

```mermaid
---
config:
  theme: dark
  look: handDrawn
title: "Trivy CLI Vulnerability Scan"
---

flowchart TD
    A["ğŸ³ Trivy CLI / Docker"]
    B["ğŸ“¥ Fetch Vulnerability DB"]
    C["ğŸ” Scan Artifact<br>(Image / Filesystem / IaC)"]
    D["ğŸ“Š Output CVEs<br>+ Severity + Fix"]

    A --> B
    B --> C
    C --> D
```

</div>

---

## ğŸ› ï¸ **Install Trivy**

### Linux / Mac:

```bash
brew install aquasecurity/trivy/trivy
```

### Docker:

```bash
docker run --rm aquasecurity/trivy:latest --help
```

---

## ğŸš¢ **Scan a Docker Image (Most Common Use Case)**

### Example: scanning nginx

```bash
trivy image nginx:latest
```

Output (simplified):

```ini
CVE-2023-0464  HIGH      openssl 1.1.1f
CVE-2021-23017 HIGH      nginx 1.21
CVE-2022-0778  CRITICAL  openssl
```

ğŸ” **Trivy checks:**

- Alpine/Debian/Ubuntu packages
- Application libraries (npm, pip, jar)
- OS vulnerabilities
- Critical CVEs

---

## ğŸ“ **Scan a Local File System (Application Source Code)**

```bash
trivy fs .
```

Use case:

- Scan your app before building a Docker image
- Pre-commit hooks
- Detect vulnerabilities in `package.json`, `requirements.txt`, etc.

---

## ğŸ—ï¸ **Scan Infrastructure as Code (IaC)**

(Super useful for Terraform & Kubernetes YAML security)

### Scan Terraform:

```bash
trivy config terraform/
```

### Scan Kubernetes YAML:

```bash
trivy config k8s-manifests/
```

Example output:

```ini
K8S003: Containers should not run as root
K8S010: Image tag should not be 'latest'
```

---

## â˜¸ï¸ **Scan a Kubernetes Cluster (Running Workloads)**

```bash
trivy k8s --report summary
```

Or scan a namespace:

```bash
trivy k8s --namespace dev deployment/myapp
```

Output:

```ini
deployment/myapp has 3 High vulnerabilities
```

ğŸŸ¦ Useful for:

- Cluster auditing
- Admission control integration
- Continuous compliance monitoring

---

## ğŸ“¦ **Generate SBOM Using Trivy**

Trivy can output **CycloneDX** or **SPDX** SBOMs.

### Generate CycloneDX SBOM:

```bash
trivy image --format cyclonedx --output sbom.json myapp:1.0
```

### Generate SPDX SBOM:

```bash
trivy image --format spdx --output sbom.spdx myapp:1.0
```

---

## ğŸ” **Scan an SBOM File**

If you already have an SBOM (from Syft, Docker Scout, etc.):

```bash
trivy sbom sbom.json
```

---

## ğŸ“¦ **Trivy + Docker Registry Scanning**

### Scan images without pulling:

```bash
trivy image --remote registry.example.com/app:prod
```

Useful for:

- Private registries
- GitHub Container Registry
- AWS ECR / GCP GCR / Azure ACR

---

## ğŸ§ª **Trivy in CI/CD (Example: GitHub Actions)**

`.github/workflows/trivy.yml`

```yaml
name: Trivy Scan
on: push

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build Docker image
        run: docker build -t myapp:latest .

      - name: Run Trivy scan
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: "myapp:latest"
          format: "table"
          exit-code: "1"
          severity: "CRITICAL,HIGH"
```

ğŸ“Œ **exit-code: 1 â†’ pipeline fails for High/Critical CVEs**

Perfect for DevSecOps.

---

## ğŸ” **Advanced: Scanning Only Critical / High Issues**

```bash
trivy image --severity HIGH,CRITICAL myapp:latest
```

---

## ğŸ¯ **Advanced: Ignore a Specific CVE (Justification Required)**

Add file `.trivyignore`:

```ini
CVE-2022-12345
CVE-2021-44572
```

Then run:

```bash
trivy image myapp:latest
```

---

## ğŸ§¹ **Best Practices for Using Trivy in Production**

<div align="center" style="background-color:#F1F1F1; border-radius: 10px; border: 2px solid">
<img src="image/1763548509911.png" alt="OpenSSL" style="width: 80%">
</div>

---

### âœ” 1. Scan early (shift left)

- Run Trivy in CI before building or deploying.

### âœ” 2. Fail pipeline for High/Critical

- Use severity thresholds.

### âœ” 3. Generate SBOMs automatically

- Store them in artifact registry.

### âœ” 4. Scan running clusters periodically (using Trivy Operator)

- Trivy Operator is available for Kubernetes.

### âœ” 5. Use minimal base images

<div align="center" style="background-color:#F1F1F1; border-radius: 10px; border: 2px solid;margin: 0 20px">
<img src="image/1763548471528.png" alt="OpenSSL" style="width: 60%">
</div>

- Examples:

  - `distroless`
  - `alpine`
  - `ubi-micro`

### âœ” 6. Fix CVEs by upgrading:

- Base image
- OS packages
- Library versions

---

## ğŸ§© **Trivy vs Grype vs Clair**

| Feature              | Trivy | Grype  | Clair |
| -------------------- | ----- | ------ | ----- |
| Image scanning       | âœ”     | âœ”      | âœ”     |
| SBOM generation      | âœ”     | âœ”      | âœ–     |
| IaC scanning         | âœ”     | âœ–      | âœ–     |
| File system scanning | âœ”     | âœ”      | âœ–     |
| Kubernetes scanning  | âœ”     | âœ–      | âœ”     |
| Speed                | Fast  | Medium | Slow  |
| Setup                | Easy  | Easy   | Hard  |

---

## ğŸ **Final Summary**

**Trivy is the most versatile and easiest vulnerability scanner in DevOps.**
You can scan:

- Docker images
- Kubernetes clusters
- IaC (Terraform / YAML)
- Filesystems
- SBOMs
- Repos
- Registries
- Cloud environments

With one tool.

And it works perfectly with CI/CD, DevSecOps, and Kubernetes admissions.

---

If you want, I can also provide:

- ğŸ”¸ **Hands-on example for Trivy Operator in Kubernetes**
- ğŸ”¸ **Trivy as an Admission Controller**
- ğŸ”¸ **Trivy vs Grype deep comparison**
- ğŸ”¸ **SBOM workflow using Trivy + Syft + Grype**

Just tell me **â€œcontinueâ€**!
