# ğŸ” Projected ServiceAccount Tokens (Kubernetes â‰¥1.24)

Projected tokens are the default mechanism Kubernetes uses to securely mount ServiceAccount credentials into Pods. They replace legacy long-lived Secret-based tokens with **short-lived, auto-rotated, audience-bound JWTs**.

---

## ğŸ§“ğŸ» vs ğŸ†• **Token Types**

### ğŸ§© Legacy Tokens (Old Behavior)

- Static token stored as a **Secret**
- Never expires (risky)
- Was default before Kubernetes v1.24

### ğŸ§© Bound ServiceAccount Tokens (New Default)

Introduced in v1.24+ for security:

- **Auto-generated** and **short-lived**
- Automatically rotated by Kubernetes
- Not stored as Secrets
- **Bound** to a specific Pod â†’ cannot be reused elsewhere

---

## ğŸ§© What Is a Projected Token?

A **projected ServiceAccount token** is:

- A **short-lived JWT** (default: 1 hour)
- **Bound to a specific audience** (e.g., `kubernetes.default.svc`)
- **Auto-rotated** by the kubelet before expiration
- **Mounted via a projected volume** at:

  ```ini
  /var/run/secrets/kubernetes.io/serviceaccount/token
  ```

- **Not stored in etcd** or exposed via `kubectl get secret`

---

## âš™ï¸ Default Behavior for Internal ServiceAccounts

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Behavior         | Default Value / Action                                      |
| ---------------- | ----------------------------------------------------------- |
| Token Mount Path | `/var/run/secrets/kubernetes.io/serviceaccount/token`       |
| Expiration       | 3600 seconds (1 hour)                                       |
| Rotation         | âœ… Auto-rotated before expiry                               |
| Audience         | `kubernetes.default.svc`                                    |
| Storage          | âŒ Not stored in etcd                                       |
| Scope            | Bound to Pod lifetime                                       |
| Feature Gate     | `BoundServiceAccountTokenVolume` (enabled by default â‰¥1.20) |

</div>

---

## ğŸ“¦ Example: Default Pod Behavior (Auto-Renewed Token)

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: demo
  namespace: dev
spec:
  serviceAccountName: webapp-sa
  containers:
    - name: app
      image: busybox
      command: ["sleep", "3600"]
```

Inside the Pod:

```bash
cat /var/run/secrets/kubernetes.io/serviceaccount/token
```

This token is:

- Auto-mounted
- Auto-rotated
- Valid only for the Kubernetes API

---

## âŒ Custom Projected Token (Static, Non-Rotated)

If you manually define a projected volume, Kubernetes treats the token as **static** and **does not auto-rotate** it:

```yaml
volumes:
  - name: static-token
    projected:
      sources:
        - serviceAccountToken:
            path: token
            expirationSeconds: 3600
            audience: custom-audience
```

> âš ï¸ This token will expire after 1 hour and must be refreshed manually.

---

## ğŸ§  Key Differences: Auto vs Static Token

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Mount Style              | Auto-Renewed? | Rotation Managed By  | Use Case                             |
| ------------------------ | ------------- | -------------------- | ------------------------------------ |
| Default (implicit mount) | âœ… Yes        | Kubernetes           | Internal Pods needing API access     |
| Manual projected volume  | âŒ No         | You (manual refresh) | Webhooks, short-lived jobs, external |

</div>

---

## ğŸ”„ Deployment Behavior

- If you edit a Deployment to change `expirationSeconds` or `audience`, the change **only applies to new Pods**
- Existing Pods **retain their original token config**
- To apply changes immediately:

  ```bash
  kubectl rollout restart deployment <name> -n <namespace>
  ```
