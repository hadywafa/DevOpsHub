# ğŸ“‹ **OPA - Notes**

## ğŸ“Œ **OPA References**

How Netflix Is Solving Authorization Across Their Cloud [I] â€“ Manish Mehta & Torin Sandall, Netflix

- <https://www.youtube.com/watch?v=R6tUNpRpdnY>

OPA Deep Dive

- <https://www.youtube.com/watch?v=4mBJSIhs2xQ>

## ğŸ“Œ **kube-mgmt**

**`kube-mgmt` is a sidecar component used with Open Policy Agent (OPA) to automatically load Kubernetes resources (like ConfigMaps and CRDs) into OPA for policy evaluation. It is _not_ part of Gatekeeper, but rather used in standalone OPA deployments.**

---

### ğŸ“– **What Is `kube-mgmt`?**

- **Purpose:** It syncs Kubernetes resources into OPAâ€™s internal data store.
- **Use Case:** When you deploy OPA as an admission controller (outside of Gatekeeper), `kube-mgmt` runs alongside it to keep OPA updated with cluster state.
- **Functionality:**

  - Watches Kubernetes resources (e.g., `ConfigMaps`, `Namespaces`, `Deployments`)
  - Loads them into OPA as structured JSON under `data.kubernetes`
  - Enables policies like:

    ```rego
    package kubernetes.admission

    deny[msg] {
      input.request.kind.kind == "Pod"
      not input.request.object.spec.containers[_].resources
      msg = "Containers must specify resource limits"
    }
    ```

---

### â“ **How It Differs from Gatekeeper**

| Feature           | `kube-mgmt` + OPA                 | Gatekeeper (OPA-native)               |
| ----------------- | --------------------------------- | ------------------------------------- |
| Policy Language   | Rego                              | Rego                                  |
| Syncing Resources | Uses `kube-mgmt` sidecar          | Built-in via CRDs                     |
| Policy Management | Manual (ConfigMaps, etc.)         | Declarative via `ConstraintTemplates` |
| Mutation Support  | Yes (via webhook)                 | Yes                                   |
| Community Support | Deprecated in favor of Gatekeeper | Actively maintained                   |

Gatekeeper is now the preferred way to enforce policies in Kubernetes using OPA, as it integrates deeply with Kubernetes via CRDs like `ConstraintTemplate` and `Constraint`.

---

### â“ When to Use `kube-mgmt`

- **Standalone OPA deployments** (e.g., custom admission controllers)
- **Non-Kubernetes environments** where you still want to sync external data
- **Legacy setups** before Gatekeeper became standard
