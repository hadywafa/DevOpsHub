# ğŸš€ Kubernetes Security Controls Explained (PSP vs PAC vs PSS vs PSA)

_*Your Ultimate Visual + Practical Explanation*_

Kubernetes security evolved dramatically over the last few years. To secure Pods properly, you must understand **four major concepts**:

- **PSP â€” Pod Security Policy (Deprecated âŒ)**
- **PSS â€” Pod Security Standards (Privileged / Baseline / Restricted)**
- **PSA â€” Pod Security Admission (the new built-in admission controller)**
- **PAC â€” Policy-as-Code solutions (Kyverno, OPA, Gatekeeper)**

This guide explains all four in your preferred enhanced style. Enjoy! ğŸ˜„

---

## âŒ 1. Pod Security Policy (PSP) â€” _The Old, Confusing Giant_ (Deprecated)

### ğŸ¯ What PSP Was

A **cluster-level admission controller** used to enforce Pod security settings before Pods were created.

It controlled things like:

- Running as root
- Privileged containers
- Host networking
- Linux capabilities
- seccomp/apparmor
- hostPath mounts
- and much more

In theory, PSP was great.  
In practiceâ€¦ PSP was a **mess**. ğŸ˜…

---

### ğŸ˜« Problems With PSP (Why It Was Removed)

#### ğŸ”¸ 1. Hard to Understand

- Nobody could easily tell **which PSP applied** to which Pod.
- It felt like debugging invisible ghosts ğŸ‘».

#### ğŸ”¸ 2. Too Many Foot-guns

- Users often got overly permissive PSPs _just to make things work_, defeating security.

#### ğŸ”¸ 3. No Audit / Dry-Run Mode

- You couldnâ€™t test if a Pod would break before applying PSP.

#### ğŸ”¸ 4. Didnâ€™t Support Modern Runtime Needs

- Things like Kata containers, gVisor, runtime classes were difficult.

#### ğŸ”¸ 5. Enabled Too Late in Kubernetesâ€™ History

- Clusters couldnâ€™t enable PSP by default without breaking everything.

---

### âš ï¸ PSP Deprecation Timeline

| Kubernetes Version | Status                 |
| ------------------ | ---------------------- |
| v1.21              | PSP deprecated         |
| v1.25              | PSP removed completely |

---

## ğŸ“ƒ PSS â€” Pod Security Standards

**PSS is NOT an admission controller.**
Itâ€™s a **specification**, a **set of 3 security profiles** that Kubernetes recommends.

Think of PSS as:
ğŸ‘‰ â€œSecurity levels describing what Pods are allowed to do.â€

These levels are **cumulative**.

---

### âš™ï¸ The Three PSS Levels

| Level             | Purpose               | Summary                               |
| ----------------- | --------------------- | ------------------------------------- |
| **Privileged** ğŸ”¥ | For system components | Everything allowed                    |
| **Baseline** âš–ï¸   | Safe defaults         | No privilege escalation               |
| **Restricted** ğŸ”’ | Maximum security      | Non-root, read-only FS, seccomp, etc. |

---

### ğŸ”¥ Privileged (Most Permissive)

Used for:

- CNI plugins
- CSI drivers
- low-level daemons
- debugging

Allows everything including:

- `privileged: true`
- host networking
- host volumes
- host PID/IPC

---

### âš–ï¸ Baseline (Standard Default)

Blocks:

- Privilege escalation
- Adding Linux capabilities
- hostPath
- hostPID
- hostIPC
- hostNetwork

---

### ğŸ”’ Restricted (Production Hardening)

Requires:

- `runAsNonRoot: true`
- read-only root filesystem
- seccomp runtime default
- drops all capabilities
- avoids host namespace usage

Used for:

- Payments systems
- PII data services
- Regulated industries

---

## ğŸ§² 2. PSA â€” Pod Security Admission

**PSA is the built-in admission controller released to replace PSP.**

Think of PSA as:
ğŸ‘‰ â€œEnforce PSS via Namespace labels.â€

PSA enforces PSS using **three modes**:

---

### ğŸ® PSA Modes

#### 1ï¸âƒ£ Enforce Mode ğŸš«

- Violating Pod is **rejected**
- Strongest enforcement

#### 2ï¸âƒ£ Audit Mode ğŸ“

- Pod allowed
- Violation logged in audit events

#### 3ï¸âƒ£ Warn Mode âš ï¸

- Pod allowed
- User gets CLI warnings

---

### ğŸ·ï¸ PSA Namespace Labels

| Mode    | Label                                | Value                              |
| ------- | ------------------------------------ | ---------------------------------- |
| Enforce | `pod-security.kubernetes.io/enforce` | privileged / baseline / restricted |
| Audit   | `pod-security.kubernetes.io/audit`   | privileged / baseline / restricted |
| Warn    | `pod-security.kubernetes.io/warn`    | privileged / baseline / restricted |

Multiple modes can exist on the same namespace.

---

### ğŸ“¦ Example

#### Enforce Strict Policy

```yaml
pod-security.kubernetes.io/enforce: restricted
```

Any Pod failing Restricted PSS = âŒ rejected.

#### Audit Violations

```yaml
pod-security.kubernetes.io/audit: baseline
```

Violations appear in logs but Pods run.

#### Warn Users

```yaml
pod-security.kubernetes.io/warn: privileged
```

Users see warnings, but Pods run.

---

### ğŸ§© PSA Exemptions â€” The VIP Pass ğŸ«

Sometimes certain entities need to bypass PSA rules.

#### 1ï¸âƒ£ User Exemptions

Whitelisted usernames bypass checks.

Used for:

- CI/CD pipelines
- Admin automation

#### 2ï¸âƒ£ RuntimeClass Exemptions

Some runtimes (e.g., gVisor) might require exemptions.

#### 3ï¸âƒ£ Namespace Exemptions

System namespaces often exempted:

- `kube-system`
- `kube-public`

So that CNIs / CSIs work.

---

## ğŸ¤– 3. PAC â€” Policy as Code (Kyverno, OPA, Gatekeeper, jsPolicy)

PAC = **write rules in code and enforce them through admission controllers**.

Think of PAC as:
ğŸ‘‰ â€œBuild your own Kubernetes security guard with custom rules.â€

---

### ğŸ¯ Why PAC Became Popular

Because PSP was limited and too static.

PAC tools offer:

- Custom policies
- JSON/YAML-based rule definition
- Auditing
- Mutations
- Validation
- Exceptions
- Reusable libraries

---

### â­ Popular PAC Tools

#### ğŸ”¹ **Kyverno**

- Kubernetes-native
- Policies written in YAML
- Easy for ops teams
- Mutation + Validation + Generation

#### ğŸ”¹ **OPA + Gatekeeper**

- Rego policy language
- Extremely flexible
- Enterprise-grade compliance

#### ğŸ”¹ **jsPolicy**

- Write policies in JavaScript
- Fun for web dev teams

---

### ğŸ¤” When Should You Use PAC?

- Multi-team clusters
- Strict compliance (PCI, SOC2)
- Complex rules
- Custom logic (e.g., image registry restrictions)
- When PSA is not enough

---

## ğŸ”„ Migration Strategy: PSP â PSA (Your Easy Roadmap)

Here is a simple, structured migration plan:

1. **Inventory PSPs**
   Identify privileged, baseline-like, and restricted-like settings.

2. **Enable PSA in Audit Mode First**
   No breakage, just logs.

3. **Review Violations**
   List workloads that wonâ€™t pass Baseline/Restricted.

4. **Fix Pod Specs**
   Update securityContext settings.

5. **Enable Warn Mode**
   Warn users before forcing changes.

6. **Enable Enforce**
   Start with Baseline â†’ Restricted later.

7. **Roll out gradually**
   Namespace by namespace.

8. **Communicate**
   Dev teams must understand why Pods fail.

---

## ğŸ” Visual Diagram

### _How PSA Works Internally_

```mermaid
flowchart LR
    A[User Creates Pod] --> B[API Server]
    B --> C{PSA Admission Controller}
    C -->|Check Against Labels| D[Evaluate Against PSS]
    D -->|Pass| E[Pod Accepted]
    D -->|Warn Mode| F[Warning to User]
    D -->|Audit Mode| G[Audit Log Entry]
    D -->|Enforce Failed| H[Pod Rejected]
```

---

## ğŸ§ª Example Pods for Each PSS Level

### ğŸ”¥ Privileged

```yaml
securityContext:
  privileged: true
```

### âš–ï¸ Baseline

```yaml
securityContext:
  allowPrivilegeEscalation: false
```

### ğŸ”’ Restricted

```yaml
securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  readOnlyRootFilesystem: true
  seccompProfile:
    type: RuntimeDefault
```

---

## ğŸ§  When to Use PSP, PAC, PSS, PSA? (Final Cheat Sheet)

| Feature            | PSP          | PSA                      | PAC (OPA/Kyverno)        |
| ------------------ | ------------ | ------------------------ | ------------------------ |
| Deprecated?        | Yes          | No                       | No                       |
| Enforces security? | Yes          | Yes                      | Yes                      |
| Built-in?          | Yes (old)    | Yes                      | No                       |
| Flexible?          | âŒ           | âš ï¸ Medium                | âœ”ï¸ Very                  |
| Custom rules?      | Limited      | No                       | âœ”ï¸ Yes                   |
| Best for           | Old clusters | Simple built-in security | Enterprise-grade control |

---

## ğŸ Final Summary

- **PSP** â†’ Old, confusing, removed
- **PSS** â†’ Security specification (Privileged, Baseline, Restricted)
- **PSA** â†’ Admission controller enforcing PSS with namespace labels
- **PAC** â†’ Custom rules (Kyverno, OPA, Gatekeeper)

Together, **PSS + PSA** give Kubernetes a simple, built-in security model.
For maximum enterprise flexibility â†’ **PAC solutions**.
