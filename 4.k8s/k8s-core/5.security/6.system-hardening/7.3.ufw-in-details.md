# ğŸ”¥ **UFW (Uncomplicated Firewall)**

A simple but powerful firewall tool for Ubuntu/Debian systems.

UFW manages **iptables/nftables** rules through a clean and human-friendly interface.

This guide includes:

- âœ” Basic commands
- âœ” Allow/deny rules
- âœ” Port, protocol, app profiles
- âœ” IP, subnet, interface rules
- âœ” Logging
- âœ” Reset/disable
- âœ” Default policies
- âœ” Advanced rules (rate limit, outgoing rules, delete rules)
- âœ” Status & troubleshooting

---

## ğŸ§© **UFW Installation & Service Management**

### **Install**

```bash
sudo apt install ufw
```

### **Check status**

```bash
sudo ufw status verbose
```

### **Enable firewall**

```bash
sudo ufw enable
```

### **Disable firewall**

```bash
sudo ufw disable
```

### **Reload rules**

```bash
sudo ufw reload
```

---

## ğŸ› ï¸ **Basic Allow / Deny Rules**

### **Allow a port**

```bash
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
```

### **Allow specific protocol**

```bash
sudo ufw allow 53/udp
sudo ufw allow 25/tcp
```

### **Deny a port**

```bash
sudo ufw deny 23
sudo ufw deny 3389
```

---

## ğŸ“¦ **Application Profiles (Very Useful)**

UFW integrates with `/etc/ufw/applications.d/` where apps define their ports.

### **List available profiles**

```bash
sudo ufw app list
```

### **View profile details**

```bash
sudo ufw app info "Nginx Full"
```

### **Allow an app**

```bash
sudo ufw allow "Nginx Full"
```

---

## ğŸŒ **Rules by IP Address**

### **Allow specific IP**

```bash
sudo ufw allow from 192.168.1.10
```

### **Allow a subnet**

```bash
sudo ufw allow from 10.0.0.0/24
```

### **Allow IP to specific port**

```bash
sudo ufw allow from 203.0.113.5 to any port 22
```

### **Deny a specific IP**

```bash
sudo ufw deny from 192.168.1.55
```

---

## ğŸ” **Rules by Network Interface**

Useful when securing servers with multiple NICs.

### **Allow port on specific interface**

```bash
sudo ufw allow in on eth0 to any port 22
```

### **Block everything on eth1**

```bash
sudo ufw deny in on eth1
```

### **Allow subnet via interface**

```bash
sudo ufw allow in on ens33 from 10.1.1.0/24 to any port 443
```

---

## ğŸ§± **Default Firewall Policies**

These apply when no rule matches.

### **Default deny all incoming**

```bash
sudo ufw default deny incoming
```

### **Default allow outgoing**

```bash
sudo ufw default allow outgoing
```

### **Default deny outgoing (restrictive environments)**

```bash
sudo ufw default deny outgoing
```

### **Default reject incoming (instead of silent drop)**

```bash
sudo ufw default reject incoming
```

---

## ğŸš” **Rate Limiting (Anti-Brute-Force)**

UFWâ€™s built-in rate limit is very useful for SSH.

### **Limit SSH**

```bash
sudo ufw limit 22/tcp
```

This allows only **6 connections per 30 seconds** â†’ prevents brute-force.

### Limit any port

```bash
sudo ufw limit 443/tcp
```

---

## ğŸ” **Viewing, Deleting & Editing Rules**

### **List rules with numbers**

```bash
sudo ufw status numbered
```

### **Delete a rule by number**

```bash
sudo ufw delete 3
```

### **Delete allow/deny rule**

```bash
sudo ufw delete allow 80
sudo ufw delete deny from 192.168.1.50
```

---

## ğŸ” **Logging & Monitoring**

### **Enable logging**

```bash
sudo ufw logging on
```

### **Set logging levels**

```bash
sudo ufw logging low
sudo ufw logging medium
sudo ufw logging high
sudo ufw logging full
```

### Log file location

```ini
/var/log/ufw.log
/var/log/syslog (also contains ufw entries)
```

---

## ğŸ©º **Troubleshooting Commands**

### **Check if UFW is active in kernel**

```bash
sudo ufw status
sudo iptables -L
sudo nft list ruleset
```

### **Simulate rule match**

```bash
sudo ufw --dry-run allow 80
```

### **View raw rules**

```bash
sudo ufw show raw
```

---

## ğŸ”„ **Resetting UFW**

### **Reset everything**

```bash
sudo ufw reset
```

This:

- Deletes all rules
- Resets to defaults
- Disables UFW

Then re-enable:

```bash
sudo ufw enable
```

---

## ğŸ”’ **Advanced Outgoing Control**

### **Block a port outbound**

```bash
sudo ufw deny out 25
```

### **Allow outbound to specific IP**

```bash
sudo ufw allow out to 8.8.8.8 port 53
```

### **Block all outgoing except DNS + HTTPS (example)**

```bash
sudo ufw default deny outgoing
sudo ufw allow out 53
sudo ufw allow out 443
```

---

## ğŸ§© **UFW & Docker â€” Important Note**

Docker modifies iptables directly.

If using UFW + Docker:

```bash
/etc/docker/daemon.json:
{
  "iptables": false
}
```

Or use:

- Firewalld
- DOCKER-USER chain rules
- Calico/Cilium for container firewalling

---

## ğŸ¯ **Best Practices (Sysadmin + CKS-Relevant)**

- âœ” Always default-deny incoming
- âœ” Allow only required ports
- âœ” Use `limit` for SSH
- âœ” Restrict access by IP when possible
- âœ” Use app profiles for safer Nginx/Apache configs
- âœ” Always test rules remotely to avoid locking yourself out
- âœ” Enable logging (medium) for auditability
