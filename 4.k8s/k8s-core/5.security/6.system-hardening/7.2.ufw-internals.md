# ‚öôÔ∏è **UFW (Uncomplicated Firewall)** Internals

**UFW (Uncomplicated Firewall)** is essentially a **frontend for `iptables`** (and `nftables` on newer systems). It simplifies the process of writing complex firewall rules by abstracting them into easy commands.

---

## üîß How UFW Works Internally

### ‚úÖ 1. **Command Translation**

When you run something like:

```bash
sudo ufw allow 22
```

UFW translates that into a set of `iptables` rules like:

```bash
iptables -A ufw-user-input -p tcp --dport 22 -j ACCEPT
```

These rules are inserted into specific `iptables` chains managed by UFW.

---

### ‚úÖ 2. **Rule Management**

UFW manages its own chains:

- `ufw-before-input`
- `ufw-user-input`
- `ufw-after-input`

These are hooked into the main `INPUT`, `OUTPUT`, and `FORWARD` chains.

You can inspect them with:

```bash
sudo iptables -L
```

Or for more detail:

```bash
sudo iptables -S
```

---

### ‚úÖ 3. **Persistent Rules**

UFW stores its rules in:

```bash
/etc/ufw/user.rules
/etc/ufw/before.rules
/etc/ufw/after.rules
```

These are loaded at boot by the UFW service.

---

### ‚úÖ 4. **nftables Support (Newer Systems)**

On newer distributions (like Ubuntu 22.04+), UFW may use `nftables` as the backend instead of `iptables`. You can check with:

```bash
sudo ufw status verbose
```

If it says `Default: deny (incoming)`, it‚Äôs using `iptables`. If it mentions `nft`, then it‚Äôs using `nftables`.

---

## üß† Summary

| Layer        | Tool                     | Role                                |
| ------------ | ------------------------ | ----------------------------------- |
| User Command | `ufw allow 80`           | Easy interface for firewall rules   |
| Backend      | `iptables` or `nftables` | Actual packet filtering engine      |
| Persistence  | `/etc/ufw/*.rules`       | Stores rules for reboot persistence |
