# üß© **Ingress Controller Components**

## üìñ **What Actually Is ‚ÄúIngress‚Äù?**

Let‚Äôs clarify this once and for all:

> ‚ùó‚ÄúIngress‚Äù is not a single component ‚Äî it‚Äôs an **architecture pattern** in Kubernetes
> made of multiple resources and processes working together.

The **Ingress system** =
üß© **Ingress Resource (rules)**

- ‚öôÔ∏è **Ingress Controller (engine)**
- üö™ **Ingress Service (exposure layer)**
- üåê **Backend Services & Pods (targets)**

---

## 1Ô∏è‚É£ **Component #1** ‚Äî **`Ingress Resource`**

### üí° What It Is

A Kubernetes **API object** (Custom Resource Definition CRD) that defines:

- Hostname (e.g., `myapp.com`)
- Path rules (`/`, `/api`, `/auth`)
- Which backend Service each path should forward to
- Optional TLS secrets for HTTPS

### üßæ Example

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: myapp
spec:
  ingressClassName: nginx
  tls:
    - hosts:
        - myapp.com
      secretName: tls-secret
  rules:
    - host: myapp.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: frontend
                port:
                  number: 80
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: api
                port:
                  number: 8080
```

---

> üö® That‚Äôs just configuration; the logic is implemented by the Ingress Controller pods.

---

## 2Ô∏è‚É£ **Component #2** ‚Äî **`IngressClass`**

### üí° What It Is

A **metadata link** between the `Ingress` resources and the controller that should handle them.

If you have multiple Ingress Controllers (e.g., Nginx + Istio + AWS ALB), this defines which one processes your rules.

```yaml
apiVersion: networking.k8s.io/v1
kind: IngressClass
metadata:
  name: nginx
spec:
  controller: k8s.io/ingress-nginx
```

Then in your Ingress rule:

```yaml
spec:
  ingressClassName: nginx
```

---

> üö® It's tracked by ingress deployment and he use it fo filtering to Ensures the Nginx controller only processes its own Ingress objects.

---

## 3Ô∏è‚É£ **Component #3** ‚Äî **`Ingress Controller`**

### üí° What It Is

A **real running application** (usually Nginx, Traefik, HAProxy, or Envoy) that implements the logic for handling and routing HTTP/S traffic.

üö® **Note:**

> The **Ingress Controller** is <u title="ÿ®ÿßŸÑŸÅÿπŸÑ">indeed</u> a **custom controller**,  
> but its **logic runs as a binary inside Pods managed by a Deployment** Not in the control plane as loop back processes.  
> This makes it portable, scalable, and namespace-isolated ‚Äî unlike built-in control plane controllers.

### üöÄ Created As:

- A **Deployment** (for HA, runs multiple replicas)
- A **Service** (to expose it externally)
- Usually deployed in the **namespace:** `ingress-nginx` or `kube-system`

### üß† Responsibilities:

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Task                   | Description                                                |
| ---------------------- | ---------------------------------------------------------- |
| üëÇ Watch API Server    | Watches all `Ingress` resources in the cluster             |
| üßæ Parse Rules         | Reads host/path mappings and backend services              |
| ‚öôÔ∏è Generate Config     | Dynamically builds routing config (e.g., `nginx.conf`)     |
| üîÑ Reload On Change    | Reconfigures itself when rules change                      |
| üì° Handle HTTP Traffic | Listens on 80/443 and proxies requests to backend services |
| üîê Manage TLS          | Terminates HTTPS if TLS secrets are attached               |

</div>

---

## 4Ô∏è‚É£ **Component #4** ‚Äî **`Ingress Controller Service`**

This is the **entry point** to the cluster traffic.

### üí° What It Is

A standard **Kubernetes Service** that exposes the controller pods.

### üî¢ Service Types

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Environment            | Service Type                                 | Description                                 |
| ---------------------- | -------------------------------------------- | ------------------------------------------- |
| Local (Kind, Minikube) | `NodePort`                                   | Opens port on all nodes (e.g., 32080/32443) |
| Cloud (EKS, GKE, AKS)  | `LoadBalancer`                               | Allocates a public cloud load balancer      |
| On-Prem                | `NodePort` + External LB manually configured | You provide your own entry IP               |

</div>

### ‚öôÔ∏è Function

- Receives all HTTP/HTTPS traffic first
- Forwards packets to one of the Ingress Controller pods
- Acts like a ‚Äúgateway‚Äù service

---

## ‚öôÔ∏è **How Ingress Controller Builds Its Routing Logic**

Let‚Äôs see what happens inside one of those Nginx controller pods.

1. **Starts Up**
   ‚Üí Connects to the Kubernetes API
   ‚Üí Subscribes to watch events for:

   - Ingress resources
   - Services
   - Endpoints
   - Secrets (for TLS)

2. **Watches for Changes**
   When a new Ingress is created or updated:

   - The controller detects it immediately (via informer).

3. **Regenerates Configuration**
   It rebuilds an internal config (e.g., Nginx‚Äôs `nginx.conf`).

4. **Hot Reloads**
   The controller triggers a smooth reload of its proxy process without downtime.

5. **Handles Requests**
   For every HTTP request:

   - Parses Host and Path
   - Finds matching backend
   - Sends traffic to the correct ClusterIP Service.

---

## üñºÔ∏è **The Full Internal Chain**

Let‚Äôs follow one **live request** inside your Kind cluster:

<div align="center" style="background-color: #232b2dff; border-radius: 10px; border: 2px solid">

```mermaid
sequenceDiagram
  participant Browser as üåç Browser
  participant NodePort as üîå NodePort:32080
  participant IngressPod as ‚öôÔ∏è Ingress Controller Pod (Nginx)
  participant API as üìú Ingress Resource (Rules)
  participant BackendSvc as üö¶ ClusterIP Service (api)
  participant Pod as üåê Backend Pod

  Browser->>NodePort: HTTP GET /api
  NodePort->>IngressPod: Forwards to controller
  IngressPod->>API: Matches rule /api ‚Üí api:8080
  IngressPod->>BackendSvc: Forwards traffic
  BackendSvc->>Pod: Kube-proxy routes to endpoint
  Pod-->>Browser: JSON Response
```

</div>

---

## ‚ûï **Supporting Components**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Component              | Type                  | Role                                                    |
| ---------------------- | --------------------- | ------------------------------------------------------- |
| **ConfigMap**          | Cluster-scoped config | Nginx tuning (timeouts, body size, etc.)                |
| **Secret**             | Namespaced            | Stores TLS certificates                                 |
| **ServiceAccount**     | Namespaced            | Used by controller pods to access API Server            |
| **Role & RoleBinding** | RBAC                  | Grants permission to watch Ingresses, Services, Secrets |

</div>

---

## üèÅ **Summary Table**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Layer | Component                  | Kind                  | Namespace     | Main Role                   |
| ----- | -------------------------- | --------------------- | ------------- | --------------------------- |
| 1Ô∏è‚É£    | Ingress Resource           | API Object            | app ns        | Defines routing rules       |
| 2Ô∏è‚É£    | IngressClass               | API Object            | cluster-wide  | Binds Ingress to controller |
| 3Ô∏è‚É£    | Ingress Controller         | Deployment + Pods     | ingress-nginx | Implements the logic        |
| 4Ô∏è‚É£    | Ingress Controller Service | Service (NodePort/LB) | ingress-nginx | Exposes controller pods     |
| 5Ô∏è‚É£    | ConfigMap                  | Config                | ingress-nginx | Controller config tuning    |
| 6Ô∏è‚É£    | Secrets                    | Object                | app ns        | TLS certificates            |
| 7Ô∏è‚É£    | Backend Services           | ClusterIP             | app ns        | Target destinations         |
| 8Ô∏è‚É£    | Pods                       | Runtime               | app ns        | Actual app containers       |

</div>

---

## üß† **TL;DR**

> üí° **Ingress = Reverse Proxy as a Kubernetes Native Service.**
>
> - You define **Ingress Resources** ‚Üí Rules (Hosts, Paths).
> - **Ingress Controller** watches them ‚Üí Generates proxy config.
> - **Ingress Service** exposes it ‚Üí One entry point for all.
> - **Requests** ‚Üí Routed internally ‚Üí Correct **ClusterIP Services** ‚Üí **Pods**.
