# ğŸ§© **Ingress Controller Components**

## ğŸ“– **What Actually Is â€œIngressâ€?**

Letâ€™s clarify this once and for all:

> â—â€œIngressâ€ is not a single component â€” itâ€™s an **architecture pattern** in Kubernetes
> made of multiple resources and processes working together.

The **Ingress system** =
ğŸ§© **Ingress Resource (rules)**

- âš™ï¸ **Ingress Controller (engine)**
- ğŸšª **Ingress Service (exposure layer)**
- ğŸŒ **Backend Services & Pods (targets)**

---

<div align="center" style="background-color:#F5F0F6; border-radius: 10px; border: 2px solid">
    <img src="image/1763204699463.png" alt="Containers" style="width: 60%; border-radius: 10px" />
</div>

---

## 1ï¸âƒ£ **Component #1** â€” **`Ingress Resource`**

### ğŸ’¡ What It Is

A Kubernetes **API object** (Custom Resource Definition CRD) that defines:

- Hostname (e.g., `myapp.com`)
- Path rules (`/`, `/api`, `/auth`)
- Which backend Service each path should forward to
- Optional TLS secrets for HTTPS

### ğŸ§¾ Example

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: myapp
spec:
  ingressClassName: nginx
  tls:
    - hosts:
        - myapp.com
      secretName: tls-secret
  rules:
    - host: myapp.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: frontend
                port:
                  number: 80
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: api
                port:
                  number: 8080
```

---

> ğŸš¨ Thatâ€™s just configuration; the logic is implemented by the Ingress Controller pods.

---

## 2ï¸âƒ£ **Component #2** â€” **`IngressClass`**

### ğŸ’¡ What It Is

A **metadata link** between the `Ingress` resources and the controller that should handle them.

If you have multiple Ingress Controllers (e.g., Nginx + Istio + AWS ALB), this defines which one processes your rules.

```yaml
apiVersion: networking.k8s.io/v1
kind: IngressClass
metadata:
  name: nginx
spec:
  controller: k8s.io/ingress-nginx
```

Then in your Ingress rule:

```yaml
spec:
  ingressClassName: nginx
```

---

> ğŸš¨ It's tracked by ingress deployment and he use it fo filtering to Ensures the Nginx controller only processes its own Ingress objects.

---

## 3ï¸âƒ£ **Component #3** â€” **`Ingress Controller`**

### ğŸ’¡ What It Is

A **real running application** (usually Nginx, Traefik, HAProxy, or Envoy) that implements the logic for handling and routing HTTP/S traffic.

ğŸš¨ **Note:**

> The **Ingress Controller** is <u title="Ø¨Ø§Ù„ÙØ¹Ù„">indeed</u> a **custom controller**,  
> but its **logic runs as a binary inside Pods managed by a Deployment** Not in the control plane as loop back processes.  
> This makes it portable, scalable, and namespace-isolated â€” unlike built-in control plane controllers.

### ğŸš€ Created As:

- A **Deployment** (for HA, runs multiple replicas)
- A **Service** (to expose it externally)
- Usually deployed in the **namespace:** `ingress-nginx` or `kube-system`

### ğŸ§  Responsibilities:

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Task                   | Description                                                |
| ---------------------- | ---------------------------------------------------------- |
| ğŸ‘‚ Watch API Server    | Watches all `Ingress` resources in the cluster             |
| ğŸ§¾ Parse Rules         | Reads host/path mappings and backend services              |
| âš™ï¸ Generate Config     | Dynamically builds routing config (e.g., `nginx.conf`)     |
| ğŸ”„ Reload On Change    | Reconfigures itself when rules change                      |
| ğŸ“¡ Handle HTTP Traffic | Listens on 80/443 and proxies requests to backend services |
| ğŸ” Manage TLS          | Terminates HTTPS if TLS secrets are attached               |

</div>

---

## 4ï¸âƒ£ **Component #4** â€” **`Ingress Controller Service`**

This is the **entry point** to the cluster traffic.

### ğŸ’¡ What It Is

A standard **Kubernetes Service** that exposes the controller pods.

### ğŸ”¢ Service Types

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Environment            | Service Type                                 | Description                                 |
| ---------------------- | -------------------------------------------- | ------------------------------------------- |
| Local (Kind, Minikube) | `NodePort`                                   | Opens port on all nodes (e.g., 32080/32443) |
| Cloud (EKS, GKE, AKS)  | `LoadBalancer`                               | Allocates a public cloud load balancer      |
| On-Prem                | `NodePort` + External LB manually configured | You provide your own entry IP               |

</div>

### âš™ï¸ Function

- Receives all HTTP/HTTPS traffic first
- Forwards packets to one of the Ingress Controller pods
- Acts like a â€œgatewayâ€ service

---

## âš™ï¸ **How Ingress Controller Builds Its Routing Logic**

Letâ€™s see what happens inside one of those Nginx controller pods.

1. **Starts Up**
   â†’ Connects to the Kubernetes API
   â†’ Subscribes to watch events for:

   - Ingress resources
   - Services
   - Endpoints
   - Secrets (for TLS)

2. **Watches for Changes**
   When a new Ingress is created or updated:

   - The controller detects it immediately (via informer).

3. **Regenerates Configuration**
   It rebuilds an internal config (e.g., Nginxâ€™s `nginx.conf`).

4. **Hot Reloads**
   The controller triggers a smooth reload of its proxy process without downtime.

5. **Handles Requests**
   For every HTTP request:

   - Parses Host and Path
   - Finds matching backend
   - Sends traffic to the correct ClusterIP Service.

---

## ğŸ–¼ï¸ **The Full Internal Chain**

Letâ€™s follow one **live request** inside your Kind cluster:

<div align="center" style="background-color: #232b2dff; border-radius: 10px; border: 2px solid">

```mermaid
sequenceDiagram
  participant Browser as ğŸŒ Browser
  participant NodePort as ğŸ”Œ NodePort:32080
  participant IngressPod as âš™ï¸ Ingress Controller Pod (Nginx)
  participant API as ğŸ“œ Ingress Resource (Rules)
  participant BackendSvc as ğŸš¦ ClusterIP Service (api)
  participant Pod as ğŸŒ Backend Pod

  Browser->>NodePort: HTTP GET /api
  NodePort->>IngressPod: Forwards to controller
  IngressPod->>API: Matches rule /api â†’ api:8080
  IngressPod->>BackendSvc: Forwards traffic
  BackendSvc->>Pod: Kube-proxy routes to endpoint
  Pod-->>Browser: JSON Response
```

</div>

---

## â• **Supporting Components**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Component              | Type                  | Role                                                    |
| ---------------------- | --------------------- | ------------------------------------------------------- |
| **ConfigMap**          | Cluster-scoped config | Nginx tuning (timeouts, body size, etc.)                |
| **Secret**             | Namespaced            | Stores TLS certificates                                 |
| **ServiceAccount**     | Namespaced            | Used by controller pods to access API Server            |
| **Role & RoleBinding** | RBAC                  | Grants permission to watch Ingresses, Services, Secrets |

</div>

---

## ğŸ **Summary Table**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Layer | Component                  | Kind                  | Namespace     | Main Role                   |
| ----- | -------------------------- | --------------------- | ------------- | --------------------------- |
| 1ï¸âƒ£    | Ingress Resource           | API Object            | app ns        | Defines routing rules       |
| 2ï¸âƒ£    | IngressClass               | API Object            | cluster-wide  | Binds Ingress to controller |
| 3ï¸âƒ£    | Ingress Controller         | Deployment + Pods     | ingress-nginx | Implements the logic        |
| 4ï¸âƒ£    | Ingress Controller Service | Service (NodePort/LB) | ingress-nginx | Exposes controller pods     |
| 5ï¸âƒ£    | ConfigMap                  | Config                | ingress-nginx | Controller config tuning    |
| 6ï¸âƒ£    | Secrets                    | Object                | app ns        | TLS certificates            |
| 7ï¸âƒ£    | Backend Services           | ClusterIP             | app ns        | Target destinations         |
| 8ï¸âƒ£    | Pods                       | Runtime               | app ns        | Actual app containers       |

</div>

---

## ğŸ§  **TL;DR**

> ğŸ’¡ **Ingress = Reverse Proxy as a Kubernetes Native Service.**
>
> - You define **Ingress Resources** â†’ Rules (Hosts, Paths).
> - **Ingress Controller** watches them â†’ Generates proxy config.
> - **Ingress Service** exposes it â†’ One entry point for all.
> - **Requests** â†’ Routed internally â†’ Correct **ClusterIP Services** â†’ **Pods**.
