# ğŸª– **Helm**

## ğŸ“– **What is Helm?**

Helm is a **package manager** for Kubernetes that simplifies the deployment and management of applications.  
It enables users to define, install, and upgrade even the most complex Kubernetes applications.

> ğŸ’­ Think of Helm as the "apt" or "yum" for Kubernetes.

---

## ğŸ§© **Helm Components**

1. **ğŸ”¹ Helm CLI**: Command-line interface for managing Helm charts and releases.
2. **ğŸ”¹ Helm Chart**: A collection of files that describe a related set of Kubernetes resources.
3. **ğŸ”¹ Chart Repository**: A location where charts can be stored and shared.
4. **ğŸ”¹ Helm Release**: An instance of a chart running in a Kubernetes cluster.

---

## âœ… **Benefits of Using Helm**

1. **Simplifies Deployment and Management**:

   - Packages all Kubernetes resources into a single chart.
   - Ensures consistent deployment across different environments.

2. **Versioning and Rollbacks**:

   - Tracks changes with versioned charts.
   - Easily upgrades and reverts applications to previous versions.

3. **Reusability and Sharing**:

   - Reusable charts promote standardization.
   - Store and share charts in repositories for easy distribution and collaboration.

4. **Configuration Management**:

   - Separate configuration values from templates using values files.
   - Override values for flexible and environment-specific configurations.

5. **Powerful Templating Engine**:

   - Use variables and conditionals in resource definitions for dynamic configuration.

6. **Dependency Management**:

   - Specify and manage dependencies between charts.
   - Organize complex applications with subcharts.

7. **Community and Ecosystem**:
   - Access a large community with pre-built charts for common applications.
   - Integrate with CI/CD tools and cloud providers for enhanced capabilities.

---

## ğŸ§‘ğŸ»â€ğŸ’» **Installing Helm**

**Download and Install Helm**: Follow the installation instructions from the [official Helm website](https://helm.sh/docs/intro/install/).

```bash
curl https://baltocdn.com/helm/signing.asc | gpg --dearmor | sudo tee /usr/share/keyrings/helm.gpg > /dev/null

sudo apt-get install apt-transport-https --yes

echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main" | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list

sudo apt-get update
sudo apt-get install helm
```

---

## ğŸ“‚ **Directory Structure**

```ini
myapp # root directory
.
â”œâ”€â”€ Chart.yaml # ğŸ‘ˆ Chart metadata
â”œâ”€â”€ charts # ğŸ‘ˆ Contains dependency sub-charts (if any)
â”œâ”€â”€ templates # ğŸ‘ˆ Contains your K8s  template manifests
    â”œâ”€â”€ _helpers.tpl   # ğŸ‘ˆ our reusable template library
â”‚Â Â  â”œâ”€â”€ deployment.yaml
â”‚Â Â  â”œâ”€â”€ hpa.yaml
â”‚Â Â  â”œâ”€â”€ ingress.yaml
â”‚Â Â  â”œâ”€â”€ service.yaml
â”‚Â Â  â”œâ”€â”€ serviceaccount.yaml
â”‚Â Â  â””â”€â”€ tests # ğŸ‘ˆ Contains your k8s test manifests (if any)
â”‚Â Â      â””â”€â”€ test-connection.yaml
â””â”€â”€ values.yaml # ğŸ‘ˆ default values for your template
```

---

## ğŸ§‘ğŸ»â€ğŸ’» **Core Helm Command**

### ğŸ“Œ **Deploy a copy releases from Online Helm Chart**

```sh
# Download Helm Chart Repository
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

# Deploy a Releases
helm install myApp bitnami/nginx -f app-values.yaml
```

### ğŸ“Œ **Deploy releases From Local Helm Chart**

```sh
# App1 Release
helm install myApp1 <./chartDirPath> -f app1-values.yaml
# App2 Release
helm install myApp2 <./chartDirPath> -f app2-values.yaml
```

### ğŸ“Œ **Options Overriding Default Values**

#### ğŸ”¹ **Using `--set` Flag**:

```sh
helm install myrelease bitnami/nginx --set service.type=LoadBalancer
```

#### ğŸ”¹ **Using a Custom values.yaml File**:

1. Create a custom **dev-values.yaml** file.

2. Edit the **dev-values.yaml** file to override the default values in the **values.yaml** file.

   ```sh
   service:
     type: LoadBalancer
   ```

3. Install the release using the **dev-values.yaml** file.

   ```sh
   helm install myrelease bitnami/nginx -f dev-values.yaml
   ```

#### ğŸ”¹ **Combining `--set` and Custom dev-values.yaml**:

```sh
helm install myrelease bitnami/nginx -f dev-values.yaml --set service.port=8080
```

---

## ğŸªœ **Creating Your Own Helm Chart** - Step-by-Step

1. **Create a New Chart**:

   ```sh
   helm create myapp
   ```

2. **Directory Structure**:

   ```ini
   myapp # root directory
   .
   â”œâ”€â”€ Chart.yaml # Chart metadata
   â”œâ”€â”€ charts # Contains dependency sub-charts (if any)
   â”œâ”€â”€ templates # Contains your K8s  template manifests
   â”‚Â Â  â”œâ”€â”€ deployment.yaml
   â”‚Â Â  â”œâ”€â”€ hpa.yaml
   â”‚Â Â  â”œâ”€â”€ ingress.yaml
   â”‚Â Â  â”œâ”€â”€ service.yaml
   â”‚Â Â  â”œâ”€â”€ serviceaccount.yaml
   â”‚Â Â  â””â”€â”€ tests # Contains your k8s test manifests (if any)
   â”‚Â Â      â””â”€â”€ test-connection.yaml
   â””â”€â”€ values.yaml # default values for your template
   ```

3. **Edit Chart.yaml**: Define metadata about your chart.

   ```yaml
   apiVersion: v2
   name: myapp
   description: A Helm chart for Kubernetes
   version: 0.1.0
   ```

4. **Create Kubernetes Manifests in templates/**: Use templates to define your Kubernetes resources.

   ```yaml
   # templates/deployment.yaml
   apiVersion: apps/v1
   kind: Deployment
   metadata:
     name: {{ .Release.Name }}-deployment
   spec:
     replicas: {{ .Values.replicaCount }}
     selector:
       matchLabels:
         app: {{ .Release.Name }}
     template:
       metadata:
         labels:
           app: {{ .Release.Name }}
       spec:
         containers:
           - name: {{ .Release.Name }}
             image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
             ports:
               - containerPort: 80
   ```

5. **Define Values in values.yaml**: Store `default` configuration values.

   ```yaml
   replicaCount: 2

   image:
     repository: nginx
     tag: stable

   service:
     type: ClusterIP
     port: 80
   ```

6. **Validate the Chart**: Run the following command to validate the chart.

   ```sh
   helm lint .
   ```

7. **Show Final Manifests Without Installing**:

   ```sh
   helm template .
   ```

8. **Package the Chart**: Run the following command to package the chart.

   ```sh
   helm package .
   ```

9. **Index the Chart**: Run the following command to index the chart.

   ```sh
   helm repo index .
   ```

10. **Build the Chart**: Run the following command to build the chart.

    ```sh
    helm build .
    ```

11. **Deploy the Chart**:

    ```sh
    helm install myapp .
    ```

---

## âœ… **Best Practices**

1. **Version Control**: Store your Helm charts in a version-controlled repository.
2. **Environment-Specific Values**: Use different `values.yaml` files for different environments.
3. **Template Simplicity**: Keep your templates simple and manageable.
4. **Security**: Regularly scan Helm charts for vulnerabilities.
5. **Automation**: Use CI/CD pipelines to automate Helm operations like testing, linting, and deployment.
