# üî° **Helm Built-In Variables**

## üìñ **What Are Built-In Variables?**

When Helm renders your chart, it passes several **predefined objects** into the Go templating engine.

These objects let you:

- Access chart metadata (`.Chart`)
- Get release details (`.Release`)
- Read user values (`.Values`)
- Loop through files or subcharts
- Dynamically build names, labels, or configurations

> Think of these like ‚Äúpre-loaded global variables‚Äù available in every template.

---

## üß© **Core Built-In Objects**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Object          | Description                             | Example Usage                         |
| --------------- | --------------------------------------- | ------------------------------------- |
| `.Chart`        | Information from `Chart.yaml`           | `.Chart.Name`, `.Chart.Version`       |
| `.Values`       | Values from `values.yaml` and overrides | `.Values.image.repository`            |
| `.Release`      | Info about the Helm release             | `.Release.Name`, `.Release.Namespace` |
| `.Capabilities` | Info about the Kubernetes cluster       | `.Capabilities.KubeVersion`           |
| `.Files`        | Access non-template files               | `.Files.Get("config.json")`           |
| `.Template`     | Info about current template file        | `.Template.Name`                      |
| `.Subcharts`    | Access data from dependent charts       | `.Subcharts.redis.Values.image.tag`   |

</div>

---

## üß± 1. `.Chart` ‚Äî Chart Metadata

> Holds all information from your `Chart.yaml`.

**Example `Chart.yaml`:**

```yaml
apiVersion: v2
name: mywebapp
description: A Helm chart for deploying a web app
type: application
version: 0.2.0
appVersion: "1.5.1"
```

**Use inside template:**

```yaml
metadata:
  name: { { .Chart.Name } }
  labels:
    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
    appVersion: "{{ .Chart.AppVersion }}"
```

**Output:**

```yaml
metadata:
  name: mywebapp
  labels:
    chart: "mywebapp-0.2.0"
    appVersion: "1.5.1"
```

üß† **Common `.Chart` fields:**

| Field                | Meaning          |
| -------------------- | ---------------- |
| `.Chart.Name`        | Chart name       |
| `.Chart.Version`     | Chart version    |
| `.Chart.AppVersion`  | App version      |
| `.Chart.Description` | Description text |

---

## üí° 2. `.Values` ‚Äî User-Defined Configuration

> The most commonly used object.
> It represents values defined in:
>
> - `values.yaml`
> - `--set` CLI flag
> - Extra `-f` override files

**Example `values.yaml`:**

```yaml
image:
  repository: nginx
  tag: 1.25
replicaCount: 3
```

**Template example (`deployment.yaml`):**

```yaml
spec:
  replicas: { { .Values.replicaCount } }
  template:
    spec:
      containers:
        - name: app
          image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
```

üß† **Priority order (highest ‚Üí lowest):**

1. CLI `--set`
2. Extra values files `-f custom.yaml`
3. Default `values.yaml`

---

## üöÄ 3. `.Release` ‚Äî Information About This Release

> Describes where and how the chart was installed.

üß© **Common fields:**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Field                | Example      | Description             |
| -------------------- | ------------ | ----------------------- |
| `.Release.Name`      | `mywebapp`   | Release name            |
| `.Release.Namespace` | `production` | Namespace deployed into |
| `.Release.Service`   | `Helm`       | Always `Helm`           |
| `.Release.Revision`  | `3`          | Revision number         |
| `.Release.IsInstall` | `true/false` | Whether it's an install |
| `.Release.IsUpgrade` | `true/false` | Whether it's an upgrade |
| `.Release.Time`      | Timestamp    | Deployment time         |

</div>

üß© **Example:**

```yaml
metadata:
  name: {{ .Release.Name }}-deployment
  namespace: {{ .Release.Namespace }}
```

üß† **Pro Tip:**  
Use `.Release.Name` to ensure resource names are unique per release.

---

## ‚öôÔ∏è 4. `.Capabilities` ‚Äî Kubernetes Cluster Information

> Lets your templates adjust automatically depending on cluster version and APIs.

**Example usage:**

```yaml
{{- if .Capabilities.APIVersions.Has "apps/v1" }}
apiVersion: apps/v1
{{- else }}
apiVersion: extensions/v1beta1
{{- end }}
```

üß© **Common fields:**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Field                               | Description                    |
| ----------------------------------- | ------------------------------ |
| `.Capabilities.KubeVersion.Version` | e.g. `v1.30.1`                 |
| `.Capabilities.APIVersions`         | List of supported API versions |
| `.Capabilities.HelmVersion.Version` | Helm version used              |

</div>

> üí° **Use case:** backward compatibility for older clusters.

---

## üìÇ 5. `.Files` ‚Äî Access Raw Files

> Lets you embed or read non-template files in your chart.

**Example file:**  
`files/config.json`

```json
{ "env": "production" }
```

**Usage in template:**

```yaml
data:
  config.json: |-
    {{ .Files.Get "files/config.json" | indent 4 }}
```

üß† **Common methods:**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Method                  | Description                                            |
| ----------------------- | ------------------------------------------------------ |
| `.Files.Get "path"`     | Returns file content                                   |
| `.Files.Glob "pattern"` | Returns matching files                                 |
| `.Files.AsSecrets`      | Base64 encode file contents                            |
| `.Files.AsConfig`       | Converts multiple files into ConfigMap key-value pairs |

</div>

---

## üß≠ 6. `.Template` ‚Äî Info About Current Template File

> Use this for debugging or metadata.

```yaml
metadata:
  annotations:
    source: "{{ .Template.Name }}"
```

üßæ Example output:

```ini
source: mywebapp/templates/service.yaml
```

---

## üß© 7. `.Subcharts` ‚Äî Access Dependent Charts

When you use dependencies via `Chart.yaml`, Helm injects subcharts under `.Subcharts`.

**Example:**
If your chart depends on Redis:

```yaml
dependencies:
  - name: redis
    repository: https://charts.bitnami.com/bitnami
    version: 17.8.0
```

Then in template:

```yaml
{{ .Subcharts.redis.Chart.Version }}
{{ .Subcharts.redis.Values.image.repository }}
```

üß† **Used for**:
Reading subchart values or metadata for debugging or templating logic.

---

## üßÆ 8. `.Values.global` ‚Äî Global Shared Values

> When you have multiple subcharts, define common values under `.Values.global` so all charts can access them.

**Example (root values.yaml):**

```yaml
global:
  imagePullSecrets: my-secret
```

**Usage (in any subchart):**

```yaml
spec:
  imagePullSecrets:
    - name: { { .Values.global.imagePullSecrets } }
```

---

## ü™Ñ 9. `.Release.IsInstall` / `.Release.IsUpgrade`

> Super useful in conditional logic.

```yaml
{{- if .Release.IsInstall }}
# Do something only on fresh install
{{- end }}

{{- if .Release.IsUpgrade }}
# Do something only during upgrade
{{- end }}
```

Used for:

- Conditional jobs (e.g., run migration job only during upgrade)
- Hooks customization

---

## üß† Diagram ‚Äî Helm Template Rendering Flow

<div align="center" style="background-color: #2b3436ff; border-radius: 10px; border: 2px solid">

```mermaid
flowchart TD
  A[values.yaml] --> B[.Values]
  B --> C[Render Templates]
  D[Chart.yaml] --> E[.Chart]
  F[helm install myapp] --> G[.Release]
  H[Cluster Info] --> I[.Capabilities]
  C --> J[Final YAML Manifests]
```

</div>

---

## ‚ö° Quick Reference: Common Built-In Variables

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Variable                            | Example                   | Description              |
| ----------------------------------- | ------------------------- | ------------------------ |
| `.Chart.Name`                       | `"mywebapp"`              | Chart name               |
| `.Chart.AppVersion`                 | `"1.5.1"`                 | Application version      |
| `.Values.image.tag`                 | `"v2.1"`                  | Value from `values.yaml` |
| `.Release.Name`                     | `"mywebapp-prod"`         | Release name             |
| `.Release.Namespace`                | `"prod"`                  | Target namespace         |
| `.Capabilities.KubeVersion.Version` | `"v1.30.1"`               | Cluster version          |
| `.Files.Get "file.txt"`             | `"raw file content"`      | Reads a file             |
| `.Template.Name`                    | `"templates/deploy.yaml"` | Current template name    |
| `.Values.global.*`                  | ‚Äî                         | Shared global values     |
| `.Release.IsUpgrade`                | `true`                    | Indicates upgrade action |

</div>

---

## üí° Pro Tips for Real Projects

- ‚úÖ Always prefix variables with context to avoid collisions (e.g., `.Values.image.repository` not just `.image.repository`).
- ‚úÖ Use `_helpers.tpl` to store reusable template logic and name formatting.
- ‚úÖ Combine `.Capabilities` for version-specific manifests (multi-cluster compatibility).
- ‚úÖ Don‚Äôt hardcode namespaces ‚Äî always use `.Release.Namespace`.
- ‚úÖ Use `.Files` for embedding config files or certificates.
