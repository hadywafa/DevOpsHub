# ğŸ­ **Overlays in Kustomize**

## ğŸ”´ **Problem**

You have one app, but **different environments** â€”  
each needs small tweaks (like image tag, replicas, or namespace).

You could create separate folders (`dev/`, `prod/`) and duplicate YAMLsâ€¦  
but thatâ€™s messy, hard to maintain, and causes drift ğŸ˜©

---

## âœ… Solution â€” **Overlays**

Kustomize uses a **base + overlay** model:

- The **base** contains common configuration (shared across all envs)
- Each **overlay** adds its own small differences (via patches or transformers)

You build the environment you want with:

```bash
kubectl apply -k overlays/dev/
```

---

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761141896892.png" alt="Kustomize" style="width: 80%">
</div>

---

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761141945069.png" alt="Kustomize" style="width: 80%">
</div>

---

## ğŸ“ **Example Folder Structure**

```ini
k8s/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â””â”€â”€ kustomization.yaml
â””â”€â”€ overlays/
    â”œâ”€â”€ dev/
    â”‚   â”œâ”€â”€ kustomization.yaml
    â”‚   â””â”€â”€ patch-replicas.yaml
    â””â”€â”€ prod/
        â”œâ”€â”€ kustomization.yaml
        â””â”€â”€ patch-replicas.yaml
```

---

### ğŸ“ƒ `base/kustomization.yaml`

```yaml
resources:
  - deployment.yaml
  - service.yaml

commonLabels:
  app: myapi
```

---

### ğŸ“ƒ `overlays/dev/patch-replicas.yaml`

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapi
spec:
  replicas: 1
```

---

### ğŸ“ƒ `overlays/prod/patch-replicas.yaml`

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapi
spec:
  replicas: 3
```

---

### ğŸ“ƒ `overlays/dev/kustomization.yaml`

```yaml
resources:
  - ../../base

patchesStrategicMerge:
  - patch-replicas.yaml

namespace: dev
namePrefix: dev-
```

---

### ğŸ“ƒ `overlays/prod/kustomization.yaml`

```yaml
resources:
  - ../../base

patchesStrategicMerge:
  - patch-replicas.yaml

namespace: prod
namePrefix: prod-
```

---

## ğŸš€ **How to Deploy**

```bash
kubectl apply -k overlays/dev/   # Deploy dev
kubectl apply -k overlays/prod/  # Deploy prod
```

> âœ… Both use the same base,  
> but each has its own replicas, namespace, and name prefix.

---

## ğŸ **Feature Based**

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761141987326.png" alt="Kustomize" style="width: 80%">
</div>

---

## ğŸ’¬ **Summary**

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Concept     | Purpose                                          |
| ----------- | ------------------------------------------------ |
| **Base**    | Common resources shared across all envs          |
| **Overlay** | Environment-specific modifications               |
| **Command** | `kubectl apply -k overlays/<env>`                |
| **Benefit** | Reusable, clean, and environment-aware structure |

</div>

---

âœ… **In short:**

> ğŸ—ï¸ Base = shared blueprint  
> ğŸ­ Overlay = environment personality
