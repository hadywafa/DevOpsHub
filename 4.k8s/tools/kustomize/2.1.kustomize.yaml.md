# ğŸ“œ **Kustomization.yaml â€” The Heart of Kustomize**

## ğŸ”´ Real Problem

`kubectl apply -f .` works fine for **small apps**, because it applies all YAMLs in the folder (and subfolders).
But as your project grows, youâ€™ll face these issues:

- ğŸŒ€ You want to **reuse** the same YAMLs for multiple environments (dev/staging/prod).
- ğŸ§© You need to **add or change metadata** (like labels or namespace) globally.
- ğŸ§± You want to **combine** only selected YAMLs, not _every_ file in the directory.
- ğŸš« You may have helper files or test manifests you **donâ€™t want to apply**.

Thatâ€™s where **Kustomize** and its **`kustomization.yaml`** file come in.

---

## âœ… Solution: `kustomization.yaml`

Instead of blindly applying all files,
you tell Kustomize exactly **which YAMLs to include**, **how to modify them**, and **which ones to ignore**.

---

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761139309935.png" alt="Kustomize" style="width: 80%">
</div>

---

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761139313679.png" alt="Kustomize" style="width: 80%">
</div>

---

## ğŸ“ Example

### Folder Structure

```ini
k8s/
â”œâ”€â”€ deployment.yaml
â”œâ”€â”€ service.yaml
â”œâ”€â”€ secret-dev.yaml
â”œâ”€â”€ test-config.yaml      # should not be deployed
â”œâ”€â”€ .kustomizeignore
â””â”€â”€ kustomization.yaml
```

---

### `kustomization.yaml`

```yaml
resources:
  - deployment.yaml
  - service.yaml
  - secret-dev.yaml

namespace: dev
commonLabels:
  app: myapi

images:
  - name: myacr.azurecr.io/myapi
    newTag: v1.2.3
```

âœ… This file:

- Combines the 3 listed YAMLs
- Adds a common label (`app: myapi`)
- Sets namespace = `dev`
- Updates the image tag
- Builds a single clean manifest

---

### `.kustomizeignore`

```bash
test-config.yaml
*.backup
```

âœ… This tells Kustomize:

> â€œIgnore these files even if they exist in this folder.â€

So files like `test-config.yaml` or any `.backup` file are never processed.

---

## âš™ï¸ Apply it

```bash
kubectl apply -k k8s/
```

Kustomize:

1. Reads only the listed resources
2. Ignores files in `.kustomizeignore`
3. Applies transformations
4. Deploys the final manifest

---

## ğŸ“˜ Why Itâ€™s Better Than `kubectl apply -f .`

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Feature                  | `apply -f .` | `apply -k .` (Kustomize)    |
| ------------------------ | ------------ | --------------------------- |
| Applies all YAMLs        | âœ… Yes       | âœ… Yes (only selected)      |
| Global labels, namespace | âŒ No        | âœ… Yes                      |
| Image tag override       | âŒ No        | âœ… Yes                      |
| Ignore unwanted files    | âŒ No        | âœ… Yes (`.kustomizeignore`) |
| Reuse for multiple envs  | âŒ No        | âœ… Yes                      |
| Works with overlays      | âŒ No        | âœ… Yes                      |

</div>

---

## ğŸ’¬ Summary

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Concept                               | Description                                                             |
| ------------------------------------- | ----------------------------------------------------------------------- |
| **kustomization.yaml**                | Central file defining which manifests to include and how to modify them |
| **resources:**                        | List of YAML files or directories                                       |
| **commonLabels / namespace / images** | Add consistent metadata or overrides                                    |
| **.kustomizeignore**                  | Exclude specific files (like `.gitignore`)                              |
| **Command**                           | `kubectl apply -k <dir>` builds and applies all rules                   |
| **Main Benefit**                      | Clean, reusable, controlled deployments                                 |

</div>

---

âœ… **In short:**

> `kubectl apply -f .` = "Throw everything inside."
>
> `kubectl apply -k .` = "Apply what Iâ€™ve defined, how Iâ€™ve defined it â€” clean and consistent."
