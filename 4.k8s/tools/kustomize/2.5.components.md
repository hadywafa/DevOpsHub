# ğŸ§© **Components in Kustomize**

## ğŸ”´ **Problem**

Sometimes, you donâ€™t just have _environments_ â€”  
you have **optional features** you might enable or disable per environment.

Examples:

- Monitoring with Prometheus
- Autoscaling with HPA
- Debug sidecar container
- Logging agent

You donâ€™t want to duplicate those YAMLs everywhere â€”  
just plug them in when needed.

---

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761142259921.png" alt="Kustomize" style="width: 80%">
</div>

---

## âœ… **Solution** â€” **Components**

**Components** are _like mini reusable modules_ containing:

- resources
- patches
- transformers

They can be included inside multiple overlays easily.  
Think of them like **"feature toggles"** for your Kubernetes setup.

---

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761142270532.png" alt="Kustomize" style="width: 80%">
</div>

---

## âœğŸ» **Full Example**

### 1ï¸âƒ£ Step 1

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761142279468.png" alt="Kustomize" style="width: 80%">
</div>

### 2ï¸âƒ£ Step 2

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761142440326.png" alt="Kustomize" style="width: 80%">
</div>

### 3ï¸âƒ£ Step 3

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761142444645.png" alt="Kustomize" style="width: 80%">
</div>

### 4ï¸âƒ£ Step 4

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761142449157.png" alt="Kustomize" style="width: 80%">
</div>

### 5ï¸âƒ£ Step 5

<div align="center" style="background-color:#13191E; border-radius: 10px; border: 2px solid">
  <img src="image/1761142453373.png" alt="Kustomize" style="width: 80%">
</div>

---

## ğŸ“ **Example Folder Structure**

```ini
k8s/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â””â”€â”€ kustomization.yaml
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ hpa/
â”‚   â”‚   â”œâ”€â”€ hpa.yaml
â”‚   â”‚   â””â”€â”€ kustomization.yaml
â”‚   â””â”€â”€ monitoring/
â”‚       â”œâ”€â”€ service-monitor.yaml
â”‚       â””â”€â”€ kustomization.yaml
â””â”€â”€ overlays/
    â”œâ”€â”€ dev/
    â”‚   â””â”€â”€ kustomization.yaml
    â””â”€â”€ prod/
        â””â”€â”€ kustomization.yaml
```

---

## ğŸ“ **Example â€” Component Definition**

### `components/hpa/kustomization.yaml`

```yaml
resources:
  - hpa.yaml
```

### `components/hpa/hpa.yaml`

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: myapi-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: myapi
  minReplicas: 2
  maxReplicas: 5
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
```

---

## ğŸ“ **Example â€” Using Components in an Overlay**

### `overlays/prod/kustomization.yaml`

```yaml
resources:
  - ../../base

components:
  - ../../components/hpa
  - ../../components/monitoring

namespace: prod
namePrefix: prod-
```

âœ… This overlay will:

- Reuse the base resources
- Include HPA and monitoring components
- Apply any common labels or namespace

---

## âš™ï¸ **Apply Command**

```bash
kubectl apply -k overlays/prod/
```

Kustomize builds:

- Base manifests
- HPA and monitoring components
- Then merges all configurations together

---

## ğŸ’¬ **Summary**

| Concept        | Purpose                                                                  |
| -------------- | ------------------------------------------------------------------------ |
| **Components** | Optional reusable feature modules                                        |
| **Usage**      | Include under `components:` in `kustomization.yaml`                      |
| **Contents**   | Can include `resources`, `patches`, or `transformers`                    |
| **Benefit**    | Reuse features (like monitoring or autoscaling) across multiple overlays |

---

ğŸ§  **In short:**

> **Base** = common resources
> **Overlay** = per environment
> **Component** = reusable optional feature
