# 🔐 Privilege Escalation with `sudo`: Secure Elevation Without Root Risk

In Linux systems, **privilege escalation** means allowing a regular (non-root) user to perform tasks that normally require superuser rights. Instead of logging in as `root` — which is risky and hard to audit — you use `sudo` to delegate specific commands safely.

---

## 🧠 Why Use `sudo`?

Using `sudo` gives you:

- ✅ **Temporary elevated rights** without exposing the root password
- ✅ **Audit trails** of who ran what command
- ✅ **Fine-grained control** over which users can run which commands

> _Example_: You want a developer to restart a service, but not install packages or modify system files. `sudo` lets you define that exactly.

---

## 🧪 Attempting a Restricted Operation Without `sudo`

Let’s say a user tries to install NGINX:

```bash
$ apt install nginx
E: Could not open lock file /var/lib/dpkg/lock-frontend - open (13: Permission denied)
E: Unable to acquire the dpkg frontend lock, are you root?
```

This fails because `apt` needs root privileges.

---

## ✅ Elevate with `sudo`

Now try again with `sudo`:

```bash
$ sudo apt install nginx
[sudo] password for michael:
```

Success — the command runs with elevated rights, but only for this operation.

> _Note_: If you see `User michael is not in the sudoers file`, you need to add the user to the `sudo` group or configure `/etc/sudoers`.

---

## ⚙️ Configuring `sudo`: The `/etc/sudoers` File

All sudo rules live in:

- `/etc/sudoers` — main config file
- `/etc/sudoers.d/` — modular rule files

> ⚠️ _Always use `visudo` to edit these files_ — it checks for syntax errors and prevents lockouts.

```bash
sudo visudo
```

### 🔍 Sample Rules

```text
# Root has full access
root    ALL=(ALL:ALL) ALL

# Admin group can run anything
%admin  ALL=(ALL)       ALL

# Sudo group can run anything
%sudo   ALL=(ALL:ALL)   ALL

# Mark can run anything
mark    ALL=(ALL:ALL)   ALL

# Sarah can reboot the system only
sarah   localhost=/usr/bin/shutdown -r now
```

---

## 🧩 Field Breakdown

| Field                | Description                         | Example                          |
| -------------------- | ----------------------------------- | -------------------------------- |
| User or Group        | Username or group name              | `mark`, `%sudo`                  |
| Host(s)              | Host where rule applies             | `ALL`, `localhost`               |
| Run-As Specification | Who the command runs as             | `(ALL:ALL)`                      |
| Commands             | Allowed commands or `ALL`           | `/usr/bin/shutdown -r now`       |
| Comments             | Lines starting with `#` are ignored | `# User privilege specification` |

---

## 🛡️ Best Practices for `sudo` Configuration

- ✅ Grant **only the commands needed** for a task
- ✅ Use **group-based rules** for easier management
- ✅ Avoid `NOPASSWD` unless automation requires it
- ✅ Keep custom rules in `/etc/sudoers.d/` for modularity

> _Tip_: Modular files like `/etc/sudoers.d/devops` make it easy to manage access per team or role.

---

## 🧪 Hands-On Exercise

### 1. Create a test user

```bash
sudo useradd -m bob
sudo passwd bob
```

### 2. Add user to `sudo` group

```bash
sudo usermod -aG sudo bob
```

### 3. Switch to bob and install a package

```bash
su - bob
sudo apt update && sudo apt install htop
```

### 4. Create a custom rule for bob

```bash
sudo visudo -f /etc/sudoers.d/custom_rules
```

Add:

```text
bob ALL=(ALL) NOPASSWD: /bin/systemctl restart nginx
```

> This lets bob restart NGINX without entering a password — useful for automation or service management.
