# ğŸ•µğŸ» **Trivy**

## ğŸ“– **What Is Trivy?**

> **Trivy** (by Aqua Security) is a **vulnerability scanner** for:
>
> - Docker **images**
> - **Containers** running on your host
> - Local **filesystems**
> - **Git repositories** (IaC scanning)
> - **Kubernetes clusters**

Its job:  
ğŸ‘‰ Find **known security vulnerabilities (CVEs)** in packages and libraries  
ğŸ‘‰ Detect **misconfigurations** (like privileged containers, weak permissions)

---

<div align="center" style="background-color:#F4F4F4; border-radius: 10px; border: 2px solid">
  <img src="image/trivy.gif" alt="Docker Image" style="width: 60%">
</div>

---

## ğŸ§  **Why We Need It**

Docker Content Trust (DCT) only ensures â€œthe image is from the right person.â€
But we also need to know:  
 â€œIs the image **safe** to run?â€

Example:

- Image is signed âœ… (authentic)
- But includes **OpenSSL with CVE-2024-XXXX** âŒ

Thatâ€™s what **Trivy** detects.

---

## âš™ï¸ **How Trivy Works Internally**

<div align="center" style="background-color:#071D28; border-radius: 10px; border: 2px solid">

```mermaid
flowchart TD
    A[ğŸ§± Docker Image] -->|analyze| B[ğŸ” Trivy Scanner]
    B -->|extracts| C[Image Layers]
    C -->|identify| D[OS packages & libraries]
    D -->|compare| E[CVE Database]
    E -->|generate| F[ğŸ“œ Report: Vulnerabilities + Misconfigurations]
```

</div>

### ğŸ§  **Internals:**

1. **Extracts image layers**

   - Reads `/var/lib/docker/overlay2/...` or pulls metadata directly from registry.
   - Looks for OS packages (apk, dpkg, rpm) and language dependencies (npm, pip, etc.).

2. **Matches each package version**

   - Compares against its **CVE database** (updated from NVD, vendor advisories, etc.).

3. **Outputs report**

   - Lists vulnerabilities with severity, fixed version, and package details.

---

## âš™ï¸ **Installing Trivy**

You can install it on any machine with Docker:

### ğŸ§ On Linux / macOS:

```bash
brew install aquasecurity/trivy/trivy
# or
sudo apt install trivy
```

### ğŸªŸ On Windows (PowerShell):

```powershell
choco install trivy
```

---

## âœğŸ» **Basic Image Scan Example**

```bash
trivy image nginx:latest
```

Output:

```ini
nginx:latest (debian 12.1)

Total: 5 (UNKNOWN: 0, LOW: 1, MEDIUM: 2, HIGH: 2, CRITICAL: 0)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Severity  â”‚     Vulnerability   â”‚ Package  â”‚ Installed Ver â”‚ Fixed Verâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HIGH      â”‚ CVE-2024-12345      â”‚ openssl  â”‚ 3.0.2-1       â”‚ 3.0.8    â”‚
â”‚  MEDIUM    â”‚ CVE-2023-6789       â”‚ libc6    â”‚ 2.36          â”‚ 2.37     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

âœ… **Interpreting results:**

- Each row = one vulnerability.
- â€œFixed versionâ€ shows what you should update to.
- â€œSeverityâ€ helps prioritize fixes.

---

## âœğŸ» **Advanced Example â€” CI/CD Report**

Generate JSON or table reports for automation:

```bash
# Scan and output JSON
trivy image --format json --output report.json myapp:1.0

# Scan for only high or critical
trivy image --severity HIGH,CRITICAL myapp:1.0
```

---

## ğŸ” **Scan Without Pulling Image (Remote Registry)**

You can scan images directly from Docker Hub or ECR:

```bash
trivy image docker.io/library/alpine:latest
trivy image 123456789012.dkr.ecr.us-east-1.amazonaws.com/myapp:v1
```

If the registry requires auth, Trivy uses your local Docker credentials.

---

## ğŸ **Scanning Files and Repos (Bonus)**

Trivy can also scan **code repos** for secrets or IaC issues:

```bash
# Scan source code for secrets/misconfigurations
trivy fs .
# Scan Terraform or Kubernetes manifests
trivy config .
```

---

## ğŸ«™ **How the CVE Database Works**

- Trivy maintains a **local cache** of vulnerability data.
- You can update it anytime:

  ```bash
  trivy --download-db-only
  ```

- It merges multiple feeds:

  - NVD (National Vulnerability Database)
  - GitHub Security Advisories
  - OS vendor advisories (Debian, Alpine, etc.)

---

## âš ï¸ **Trivy Severities**

<div align="center" style="background-color:#071D28; border-radius: 10px; border: 2px solid">

| Severity     | Meaning                                      | Action               |
| ------------ | -------------------------------------------- | -------------------- |
| **CRITICAL** | Remote code execution / privilege escalation | Patch immediately    |
| **HIGH**     | Denial-of-service / serious flaw             | Fix quickly          |
| **MEDIUM**   | Information disclosure                       | Plan update          |
| **LOW**      | Cosmetic or minor issue                      | Optional fix         |
| **UNKNOWN**  | No rating yet                                | Investigate manually |

</div>

---

## â™¾ï¸ **Integrating Trivy in CI/CD**

Example (GitHub Actions):

```yaml
name: Image Scan
on: [push]
jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build Docker image
        run: docker build -t myapp:${{ github.sha }} .
      - name: Scan image with Trivy
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: myapp:${{ github.sha }}
          format: table
          exit-code: 1
          ignore-unfixed: true
```

ğŸ§  This fails the pipeline if any **HIGH/CRITICAL** vulnerability is found.

---

## ğŸ–¼ï¸ **Visual Flow:** Trivy in DevOps Pipeline

```mermaid
flowchart LR
    A[ğŸ§‘â€ğŸ’» Developer commits code] --> B[âš™ï¸ CI builds Docker image]
    B --> C[ğŸ” DCT signs image]
    C --> D[ğŸ” Trivy scans image]
    D -->|Clean| E[âœ… Push to Registry]
    D -->|Vulnerable| F[âŒ Block build / alert]
```

---

## âœ”ï¸ **Key Takeaways**

| Concept           | Explanation                                     |
| ----------------- | ----------------------------------------------- |
| **Purpose**       | Finds CVEs, misconfigurations, and secrets      |
| **When**          | After build or before deploy                    |
| **Data Source**   | CVE databases (NVD, vendor feeds)               |
| **Output**        | Table, JSON, SARIF for CI integration           |
| **Usage**         | `trivy image`, `trivy fs`, `trivy config`       |
| **Best Practice** | Automate in CI/CD; block severe vulnerabilities |

## ğŸ”— **Learn More**

- [Trivy Security Blog](https://devopscube.com/scan-docker-images-using-trivy/)
- [Trivy GitHub](https://github.com/aquasecurity/trivy)
- [Trivy Docker Hub](https://hub.docker.com/r/aquasecurity/trivy)
- [Trivy Blog](https://aquasecurity.github.io/trivy/)
