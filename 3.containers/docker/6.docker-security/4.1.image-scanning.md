# üîç **Image Scanning**

## üìñ **What Is Image Scanning?**

> **Image Scanning** is the process of analyzing a **container image** to find **security vulnerabilities**, **malware**, or **misconfigurations** before it‚Äôs deployed.

When you build a Docker image ‚Äî it contains:

- an **OS base** (e.g., Ubuntu, Alpine, Debian)
- **system libraries**
- **language dependencies** (npm, pip, gem, etc.)
- your **application code**

Each of these layers may contain **known vulnerabilities (CVEs)**.

Example:

You built your app using `ubuntu:20.04`, but that image contains:

- OpenSSL 1.1.1k (CVE-2023-0464)
- curl 7.68.0 (CVE-2022-27774)

So even though your app runs fine, it‚Äôs silently insecure.

---

## üß† **Why It‚Äôs Critical for DevOps/SRE**

| Without Scanning                              | With Scanning                                |
| --------------------------------------------- | -------------------------------------------- |
| You deploy images ‚Äúas is.‚Äù                    | You detect risky packages early.             |
| Vulnerabilities show up **after** compromise. | You fix vulnerabilities **before** shipping. |
| No visibility into base image health.         | Centralized reports on image risk.           |
| Difficult to enforce compliance.              | Meets SOC2, ISO, and CIS benchmarks.         |

### üìå Real-world rule:

> ‚Äú**Never deploy an image that hasn‚Äôt been scanned**.‚Äù
> Most enterprises enforce this in CI/CD (especially for prod environments).

---

## ‚öôÔ∏è **How Image Scanning Works Internally**

<div align="center" style="background-color:#071D28; border-radius: 10px; border: 2px solid">

```mermaid
flowchart TD
    A[üì¶ Container Image] -->|1. Extract Layers| B[üóÇ File System Snapshot]
    B -->|2. Identify OS + Packages| C[üìö Package Inventory]
    C -->|3. Compare with CVE DB| D[üîç Vulnerability Matching Engine]
    D -->|4. Report Results| E[üìú Vulnerability Report]
```

</div>

### Step-by-step:

#### 1Ô∏è‚É£ Extract Layers

- Each image is a stack of **read-only layers**.
- The scanner unpacks these layers and inspects filesystem metadata.

#### 2Ô∏è‚É£ Identify OS + Packages

- It checks `/etc/os-release` to detect OS type (Ubuntu, Alpine, etc.)
- Then reads installed packages from:

  - `dpkg -l` (Debian/Ubuntu)
  - `rpm -qa` (RHEL/CentOS)
  - `apk info` (Alpine)

- Also scans dependency manifests like:

  - `package-lock.json` (Node.js)
  - `requirements.txt` (Python)
  - `pom.xml` (Java)

#### 3Ô∏è‚É£ Match Against CVE Databases

- Each package version is compared to known **Common Vulnerabilities and Exposures (CVE)** records from:

  - NVD (National Vulnerability Database)
  - Vendor advisories (RedHat, Debian)
  - GitHub Security Advisories

#### 4Ô∏è‚É£ Generate Report

- Each finding includes:

  - **CVE ID**
  - **Severity**
  - **Package name**
  - **Installed version**
  - **Fixed version (if available)**

---

## üßæ **Example Vulnerability Entry**

| Field                 | Example                                       |
| --------------------- | --------------------------------------------- |
| **CVE ID**            | CVE-2024-12345                                |
| **Package**           | openssl                                       |
| **Installed Version** | 1.1.1k                                        |
| **Fixed In**          | 1.1.1w                                        |
| **Severity**          | HIGH                                          |
| **Description**       | Heap buffer overflow in SSL_do_handshake()... |

This data helps DevOps teams patch the image or rebuild with newer base layers.

---

## ‚öôÔ∏è **Types of Image Scanning**

<div align="center" style="background-color:#071D28; border-radius: 10px; border: 2px solid">

| Type                             | What It Checks                            | Examples                        |
| -------------------------------- | ----------------------------------------- | ------------------------------- |
| **OS Package Scanning**          | Vulnerabilities in system libs            | CVEs in glibc, openssl, bash    |
| **Language Dependency Scanning** | Vulnerabilities in app-level dependencies | npm, pip, gem, maven            |
| **Configuration Scanning**       | Insecure Dockerfile / permissions         | Running as root, no healthcheck |
| **Secrets Scanning**             | Exposed API keys, tokens                  | AWS keys, SSH private keys      |
| **Malware Scanning**             | Known bad binaries                        | Signature-based detection       |

</div>

---

## üîñ **Common Image Scanning Tools**

<div align="center" style="background-color:#071D28; border-radius: 10px; border: 2px solid">

| Tool                              | Type                  | Notes                                    |
| --------------------------------- | --------------------- | ---------------------------------------- |
| **Trivy**                         | Open-source           | Fast, supports CVE, config, IaC, secrets |
| **Grype**                         | Open-source (Anchore) | Works offline, SBOM-based                |
| **Clair**                         | CNCF project          | Used by Harbor registry                  |
| **Docker Scout**                  | Docker official       | Integrated with Docker Hub               |
| **AWS ECR Scan**                  | Managed               | Automatically scans pushed images        |
| **Azure Defender for Containers** | Managed               | Scans ACR and AKS                        |
| **GCP Artifact Registry Scan**    | Managed               | Built into Google Cloud registry         |

</div>

---

## üéØ **Where Image Scanning Fits**

Image scanning usually happens in **three stages** of the container lifecycle:

<div align="center" style="background-color:#071D28; border-radius: 10px; border: 2px solid">

| Stage             | Description                            | Example                    |
| ----------------- | -------------------------------------- | -------------------------- |
| **Build Time**    | Scan images before pushing to registry | Trivy, Grype               |
| **Registry Time** | Registry auto-scans after push         | AWS ECR, ACR               |
| **Runtime**       | Scan running containers or nodes       | Falco, Aqua, Sysdig Secure |

</div>

---

## üìù **Example**: Build + Scan Pipeline

```mermaid
flowchart LR
    A[Developer commits code] --> B[Build Docker image]
    B --> C[Scan image for vulnerabilities]
    C -->|Pass| D[Push to registry]
    C -->|Fail| E[Block deploy & alert team]
    D --> F[Deploy to production]
```

Example CI/CD snippet:

```yaml
# Pseudo YAML pipeline
steps:
  - name: Build image
    run: docker build -t myapp:v1 .
  - name: Scan image
    run: trivy image --exit-code 1 --severity HIGH,CRITICAL myapp:v1
  - name: Push to registry
    run: docker push myapp:v1
```

If Trivy finds any **HIGH or CRITICAL** issues, it stops the pipeline üö´

---

## üß† Key Benefits

- ‚úÖ Early vulnerability detection
- ‚úÖ Automated compliance (CIS, PCI-DSS, SOC2)
- ‚úÖ Prevents deployment of insecure containers
- ‚úÖ Integrates easily with CI/CD tools (GitHub, Jenkins, GitLab)
- ‚úÖ Supports **SBOM (Software Bill of Materials)** generation

---

## üèÅ In Short

| Aspect            | Description                                      |
| ----------------- | ------------------------------------------------ |
| **Purpose**       | Find vulnerabilities, misconfigurations, secrets |
| **Focus**         | Image content (packages, libs, configs)          |
| **Output**        | List of CVEs and risks                           |
| **Frequency**     | On every build or registry push                  |
| **Tool Examples** | Trivy, Grype, Clair, ECR Scan, Docker Scout      |

---

## üí≠ Quick Analogy

Think of **image scanning** like a **security X-ray** for your container:

- It doesn‚Äôt change or block your image itself.
- It just reports what‚Äôs _inside_ ‚Äî good or bad.
- You decide whether it‚Äôs ‚Äúsafe to deploy.‚Äù
