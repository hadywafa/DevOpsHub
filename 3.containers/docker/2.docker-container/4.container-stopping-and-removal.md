# ğŸ§© Mastering Docker Container Stopping & Removal

_ğŸ¯ out goal to -> Understanding Linux Signals, Pause/Stop/Kill, RM, Prune, and `--rm` flag_

---

## ğŸ§  1. The Foundation â€” Linux Signals Explained

Before understanding Dockerâ€™s lifecycle control, you must know what **Linux signals** are.

When you run any process in Linux, it has a **PID** (Process ID).
Linux allows the kernel and other processes to send **signals** to control that process.

Each signal has a number and purpose â€” like messages that say:
â€œPauseâ€, â€œContinueâ€, â€œStop gracefullyâ€, or â€œDie right nowâ€.

---

### ğŸª„ Common Linux Signals Used by Docker

<div align="center" style="background-color: #071D28; border-radius: 20px;">

| Signal           | Name      | Meaning                                 | Can be Ignored? | Example               |
| ---------------- | --------- | --------------------------------------- | --------------- | --------------------- |
| **SIGSTOP (19)** | Stop      | Freezes (pauses) the process            | âŒ No           | `kill -SIGSTOP <pid>` |
| **SIGCONT (18)** | Continue  | Resumes paused process                  | âœ… Yes          | `kill -SIGCONT <pid>` |
| **SIGTERM (15)** | Terminate | Graceful shutdown request               | âœ… Yes          | `kill -SIGTERM <pid>` |
| **SIGKILL (9)**  | Kill      | Immediate termination (canâ€™t be caught) | âŒ No           | `kill -SIGKILL <pid>` |

</div>

---

> To know the process id of service you can call
>
> ```bash
> pgrep <service_name>
> ```
>
> and then use `kill -SIGSTOP <pid>`
> or `kill -SIGKILL $(pgrep <service_name>)`

---

### ğŸ§© Why It Matters for Docker

Each Docker container is **just a Linux process tree**, isolated using:

- **Namespaces** â†’ isolate filesystem, network, PID space, etc.
- **cgroups (control groups)** â†’ manage CPU, memory, and I/O limits.

So when Docker needs to pause, stop, or kill a container, it simply sends these **Linux signals** to the containerâ€™s **main process (PID 1 inside container)**.

---

## âš™ï¸ 2. Docker Lifecycle Commands and Their Signals

Letâ€™s now map these signals to Docker commands â€” this is the â€œtranslation layerâ€ ğŸ‘‡

---

### ğŸŸ¡ `docker container pause`

- **Purpose:** Freeze all processes inside a container (no CPU usage).
- **Signal Sent:** `SIGSTOP` (like pressing â€œPauseâ€ on a video).
- **Mechanism:** Uses Linuxâ€™s **freezer cgroup** subsystem.

```bash
docker container pause web
```

ğŸ§Š Everything inside the container is **frozen** â€” memory stays allocated,
but CPU scheduling is halted.

To resume:

```bash
docker container unpause web
```

â†’ Sends `SIGCONT` to resume all processes.

âœ… **Use Case:** Temporarily freeze heavy processes without stopping the container.

---

### ğŸŸ¢ `docker container stop`

- **Purpose:** Gracefully stop the container.
- **Signals Sent:**

  1. `SIGTERM` â†’ ask process to exit politely.
  2. Wait 10 seconds (default).
  3. If still running â†’ `SIGKILL`.

```bash
docker container stop web
```

You can control the waiting period:

```bash
docker container stop -t 5 web
```

This gives the process time to **cleanup**, close files, or write logs before shutdown.

âœ… **Use Case:** Normal controlled shutdown (default behavior when you use `docker-compose down`).

---

### ğŸ”´ `docker container kill`

- **Purpose:** Force stop a container immediately (no cleanup).
- **Signal Sent:** `SIGKILL` by default, but you can choose.

```bash
docker container kill web
# or send a custom signal
docker container kill --signal=SIGTERM web
```

ğŸ’¥ This is **instant** â€” the process dies without executing shutdown handlers.

âš ï¸ **Use Case:** When `docker stop` doesnâ€™t work or container is frozen.

---

## ğŸ§¹ 3. Removing Containers

Once a container is **stopped**, its data still exists:

- Metadata (ID, name, config)
- Logs
- Mount information
  All stored under `/var/lib/docker/containers/<container_id>/`.

You can **remove** it manually or automatically.

---

### âšª `docker container rm`

- **Purpose:** Delete a containerâ€™s metadata and file references.
- Works **only** on stopped containers.

```bash
docker container rm web
```

If the container is still running, use `-f` (force):

```bash
docker container rm -f web
```

This performs an internal **stop â†’ remove** sequence.

After removal:

- `/var/lib/docker/containers/<id>/` directory is deleted.
- Logs (`container.log`) and config (`config.v2.json`) are removed.

âœ… **Use Case:** Clean up containers after youâ€™re done using them.

---

### âš™ï¸ `--rm` Flag (Auto-Remove After Exit)

When you run a container with `--rm`, Docker automatically removes it
as soon as it stops.

```bash
docker run --rm ubuntu echo "Hello"
```

Sequence:

1. Container starts.
2. Runs command and exits.
3. Docker automatically deletes it.

âœ… **Use Case:** Short-lived test containers (builds, scripts, CLI tasks).

---

### ğŸ§¾ `docker container prune`

Deletes **all stopped containers** in one go.

```bash
docker container prune
```

Youâ€™ll get a warning:

```ini
WARNING! This will remove all stopped containers.
Are you sure you want to continue? [y/N]
```

To skip confirmation:

```bash
docker container prune -f
```

âœ… **Use Case:** Cleanup environment to free disk space.

---

## ğŸ§© 4. Internal Mechanics â€” What Happens Under `/var/lib/docker/containers`

Whenever you run or stop containers, Docker maintains records under:

```ini
/var/lib/docker/containers/<container_id>/
```

Inside youâ€™ll find:

```ini
config.v2.json        # Container metadata (env vars, mounts, ports)
hostconfig.json       # Host-level config (volumes, network mode, etc.)
log.json              # Container stdout/stderr logs
checkpoint/           # Used for paused or checkpointed containers
mounts/               # Info about mounted volumes
```

### When you stop a container:

- Docker sends `SIGTERM` â†’ waits â†’ maybe `SIGKILL`.
- Updates container state in `config.v2.json` to `"Stopped"`.
- Logs written to `log.json`.

### When you remove a container:

- Deletes the container directory entirely.
- Removes log and config files.
- Clears references from Dockerâ€™s internal metadata store.

### When you use `--rm`:

- This cleanup happens automatically after container exit.

---

## ğŸ§­ 5. Visual Summary

<div align="center" style="background-color: #071D28; border-radius: 20px;">
  <img src="image/1760300132459.png" alt="Linux Signals" style="width: 80%;">
</div>

---

## ğŸ’¡ 6. Quick Reference Summary

| Command   | Linux Signal(s)   | Behavior                      | Common Option  | Notes                      |
| --------- | ----------------- | ----------------------------- | -------------- | -------------------------- |
| `pause`   | SIGSTOP           | Freeze processes              |                | Uses freezer cgroup        |
| `unpause` | SIGCONT           | Resume frozen processes       |                |                            |
| `stop`    | SIGTERM â†’ SIGKILL | Graceful shutdown             | `-t <seconds>` | Waits before force killing |
| `kill`    | SIGKILL or custom | Force stop                    | `--signal=9`   | Immediate                  |
| `rm`      | â€”                 | Remove stopped container      | `-f`           | Deletes container dir      |
| `prune`   | â€”                 | Remove all stopped containers | `-f`           | Cleanup utility            |
| `--rm`    | Auto remove       | Cleanup after exit            | â€”              | Temporary container        |

---

## ğŸ§  7. Easy-to-Memorize Analogy

| Action      | Think Of It As                              |
| ----------- | ------------------------------------------- |
| **pause**   | â€œFreeze frame ğŸ§Šâ€ â€” CPU stops, memory stays |
| **unpause** | â€œContinue playback â–¶ï¸â€                      |
| **stop**    | â€œGracefully power down ğŸ’¬â€                  |
| **kill**    | â€œUnplug the server âš¡â€                      |
| **rm**      | â€œDelete it from history ğŸ§¹â€                 |
| **prune**   | â€œMass cleanup ğŸª¦â€                            |
| **--rm**    | â€œSelf-destruct after use ğŸª„â€                 |

---

## âœ… 8. Pro Tips

- Always prefer `stop` before `kill` (graceful shutdown).
- Use `--rm` for short tasks to avoid clutter.
- Use `prune` regularly in dev environments.
- To see paused containers: `docker ps -a --filter status=paused`
- For debugging container termination: `docker inspect <id> | grep -A5 State`
