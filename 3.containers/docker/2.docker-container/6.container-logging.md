# ğŸ§  Mastering Docker Logging Drivers

_(How Docker Captures, Stores, and Routes Container Logs)!_

---

## ğŸ” 1. What Are Container Logs?

Every process running inside a container (like Nginx, Node.js, or Python) writes messages to **stdout** (standard output) and **stderr** (standard error).

ğŸ’¡ Example:

```bash
print("Hello world")   # â†’ stdout
raise Exception("Oops!")  # â†’ stderr
```

In Linux, both these â€œstreamsâ€ normally appear on your terminal.
Docker **captures these two streams** for each container and sends them to a **logging driver**.

---

## âš™ï¸ 2. What Is a Logging Driver?

A **logging driver** decides **where and how** Docker stores or forwards the container logs.

Each container can have:

- Its own logging driver
- Custom configuration options for that driver

By default, Docker uses the **`json-file`** driver.

---

### ğŸ§© The Flow

```mermaid
---
config:
  look: handDrawn
  theme: dark
---
flowchart LR
    A["Container Process (stdout/stderr)"] --> B["Docker Engine Logging System"]
    B --> C["Logging Driver"]
    C -->|json-file| D["/var/lib/docker/containers/container-id/container-id-json.log"]
    C -->|local| W["/var/lib/docker/containers/container-id/*.log"]
    C -->|journald| X["/var/log/journal"]
    C -->|syslog| E["/var/log/syslog"]
    C -->|fluentd| F["Fluentd Collector"]
    C -->|awslogs| G["AWS CloudWatch Logs"]
```

---

## ğŸ“¦ 3. Default Behavior â€” `json-file` Driver

When you run a container without specifying any logging driver, Docker uses:

```json
"log-driver": "json-file"
```

It saves logs as structured JSON objects at:

```ini
/var/lib/docker/containers/<container_id>/<container_id>-json.log
```

---

### ğŸ§¾ Example Log Entry:

```json
{
  "log": "GET /index.html 200 OK\n",
  "stream": "stdout",
  "time": "2025-10-13T10:30:05.241Z"
}
```

You can view these logs using:

```bash
docker logs <container_id>
```

ğŸ’¡ Behind the scenes, this command just reads the JSON file and formats it nicely.

---

## ğŸ§° 4. List of Docker Logging Drivers

| Logging Driver | Description                                  | Where Logs Go                                   |
| -------------- | -------------------------------------------- | ----------------------------------------------- |
| **json-file**  | Default; saves logs as JSON locally          | `/var/lib/docker/containers/<id>/<id>-json.log` |
| **local**      | Optimized local format; faster & smaller     | `/var/lib/docker/containers/`                   |
| **syslog**     | Sends logs to systemâ€™s syslog daemon         | `/var/log/syslog`                               |
| **journald**   | Integrates with systemd journal              | `journalctl -u docker`                          |
| **fluentd**    | Sends logs to Fluentd service                | Fluentd endpoint                                |
| **gelf**       | Sends logs using Graylog Extended Log Format | Graylog/Logstash                                |
| **awslogs**    | Sends logs to AWS CloudWatch Logs            | CloudWatch console                              |
| **splunk**     | Sends logs to Splunk HTTP Event Collector    | Splunk server                                   |
| **etwlogs**    | Windows Event Tracing (Windows only)         | Event Viewer                                    |
| **gcplogs**    | Sends logs to Google Cloud Logging           | Google Cloud console                            |
| **none**       | Disables logging                             | No logs                                         |

---

## ğŸ§® 5. Setting Logging Driver

You can set the logging driver at:

### âœ… (A) **Container level**

Use the `--log-driver` flag when running a container:

```bash
docker run -d --log-driver=syslog nginx
```

To add custom driver options:

```bash
docker run -d \
  --log-driver=json-file \
  --log-opt max-size=10m \
  --log-opt max-file=3 \
  nginx
```

---

### âœ… (B) **Daemon level (default for all containers)**

Edit Dockerâ€™s service configuration file (usually at `/etc/docker/daemon.json`):

```json
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "5"
  }
}
```

Then restart Docker:

```bash
sudo systemctl restart docker
```

Now all new containers will use this logging config by default.

---

## ğŸ“š 6. `json-file` vs `local` Driver

These two are often confused â€” letâ€™s compare them:

| Feature                   | json-file         | local                |
| ------------------------- | ----------------- | -------------------- |
| Format                    | JSON objects      | Compact binary       |
| Readable by `docker logs` | âœ… Yes            | âœ… Yes               |
| Disk space usage          | High              | Lower                |
| Speed                     | Slower            | Faster               |
| Rotation support          | Yes (via log-opt) | Yes                  |
| Default                   | âœ… Default        | Optional alternative |

ğŸ’¡ **Best practice:** Use `local` driver for better performance if logs are not needed outside the host.

---

## ğŸªµ 7. Log Rotation and Size Limits

Without rotation, `json-file` logs can grow endlessly.
You can control this using **log options** (`--log-opt`):

| Option     | Description                     | Example                   |
| ---------- | ------------------------------- | ------------------------- |
| `max-size` | Max size of a single log file   | `--log-opt max-size=10m`  |
| `max-file` | Number of rotated files to keep | `--log-opt max-file=3`    |
| `compress` | Compress rotated files          | `--log-opt compress=true` |

Example:

```bash
docker run -d \
  --log-opt max-size=10m \
  --log-opt max-file=3 \
  nginx
```

Docker will:

- Rotate the log when it exceeds 10 MB
- Keep only 3 old files
- Delete older ones automatically

---

## ğŸ”— 8. External Logging Drivers (Integrations)

These are used when you want centralized log collection for multiple containers or hosts.

---

### ğŸ§± **Syslog**

Send logs to Linux system log service.

```bash
docker run -d \
  --log-driver=syslog \
  --log-opt syslog-address=udp://192.168.1.10:514 \
  nginx
```

âœ… Useful for sending logs to:

- `/var/log/syslog`
- Remote syslog servers

---

### ğŸ’¬ **Fluentd**

```bash
docker run -d \
  --log-driver=fluentd \
  --log-opt fluentd-address=127.0.0.1:24224 \
  nginx
```

âœ… Great for Elastic Stack (ELK) or centralized pipelines.

---

### â˜ï¸ **AWS CloudWatch Logs**

```bash
docker run -d \
  --log-driver=awslogs \
  --log-opt awslogs-region=us-east-1 \
  --log-opt awslogs-group=my-app \
  nginx
```

âœ… Sends logs directly to CloudWatch, visible in AWS Console.

---

### ğŸª¶ **Splunk**

```bash
docker run -d \
  --log-driver=splunk \
  --log-opt splunk-token=YOUR_TOKEN \
  --log-opt splunk-url=https://splunk-server:8088 \
  nginx
```

---

### ğŸ§© **GELF (Graylog / Logstash)**

```bash
docker run -d \
  --log-driver=gelf \
  --log-opt gelf-address=udp://192.168.1.50:12201 \
  nginx
```

---

## ğŸš« 9. Disabling Logging

You can disable logging completely for lightweight or ephemeral containers:

```bash
docker run -d --log-driver=none nginx
```

âš ï¸ Means:

- `docker logs` wonâ€™t show anything
- No local files under `/var/lib/docker/containers`

âœ… Use this for high-frequency, temporary jobs that produce huge logs you donâ€™t need.

---

## ğŸ§­ 10. Viewing and Managing Logs

| Command                                                           | Description                         |
| ----------------------------------------------------------------- | ----------------------------------- |
| `docker logs <container>`                                         | Show container logs (stdout/stderr) |
| `docker logs -f <container>`                                      | Follow live logs                    |
| `docker inspect --format '{{.HostConfig.LogConfig}}' <container>` | See containerâ€™s logging driver      |
| `docker system df --format '{{.LogSpaceUsed}}'`                   | Check log disk usage                |
| `sudo ls /var/lib/docker/containers/<id>/`                        | Inspect raw log files               |

---

## ğŸ§© 11. Example: Combining All Concepts

```bash
docker run -d \
  --name web \
  --log-driver=json-file \
  --log-opt max-size=20m \
  --log-opt max-file=5 \
  -p 8080:80 \
  nginx
```

â¡ï¸ Hereâ€™s what happens:

1. Container writes logs to stdout/stderr.
2. Docker captures them via `json-file` driver.
3. Files saved under `/var/lib/docker/containers/<id>`.
4. Log rotation kicks in when >20MB.
5. You can read them with `docker logs web`.

---

## ğŸ” 12. Internal Structure in `/var/lib/docker/containers/<id>`

When using `json-file` or `local` driver, youâ€™ll find:

```ini
/var/lib/docker/containers/<id>/
â”œâ”€â”€ config.v2.json
â”œâ”€â”€ hostconfig.json
â”œâ”€â”€ <id>-json.log        â† container log file
â”œâ”€â”€ checkpoints/
â”œâ”€â”€ mounts/
â””â”€â”€ resolv.conf
```

Docker keeps a single file `<id>-json.log` where it continuously appends JSON entries.

If you rotate logs, youâ€™ll also see:

```ini
<id>-json.log.1
<id>-json.log.2
```

---

## ğŸ§  13. Best Practices Summary

âœ… Use `json-file` or `local` for single-host setups.
âœ… Always configure log rotation (max-size, max-file).
âœ… For production â†’ forward logs to centralized system (Fluentd, CloudWatch, etc).
âœ… Disable logs (`--log-driver=none`) for heavy short-lived jobs.
âœ… Use `docker logs` for short-term debugging, not long-term monitoring.

---

## ğŸ§­ 14. Visual Recap

```mermaid
---
config:
  look: handDrawn
  theme: dark
title: "Docker Logging Driver Flow"
---
flowchart TD
    A["App (stdout/stderr)"] --> B["Docker Daemon"]
    B -->|Driver=json-file| C["/var/lib/docker/containers/<id>/*.log"]
    B -->|Driver=syslog| D["/var/log/syslog"]
    B -->|Driver=fluentd| E["Fluentd â†’ ELK"]
    B -->|Driver=awslogs| F["AWS CloudWatch"]
    B -->|Driver=none| G["No logs stored"]
```

---

## ğŸ§© 15. Quick Reference Table

| Driver        | Location / Destination      | Rotation Support | Works with `docker logs` | Notes                         |
| ------------- | --------------------------- | ---------------- | ------------------------ | ----------------------------- |
| **json-file** | Local JSON file             | âœ…               | âœ…                       | Default                       |
| **local**     | Compact local file          | âœ…               | âœ…                       | Faster alternative            |
| **syslog**    | System log daemon           | âŒ               | âŒ                       | Good for host log aggregation |
| **journald**  | systemd journal             | âŒ               | âŒ                       | For systemd environments      |
| **fluentd**   | Fluentd endpoint            | âŒ               | âŒ                       | For ELK / log pipeline        |
| **awslogs**   | CloudWatch Logs             | âŒ               | âŒ                       | Cloud logging                 |
| **splunk**    | Splunk HTTP Event Collector | âŒ               | âŒ                       | Enterprise                    |
| **gcplogs**   | Google Cloud Logging        | âŒ               | âŒ                       | GCP                           |
| **none**      | No logging                  | â€”                | âŒ                       | Disable logs                  |

---

## ğŸ§  TL;DR: Mental Model

| Action                | Think Of It As                            |
| --------------------- | ----------------------------------------- |
| Container writes logs | â€œApp speaks out loud ğŸ™ï¸â€                  |
| Docker logging driver | â€œMicrophone ğŸ§ choosing where to send itâ€ |
| json-file             | â€œSave logs as local diary ğŸ“˜â€             |
| fluentd/awslogs       | â€œStream logs to a data center ğŸŒâ€         |
| none                  | â€œMute the container ğŸ”‡â€                   |
