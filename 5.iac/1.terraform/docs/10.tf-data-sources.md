# ğŸ“š Terraform Data Sources â€“ Full Explanation with Examples

## ğŸ§  What Are Data Sources in Terraform?

In Terraform, a **data source** allows you to **fetch and use information from existing infrastructure** or external services **without creating new resources**.

> ğŸ” Think of it as â€œread-onlyâ€ access to cloud infrastructure.

You use data sources to **reference** existing infrastructure â€” like a VPC, AMI, subnet, or user â€” that may not be created in your current Terraform configuration.

---

## ğŸ¯ Why Use Data Sources?

| Use Case                               | Benefit                                |
| -------------------------------------- | -------------------------------------- |
| Reference existing resources           | Donâ€™t recreate â€” just reuse            |
| Share infrastructure across modules    | Keep modules clean and reusable        |
| Lookup dynamic values                  | No hardcoding â€” fetch by filter or tag |
| Work with externally created resources | Interop with manual or legacy infra    |

---

## ğŸ”§ Basic Syntax

```hcl
data "<provider>_<resource>" "<name>" {
  [config...]
}
```

- `data` â€“ Indicates a **data source**
- `<provider>_<resource>` â€“ e.g., `aws_ami`, `azurerm_resource_group`
- `<name>` â€“ A local name you assign

---

## ğŸ§ª Real Example â€“ Get Latest Amazon Linux 2 AMI

```hcl
data "aws_ami" "amazon_linux" {
  most_recent = true
  owners      = ["amazon"]

  filter {
    name   = "name"
    values = ["amzn2-ami-hvm-*-x86_64-gp2"]
  }
}
```

### âœ… Use it in a resource:

```hcl
resource "aws_instance" "web" {
  ami           = data.aws_ami.amazon_linux.id
  instance_type = "t2.micro"
}
```

> This lets Terraform **dynamically fetch** the latest AMI each time instead of hardcoding a static AMI ID.

---

## ğŸ“¦ Common AWS Data Source Examples

| Data Source                 | Purpose                                   |
| --------------------------- | ----------------------------------------- |
| `aws_ami`                   | Lookup latest AMI by filter               |
| `aws_vpc`                   | Reference an existing VPC by name or CIDR |
| `aws_subnet`                | Use an existing subnet for EC2 instance   |
| `aws_secretsmanager_secret` | Read secrets from Secrets Manager         |
| `aws_s3_bucket`             | Access properties of an existing bucket   |

---

## ğŸ§± Example â€“ Reference Existing VPC and Subnet

```hcl
data "aws_vpc" "main" {
  filter {
    name   = "tag:Name"
    values = ["my-production-vpc"]
  }
}

data "aws_subnet_ids" "private" {
  vpc_id = data.aws_vpc.main.id
}
```

### âœ… Usage:

```hcl
resource "aws_instance" "app" {
  subnet_id = data.aws_subnet_ids.private.ids[0]
}
```

Youâ€™re using the **VPC and subnet that already exist**, no duplication!

---

## ğŸ”„ Difference Between Resource and Data

| Resource (`resource`)  | Data Source (`data`) |
| ---------------------- | -------------------- |
| Creates a new resource | Reads existing one   |
| Changes infra          | Never changes infra  |
| Tracked in state       | Read-only access     |
| Used in `apply`        | Used in `plan`       |

---

## âš ï¸ When _Not_ to Use Data Sources

- ğŸš« Don't use data sources to **simulate dependencies** between modules (use outputs + inputs instead)
- ğŸš« Donâ€™t try to mutate data source results â€” theyâ€™re **read-only**
- ğŸš« Avoid depending on mutable external resources (e.g., if someone renames a tag, your config could break)

---

## ğŸ” Using Data with Sensitive Info

```hcl
data "aws_secretsmanager_secret_version" "db_password" {
  secret_id = "my-db-secret"
}

output "db_pass" {
  value     = data.aws_secretsmanager_secret_version.db_password.secret_string
  sensitive = true
}
```

Always mark outputs as `sensitive = true` when referencing secrets!

---

## ğŸ§  Summary

| Concept           | Explanation                                                         |
| ----------------- | ------------------------------------------------------------------- |
| `data` block      | Fetches existing resource info                                      |
| Read-only         | Cannot create, update, or delete                                    |
| Usage             | Reference in `resource` blocks to reuse existing infrastructure     |
| Provider-specific | `aws_ami`, `azurerm_resource_group`, `google_compute_network`, etc. |

---

## âœ… Best Practices

- âœ”ï¸ Use `data` sources to **integrate** with existing infrastructure
- âœ”ï¸ Combine with `locals` and `output` for flexibility and reuse
- âœ”ï¸ Filter by tags or names â€” not hardcoded IDs
- âœ”ï¸ Always test with `terraform plan` to verify lookups
