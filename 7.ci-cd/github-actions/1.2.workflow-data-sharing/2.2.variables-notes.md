# âš™ï¸ `$` vs `${{ }}` in GitHub Actions

_â€” The secret difference between shell expansion and YAML expression evaluation._

---

## ğŸ§  The Two â€œWorldsâ€ Inside a Workflow

When you write a GitHub Actions workflow, there are **two interpreters** at play:

<div align="center" style="background:#343739ff; border-radius:20px">

| World                         | Evaluator              | Example             | Runs Where              |
| ----------------------------- | ---------------------- | ------------------- | ----------------------- |
| ğŸŒ **YAML Expression Engine** | GitHub Actions engine  | `${{ github.ref }}` | Before the job starts   |
| ğŸ’» **Shell Environment**      | Bash, PowerShell, etc. | `$GITHUB_REF`       | Inside a `run:` command |

</div>

---

ğŸ‘‰ The key difference:

- **`${{ ... }}`** = evaluated by GitHub Actions **before** the job runs (YAML-level)
- **`$VAR`** = evaluated by the **shell inside the runner** during execution

Letâ€™s visualize this.

---

<div align="center" style="background:#343739ff; border-radius:20px">

```mermaid
graph LR
    A["ğŸ§© Workflow YAML"] --> B["ğŸ§® GitHub Actions Expression Parser"]
    B --> C["âš™ï¸ Evaluates ${{ github.ref }}"]
    C --> D["ğŸ§± Job Runner (Bash/PowerShell)"]
    D --> E["ğŸ’» Executes $GITHUB_REF"]
```

</div>

---

## ğŸ“Œ Part 1 â€” `${{ }}` (Expression Syntax)

### ğŸ“– Official Definition

> The `${{ }}` syntax tells GitHub Actions to evaluate the expression **before** the runner starts.

It works **in YAML fields** such as:

- `name:`
- `if:`
- `env:`
- `with:`
- `jobs.<job_id>.outputs`
- and others.

---

### ğŸ“ Example â€” Using `${{ }}` in `if` and `env`

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    env:
      BUILD_MODE: ${{ github.ref == 'refs/heads/main' && 'release' || 'dev' }}
    steps:
      - name: Show mode
        run: echo "Mode is $BUILD_MODE"
```

**Explanation:**

- `${{ github.ref }}` is evaluated _before runtime_ by GitHub Actions.
- It sets `BUILD_MODE` to `"release"` if main branch, else `"dev"`.
- `$BUILD_MODE` (with a `$`) is used **inside the shell** to print it.

---

### ğŸ“ Example â€” `${{ vars.MY_VAR }}` for Repo Variables

```yaml
env:
  REGION: ${{ vars.AZURE_REGION }}
```

â¡ï¸ The `${{ }}` part runs before execution and inserts the value from the GitHub variable store.
Once job starts â†’ `$REGION` becomes available for shell commands.

---

## ğŸ“Œ Part 2 â€” `$VAR` (Shell Variable)

This is a **runtime environment variable** â€”
it exists inside the OS shell (like Bash or PowerShell).

You use `$VAR` **inside `run:` blocks**, because thatâ€™s when the shell runs.

---

### ğŸ“ Example â€” Using `$VAR` Inside `run`

```yaml
steps:
  - name: Print branch info
    run: echo "Branch: $GITHUB_REF"
```

Here:

- `$GITHUB_REF` is a **Bash environment variable** automatically set by GitHub Actions.
- Itâ€™s **not YAML interpolation**, itâ€™s the **Linux shell** printing a value.

---

## âš–ï¸ Side-by-Side Comparison

<div align="center" style="background:#343739ff; border-radius:20px">

| Purpose                  | Expression Engine (`${{ }}`)                   | Shell Expansion (`$VAR`) |
| ------------------------ | ---------------------------------------------- | ------------------------ |
| Evaluated by             | GitHub Actions                                 | Bash / PowerShell        |
| When it runs             | Before workflow executes                       | During job execution     |
| Used in                  | `env`, `if`, `with`, `name`, `outputs`         | `run:`                   |
| Access to contexts       | âœ… Yes (`github`, `vars`, `secrets`, `matrix`) | âŒ No                    |
| Example                  | `env: MODE: ${{ github.ref_name }}`            | `run: echo $MODE`        |
| Can be used in step name | âœ… Yes                                         | âŒ No                    |

</div>

---

## ğŸ§® Real Example: Mixing Both

Letâ€™s see both working together in one practical workflow ğŸ‘‡

```yaml
name: Example Mix

on: [push]

jobs:
  demo:
    runs-on: ubuntu-latest
    env:
      AUTHOR: ${{ github.actor }}
      BUILD_ID: ${{ github.run_id }}
    steps:
      - name: Show YAML-level vars
        run: |
          echo "Author (from YAML): $AUTHOR"
          echo "Build ID (from YAML): $BUILD_ID"
          echo "Repo name (from GitHub Context): ${{ github.repository }}"
```

â‰ï¸ What happens:

1. GitHub evaluates `${{ github.actor }}` and `${{ github.run_id }}` â†’ injects them into environment.
2. Shell then expands `$AUTHOR` and `$BUILD_ID`.
3. `${{ github.repository }}` still works inside `run:` because GitHub expands it before sending the command to shell.

---

## âš™ï¸ Special Case â€” Secrets

Secrets can be used in **either** form depending on context.

- âœ… Inside `env:` or `with:` â†’ `${{ secrets.MY_SECRET }}`
- âœ… Inside `run:` â†’ `$MY_SECRET` (after being exposed via env)

Example:

```yaml
steps:
  - name: Login
    env:
      PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
    run: docker login -u user -p "$PASSWORD"
```

Here `${{ }}` injects the secret _securely_ into environment,
and `$PASSWORD` expands in shell.

---

## ğŸ§© Conditional Expressions Only Use `${{ }}`

When writing conditions, _always_ use `${{ }}` because the shell doesnâ€™t run yet.

âœ… Works:

```yaml
if: ${{ github.ref == 'refs/heads/main' }}
```

âŒ Wonâ€™t work:

```yaml
if: $GITHUB_REF == 'refs/heads/main' # âŒ Invalid
```

---

## ğŸ§  Advanced Tip â€” Debugging Which One Works

If youâ€™re unsure which variable is available where:

```yaml
- name: Show all env vars
  run: printenv | sort
```

And youâ€™ll see things like:

```ini
GITHUB_REF=refs/heads/main
GITHUB_REPOSITORY=yourname/repo
BUILD_MODE=release
```

But variables that use `${{ }}` only at YAML level (like conditional expressions) wonâ€™t appear here.

---

## ğŸ¯ Quick Reference Summary

<div align="center" style="background:#343739ff; border-radius:20px">

| Context                        | Syntax                     | When to Use                          | Example                                      |
| ------------------------------ | -------------------------- | ------------------------------------ | -------------------------------------------- |
| **Workflow Logic**             | `${{ github.ref }}`        | Conditions, env setup, dynamic names | `if: ${{ github.ref == 'refs/heads/main' }}` |
| **Environment Var Inside run** | `$VAR`                     | Shell commands                       | `run: echo $VAR`                             |
| **Secrets / Vars (YAML)**      | `${{ secrets.MY_SECRET }}` | In `env:` or `with:`                 | `env: TOKEN: ${{ secrets.GH_TOKEN }}`        |
| **Runtime Var**                | `$GITHUB_ENV`              | To define at runtime                 | `echo "VAR=value" >> $GITHUB_ENV`            |
| **Matrix Var**                 | `${{ matrix.os }}`         | Job strategy and naming              | `runs-on: ${{ matrix.os }}`                  |

</div>

---

<div align="center" style="background:#343739ff; border-radius:20px">

```mermaid
graph TD
  A["${{ }}" Evaluated by GitHub Engine"] --> B["ğŸ§± Used in workflow logic"]
  C["$VAR Evaluated by Shell"] --> D["ğŸ’» Used inside run steps"]
  A -.->|before execution| D
  C -.->|during execution| B
```

</div>

---

## ğŸ’¬ Simple Analogy

Think of `${{ }}` as **the architect** ğŸ§  designing your workflow blueprint before construction,
and `$VAR` as **the builder** ğŸ§± executing inside the site.

They live in different worlds â€” one plans, the other builds.

---

## ğŸ§  **TL;DR**

<div align="center" style="background:#343739ff; border-radius:20px">

| Use Case                | Correct Syntax                               |
| ----------------------- | -------------------------------------------- |
| Reference repo info     | `${{ github.repository }}`                   |
| Reference secret        | `${{ secrets.MY_SECRET }}`                   |
| Use variable in shell   | `$MY_VAR`                                    |
| Set env var dynamically | `echo "VAR=value" >> $GITHUB_ENV`            |
| Conditional logic       | `if: ${{ github.ref == 'refs/heads/main' }}` |
| Matrix value            | `${{ matrix.node }}`                         |

</div>

---

âœ… **In one line:**

> Use `${{ }}` when you want GitHub to compute the value.
> Use `$VAR` when you want the **runnerâ€™s shell** to print or use it.
