# ğŸ³ `docker/build-push-action` â€” The Powerhouse of Docker CI/CD

> **Official Definition:**  
> The [`docker/build-push-action`](https://github.com/docker/build-push-action) builds and optionally pushes Docker images using [BuildKit](https://docs.docker.com/build/buildkit/) (the modern high-performance builder engine by Docker).

---

## âš™ï¸ **Why We Need It**

Normally, in your local machine, youâ€™d run:

```bash
docker build -t myapp:latest .
docker push myapp:latest
```

In GitHub Actions, you can automate this with a single YAML step â€” **more efficient**, **cache-friendly**, and **secure**.

Without it:

- Youâ€™d need multiple `run:` steps with `docker build` + `docker push` commands.
- Youâ€™d lose **caching**, **multi-platform**, and **BuildKit** optimizations.
- Your workflow would be **slow** and **repetitive**.

So, instead, we use this action ğŸ‘‡

---

## ğŸ§© **Basic Example â€” Build + Push**

```yaml
- name: Build and Push Docker Image
  uses: docker/build-push-action@v6
  with:
    context: .
    file: ./Dockerfile
    push: true
    tags: ghcr.io/${{ github.repository }}:latest
```

ğŸ’¡ **How it works:**

1. It uses the source code from the repo.
2. Builds a Docker image.
3. Tags it (in this case, `:latest`).
4. Pushes it to the registry youâ€™re logged into (thanks to `docker/login-action`).

---

<div align="center" style="background:#343739ff; border-radius:20px">

```mermaid
sequenceDiagram
    participant G as ğŸ§‘â€ğŸ’» GitHub Runner
    participant L as ğŸ” docker/login-action
    participant B as âš™ï¸ docker/build-push-action
    participant R as ğŸ³ Registry (e.g., GHCR / DockerHub)

    G->>L: Login with registry credentials
    L-->>G: Session authenticated
    G->>B: Build image using BuildKit
    B->>R: Push image tag(s)
    R-->>B: 200 OK âœ…
    B-->>G: Build + Push complete
```

</div>

---

## ğŸ§  **Parameters Breakdown (Simplified)**

<div align="center" style="background:#343739ff; border-radius:20px">

| Parameter        | Description                                                                    |
| ---------------- | ------------------------------------------------------------------------------ |
| **`context`**    | Build context directory (default: `.`)                                         |
| **`file`**       | Path to the Dockerfile                                                         |
| **`push`**       | `true` = push image to registry                                                |
| **`load`**       | `true` = load image into local Docker daemon (useful for testing, not pushing) |
| **`tags`**       | One or more tags separated by commas                                           |
| **`build-args`** | Build arguments passed to Dockerfile                                           |
| **`target`**     | Target stage (for multi-stage builds)                                          |
| **`cache-from`** | Use existing images or layers for cache                                        |
| **`cache-to`**   | Export built cache for future builds                                           |
| **`platforms`**  | Multi-platform support (e.g., `linux/amd64,linux/arm64`)                       |
| **`labels`**     | Add metadata to image                                                          |
| **`secrets`**    | Pass secrets to the build securely                                             |
| **`pull`**       | Always pull latest base image before build                                     |

</div>

---

## âœğŸ» **Example â€” Multi-Tag Build**

Tagging multiple versions in one go (best practice for CI):

```yaml
- name: Build and Push with Multiple Tags
  uses: docker/build-push-action@v6
  with:
    context: .
    push: true
    tags: |
      ghcr.io/${{ github.repository }}:latest
      ghcr.io/${{ github.repository }}:${{ github.sha }}
```

ğŸ’¡ This gives you:

- `:latest` â†’ for deployments
- `:<commit-sha>` â†’ for traceability (audit/debugging)

---

## âœğŸ» **Example â€” Use Cache for Faster Builds**

```yaml
- uses: docker/build-push-action@v6
  with:
    context: .
    push: true
    tags: ghcr.io/${{ github.repository }}:latest
    cache-from: type=registry,ref=ghcr.io/${{ github.repository }}:cache
    cache-to: type=registry,ref=ghcr.io/${{ github.repository }}:cache,mode=max
```

ğŸ§  What happens:

- Before building, it pulls cached layers from the registry.
- After building, it uploads updated layers.
- Next build = âš¡ instant speed.

---

## âœğŸ» **Example â€” Build Only (No Push)**

```yaml
- name: Build without pushing
  uses: docker/build-push-action@v6
  with:
    context: .
    push: false
    load: true
    tags: myapp:test
```

Use this pattern in CI pipelines for tests before deployment.

---

## âœğŸ» **Example â€” Build Args**

You can dynamically pass build-time variables:

```yaml
- uses: docker/build-push-action@v6
  with:
    context: .
    push: true
    build-args: |
      NODE_ENV=production
      VERSION=${{ github.run_number }}
```

Equivalent to:

```bash
docker build --build-arg NODE_ENV=production --build-arg VERSION=123 .
```

---

## âœğŸ» **Example â€” Multi-Stage Build Target**

If your Dockerfile has multiple stages:

```Dockerfile
FROM node:18 AS build
RUN npm ci && npm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
```

You can build only the first stage (useful for testing):

```yaml
- uses: docker/build-push-action@v6
  with:
    target: build
    load: true
```

---

## âœğŸ» **Example â€” Multi-Platform Build ğŸ¦¾**

Build once â†’ run anywhere (ARM, AMD64, etc.):

```yaml
- name: Build multi-platform image
  uses: docker/setup-buildx-action@v3

- uses: docker/build-push-action@v6
  with:
    push: true
    platforms: linux/amd64,linux/arm64
    tags: ghcr.io/${{ github.repository }}:latest
```

This uses **Buildx** â€” a high-performance builder that can cross-compile for different architectures.

---

## âœğŸ» **Example â€” Add Labels (Metadata)**

```yaml
- uses: docker/build-push-action@v6
  with:
    push: true
    tags: ghcr.io/${{ github.repository }}:latest
    labels: |
      org.opencontainers.image.source=${{ github.repositoryUrl }}
      org.opencontainers.image.created=${{ github.run_id }}
```

These labels appear when someone inspects the image (`docker inspect`), providing helpful metadata for traceability.

---

## âœğŸ» **Example â€” Secrets in Build (Securely)**

Never use `build-args` for secrets â€” use `secrets` instead:

```yaml
- uses: docker/build-push-action@v6
  with:
    push: true
    tags: ghcr.io/${{ github.repository }}:latest
    secrets: |
      GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}
      NPM_TOKEN=${{ secrets.NPM_TOKEN }}
```

Inside your Dockerfile:

```Dockerfile
# syntax=docker/dockerfile:1.4
RUN --mount=type=secret,id=NPM_TOKEN \
    npm config set //registry.npmjs.org/:_authToken=$(cat /run/secrets/NPM_TOKEN)
```

ğŸ§  The secret never gets stored in the image â€” only used during build.

---

## ğŸ§  **How Caching + Buildx + Login Work Together**

<div align="center" style="background:#343739ff; border-radius:20px">

```mermaid
graph TD
    A["ğŸ§‘â€ğŸ’» Developer Pushes Code"] --> B["âš™ï¸ GitHub Actions Workflow"]
    B --> C["ğŸ” docker/login-action"]
    C --> D["ğŸ³ docker/build-push-action"]
    D --> E["ğŸ§± BuildKit builds layers"]
    E --> F["ğŸ§° Cache-to / Cache-from registry"]
    F --> G["â˜ï¸ Push final image to GHCR / DockerHub"]
```

</div>

---

## ğŸ§© **Advanced Tagging Strategy (for real CI/CD)**

```yaml
- name: Build & Push CI Tags
  uses: docker/build-push-action@v6
  with:
    push: true
    tags: |
      ghcr.io/${{ github.repository }}:${{ github.ref_name }}
      ghcr.io/${{ github.repository }}:${{ github.sha }}
      ghcr.io/${{ github.repository }}:latest
```

This gives:

- `:main` â†’ for branch
- `:commit-sha` â†’ for traceability
- `:latest` â†’ for production or default pulls

---

## ğŸ§  **Best Practices**

<div align="center" style="background:#343739ff; border-radius:20px">

| Practice                                          | Why it matters                         |
| ------------------------------------------------- | -------------------------------------- |
| Use `@v6`                                         | Latest, most secure version            |
| Always cache                                      | Saves huge build time                  |
| Separate `login` & `build` steps                  | Cleaner workflows                      |
| Tag with `commit-sha` or version                  | Reproducibility                        |
| Add labels                                        | For traceability in container metadata |
| Use `secrets` not `build-args` for sensitive data | Security best practice                 |
| Use Buildx for multi-arch                         | Faster + portable builds               |

</div>

---

## ğŸ“˜ **Summary Table**

<div align="center" style="background:#343739ff; border-radius:20px">

| Feature        | Supported | Example                              |
| -------------- | --------- | ------------------------------------ |
| Multi-Stage    | âœ…        | `target: build`                      |
| Multi-Arch     | âœ…        | `platforms: linux/amd64,linux/arm64` |
| Caching        | âœ…        | `cache-from` / `cache-to`            |
| Secrets        | âœ…        | `secrets:` block                     |
| Labels         | âœ…        | `labels:` block                      |
| Push           | âœ…        | `push: true`                         |
| Local Load     | âœ…        | `load: true`                         |
| OCI Compliance | âœ…        | Labels & metadata                    |

</div>

---

## ğŸ§© **TL;DR Summary**

> ğŸš€ `docker/build-push-action` is your all-in-one CI/CD tool for building, caching, tagging, and pushing Docker images â€” powered by BuildKit and integrated seamlessly with GitHub Actions.

Itâ€™s the **â€œheartâ€** of modern container pipelines â€” lightweight, fast, and secure.
