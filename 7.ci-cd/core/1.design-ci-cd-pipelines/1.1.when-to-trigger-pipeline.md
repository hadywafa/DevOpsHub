# ğŸ”¥ **DevOps Best Practices â€” PR Trigger vs Push-to-Main Trigger (Q&A Style)**

## â“ **1. Whatâ€™s the difference between triggering a pipeline _on pull request (type = closed)_ vs _on push to main_?**

### âœ… **On `pull_request` (type = `closed`):**

- This runs **after** a PR is closed.
- A PR can be:

  - **Merged** â†’ in that case `closed` = merged
  - **Closed without merging** â†’ also triggers the pipeline

- Meaning:
  ğŸ‘‰ You cannot use this event to validate code **before merging**
  ğŸ‘‰ If code breaks, itâ€™s **already merged** into `main` â†’ too late

### âœ… **On `push` to `main`:**

- Runs every time a commit lands **in main**.
- This is where companies typically:

  - Build the final merged artifact
  - Push Docker images
  - Run infrastructure CI
  - Deploy to staging/prod
  - Run smoke tests after deployment

---

## â“ **2. What do most companies do in real-world DevOps pipelines?**

### ğŸ¢ **Standard best-practice setup:**

| Event type                                     | Purpose                                      | When it runs                      | Why companies use it                      |
| ---------------------------------------------- | -------------------------------------------- | --------------------------------- | ----------------------------------------- |
| **PR trigger (opened, synchronize, reopened)** | Validate code before merge                   | Every change inside PR            | Prevent broken code from entering `main`  |
| **Push to main**                               | Build â†’ Publish â†’ Deploy â†’ Post-deploy tests | After merge to main               | Ensures only validated code gets released |
| **PR closed** (optional)                       | Cleanup preview envs, close tickets          | When PR is closed (merged or not) | Not used for CI, only for cleanup         |

### ğŸ¯ Summary of what companies do:

- **They do NOT run the main CI on `pull_request.closed`.**
- **They ALWAYS run validation on PR (before merge).**
- **They ALWAYS run build + deployment on push to `main`.**
- **Optional PR-closed pipeline only for environment cleanup** (e.g., delete preview namespace in Kubernetes).

---

## â“ **3. Why is `pull_request` (type = closed) a bad trigger for CI validation?**

Because it runs **after the merge**.

If tests fail at this stage:

âŒ Main branch is already broken
âŒ Other developers get blocked
âŒ Rollback or revert is required
âŒ Violates GitFlow & trunk-based development best practices

This is a classic anti-pattern.
No mature DevOps team does this for validation.

---

## â“ **4. What is the correct trigger for validating code before merging?**

Use PR events that fire **while the PR is still open**:

```yaml
on:
  pull_request:
    branches: [main]
    types: [opened, synchronize, reopened]
```

This gives you:

- Unit tests
- Linting
- Build validation
- SAST / SCA scans
- Optional integration tests

And then you enforce it using **branch protection**:

âœ” PR must pass pipeline
âœ” PR must have reviewer approvals
âœ” No direct commits to `main`

---

## â“ **5. What is the correct trigger for building and deploying to production?**

**Push to `main`**

```yaml
on:
  push:
    branches: [main]
```

This is where companies do:

- Build final merged artifact
- Create a version tag
- Push container image â†’ ACR/ECR/DockerHub
- Deploy to staging/prod (via GitOps, ArgoCD, Flux, or ADO release)
- Run smoke tests + health checks

This ensures:

âœ” Production always deploys **validated** code
âœ” No manual deployments from laptops
âœ” No surprises after merge

---

## â“ **6. When should I use `pull_request` type = `closed`?**

Only for **cleanup tasks**, not CI.

Examples:

- Delete preview environment in Kubernetes
- Remove temporary resources created for the PR
- Close linked tickets
- Notify Slack/Jira about merged/closed PR

Never for build/test/deploy.

---

## â“ **7. What should I say in an interview when asked this question?**

Hereâ€™s a clean, senior-level answer:

> \*\*â€œPull-request pipelines should run on `opened`, `synchronize`, and `reopened` events because they validate the code before it reaches main.
>
> Triggering CI on `pull_request.closed` is a bad practice because it fires after merge â€” if something fails, main is already broken.
>
> The correct pattern is PR validation before merge + push-to-main pipeline for final build, artifact creation, and deployment.
>
> `pull_request.closed` is only used for cleanup tasks like deleting preview environments.
>
> This is the approach used by most enterprises including IBM, Microsoft, and AWS.â€\*\*

Boom ğŸ’¥ â€” senior-level, concise, and accurate.

---

## â“ **8. Final recommendation: What should _you_ use?**

### Use **both** â€” but for different purposes:

ğŸŸ¦ **PR Pipeline (on PR to main):**

- Validate code
- Block merge if failing
- Fast, deterministic

ğŸŸ© **Main Pipeline (on push main):**

- Build
- Publish
- Deploy
- Smoke test

ğŸŸ§ **PR closed (optional):**

- Cleanup only
