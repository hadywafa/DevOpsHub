# ðŸ›¡ï¸ Istio Authorization (RBAC)

(Also known as **AuthorizationPolicy**)

Istio Authorization controls **who is allowed to access what**, using **L7-aware Zero Trust rules**.

Think of it as:

> **â€œFirewall + RBAC + API-level access control for your microservices, with awareness of identity, HTTP paths, headers, ports, and mTLS identity.â€**

Kubernetes NetworkPolicy only protects **IP/ports** at L3/L4, but Istio AuthorizationPolicy protects **services and APIs** at L7 with **service identity**.

Letâ€™s go step-by-step.

---

## ðŸ§  What Istio Authorization Actually Does

AuthorizationPolicy controls:

- âœ”ï¸ Which workloads can talk to which workloads
- âœ”ï¸ Which users (JWT tokens) can call which services
- âœ”ï¸ Which HTTP paths, methods, headers are allowed
- âœ”ï¸ Which ports are accessible
- âœ”ï¸ Which namespaces are allowed
- âœ”ï¸ Which service accounts are allowed
- âœ”ï¸ Which operations (GET, POSTâ€¦)
- âœ”ï¸ And more

This is REAL Zero Trust.

---

## ðŸ§© Core Concepts of Istio Authorization

There are **3 major pieces**:

---

### 1ï¸âƒ£ **Subjects (who is making the request)**

This includes:

- Service accounts (derives from mTLS)
- JWT identities
- Namespaces
- Principals (SPIFFE IDs)
- IP blocks (rarely used)
- Remote clients (ingress)

Example subject:

```yaml
from:
  - source:
      principals: ["cluster.local/ns/team-a/sa/b-client"]
```

---

### 2ï¸âƒ£ **Actions**

What type of request?

- `"GET"`, `"POST"`, `"PUT"`, `"DELETE"`, `"PATCH"`
- On which **port**
- Whether **inbound** or **outbound**
- Protocol (HTTP, gRPC, TCP)

---

### 3ï¸âƒ£ **Resources (where the request is going)**

This defines **which workload(s) the policy applies to**, using:

- Workload selectors (`matchLabels`)
- Namespace
- Inbound port
- Paths (HTTP)
- Methods
- Hosts

Example resource:

```yaml
to:
  - operation:
      methods: ["GET"]
      paths: ["/health", "/api/v1/data"]
```

---

## ðŸ“ AUTHORIZATION POLICY STRUCTURE

```yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: sample
  namespace: team-a
spec:
  selector:
    matchLabels:
      app: a-backend
  action: ALLOW # or DENY
  rules:
    - from:
        - source:
            principals: ["cluster.local/ns/team-b/sa/b-client"]
      to:
        - operation:
            methods: ["GET"]
            paths: ["/public"]
```

> ðŸš¨ if you don't specify a namespace in metadata, the policy applies to **all namespaces**

---

## ðŸŽ® Simple Example

"_Only team-bâ€™s client can access /data on a-backend._"

```yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: allow-team-b
  namespace: team-a
spec:
  selector:
    matchLabels:
      app: a-backend
  action: ALLOW
  rules:
    - from:
        - source:
            namespaces: ["team-b"]
      to:
        - operation:
            methods: ["GET"]
            paths: ["/data"]
```

If **this policy exists**, then **everything else is implicitly DENIED** unless you add another ALLOW rule.

---

## ðŸ§¨ Default Deny Mode

If you enable **Deny-by-Default**, Istio becomes fully Zero Trust:

```yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: deny-all
  namespace: team-a
spec: {}
```

This blocks _all traffic_ to workloads in `team-a` unless other ALLOW policies exist.

---

## ðŸ§ª Authorization Testing (How to Verify)

### Check applied policies:

```bash
kubectl get authorizationpolicies -A
```

### Check if traffic matches the rules:

Use Envoy debug logs:

```bash
kubectl logs deploy/a-backend -n team-a istio-proxy
```

Or test directly:

```bash
kubectl exec $POD -n team-b -- curl -v a-backend.team-a.svc.cluster.local:8080/api
```

You will see:

- `403 Forbidden` â†’ when authorization fails
- `200 OK` â†’ when allowed

---

## ðŸ†š Istio Authorization vs Kubernetes NetworkPolicy

Here's the clean, accurate comparison you need.

---

## âš–ï¸ Kubernetes NetworkPolicy = L3/L4 Firewall

Used for:

- âœ”ï¸ Allowing/blocking IPs
- âœ”ï¸ Blocking traffic between namespaces (network segmentation)
- âœ”ï¸ Blocking pods by label selectors
- âœ”ï¸ Only works for **L3/L4**
- âœ”ï¸ Based on **IP and ports**, NOT identities

NetworkPolicy CANNOT understand:

- Service accounts
- HTTP methods
- HTTP paths
- JWT tokens
- mTLS SPIFFE identities
- Specific APIs
- Directional allow/deny at L7
- Authorization logic
- Ingress gateway identity
- Calls within service mesh

---

## âš–ï¸ Istio Authorization = L7 Zero Trust Security

Used for:

- âœ”ï¸ Identity-based rules (service account, SPIFFE ID)
- âœ”ï¸ Namespace rules
- âœ”ï¸ HTTP method rules
- âœ”ï¸ Path-based rules
- âœ”ï¸ Allowing JWT-based user identities
- âœ”ï¸ Workload-level RBAC
- âœ”ï¸ L7-aware Deny/Allow
- âœ”ï¸ Works with mTLS
- âœ”ï¸ Works inside service mesh
- âœ”ï¸ Works across namespaces
- âœ”ï¸ Protects APIs, not ports

Istio knows:

- _â€œservice-b in namespace team-b is calling service-a using GET /dataâ€_
- Kubernetes only knows:
- _â€œIP 10.42.0.21 is accessing IP 10.42.1.14 on port 8080â€_

BIG difference.

---

## ðŸ§¨ The Key Differences (The Fast Table)

| Feature                      | Kubernetes NetworkPolicy | Istio AuthorizationPolicy           |
| ---------------------------- | ------------------------ | ----------------------------------- |
| Layer                        | L3/L4                    | L7 (HTTP/gRPC)                      |
| Identity-based rules         | âŒ No                    | âœ”ï¸ Yes (mTLS SPIFFE, namespace, SA) |
| HTTP methods                 | âŒ                       | âœ”ï¸                                  |
| HTTP paths                   | âŒ                       | âœ”ï¸                                  |
| mTLS awareness               | âŒ                       | âœ”ï¸                                  |
| JWT user authentication      | âŒ                       | âœ”ï¸ (with RequestAuthentication)     |
| Can block gRPC methods       | âŒ                       | âœ”ï¸                                  |
| Per-workload policy          | âš ï¸ Yes (via selectors)   | âœ”ï¸ Yes                              |
| Direction (inbound/outbound) | Limited                  | Full control                        |
| Works outside the mesh       | âœ”ï¸                       | âŒ Only inside mesh                 |
| Can apply deny-by-default    | âŒ                       | âœ”ï¸ Zero Trust mode                  |
| API-level firewall           | âŒ                       | âœ”ï¸                                  |

---

## ðŸ§ SUPER SHORT SUMMARY

### **K8s NetworkPolicy:**

> IP-based firewall. Basic. L3/L4 only.

### **Istio Authorization:**

> Identity-aware API firewall. Zero Trust. L7.

They are NOT competitors.
They are complementary:

- **NetworkPolicy** = cluster segmentation
- **Istio Authorization** = Zero Trust per workload/API
