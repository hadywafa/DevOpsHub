# üì¶ How Istio is installed

On Kubernetes, Istio is **just a bunch of Kubernetes resources** (CRDs, Deployments, DaemonSets, etc.).
You usually install it in one of two main ways:

1. **Using `istioctl` (Istio CLI)** ‚Üí one command, picks components for you based on a **profile**. ([Istio][1])
2. **Using Helm charts** ‚Üí more manual, but very GitOps-friendly and production-style. ([Istio][2])

And you choose _which dataplane_ you want:

- **Sidecar mode** (classic Envoy sidecars in each pod)
- **Ambient mode** (no sidecars; ztunnel + waypoints)

We‚Äôll cover both.

---

## üìñ What is `istioctl` (Istio CLI)?

`istioctl` is the **command-line tool for Istio**. It can: ([Istio][3])

- Install / uninstall Istio
- Validate your config
- Inspect proxies (Envoy), mesh status, traffic config
- Help with debugging

Install it (Linux/macOS example):

```bash
curl -sL https://istio.io/downloadIstioctl | sh -
export PATH="$HOME/.istioctl/bin:$PATH"
```

---

## üìÉ Istio profiles

**Profiles** = named presets of Helm values that define what to install and how.  
They exist for both **`istioctl` and Helm** and are shared. ([Istio][4])

### 1. Deployment profiles (most relevant ones)

From the docs: ([Istio][4])

- `default` ‚Üí **recommended for production sidecar** mode.
- `demo` ‚Üí for labs / learning; more logging & tracing; not for perf tests.
- `minimal` ‚Üí only control plane (`istiod`); no gateways.
- `remote` ‚Üí secondary cluster controlled by a primary mesh.
- `ambient` ‚Üí presets for **ambient mode** (ztunnel, CNI, etc.).
- `empty` ‚Üí installs nothing (base for custom setups).
- `preview` ‚Üí experimental features, not stable.

### 2. Platform profiles

These tune Istio to specific Kubernetes platforms: `gke`, `eks`, `openshift`, `minikube`, etc. ([Istio][4])

Example:

```bash
istioctl install \
  --set profile=default \
  --set values.global.platform=gke
```

---

## üìå Install Istio ‚Äì **Sidecar mode**

### üßëüèª‚Äçüíª Sidecar mode with `istioctl`

**Simplest command** ‚Äì default profile (sidecar mode):

```bash
istioctl install -y
# same as:
# istioctl install --set profile=default -y
```

This installs: `istiod`, CRDs, and default gateways for sidecar dataplane. ([Istio][1])

For learning/demo:

```bash
istioctl install --set profile=demo -y
```

You can verify:

```bash
istioctl verify-install
kubectl get pods -n istio-system
```

### ü™ñ Sidecar mode with Helm

Helm = more ‚Äúmanual‚Äù, but very production-friendly. ([Istio][2])

**Step 0 ‚Äì add Helm repo.**

```bash
helm repo add istio https://istio-release.storage.googleapis.com/charts
helm repo update
```

**Step 1 ‚Äì base CRDs.**

```bash
helm install istio-base istio/base \
  -n istio-system \
  --set defaultRevision=default \
  --create-namespace
```

**Step 2 ‚Äì control plane (`istiod`)**

```bash
helm install istiod istio/istiod \
  -n istio-system \
  --wait
```

**Step 3 ‚Äì optional ingress gateway.**

```bash
kubectl create namespace istio-ingress
helm install istio-ingress istio/gateway \
  -n istio-ingress \
  --wait
```

Now Istio is _installed_, but your apps are not yet in the mesh.

### ‚úÖ ‚ÄúEnable‚Äù sidecar mode for applications

Enabling sidecar mode = **turning on automatic sidecar injection**.

At **namespace level** (most common): ([Istio][5])

```bash
# enable sidecar injection for a namespace
kubectl label namespace default istio-injection=enabled

# check which namespaces are enabled
kubectl get ns -L istio-injection
```

After that:

- **New pods** in that namespace get an `istio-proxy` sidecar.
- Old pods must be **restarted** to get the sidecar.

Per-pod control:

- Force inject: `sidecar.istio.io/inject: "true"`
- Disable for a specific pod: `sidecar.istio.io/inject: "false"` ([Istio][5])

---

## üìå Install Istio ‚Äì **Ambient mode**

Ambient = no sidecars; instead:

- **ztunnel** DaemonSet on every node
- **Istio CNI** to redirect pod traffic
- Optional **waypoint** proxies for L7 stuff

### üßëüèª‚Äçüíª Ambient mode with `istioctl`

Docs show there is a built-in `ambient` deployment profile. ([Istio][4])

**Basic command:**

```bash
istioctl install --set profile=ambient -y
```

This typically installs:

- `istiod`
- CNI
- `ztunnel`
- (and the needed configs for ambient)

You can also mix in a platform profile:

```bash
istioctl install \
  --set profile=ambient \
  --set values.global.platform=eks \
  -y
```

### ü™ñ Ambient mode with Helm

Ambient Helm install is split clearly into control plane and data plane. ([Istio][6])

**Step 0 ‚Äì repo:**

```bash
helm repo add istio https://istio-release.storage.googleapis.com/charts
helm repo update
```

**Step 1 ‚Äì base CRDs:**

```bash
helm install istio-base istio/base \
  -n istio-system \
  --create-namespace \
  --wait
```

**Step 2 ‚Äì Kubernetes Gateway API CRDs (if needed):**

```bash
kubectl get crd gateways.gateway.networking.k8s.io &> /dev/null || \
  kubectl apply --server-side \
    -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.4.0/experimental-install.yaml
```

**Step 3 ‚Äì control plane (`istiod`) in ambient profile:**

```bash
helm install istiod istio/istiod \
  -n istio-system \
  --set profile=ambient \
  --wait
```

**Step 4 ‚Äì CNI node agent for ambient:**

```bash
helm install istio-cni istio/cni \
  -n istio-system \
  --set profile=ambient \
  --wait
```

**Step 5 ‚Äì ztunnel data plane:**

```bash
helm install ztunnel istio/ztunnel \
  -n istio-system \
  --wait
```

**Optional ‚Äì ingress gateway:**

```bash
helm install istio-ingress istio/gateway \
  -n istio-ingress \
  --create-namespace \
  --wait
```

Verify:

```bash
helm ls -n istio-system
kubectl get pods -n istio-system
```

You should see `istiod`, `istio-cni-node-*`, `ztunnel-*`, etc. ([Istio][6])

### ‚úÖ ‚ÄúEnable‚Äù ambient mode for applications

Ambient enablement is done via a **label**, not a sidecar. ([Istio][7])

To add a whole namespace to the ambient mesh:

```bash
kubectl label namespace default istio.io/dataplane-mode=ambient
```

To add only a specific pod:

```bash
kubectl label pod my-pod istio.io/dataplane-mode=ambient
```

Key points:

- No pod restart is required.
- Traffic to/from that pod goes via **ztunnel** and is secured with mTLS.
- For L7 (HTTP routing, retries, etc.) you add a **waypoint** and label things with `istio.io/use-waypoint`. ([Istio][8])

‚ö†Ô∏è Important: **Don‚Äôt use both** `istio-injection=enabled` and `istio.io/dataplane-mode=ambient` on the same namespace ‚Äì that‚Äôs asking for confusion. Docs recommend choosing one mode per namespace. ([Istio][9])

---

## üìù `istioctl` ‚Äì useful commands cheat sheet

You don‚Äôt need them all now; just recognize the main categories. ([Istio][3])

### 1. Installation / profiles

```bash
# Install default (sidecar) profile
istioctl install -y

# Install demo profile
istioctl install --set profile=demo -y

# Install ambient profile
istioctl install --set profile=ambient -y

# List profiles
istioctl profile list
```

### 2. Verification & general health

```bash
# Check installation against cluster
istioctl verify-install

# High-level proxy connectivity status
istioctl proxy-status

# Analyze cluster for Istio config issues
istioctl analyze

# Handy: tells you if a namespace isn't injected
# (IST0102 NamespaceNotInjected)
istioctl analyze -A
```

### 3. Inspect proxies (sidecar mode mostly)

```bash
# Show all proxy config summaries
istioctl proxy-config all <pod-name> -n <ns>

# Specific parts
istioctl proxy-config cluster <pod> -n <ns>
istioctl proxy-config listener <pod> -n <ns>
istioctl proxy-config route <pod> -n <ns>
istioctl proxy-config endpoints <pod> -n <ns>
```

### 4. Sidecar injection utilities

```bash
# Manually inject sidecar into a YAML (if not using auto injection)
istioctl kube-inject -f app.yaml | kubectl apply -f -

# Check how a pod would be injected
istioctl check-inject -f app.yaml
```

### 5. Ambient-specific helpers

```bash
# Generate a waypoint Gateway YAML
istioctl waypoint generate --for service -n default

# Apply a waypoint and enroll namespace
istioctl waypoint apply -n default --enroll-namespace

# Check waypoint status
istioctl waypoint status -n default
```

[1]: https://istio.io/latest/docs/setup/install/istioctl/?utm_source=chatgpt.com "Install with Istioctl"
[2]: https://istio.io/latest/docs/setup/install/helm/ "Istio / Install with Helm"
[3]: https://istio.io/latest/docs/ops/diagnostic-tools/istioctl/?utm_source=chatgpt.com "Using the Istioctl Command-line Tool"
[4]: https://istio.io/latest/docs/setup/additional-setup/config-profiles/ "Istio / Installation Configuration Profiles"
[5]: https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/?utm_source=chatgpt.com "Installing the Sidecar - Istio"
[6]: https://istio.io/latest/docs/ambient/install/helm/ "Istio / Install with Helm"
[7]: https://istio.io/latest/docs/ambient/architecture/data-plane/?utm_source=chatgpt.com "Ambient data plane"
[8]: https://istio.io/latest/docs/ambient/usage/waypoint/?utm_source=chatgpt.com "Configure waypoint proxies"
[9]: https://istio.io/latest/docs/ambient/usage/add-workloads/?utm_source=chatgpt.com "Add workloads to the mesh"
