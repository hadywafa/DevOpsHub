# ü¶Ö **Introduction to Falco**

_The Kubernetes Runtime Security Guard!_

---

Falco is an **open-source runtime security tool** originally created by Sysdig and now a **CNCF Graduated Project** (meaning: stable, mature, production-ready).

If Kubernetes security were a house:

- **Static scanners** (Trivy, Snyk, KICS, etc.) ‚Üí check the locks before the house is built
- **Falco** ‚Üí detects the thief _while they are inside the house_

That‚Äôs runtime security.
And Falco is the most widely used runtime security engine for Kubernetes.

---

<div align="center" style="background-color:#fff; border-radius: 10px; border: 2px solid">
<img src="https://kodekloud.com/kk-media/image/upload/v1752871681/notes-assets/images/Certified-Kubernetes-Security-Specialist-CKS-Falco-Overview-and-Installation/frame_90.jpg" alt="istio installation" style="width: 100%">
</div>

---

## üìñ **What Falco Is (CNCF Status & Purpose)**

### ‚úî **Falco = Runtime Threat Detection for Linux & Kubernetes**

It monitors your cluster **in real-time** and reports:

- Unexpected process executions
- Reverse shells inside pods
- Writing to sensitive files
- Privilege escalation
- Malware / crypto miners
- Kubernetes API abuse
- Pod exec attempts
- Suspicious network behavior
- Container escape attempts

### ‚úî CNCF Status

Falco is **a CNCF Graduated Project** (same maturity level as Kubernetes, Prometheus, Envoy).
It moved from:

- **Sandbox ‚Üí Incubating ‚Üí Graduated (2024)**

This means companies like:

- **Amazon, Microsoft, Sysdig, Datadog, Red Hat**
  use or support Falco.

---

## ‚öôÔ∏è **How Falco Works Internally (Syscalls, eBPF, Drivers)**

At the heart of Falco is a brilliant idea:

üëâ **Monitor every syscall happening inside the Linux kernel** in real-time, then match it against security rules.

### üîç Syscalls?

Syscalls are OS-level actions like:

- `execve()` ‚Üí run a process
- `setns()` ‚Üí change namespace (container escape!)
- `open()` ‚Üí read/write file
- `connect()` ‚Üí open network connection
- `chmod()` ‚Üí change file permissions

Falco does _not_ run inside your container ‚Äî it sits on the **node**, watching **everything**.

---

## üß© Falco Drivers (How Falco Captures Events)

Falco needs a mechanism to ‚Äútap into‚Äù syscalls. There are **3 driver modes**:

### 1Ô∏è‚É£ **Kernel Module Driver**

- Loads a kernel module
- Highest syscall visibility
- But requires kernel headers
- Can be painful in managed Kubernetes (EKS, GKE, AKS)

### 2Ô∏è‚É£ **eBPF Probe (Recommended)**

- Modern, safe, kernel-level tool
- No kernel module compilation needed
- Works well in cloud-managed K8s
- Best balance of **stability + performance**

### 3Ô∏è‚É£ **Userspace Instrumentation (Fallback)**

- Least powerful
- Almost never used

**Most production clusters today use the eBPF driver.**

---

## üß© **Falco Components**

Falco is made of several modules:

<div align="center">
<img src="https://www.padok.fr/hubfs/Images/Blog/falco_schema.webp" alt="istio installation" style="width: 100%; border-radius: 10px; border: 2px solid">
</div>

---

<div align="center" style="background-color: #141a19ff;color: #a8a5a5ff; border-radius: 10px; border: 2px solid">

| Component                      | Location         | Description                                                                  |
| ------------------------------ | ---------------- | ---------------------------------------------------------------------------- |
| **Kernel Module / eBPF Probe** | **Kernel space** | Captures syscalls directly from the Linux kernel.                            |
| **Sysdig Libraries**           | **User space**   | Translates raw kernel events into structured data Falco can understand.      |
| **Filter Expression Engine**   | **User space**   | Applies Falco rules to decide if an event is suspicious.                     |
| **Falco Rules**                | **User space**   | YAML-based rules that define what is considered suspicious or malicious.     |
| **Alerting Engine**            | **User space**   | Sends alerts to stdout, files, gRPC, shell scripts, or HTTP endpoints.       |
| **Web Server (optional)**      | **User space**   | Receives Kubernetes audit logs and metadata (if Falco is configured for it). |
| **Kubernetes Audit Logs**      | **External**     | Sent from the Kubernetes API server to Falco via webhook or file.            |
| **Kubernetes Metadata**        | **External**     | Pulled from the Kubernetes API server to enrich runtime events.              |

</div>

---

### üîÑ Data Flow Summary

1. **Kernel space**:

   - `eBPF probe` or `kernel module` hooks into syscalls.

2. **User space**:

   - `Sysdig libraries` decode events.
   - `Filter engine` applies `Falco rules`.
   - If matched, `Alerting engine` triggers outputs.

3. **Kubernetes integration**:
   - `Audit logs` are streamed to Falco (via webhook or file).
   - `Metadata` is fetched via API to enrich runtime events.

---

## üîé **Components in Detail**

### üîπ **1. Falco Engine**

- This is the ‚Äúbrain.‚Äù

- It:

  - Receives syscall events (or Kubernetes audit events)
  - Matches them against Falco rules
  - Applies filtering logic
  - Produces alerts

- Think of it as a **real-time event evaluation engine**.

---

### üîπ **2. Falco Rules**

- Rules define ‚Äúwhat is suspicious.‚Äù

- Example rule snippet:

  ```yaml
  condition: evt.type = execve and container.id != host
  output: "Process executed inside container"
  priority: WARNING
  ```

- Falco ships with hundreds of prebuilt rules for:

  - MITRE ATT&CK
  - Kubernetes
  - File system tampering
  - Network anomalies
  - Privilege escalation
  - Reverse shells

- You can **extend, modify, disable, or create your own rules**.

---

### üîπ **3. Falco Outputs**

Where Falco sends alerts.

Out of the box:

- Stdout
- Files
- Syslog

But when combined with **Falco Sidekick**, outputs become powerful.

---

### üîπ **4. Falco Sidekick (Optional but Highly Recommended)**

Falco Sidekick is like a **router for Falco alerts**.

It can forward events to 50+ destinations:

- Slack
- Teams
- Discord
- Kafka
- Elasticsearch
- Loki
- Prometheus
- AWS SNS
- Webhooks
- SIEM systems

It also has **Falco Sidekick UI** ‚Üí nice dashboard.

---

### üß© Bonus: Where You Configure Each

| Component            | Config Location                              |
| -------------------- | -------------------------------------------- |
| Kernel module / eBPF | Falco startup flags (`--kernel`, `--ebpf`)   |
| Falco rules          | `/etc/falco/falco_rules.yaml`                |
| Audit log source     | `/etc/falco/falco.yaml` (`audit_log_config`) |
| Metadata enrichment  | `/etc/falco/falco.yaml` (`k8s_api_config`)   |
| Alert outputs        | `/etc/falco/falco.yaml` (`outputs:` section) |

---

## ‚ùì **Why Falco Is Essential in Kubernetes**

Let‚Äôs compare:

| Security Type         | Tools                   | When it Works      | What it Covers                                         |
| --------------------- | ----------------------- | ------------------ | ------------------------------------------------------ |
| **Static Scanning**   | Trivy, Snyk, Checkov    | Before deploy      | Images, IaC, vulnerabilities                           |
| **Admission Control** | OPA/Gatekeeper, Kyverno | At deploy time     | Block bad YAML                                         |
| **Runtime Security**  | **Falco**               | After the pod runs | Behavior (syscalls, processes, network, K8s API calls) |

---

### üî• Falco catches what scanners cannot:

- A pod starting a reverse shell today
- Developer doing `kubectl exec` into production pod
- A compromised container trying to escape
- A crypto miner starting suddenly
- Someone escalating permissions using K8s API

### Static scanning ‚â† runtime protection

You can ship a clean Docker image...
‚Üí but if an attacker exploits a zero-day **at runtime**, scanning won't save you.

Falco **will**.

### Without Falco, Kubernetes is blind.

K8s does NOT provide runtime monitoring by default.

Falco gives you:

- ‚úî Visibility
- ‚úî Detection
- ‚úî Alerts
- ‚úî Part of compliance (PCI, SOC2, NIST)

---

## üîö **Summary**

What Falco is

- ‚úî CNCF maturity
- ‚úî How Falco captures syscalls
- ‚úî eBPF vs kernel driver
- ‚úî Falco engine, rules, outputs, Sidekick
- ‚úî Why runtime detection is mandatory
