# ğŸ“¦ **Installing Falco on Kubernetes**

## ğŸª– **1. Using Helm Chart** (Recommended)

Falco provides an official Helm repo maintained by the Falco community via CNCF.

### Add the repo:

```bash
helm repo add falcosecurity https://falcosecurity.github.io/charts
helm repo update
```

### Install Falco (default settings):

```bash
helm install falco falcosecurity/falco --namespace falco --create-namespace
```

This installs:

- A Falco **DaemonSet**
- The syscall capture driver
- The Falco rules
- Config files

---

## ğŸ“Œ **Choosing the Correct Driver: eBPF vs Kernel Module**

Falco needs a driver to capture syscall events.

Hereâ€™s how to choose:

| Environment                   | Recommended Driver    |
| ----------------------------- | --------------------- |
| EKS (Amazon Kubernetes)       | **eBPF**              |
| GKE (Google Kubernetes)       | **eBPF**              |
| AKS (Azure Kubernetes)        | **eBPF**              |
| On-prem bare metal            | Kernel module or eBPF |
| Nodes with custom/old kernels | Kernel module         |

### âœ” Install Falco with **eBPF driver**:

```bash
helm install falco falcosecurity/falco \
  --namespace falco --create-namespace \
  --set driver.kind=ebpf \
  --set ebpf.enabled=true
```

### Why eBPF?

- No kernel module building
- Stable on managed clusters
- Lower operational complexity
- Modern and secure

99% of companies use eBPF today.

---

## ğŸ“Œ **Enable Kubernetes Audit Log Monitoring**

Falco is strongest when it monitors:

1. **Linux syscalls**
2. **Kubernetes API events** â† many attacks occur here

Examples Falco detects through audit logs:

- `kubectl exec`
- Privileged pod creation
- RBAC changes
- Secret deletion
- Role/RoleBinding modifications
- API exploitation attempts

### Install audit webhook component:

```bash
helm install falco-auditing falcosecurity/falco \
  --namespace falco \
  --set auditLog.enabled=true
```

This deploys:

- A service that receives audit logs
- webhooks that the API server will send audit events to
- Additional Falco rules for K8s API security

### Configure API server (if self-managed)

Add this to your API server config:

```yaml
--audit-webhook-config-file=/etc/kubernetes/audit-webhook.yaml
--audit-policy-file=/etc/kubernetes/audit-policy.yaml
```

Managed clusters (EKS/GKE/AKS) already support audit logging via addons or extra configuration.

---

## ğŸ“Š **Installing Falco Sidekick (Highly Recommended)**

Falco Sidekick forwards outputs to:

- Slack
- Teams
- Discord
- Kafka
- SNS/SQS
- Elasticsearch
- Loki
- Prometheus metrics
- SIEM platforms

### Install Sidekick + UI:

```bash
helm install falco-sidekick falcosecurity/falco-sidekick \
  --namespace falco
```

### Install Sidekick UI:

```bash
helm install falco-sidekick-ui falcosecurity/falco-sidekick-ui \
  --namespace falco
```

This gives you a **dashboard UI** to view Falco alerts.

---

## ğŸ§ª **Validate Falco Installation**

### âœ” Check DaemonSet pods:

```bash
kubectl get pods -n falco -o wide
```

You should see _one pod per node_.

### âœ” Check logs:

```bash
kubectl logs -n falco daemonset/falco
```

Look for:

```ini
Successfully connected to eBPF probe
Rules loaded successfully
```

### âœ” Trigger a simple detection test:

Run a shell inside a pod:

```bash
kubectl run test --image=alpine -it -- sh
```

Inside the pod:

```sh
sh
```

Now check Falco logs:

```bash
kubectl logs -n falco ds/falco | grep shell
```

You should see something like:

```ini
Falco alert: Interactive shell spawned in container
```

This proves Falco is correctly capturing syscalls.

---

## âœ… **Production-Ready Installation Considerations**

### ğŸ“Œ 1. Avoid Kernel Module on Managed Kubernetes

- Use `driver.kind=ebpf`.

### ğŸ“Œ 2. Enable Persistent Rules

- Store custom rules in a ConfigMap.

### ğŸ“Œ 3. Forward Alerts to SIEM / Logging systems

- Use Sidekick â†’ Elasticsearch/Loki/Kafka/SNS.

### ğŸ“Œ 4. Tune default rules

- Disable noisy rules.
- Add cluster-specific rules (we will write them soon).

### ğŸ“Œ 5. Deploy in all clusters/environments

- Dev, Stage, Prod.

### ğŸ“Œ 6. GitOps for rule lifecycle

- Manage Falco configuration via ArgoCD/FluxCD.
